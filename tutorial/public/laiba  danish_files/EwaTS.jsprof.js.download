'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[29],{692:function(y,x,a){a.r(x);y={};a.r(y);a.d(y,"JsSelfProfilerManager",function(){return R});x={};a.r(x);var c=a(0),b=a(14),f=a(96),r=a(535),d=a(6),k=a(139),t=a(10),m=a(58),e=a(54),w=a(1),l=a(65);class u{constructor(U){this.lPk=U}getCustomProperties(U){const K=new Map;if(U.hasOwnProperty("startTimeInMs")&&U.hasOwnProperty("totalExecutionTimeInMs")){const F=U.startTimeInMs;U=this.lPk.retrieveSlowActionsBetweenTimeRange(F,
F+U.totalExecutionTimeInMs);K.set("actions",l.a.li(U))}return K}}Object(c.a)(u,"CallTreeCustomPropertiesRetriever",null,[76]);class n{constructor(){this.customProperties=new Map}addCustomProperty(U,K){this.customProperties.set(U,K)}getCustomProperties(){return this.customProperties}}Object(c.a)(n,"CustomPropertiesRetriever",null,[75]);class v{isFeatureEnabled(U,K){return w.EwaSettings.getBooleanFeatureGate(U,K)}}Object(c.a)(v,"ExcelFeatureChecker",null,[74]);class B{isProfilingEnabled(){return!0}}
Object(c.a)(B,"ExcelProfilingFeatureChecker",null,[73]);class z{constructor(U,K){this.tXj=U;this.vXj=K}onProfilerEvent(U){switch(U.eventId){case 1:this.tXj(w.EwaSettings.isChangeGateEnabled("OfficeVSO:6144046_KeepOldCollectedActions"));break;case 0:this.vXj();break;default:b.ULS.sendTraceTag(537155529,0,15,`JSCPUIJSCPUProfilerObserver.OnProfilerEvent: got unhandled profilerEventId ${U.eventId}`)}}}Object(c.a)(z,"JSCPUProfilerObserver",null,[72]);class C{constructor(){this.samplingIntervalInMs=0;this.idleIntervalInMs=
this.profilingIntervalInMs=this.maximumNumberOfSamplesToTake=null}}Object(c.a)(C,"JSCPUProfilerInitOptions",null,[]);class D{constructor(){this.profilerTraceLoggingChunkSize=this.shouldLogRawProfilerTrace=this.shouldRecordFrameCounts=this.shouldMakeSerializedCallTreesFullyReconstructible=this.shouldKeepQueryParamsInResourceURLs=this.shouldProcessProfileCapturedWhileUserIsIdle=this.shouldSendProfilesForDeobfuscationImmediately=this.canUseMultipleWebWorkers=this.shouldUseInMemoryLogger=this.featureEnabledChecker=
this.deObfuscationRequestQueryParamsRetriever=this.deObfuscationRequestBodyPropertiesRetriever=this.durationThresholdInMsToLogOperationData=this.shouldAlwaysLogOperationsData=this.shouldUseSendBeaconForSendingCallTrees=this.shouldSendAllCallTreesFromProfileInASingleRequest=this.frameTotalExecutionTimeFilteringThresholdInMs=this.shouldCompressSerializedCallTrees=this.shouldRecordExpandedTimeStamps=this.profilerTraceProcessingWebWorkerSourceURL=this.useMainEventLoopForProfilerTraceProcessing=this.shouldKeepSamplesOutsideOfProfilingInterval=
this.shouldProfilingStartInAHiddenDocument=this.shouldProcessProfileCapturedInAHiddenDocument=this.callTreeFilteringThresholdInMs=this.deObfuscationEndpoint=this.ulsInstance=this.buildVersion=this.appName=null}}Object(c.a)(D,"JSCPUProfilingPackageInitOptions",null,[]);var J=a(43);class W{filter(U){var K,F,I;const P=!J.a.instance.TTSI||(null===(K=U.serializedFrames[0])||void 0===K?void 0:K.startTimeInMs)<J.a.instance.G0k;K=(null===(F=U.propertyBag)||void 0===F?void 0:F.actions)&&"[]"!==U.propertyBag.actions;
U=0<(null===(I=U.serializedFrames[0])||void 0===I?void 0:I.totalExecutionTimeInMs);return P&&U||K}}Object(c.a)(W,"CallTreeCustomFilterer",null,[62]);var N=a(5),M=a(97),Q=a(9);Object(M.b)(N.zd,{yk:"singleton"})(()=>No(function*(){const [U,K]=yield Promise.all([M.a.resolve(N.Lb),M.a.resolve(N.yd),M.a.resolve(N.de)]);return new R(U,K,0)}));Object(M.b)(N.Ad,{yk:"singleton"})(()=>new R(Q.a.g7a,null,1));class R{constructor(U,K,F){this.eKa=this.sUg=this.fce=this.nsb=this.gce=this.Qug=this.Sug=null;this.h8j=
new Set([1,0]);b.ULS.sendTraceTag(537155528,0,50,"JsSelfProfilerManager.Ctor: creating new JsSelfProfilerManager");this.$=U;this.eKa=K;this.Laj();this.Kaj();this.Zrj=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingSampleIntervalInMs",16);this.profilingIntervalInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingWindowDurationInMs",1E4);this.mff=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilingIdleIntervalInMs",3E5);b.ULS.sendTraceTag(507593507,
0,50,`JsSelfProfilerManager: starting profiler: ${F.toString()}`);switch(F){case 1:this.aRk(w.EwaSettings.getIntFeatureGate("Microsoft.Office.ExcelOnline.JsProfilerOnBootMaximumProfilingDurationMs",6E4));this.$.ea.Bw(()=>{this.XRk()});break;case 0:this.W_j=w.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.ProfilerName",""),this.GQk()}}dispose(){b.ULS.sendTraceTag(537155527,0,50,"JsSelfProfilerManager.Dispose");f.a.Ng(this.sUg);this.fce=this.$=null;this.gce.clear();this.nsb.clear()}GQk(){const U=
Math.random()*this.mff;b.ULS.sendTraceTag(537155526,0,50,`JsSelfProfilerManager.Ctor: starting ContinuousSessionProfiler in: ${U}`);this.sUg=m.a.instance.create(()=>{this.VGf("ExcelOnlineContinuousSessionProfiler",2).start()},U,e.a.HFk,!0)}aRk(U){U=void 0===U?1E4:U;b.ULS.sendTraceTag(537155524,0,50,"JsSelfProfilerManager.StartManualProfiler: Starting a new profiler");this.VGf("BootProfiler",0,U).start()}XRk(){var U=this.AHf("BootProfiler");U&&U.stop()}Rug(U){return this.nsb.has(U)}createProfiler(U,
K,F,I,P,Y){b.ULS.sendTraceTag(537155521,0,50,"JsSelfProfilerManager.CreateProfiler: Creating a new profiler");const ea=new C;ea.samplingIntervalInMs=K;ea.maximumNumberOfSamplesToTake=F;ea.idleIntervalInMs=I;ea.profilingIntervalInMs=P;return this.X4h(U,Y,ea)}Kaj(){const U=new B,K=new D;K.ulsInstance=new r.a;K.deObfuscationEndpoint="ProfilerReporting.ashx";K.shouldCompressSerializedCallTrees=!1;K.shouldKeepSamplesOutsideOfProfilingInterval=!1;K.shouldSendAllCallTreesFromProfileInASingleRequest=!w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldSendEachCallTreeIndividuallyFromProfile",
!1);K.shouldUseSendBeaconForSendingCallTrees=w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldUseSendBeaconForSendingCallTrees",!1);K.callTreeFilteringThresholdInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerCallTreeFilteringThresholdInMs",-1);K.frameTotalExecutionTimeFilteringThresholdInMs=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.JsProfilerFrameTotalExecutionTimeFilteringThresholdInMs",-1);K.shouldRecordFrameCounts=!0;K.deObfuscationRequestQueryParamsRetriever=
this.I1h();K.deObfuscationRequestBodyPropertiesRetriever=this.H1h();K.featureEnabledChecker=new v;K.useMainEventLoopForProfilerTraceProcessing=!1;K.profilerTraceProcessingWebWorkerSourceURL=this.$.ua.JSProfilerProcessingWebWorkerJsScriptUrl;K.shouldProcessProfileCapturedWhileUserIsIdle=w.EwaSettings.isChangeGateEnabled("OfficeVSO:6144063_ShouldProcessProfileCapturedWhileUserIsIdle");w.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShouldLogRawProfilerTrace",!1)&&(K.shouldLogRawProfilerTrace=
!0,K.profilerTraceLoggingChunkSize=w.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ProfilerTraceLoggingChunkSize",30));this.fce=this.Sug.retrievePackage(U,K).retrieveProfilerFactory()}I1h(){const U=new n;U.addCustomProperty(t.a.Gvg,d.AFrameworkApplication.userType);U.addCustomProperty(d.AFrameworkApplication.$Pa,d.AFrameworkApplication.userSessionId);U.addCustomProperty(t.a.M4d,this.$.ua.SkipAuthentication?t.a.Hbg:null);U.addCustomProperty(t.a.Fce,this.$.ua.MachineCluster);return U}H1h(){const U=
new n;U.addCustomProperty("appName","Excel");U.addCustomProperty("buildVersion",d.AFrameworkApplication.buildVersion);U.addCustomProperty("shouldUseSourceMaps","true");U.addCustomProperty("shouldFilterSensitiveResources","true");U.addCustomProperty("shouldUseJSSelfProfilerSpecificDeobfuscator","false");return U}X4h(U,K,F){const I=new n;I.addCustomProperty("ProfilerName",U);this.Qug.set(U,I);K=this.fce.createProfiler(K,F,I);this.nsb.set(U,K);w.EwaSettings.A0a()||(U=this.f3h(U),K.subscribeProfilerObserver(U,
this.h8j));U=new W;K.subscribeCallTreeCustomFilterer(U);return K}AHf(U){return this.Rug(U)?this.nsb.get(U):(b.ULS.shipAssertTag(537155520,0,!1,`JsSelfProfilerManager.GetProfiler: Profiler with such name (${U}) does not exist`),null)}VGf(U,K,F){F=void 0===F?null:F;U=this.W_j||U;if(this.Rug(U))return this.AHf(U);const I=this.Zrj;return this.createProfiler(U,I,null!=F&&0<I?F/I:2E6,2===K?this.mff:null,0===K?null:this.profilingIntervalInMs,K)}f3h(U){var K=this.eKa;if(K){const F=K.Hif();if(F){K=this.nsb.get(U);
const I=new u(F);K.subscribeCallTreeCustomPropertiesRetriever(I);K=new z(P=>{F.startCollectingSlowActions(P)},Object(k.a)(F,F.stopCollectingSlowActions,"stopCollectingSlowActions"));this.gce.set(U,K);return K}b.ULS.sendTraceTag(537155491,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: CreateSlowActionsRetriever returned null");return null}b.ULS.sendTraceTag(537155490,0,15,"JsSelfProfilerManager.CreateInteractivityTrackerObserver: call to InteractivityTracker returned null");return null}Laj(){this.Sug=
officeOnlineCpuProfiling.getJSCPUProfilingPackageRetriever();this.Qug=new Map;this.gce=new Map;this.nsb=new Map}}Object(c.a)(R,"JsSelfProfilerManager",null,[41,2]);var O=a(897);Object(M.b)(N.de)(()=>No(function*(){w.EwaSettings.isChangeGateEnabled("OfficeVSO:8428325_ExtractChunkLoading")?yield Object(O.a)("officeOnlineCpuProfiling",{va:0}):yield M.a.resolve(N.Eb,{va:0}).then(U=>U("officeOnlineCpuProfiling"));return officeOnlineCpuProfiling}));window.jsprof=!0;String(y);String(x);window.___1708742503463_closurehack=
y;window.___1708742503463_closurehack=x},897:function(y,x,a){function c(d,k){k=void 0===k?{}:k;return b.AFrameworkApplication.fa.la("IsWebpack5RibbonEnabled")?runtime.loadChunk(d):f.a.resolve(r.Eb,k).then(t=>t(d))}a.d(x,"a",function(){return c});var b=a(6),f=a(97),r=a(5)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.jsprof.js.map/f10f72910a2e85341d8e61ee31a32115/EwaTS.jsprof.js.map