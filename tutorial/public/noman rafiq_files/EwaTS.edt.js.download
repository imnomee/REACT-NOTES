'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[3],{1004:function(y,x,a){a.r(x);a.d(x,"RelativeAndAbsoluteReferencesManager",function(){return D});y=a(0);var c=a(2),b=a(14);class f{}Object(y.a)(f,"Reference",null,[]);class r extends f{constructor(){super();this.column=this.row=null}}Object(y.a)(r,"CellReference",f,[]);class d{constructor(){this.end=this.start=0;this.oA=null}HEh(J,W){for(let N=0;N<this.oA.length;N++){const M=this.Llc(J,this.oA[N]);W+=M;N<this.oA.length-
1&&(W+=":")}return W}}Object(y.a)(d,"IReferenceSequence",null,[]);var k=a(26),t=a(981);class m extends d{constructor(){super();this.EKa=!1}xzc(){const {RelativeAndAbsoluteReferencesManager:J}=a(1004),W=this.oA[0];return J.ybg(W.row.kind===t.a.abs,W.column.kind===t.a.abs)}Llc(J,W){W=k.Range.gi(W.row.index+1,W.column.index+1);return this.EKa?W.Ayc(1===J||3===J,1===J||2===J):W.Sfa(1===J||3===J,1===J||2===J,!0,!0)}}Object(y.a)(m,"CellReferenceSequence",d,[]);class e extends f{constructor(){super();this.secondColumn=
this.firstColumn=null}}Object(y.a)(e,"ColumnReference",f,[]);class w extends d{constructor(){super()}xzc(){const J=this.oA[0];return a(1004).RelativeAndAbsoluteReferencesManager.B$f(J.firstColumn,J.secondColumn).kind===t.a.abs?2:3}Llc(J,W){return k.Range.f0(W.firstColumn.index+1,W.secondColumn.index+1).Sfa(1===J||3===J,!0,1===J||3===J,!0)}}Object(y.a)(w,"ColumnReferenceSequence",d,[]);class l extends f{constructor(){super();this.right=this.left=this.bottom=this.top=null}}Object(y.a)(l,"RangeReference",
f,[]);class u extends d{constructor(){super()}xzc(){const {RelativeAndAbsoluteReferencesManager:J}=a(1004),W=this.oA[0];return J.ybg(W.top.kind===t.a.abs,W.left.kind===t.a.abs)}Llc(J,W){W=new k.Range(W.top.index+1,W.left.index+1,W.bottom.index+1,W.right.index+1,!1,!1);const N=1===J||3===J;J=1===J||2===J;return W.Sfa(N,J,N,J)}}Object(y.a)(u,"RangeReferenceSequence",d,[]);class n extends f{constructor(){super();this.secondRow=this.firstRow=null}}Object(y.a)(n,"RowReference",f,[]);class v extends d{constructor(){super()}xzc(){const J=
this.oA[0];return a(1004).RelativeAndAbsoluteReferencesManager.B$f(J.firstRow,J.secondRow).kind===t.a.abs?0:1}Llc(J,W){return k.Range.AX(W.firstRow.index+1,W.secondRow.index+1).Sfa(!0,1===J||2===J,!0,1===J||2===J)}}Object(y.a)(v,"RowReferenceSequence",d,[]);var B=a(1185),z=a(1066),C=a(163);class D{constructor(J){this.Ej=J}Cgb(J,W,N){let M,Q;M=W;Q=N;if(!J||!C.f(J))return{returnValue:J,F4d:M,E4d:Q};var R=this.Ej.VDd(J);if(!R)return b.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,F4d:M,E4d:Q};R=this.XTi(R,J,W,N);let O=0,U="",K=0,F=0;for(;F<R.length;F++)if(this.snf(R[F],W,N)){O=R[F].xzc();M=R[F].start;break}for(;F<R.length&&this.snf(R[F],W,N);F++)U+=J.substring(K,R[F].start),U=R[F].HEh(O,U),K=R[F].end;K&&(Q=U.length);U+=J.substring(K,J.length);return{returnValue:U,F4d:M,E4d:Q}}XTi(J,W,N,M){const Q=[];for(let K=0;K<J.length;K++){var R=J[K];if(R.kind===B.a.range)if(R=R.ref,R.type===z.a.cell){var O=R;R=Object(c.a)(new m,{start:R.span.start,end:R.span.end,oA:[Object(c.a)(new r,
{column:O.col,row:O.row})],EKa:this.Ej.CVa(R.span.end,W)});Q.push(R)}else if(R.type===z.a.range)this.tnf(R.topLeftSpan,N,M)&&this.tnf(R.bottomRightSpan,N,M)?(O=new l,R.top.index<=R.bottom.index?(O.top=R.top,O.bottom=R.bottom):(O.bottom=R.top,O.top=R.bottom),R.left.index<=R.right.index?(O.left=R.left,O.right=R.right):(O.right=R.left,O.left=R.right),R=Object(c.a)(new u,{start:R.topLeftSpan.start,end:R.bottomRightSpan.end,oA:[O]}),Q.push(R)):(O=Object(c.a)(new m,{start:R.topLeftSpan.start,end:R.topLeftSpan.end,
oA:[Object(c.a)(new r,{column:R.left,row:R.top})],EKa:this.Ej.CVa(R.topLeftSpan.end,W)}),R=Object(c.a)(new m,{start:R.bottomRightSpan.start,end:R.bottomRightSpan.end,oA:[Object(c.a)(new r,{column:R.right,row:R.bottom})],EKa:this.Ej.CVa(R.topLeftSpan.end,W)}),Q.push(O),Q.push(R));else if(R.type===z.a.column){O=R;for(R=Object(c.a)(new w,{start:R.span.start,end:R.span.end,oA:[Object(c.a)(new e,{firstColumn:O.startIndex,secondColumn:O.endIndex})]});R.end<W.length-1&&":"===W.charAt(R.end)&&K<J.length-
1;)if(O=J[K+1].ref,O.type===z.a.column&&O.span.start===R.end+1){var U=O;R.oA.push(Object(c.a)(new e,{firstColumn:U.startIndex,secondColumn:U.endIndex}));R.end=O.span.end;K++}else break;Q.push(R)}else if(R.type===z.a.row){O=R;for(R=Object(c.a)(new v,{start:R.span.start,end:R.span.end,oA:[Object(c.a)(new n,{firstRow:O.startIndex,secondRow:O.endIndex})]});R.end<W.length-1&&":"===W.charAt(R.end)&&K<J.length-1;)if(O=J[K+1].ref,O.type===z.a.row&&O.span.start===R.end+1)U=O,R.oA.push(Object(c.a)(new n,{firstRow:U.startIndex,
secondRow:U.endIndex})),R.end=O.span.end,K++;else break;Q.push(R)}}return Q}snf(J,W,N){return!(J.start>N||W>J.end)}tnf(J,W,N){return!(J.start>N||W>J.end)}static B$f(J,W){return J.index<=W.index?J:W}static ybg(J,W){return W||J?W&&J?2:!W&&J?3:0:1}}Object(y.a)(D,"RelativeAndAbsoluteReferencesManager",null,[754])},1027:function(y,x,a){a.d(x,"h",function(){return k});a.d(x,"g",function(){return m});a.d(x,"f",function(){return e});a.d(x,"b",function(){return w});a.d(x,"c",function(){return l});a.d(x,"e",
function(){return u});a.d(x,"d",function(){return n});a.d(x,"a",function(){return B});y=a(0);var c=a(13),b=a(483),f=a(14),r=a(1362),d=a(27);const k=(D,J,W,N)=>{const M={["flowId"]:D.flowId,["originFormulaFlowId"]:D.JY.flowId,["formulaAnonymized"]:D.anonymizedFormula,["originalFormulaAnonymized"]:D.JY.anonymizedFormula,["range"]:D.range,["failureReason"]:J,["isTableSuggestion"]:Object(r.b)(D)};f.ULS.sendTraceTag(221794372,306,20,`FormulaByExample suggestion display failure reported. Failure data ${JSON.stringify(M)}`);
W&&W.Cv(D.flowId,N,{reason:J})};var t;(function(D){D.EXAMPLE="EXAMPLE";D.MODIFIEDEXAMPLE="MODIFIEDEXAMPLE";D.RESTOFRANGE="RESTOFRANGE";D.MODIFIEDRESTOFRANGE="MODIFIEDRESTOFRANGE"})(t||(t={}));Object(y.b)("suggestionCellType",t);const m=(D,J,W,N,M,Q,R,O,U,K)=>{D={["failureReason"]:D,["flowId"]:Q.flowId,["cellType"]:R,["caller"]:M,["formulaAnonymized"]:Q.anonymizedFormula,["originalCellText"]:d.a.f_(J),["evalFormulaText"]:d.a.f_(W),["cellFormatIndex"]:N,["isOriginalValueMatchCellValue"]:O,["isTableSuggestion"]:Object(r.b)(Q),
["originalNumFmt"]:U?{["Start"]:d.a.f_(U.Start),["Separator"]:d.a.f_(U.Separator),["End"]:d.a.f_(U.End)}:null,["evalNumFmt"]:K?{["Start"]:d.a.f_(K.Start),["Separator"]:d.a.f_(K.Separator),["End"]:d.a.f_(K.End)}:null};f.ULS.sendTraceTag(84165388,0,20,`FormulaByExample CloneEval mismatch failure reported. Failure data ${JSON.stringify(D)}`)},e=(D,J,W)=>{try{const N=z(D,J,W);window.performance.mark(N)}catch(N){f.ULS.sendTraceTag(529109767,0,10,`FormulaByExampleTelemetryGenerator.markPerformancePoint: Error thrown : ${N.message}`)}},
w=D=>{for(const J in v)try{window.performance.clearMarks(z(J,D,!1)),window.performance.clearMarks(z(J,D,!0))}catch(W){f.ULS.sendTraceTag(527005662,0,10,`FormulaByExampleTelemetryGenerator.clearPerformanceFlowMarks: Error thrown : ${W.message}`)}},l=D=>C(`FBE_flowCurrentDuration_${D}`,z(v.EditCommit,D,!1)),u=(D,J)=>{try{return{["EditCommitToSignal"]:C(`FBE_EditCommitToSignal_${J}_${D}`,z(v.EditCommit,J,!1),z(v.SignalSent,J,!1)),["WorkflowAndNetworkTime"]:D?0:C(`FBE_WorkflowAndNetworkTime_${J}_${D}`,
z(v.SignalSent,J,!1),z(v.AnnotationReceived,J,!1)),["Calculation"]:C(`FBE_Calculation_${J}_${D}`,z(v.CalculationStart,J,D),z(v.CalculationEnd,J,D)),["ModelUpdate"]:C(`FBE_ModelUpdate_${J}_${D}`,z(v.CalculationEnd,J,D),z(v.ModelUpdated,J,D)),["PreviewRender"]:C(`FBE_PreviewRendered_${J}_${D}`,z(v.ModelUpdated,J,D),z(v.PreviewRendered,J,D)),["Total"]:C(`FBE_Total_${J}_${D}`,z(v.EditCommit,J,!1),z(v.PreviewRendered,J,D))}}catch(W){f.ULS.sendTraceTag(529109766,0,50,`FormulaByExampleTelemetryGenerator.getPreviewShownDurations: Error thrown : ${W.message}`)}},
n=(D,J)=>{try{return{["UserInPreviewDuration"]:C(`FBE_InputToPreviewRemovedWithCSE_${J}_${D}`,z(v.PreviewRendered,J,D),z(v.UserInputArrived,J,D)),["InputToPreviewRemovedWithCSE"]:C(`FBE_InputToPreviewRemovedWithCSE_${J}_${D}`,z(v.UserInputArrived,J,D),z(v.PreviewRemovedWithCSE,J,D))}}catch(W){f.ULS.sendTraceTag(529109765,0,10,`FormulaByExampleTelemetryGenerator.getPreviewRemovedDurations: Error thrown : ${W.message}`)}};var v;(function(D){D.EditCommit="EDITCOMMIT";D.SignalSent="SIGNALSENT";D.AnnotationReceived=
"ANNOTATIONRECEIVED";D.CalculationStart="CALCULATIONSTART";D.CalculationEnd="CALCULATIONED";D.ModelUpdated="MODELUPDATED";D.PreviewRendered="PREVIEWRENDERED";D.UserInputArrived="USERINPUTARRIVED";D.PreviewRemovedWithCSE="PREVIEWREMOVEDWITHCSE"})(v||(v={}));Object(y.b)("FormulaByExampleFlowMarks",v);const B=D=>c.HelperMethods.drd&&b.a.aVa&&D.tKa(),z=(D,J,W)=>`${D}_${J+(W?"_cached":"")}`,C=(D,J,W)=>{const N=window.performance.measure(D,J,W);if(N)return J=N.duration,performance.clearMeasures(D),J;f.ULS.sendTraceTag(526984791,
0,15,`FormulaByExampleTelemetryGenerator.measureTime: could not find performance entry for measure: ${D}, startMark: ${J}, endMark: ${W}`);return-1}},1050:function(y,x,a){a.d(x,"b",function(){return-1});a.d(x,"a",function(){return C});y=a(0);var c=a(14),b;(function(N){N[N.UserEditedInTable=0]="UserEditedInTable";N[N.FormulaByExampleNoTrigger=1]="FormulaByExampleNoTrigger";N[N.FlowInterrupted=2]="FlowInterrupted";N[N.FormulaByExampleFullTrigger=3]="FormulaByExampleFullTrigger";N[N.HadCachedSuggestion=
4]="HadCachedSuggestion";N[N.NoCachedSuggestion=5]="NoCachedSuggestion";N[N.PreCalcPreviewRejected=6]="PreCalcPreviewRejected";N[N.WaitingForCalcResult=7]="WaitingForCalcResult";N[N.PostCalcPreviewRejected=8]="PostCalcPreviewRejected";N[N.SuggestionDidntMatch=9]="SuggestionDidntMatch";N[N.SuggestionMatched=10]="SuggestionMatched";N[N.PreviewShouldBeShown=11]="PreviewShouldBeShown";N[N.SignalSent=12]="SignalSent";N[N.NoSignalSent=13]="NoSignalSent";N[N.AnnotationReceived=14]="AnnotationReceived";N[N.NoFormulaFound=
15]="NoFormulaFound";N[N.FormulaFound=16]="FormulaFound";N[N.WorkbookClosed=17]="WorkbookClosed";N[N.UnexpectedTransition=18]="UnexpectedTransition"})(b||(b={}));Object(y.b)("FormulaByExampleFlowState",b);const f=new Map([[b.UserEditedInTable,[b.FormulaByExampleNoTrigger,b.FormulaByExampleFullTrigger]],[b.FormulaByExampleFullTrigger,[b.FlowInterrupted,b.NoCachedSuggestion,b.HadCachedSuggestion]],[b.NoCachedSuggestion,[b.NoSignalSent,b.SignalSent]],[b.HadCachedSuggestion,[b.PreCalcPreviewRejected,
b.WaitingForCalcResult]],[b.PreCalcPreviewRejected,[b.NoSignalSent,b.SignalSent]],[b.WaitingForCalcResult,[b.NoSignalSent,b.SignalSent]]]),r=new Set([b.FormulaByExampleNoTrigger,b.FlowInterrupted,b.NoSignalSent,b.SignalSent]),d=new Map([[b.PreCalcPreviewRejected,[b.SuggestionDidntMatch,b.SuggestionMatched]]]),k=new Set([b.SuggestionDidntMatch,b.SuggestionMatched]),t=new Map([[b.WaitingForCalcResult,[b.PostCalcPreviewRejected,b.SuggestionDidntMatch,b.SuggestionMatched]],[b.SuggestionDidntMatch,[b.PostCalcPreviewRejected,
b.PreviewShouldBeShown]],[b.SuggestionMatched,[b.PostCalcPreviewRejected,b.PreviewShouldBeShown]]]),m=new Set([b.PostCalcPreviewRejected,b.PreviewShouldBeShown]),e=new Map([[b.SignalSent,[b.AnnotationReceived]],[b.AnnotationReceived,[b.NoFormulaFound,b.FormulaFound]],[b.FormulaFound,[b.PreCalcPreviewRejected,b.WaitingForCalcResult]]]),w=new Set([b.NoFormulaFound,b.FormulaFound]),l=new Set([b.NoFormulaFound,b.PreCalcPreviewRejected,b.WaitingForCalcResult]);var u;(function(N){N[N.Initial=0]="Initial";
N[N.Pending=1]="Pending";N[N.Resolved=2]="Resolved"})(u||(u={}));Object(y.b)("SignalState",u);var n=a(1);class v{constructor(N,M,Q){this.currentState=N;this.ARk=M;this.cui=Q}FHa(N){const M=this.ARk.get(this.currentState);return M&&M.includes(N)?(this.currentState=N,!0):!1}get isActive(){return!this.cui.has(this.currentState)}gMd(){return b[this.currentState]}}Object(y.a)(v,"FormulaByExampleStateMachine",null,[]);class B{constructor(N,M,Q,R,O,U){this.YOj=U;this.QOc=new v(0,f,r);this.yfa={flowId:N,
EVh:M,rowNumber:Q,uZ:R,ELc:null,Rxf:!1,Xle:!1,e7a:0,HU:O,Sxf:{},iaf:new Set}}get e7a(){return this.yfa.e7a}set flowId(N){this.yfa.flowId=N}sMc(N){this.yfa.iaf.add(N)}FHa(N,M){17===N?this.Hka():(this.Cuc(N,M),this.GCh())}Hka(){this.YOj(this.yfa)}Cuc(N,M){var Q,R;this.QOc.FHa(N)?this.nUj(N):(null===(Q=this.Geb)||void 0===Q?0:Q.FHa(N))?this.VKj(N):(null===(R=this.aYc)||void 0===R?0:R.FHa(N))?this.eXj(N,M):this.qSj(N,M);(N=this.WFf(N))&&this.f_e(N,M)}nUj(N){switch(N){case 2:this.yfa.Rxf=!0;break;case 6:this.Geb=
new v(N,d,k);break;case 7:this.Geb=new v(N,t,m);break;case 12:this.yfa.e7a=1,this.aYc=new v(N,e,n.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer")?l:w)}}VKj(N){switch(N){case 9:this.yfa.Xle=!1;break;case 10:this.yfa.Xle=!0}}eXj(N,M){switch(N){case 14:this.yfa.e7a=2;break;case 16:this.yfa.ELc=M?M.ELc:null;break;case 7:this.Geb=new v(N,t,m)}}qSj(N,M){this.f_e(this.WFf(18),{reason:`${`Tried to change state from ${this.rxk()} to ${b[N]}`}.${this.MHf(M)}`});
this.Hka()}GCh(){var N,M;this.QOc.isActive||(null===(N=this.Geb)||void 0===N?0:N.isActive)||(null===(M=this.aYc)||void 0===M?0:M.isActive)||this.Hka()}f_e(N,M){if(M=this.MHf(M))N.explanation||(N.explanation=""),N.explanation+=M;M=Object.assign({},N);N=N.name;M=(delete M.name,M);this.yfa.Sxf[N]=M}MHf(N){return null!=N&&null!=N.reason?" "+N.reason:""}rxk(){var N,M;const Q=`OriginStateMachine: ${this.QOc.isActive?this.QOc.gMd():"NotActive"}`,R=`CalcStateMachine: ${(null===(N=this.Geb)||void 0===N?0:
N.isActive)?this.Geb.gMd():"NotActive"}`;N=`SignalStateMachine: ${(null===(M=this.aYc)||void 0===M?0:M.isActive)?this.aYc.gMd():"NotActive"}`;return`[${Q}, ${R}, ${N}]`}WFf(N){switch(N){case 1:return this.c4("FBEFullTrigger",!1);case 3:return this.c4("FBEFullTrigger",!0);case 5:return this.c4("CachedSuggestion",!1);case 4:return this.c4("CachedSuggestion",!0);case 6:return this.c4("PreviewShouldBeShown",!1,"Before calling calc evaluation");case 8:return this.c4("PreviewShouldBeShown",!1,"After returning from Calc");
case 9:return this.c4("SetCellMatchedSuggestion",!1);case 10:return this.c4("SetCellMatchedSuggestion",!0);case 11:return this.c4("PreviewShouldBeShown",!0);case 8:return this.c4("PreviewShouldBeShown",!1,"After returning from Calc");case 15:return this.c4("FormulaFound",!1);case 16:return this.c4("FormulaFound",!0);case 18:return this.c4("UnexpectedTransition",!0)}return null}c4(N,M,Q){return Q?{name:N,value:M,explanation:Q}:{name:N,value:M}}}Object(y.a)(B,"FormulaByExampleFlowDataAggregator",null,
[]);var z=a(940);class C{static getInstance(N){this.instance||(n.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")?this.instance=D.getInstance(N):this.instance=W.getInstance(N));return this.instance}}Object(y.a)(C,"FormulaByExampleFlowsTrackerFactory",null,[]);class D{constructor(N){this.nextId=1;this.NSf=this.V8b=0;this.U4=new Map;this.hte=new Map;this.mdf=new Map;this.Li=()=>{const M=this.kQi();if(0!==M.size){this.xh.sendBeaconTraceTag(526984790,50,!1,`some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: ${this.V8b}, Unresolved flows amount: ${M.size}, pending flows: ${[...M].join()}, interrupted flows amount ${this.NSf}`);
for(const Q of M)this.Cv(Q,17)}};this.hTk=M=>{const Q=M.flowId;var R=M.EVh;const O=M.rowNumber,U=M.uZ,K=M.ELc,F=M.Rxf,I=M.Xle,P=M.e7a,Y=M.Sxf,ea=M.iaf,Ba=M.HU,Fa=this.RGf(R);M=Fa.nya;const za=M!==K;za&&(Fa.ZVg++,Fa.nya=K);I&&Fa.vof++;F&&this.NSf++;2===P&&this.V8b++;R={["flowId"]:Q,["columnKey"]:R,["rowNumber"]:O,["triggerCommand"]:z.a.hId(U),["flowDataAggergation"]:Y,["editOperationsInColumn"]:Fa.mof,["suggestionChangesInColumn"]:Fa.ZVg,["gotNewSuggestion"]:za,["matchedSuggestionsInColumn"]:Fa.vof,
["cellCycleColumns"]:Array.from(ea).sort(),["rowsEditedInColumn"]:Array.from(Fa.sof).sort(),["isInExplicitTable"]:Ba};c.ULS.sendTraceTag(512365781,0,null!=M||null!=K?20:50,`FormulaByExampleFlowsTracker.summarizeFlowOverallData: Flow Aggregation results: ${JSON.stringify(R)}`);this.U4.set(Q,void 0)};this.xh=N;N.Lp(this.Li);this.xle=new J}static getInstance(N){D.instance||(D.instance=new D(N));return D.instance}oGf(){const N=this.nextId++,M=this.U4.get(-1);M?(M.flowId=N,this.U4.set(N,M),this.U4.delete(-1)):
c.ULS.sendTraceTag(512503829,0,15,`FormulaByExampleFlowsTracker.getNewFlowId: on flowId ${N} called getNewFlowId without having matched anonymousFlow`);return N}lWf(N){const M=this.U4.has(N),Q=this.U4.get(N),R=Q&&1===Q.e7a;let O;M?Q?R||(O="The flow exists but is not pending for annotation"):O="Flow was resolved already":O="This flow does not exist";O&&c.ULS.sendTraceTag(509650145,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: flow is not pending for annotation. ${O} flowId: ${N}`);
return R}ang(N,M,Q,R){this.U4.get(-1)&&(this.Cv(-1,2),this.U4.delete(-1));const O=this.RGf(N);O.mof++;O.sof.add(M);this.U4.set(-1,new B(-1,N,M,R,Q,this.hTk))}pgg(N,M,Q,R){M=this.Exc(M,Q);this.ang(M,R,!0,N)}qgg(N,M,Q,R,O){M=this.cPb(M,Q,O);this.ang(M,R,!1,N)}sMc(N,M){const Q=this.U4.get(N);Q?Q.sMc(M):this.NDg("onCellCycleFound",N)}Cv(N,M,Q){const R=this.U4.get(N);R?R.FHa(M,Q):this.NDg("notifyFlowReachedState",N,M)}Exc(N,M){let Q=this.hte.get(N);void 0===Q&&(Q=this.hte.size,this.hte.set(N,Q));return Q+
"_"+M}cPb(N,M,Q){return this.RAf(N,Q,M)}SAf(N,M){return this.RAf(N,M)}RAf(N,M,Q){let R;const O=this.xle.$Vi(M);O?O.find((U,K)=>{R=K;return U.yi(N)})||(this.xle.H_e(M,N),R=O.length-1):(R=0,this.xle.H_e(M,N));return`${M}_${R}${Q?`_${Q}`:""}`}kQi(){const N=new Set;for(const M of this.U4){const [Q,R]=M;1===(null===R||void 0===R?void 0:R.e7a)&&N.add(Q)}return N}RGf(N){let M=this.mdf.get(N);M||(M={mof:0,vof:0,ZVg:0,nya:null,sof:new Set},this.mdf.set(N,M));return M}NDg(N,M,Q){const R=this.U4.has(M);c.ULS.sendTraceTag(509678805,
0,15,`FormulaByExampleFlowsTracker.${N}:
       on flowId ${M} ${Q?` transition to ${b[Q]}`:""}, `+"flowIdsToAggregatorsMap didn't find the requested flowAggregatoror. "+`Did flow exist: ${R}`)}}Object(y.a)(D,"FormulaByExampleFlowsTracker",null,[768]);class J{constructor(){this.NZc=new Map}H_e(N,M){this.NZc.has(N)||this.NZc.set(N,[]);this.NZc.get(N).push(M)}$Vi(N){return this.NZc.get(N)}}Object(y.a)(J,"SensedTablesHeatMap",null,[]);class W{constructor(N){this.nextId=1;this.pOb=new Set;this.V8b=0;this.Li=()=>{const M=this.pOb.size;0!==M&&
this.xh.sendBeaconTraceTag(526984790,50,!1,"some pending FBE flows were not resolved by workbook closure. Total flows amount in sessions: {0}, Unresolved flows amount: {1}, pending flows: {2}",this.V8b,M,[...this.pOb].join())};this.xh=N;this.xh.Lp(this.Li)}static getInstance(N){W.instance||(W.instance=new W(N));return W.instance}lWf(N){return this.pOb.has(N)}pgg(){}qgg(){}sMc(){}Exc(){return null}cPb(){return null}SAf(){return null}Cv(N,M){switch(M){case 12:this.$zk(N);break;case 14:this.aAk(N)}}oGf(){return this.nextId++}$zk(N){this.pOb.add(N);
this.V8b++}aAk(N){this.pOb.delete(N)}}Object(y.a)(W,"FormulaByExampleFlowsTrackerDeprecated",null,[768])},1087:function(y,x,a){a.d(x,"b",function(){return"<<<FBE_XL_RW>>>"});a.d(x,"a",function(){return c});y=a(0);a=a(1227);class c extends a.a{constructor(b,f,r,d){super(b,f,r,d);this.kind="Range";this.qDa=d.headerRow;this.gx=d.gx;this.VUb=d.xM}get formula(){const b=super.formula;return b?b.replace(RegExp("<<<FBE_XL_RW>>>","g"),`${this.originCell.top}`):null}get oGd(){return super.formula}get VUb(){return this.dkh}set VUb(b){this.dkh=
b}get gx(){return this.dqh}set gx(b){this.dqh=b}get headerRow(){return this.qDa}}Object(y.a)(c,"FormulaByExampleRangeSuggestion",a.a,[])},1088:function(y,x,a){a.d(x,"a",function(){return 2})},1159:function(y,x,a){a.d(x,"b",function(){return f});a.d(x,"c",function(){return d});a.d(x,"a",function(){return k});y=a(0);var c;(function(t){t.accept="ACCEPT";t.undo="UNDO";t.decline="DECLINE";t.ignore="IGNORE";t.unseen="UNSEEN"})(c||(c={}));Object(y.b)("PreviewOutcome",c);var b;(b||(b={})).unseen="UNSEEN";
Object(y.b)("EntryState",b);const f=Object.assign({},b,c);class r{constructor(t){this.state=f.unseen;this.J4b=0;this.suggestion=t}Z7i(){this.J4b+=1}}Object(y.a)(r,"SuggestionEntryInternal",null,[]);class d extends Map{oea(t){const m=this.ZIa(t);if(!m)return null;let e=this.get(m);e||(e=[],this.set(m,e));t=new r(t);e.push(t);return t}Qgb(t){t=this.iQb(t);return this.A$h(t)}A$h(t){if(t){var m=this.ZIa(t.suggestion);m=this.get(m);m.splice(m.indexOf(t));return!0}return!1}P2g(t){const m=this.iQb(t);return this.zxe(m,
t)}zxe(t,m){t&&(t.suggestion=m);return t}}Object(y.a)(d,"SuggestionsCache",Map,[]);class k extends d{IIi(t){var m;return null===(m=super.get(t))||void 0===m?void 0:m[0]}iQb(t){return(t=this.ZIa(t))?this.has(t)?this.get(t)[0]:null:null}oea(t){const m=this.ZIa(t);if(!m)return null;t=new r(t);this.set(m,[t]);return t}Qgb(t){return(t=this.ZIa(t))?this.delete(t):!1}}Object(y.a)(k,"SingularSuggestionsCache",d,[])},1227:function(y,x,a){a.d(x,"a",function(){return f});y=a(0);x=a(1228);var c=a(14),b=a(26);
class f extends x.a{constructor(r,d,k,t){super();this.F9c=null;this.CQe=!1;Object.assign(this,d);this.xh=r;this.VIe=k;t&&(this.Uab=t.POc,this.rgh=t.valueType,this.zhd=t.sheetId,this.CQe=t.jkj);this.JY={flowId:this.flowId,$D:this.$D,originCell:this.originCell,anonymizedFormula:this.anonymizedFormula}}set Mxi(r){this.F9c=r}set flowId(r){this.VIe=r}get flowId(){return this.VIe}get formula(){var r;if(this.F9c)return this.F9c;void 0===this.mDa&&(this.mDa=null===(r=this.generatedFormula)||void 0===r?void 0:
r.formula)&&"="!==this.mDa.charAt(0)&&(c.ULS.sendTraceTag(509620492,306,50,"FormulaByExampleSuggestion.formula: appending = sign as formula prefix."),this.mDa=`=${this.mDa}`);return this.mDa}set $D(r){this.N8c=r}get qDd(){return this.rows}get L9h(){return this.rgh}get anonymizedFormula(){var r;void 0===this.hdc&&(this.hdc=null===(r=this.generatedFormula)||void 0===r?void 0:r.anonymizedFormula);return this.hdc}get sheetId(){return this.zhd}get $D(){void 0===this.N8c&&(this.N8c=this.qDd.length);return this.N8c}set originCell(r){this.Uab=
r}get originCell(){void 0===this.Uab&&(c.ULS.sendTraceTag(509620491,306,10,`FormulaByExampleSuggestion.originCell: origin cell is not defined - falling back to first cell of annotation range. flowId: ${this.flowId}`),this.Uab=b.Range.gi(this.qDd[0],this.column));return this.Uab}get range(){return new b.Range(this.gx.top,this.Uab.left,this.gx.bottom,this.Uab.left,!0,!0)}get JTj(){return this.CQe}NVf(r){return r.yi(this.range)&&this.qDd.includes(r.top)}}Object(y.a)(f,"FormulaByExampleSuggestionBase",
x.a,[789])},1228:function(y,x,a){a.d(x,"a",function(){return b});y=a(0);x=a(920);var c=a(893);class b extends x.a{constructor(){super();this.rows=null;this.column=0;this.generatedFormula=this.formulas=null;this.resultKind=this.invocationMethod=this.stateID=0;this.errorMessage=this.guid=null;this.H_=Object.assign(new c.a,{T_:b.getTypeName(),B_:b.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}}
Object(y.a)(b,"FormulaByExampleAnnotation",x.a,[])},1229:function(y,x,a){a.d(x,"a",function(){return c});const c=b=>excelOnlineCalc.util.isSuccess(b)},1362:function(y,x,a){a.d(x,"b",function(){return l});a.d(x,"a",function(){return n});y=a(0);var c=a(387);x=a(1159);var b=a(14);class f{constructor(v){this.bH=v;this.Cnc=new Map}oea(v){return this.MPi(v.sheetId).oea(v)}lzc(v){const B=this.Cnc.get(v.sheetId);return B?B.lzc(v.range):null}s$h(v){const B=this.Cnc.get(v.sheetId);return B?B.Qgb(v):!1}MPi(v){let B=
this.Cnc.get(v);B||(B=new r(this.bH),this.Cnc.set(v,B));return B}}Object(y.a)(f,"FormulaByExampleRangeSuggestionsCache",null,[]);class r extends x.c{constructor(v){super();this.bH=v}oea(v){const B=this.P2g(v);if(B)return B;this.Qgb(v);this.bH.I7(v.originCell,3);return super.oea(v)}iQb(v){return this.lzc(v.range)}lzc(v){var B;b.ULS.shipAssertTag(509383498,306,v.I0,"FormulaByExampleRangeSuggestionsCache.getIntersectingSuggestion: lookup range must be of single column width.");return null===(B=this.get(v.left))||
void 0===B?void 0:B.find(z=>z.suggestion.range.yi(v))}ZIa(v){return v.range.left}P2g(v){const B=this.iQb(v);return B&&B.suggestion.oGd===v.oGd?this.zxe(B,v):null}}Object(y.a)(r,"ColumnBasedRangeSuggestionsCache",x.c,[]);var d=a(1);const k=(v,B,z)=>{var C,D;if(d.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){if((z=null===(C=v.U7)||void 0===C?void 0:C.HeadersList)&&0<z.length&&(z=z.find(W=>W.Index===B-1)))return v.name+"_"+z.Name;b.ULS.sendTraceTag(537161876,306,20,
`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${v.usedRange}, columnNumber: ${B}, `+`areAllTableHeadersAvailable: ${null===(D=v.U7)||void 0===D?void 0:D.IsFullTableHeaders}`);return null}D=z.lZa(v);if(!D)return null;C=v.usedRange;const J=B-C.left;return 0>J||J>=D.count?(b.ULS.sendTraceTag(537161876,306,20,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${C}, columnNumber: ${B}, `+`areAllTableHeadersAvailable: ${z.oFh(v,
D)}`),null):(z=D.ma(J))?v.name+"_"+z:null};class t extends x.a{constructor(v,B){super();this.xh=v;this.bH=B}oea(v){var B;let z=!1;const C=super.iQb(v);if(!C||(z=C.suggestion.formula!==v.formula))return z&&b.ULS.sendTraceTag(523842004,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula changed from last cache entry, overriding cache entry.
           Last example count: ${C.suggestion.$D}, current: ${v.$D}, oldFormula: ${C.suggestion.anonymizedFormula}, newFormula:${v.anonymizedFormula}`),b.ULS.sendTraceTag(537161877,306,20,`FormulaByExampleSuggestionsCache.cacheSuggestion: saving suggestion for table range. tableRange: ${null===(B=v.table)||void 0===B?void 0:B.usedRange}, columnNumber: ${v.column}, examplesCount ${v.$D}, hasPreviousSuggestion: ${this.has(this.ZIa(v))}`),(B=super.oea(v))||b.ULS.sendTraceTag(528889932,306,15,"SuggestionsCache.cacheSuggestion: failed to cache table suggestion due to getTableColumnKey failure."),
this.bH.I7(v.originCell,3),B;C.suggestion.$D!==v.$D&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${C.suggestion.$D}, current: ${v.$D}`),this.bH.I7(v.originCell,4),v.JY.$D=C.suggestion.JY.$D);C.suggestion.$D!==v.$D&&(b.ULS.sendTraceTag(523842003,306,50,`FormulaByExampleSuggestionsCache.cacheSuggestion: formula didn't change from the last cache entry, but number of examples changed. Last example ${C.suggestion.$D}, current: ${v.$D}`),
this.bH.I7(v.originCell,4),v.JY.$D=C.suggestion.JY.$D);return this.zxe(C,v)}SVi(v,B){v=k(v,B,this.xh);return v?this.IIi(v):(b.ULS.sendTraceTag(528889931,306,15,"FormulaByExampleSuggestionsCache.getTableCachedSuggestion: failed to get cached table suggestion due to getTableColumnKey failure."),null)}ZIa(v){return k(v.table,v.column,this.xh)}}Object(y.a)(t,"FormulaByExampleTableSuggestionsCache",x.a,[]);class m extends Sys.EventArgs{constructor(v){super();this.suggestion=v}}Object(y.a)(m,"FormulaByExampleFormulaRejectedEventArgs",
Sys.EventArgs,[]);x=a(38);var e=a(26),w=a(40);const l=v=>"Table"===v.kind;class u extends Map{}Object(y.a)(u,"ForbiddenFormulasMap",Map,[]);class n extends x.a{constructor(v,B,z){super();this.xh=v;this.bH=B;this.Do=z;this.Q$d=!1;this.F2j="formulaByExamplePersistentCache";this.G2j="formulaByExamplePersistentSuggestionsCache";this.Zwi="forbiddenFormulas";this.Csi=1;this.hde=new f(B);this.PZc=new t(this.xh,B);d.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&(this.kIa=
new Map,this.iQd=new Map,this.Q$d=d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)&&this.xh.Wgj())&&(this.c7g=this.xh.IYi(),void this.l9i());this.Tij=d.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleForbidFormulaForTable",!1)}zxh(v){this.addHandler("fbefr",v)}CXi(v,B){let z;const C=v.POc;var D=v.gx;if(v.HU){v=this.xh.sl(C,!1);if(!v)return b.ULS.sendTraceTag(509649310,306,50,`FormulaByExampleManager.onUserInput: getTableContainingRange returned null. flowId: ${B}, editedCellRange: ${C}`),
null;if(D=this.PZc.SVi(v,C.left))D.suggestion.table=v,z=D}else if(B=new e.Range(D.top,C.left,D.bottom,C.right,!0,!0),B=this.hde.lzc(new c.a(B,v.sheetId)))B.suggestion.gx=D,B.suggestion.VUb=v.xM,z=B;return z}oea(v){return"Table"===v.kind?this.PZc.oea(v):this.hde.oea(v)}Qgb(v){return"Table"===v.kind?this.PZc.Qgb(v):this.hde.s$h(v)}zNg(v,B,z){z=void 0===z?!1:z;v.state=B;v.Z7i();d.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.cYh(v,z)}djj(v){const B=this.sJd(v);
return this.kIa.has(B)?this.kIa.get(B).has(this.gEf(v)):!1}get aBe(){return Date.now()}gEf(v){return d.EwaSettings.isChangeGateEnabled("OfficeVSO:8666058_FormulaByExampleForbidByAnonymizedFormula")?v.anonymizedFormula:v.formula}l9i(){const v=this;return No(function*(){v.Hgl=new Promise(B=>{v.Kvj=B});v.C$h();v.xh.u$i(v.G2j,v.Zwi,v.Csi);yield v.Gvj();v.Kvj();v.Vxf()})}C$h(){const v=this.xh.deleteDatabase(this.F2j);w.TaskExtensions.Ua(v,B=>{B.result?b.ULS.sendTraceTag(507872217,306,50,"FormulaByExampleSuggestionCache.deleteV1Database: successfully deleted old database."):
b.ULS.sendTraceTag(507872216,306,15,"FormulaByExampleSuggestionCache.deleteV1Database: call to delete old database had failed.")},this.xh.xa)}Gvj(){const v=this;return No(function*(){let B,z;const C=new Promise(D=>{z=D});try{B=v.xh.xKi(v.c7g)}catch(D){b.ULS.sendTraceTag(508065931,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to get forbidden formulas from indexedDB. error: ${D}`)}if(B)return w.TaskExtensions.Ua(B,D=>{D=D.result;try{const J=JSON.parse(D);for(const W of J){const N=
new u;for(const M of W.$wi)12096E5<v.aBe-M.forbiddingDateTime||N.set(M.formula,M.forbiddingDateTime);v.kIa.set(W.target,N)}J&&0<J.length&&b.ULS.sendTraceTag(508065929,306,20,`FormulaByExampleSuggestionCache.loadSavedCacheState: successfully non-empty loaded forbidden formulas save state from indexedDB. forbiddenFormulasByTarget size: ${v.kIa.size}`)}catch(J){b.ULS.sendTraceTag(508065928,306,50,`FormulaByExampleSuggestionCache.loadSavedCacheState: failed to parse forbidden formulas from indexedDB. error: ${J}`)}finally{z()}},
v.xh.xa),C;b.ULS.sendTraceTag(508065930,306,50,"FormulaByExampleSuggestionCache.loadSavedCacheState: getSavedStateTask is undefined.");z()})}cYh(v,B){switch(v.state){case "DECLINE":case "UNDO":this.TFd(v.suggestion);break;case "IGNORE":B=this.sJd(v.suggestion);if(!this.iQd.has(B)){this.iQd.set(B,new Set([v.suggestion.formula]));break}B=this.iQd.get(B);B.has(v.suggestion.formula)?this.TFd(v.suggestion):B.add(v.suggestion.formula);break;case "ACCEPT":B&&this.TFd(v.suggestion)}}TFd(v){let B;const z=
this.sJd(v);this.kIa.has(z)||(B=new u,this.kIa.set(z,B));B=this.kIa.get(z);B.set(this.gEf(v),this.aBe);this.raiseEvent("fbefr",new m(v));this.Q$d&&this.Vxf()}Vxf(){const v=[];for(const B of this.kIa){const [z,C]=B;v.push({["target"]:z,$wi:Array.from(C.entries(),D=>{var [J,W]=D;return{["formula"]:J,["forbiddingDateTime"]:W}})})}try{this.xh.btk({key:this.c7g,value:JSON.stringify(v)}),b.ULS.sendTraceTag(508065927,306,50,"FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: successfully flushed forbidden formulas to indexedDB.")}catch(B){b.ULS.sendTraceTag(508065926,
306,50,`FormulaByExampleSuggestionCache.flushForbiddenFormulasToIndexedDB: failed to flush forbidden formulas to indexedDB. error: ${B}`)}}sJd(v){return this.Tij?"Table"===v.kind?v.table.name:this.Do.SAf(v.gx,v.sheetId):this.TVi(v)}TVi(v){return"Table"===v.kind?this.PZc.ZIa(v):this.Do.cPb(v.gx,v.gx.left-v.originCell.left,v.sheetId)}}Object(y.a)(n,"FormulaByExampleSuggestionCache",x.a,[769])},1389:function(y,x,a){a.d(x,"b",function(){return N});a.d(x,"a",function(){return M});y=a(0);var c=a(14),b=
a(26),f=a(2),r=a(322),d=a(209);x=a(1017);var k=a(893);class t extends x.a{constructor(){super();this.formulasCount=this.columnNames=this.additionalInputs=this.examples=null;this.invocationMethod=this.stateID=0;this.enableExplanations=this.cultureInfoNames=this.referenceRowValue=this.referenceRowExpression=this.timeoutInSeconds=this.guid=this.conditionalMinBranchExampleCount=this.enableConditional=this.supportedFunctions=null;this.H_=Object.assign(new k.a,{T_:t.getTypeName(),B_:t.getBaseTypes()})}static getTypeName(){return"AugLoop_FormulaByExample_FormulaByExampleSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}}
Object(y.a)(t,"FormulaByExampleSignal",x.a,[]);var m=a(1390),e=a(66),w=a(1027),l=a(1050),u=a(117),n=a(1088),v=a(1087),B=a(1),z=a(940),C=a(552);const D=B.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRAILThresholdQuantum",35),J=B.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleAsyncSignalGenerationTimeoutDuration",5E3);a=B.EwaSettings.isChangeGateEnabled("OfficeVSO:8501373_CalcTsFuncsFirstSlice")&&B.EwaSettings.isChangeGateEnabled("OfficeVSO:8625930_FBEWithCalcTSFuncsFirstSlice");
const W={TEXTSPLIT:a,TEXTSLICE:!1,FINDN:!1,TEXTAFTER:a,TEXTBEFORE:a},N={ZAd:"editRange",uZ:"triggerCommand",kve:"triggerKind",Qxf:"flowId",jXf:"isInExplicitTable",MWg:"tableInnerRange",oYf:"isNewRowPrediction",RWf:"isHeaderLess",SRg:"showNow",kbg:"newColumnHypothesis",zOf:"headerRow"};class M{constructor(Q,R,O,U){this.mGd=U;this.XK=!1;this.xh=Q;this.formulaByExampleManager=R;this.GQh=O;this.Do=l.a.getInstance(this.xh);this.XK=Object(w.a)(this.xh);this.oDj=B.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalNumberOfAdditionalInputRows",
30);this.SSg=null!=this.mGd;c.ULS.sendTraceTag(528758226,306,50,"FormulaByExampleCommandHandler.ctor: FBE command handler created")}Bi(){return!1}executeCommand(Q,R,O){Q=!1;R=R.command;switch(R){case 1928326585:var U=O&&O[N.kve]?O[N.kve]:0;Q=O[N.Qxf];if(0===U)return c.ULS.sendTraceTag(524940245,306,15,"FormulaByExampleManager.executeCommand: triggerFormulaByExample command called for execution with NoTrigger value."),this.Do.Cv(Q,1),e.Task.Va(!0);const K=!O||!O[N.ZAd],F=this.tIi(O,K),I=O[N.MWg],P=
O[N.jXf],Y=O[N.uZ],ea=O[N.oYf],Ba=O[N.RWf],Fa=this.nHi(F,I),za=O[N.SRg],xa=O[N.kbg];O=O[N.zOf];O={POc:F,HU:P,valueType:Fa,gx:I,sheetId:z.a.m0(this.xh.WWc),xM:ea,uZ:Y,qqe:za,jkj:xa,headerRow:O};K||2!==U||this.formulaByExampleManager.KYj(Q,O);if(this.SSg&&(U=this.nCf(F,P))&&this.mGd.Zfj(U))return c.ULS.sendTraceTag(508036636,306,50,"FormulaByExampleCommandHandler.executeCommand: column is locked, not triggering FBE (no signal)"),this.xh.h7(Q,"signal lock"),e.Task.Va(!0);Q=this.triggerFormulaByExample(F,
I,K,Q,P,Ba,O)}return Q?e.Task.Va(!0):Object(d.a)(R)}ni(Q,R){switch(R.command){case 1928326585:return this.xh.k0a();default:return!1}}Ji(){return!1}nHi(Q,R){var O;if(B.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")){R=this.xh.Mua("FormulaByExampleCommandHandler.getDefaultColumnValueType",new b.Range(R.top,Q.left,R.bottom,Q.left,!0,!0));try{for(;R.$$mn();){const U=R.$$cu().cell.UC;if(0!==U)return U}}catch(U){throw Error(`Error while iterating over cells: ${U}`);}finally{R&&
R.dispose()}}return null===(O=this.xh.kh(Q))||void 0===O?void 0:O.cell.UC}tIi(Q,R){c.ULS.sendTraceTag(537161928,306,50,`FormulaByExampleCommandHandler.getEditedRange: flow triggered from: ${R?"Ribbon":"AutoDetect"}`);return R?this.xh.getActiveCell():Q[N.ZAd]}triggerFormulaByExample(Q,R,O,U,K,F,I){if(!this.xh.bhj)return c.ULS.sendTraceTag(537161927,306,10,"FormulaByExampleCommandHandler.TriggerFormulaByExample: augmentationLoopManager instance is null"),this.Do.Cv(U,13,{reason:"AugmentationLoopManager instance is null"}),
this.xh.h7(U,"AL is undefined"),!0;let P=R;if(B.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")&&(P=R.pk(this.xh.getLoadedRange()),!P))return c.ULS.sendTraceTag(508363683,306,20,"FormulaByExampleCommandHandler.TriggerFormulaByExample: tableRange does not intersect loaded range"),this.Do.Cv(U,13,{reason:"tableRange does not intersect loaded range"}),this.xh.h7(U,"tableRange does not intersect loaded range"),!0;O=this.rKi(Q,P,O,U,K,F,I);void O.then(Y=>{if(Y){if(this.SSg){const ea=
this.nCf(Q,K);ea&&this.QHj(U,ea,Y.examples,R)}c.ULS.sendTraceTag(537161926,306,50,`FormulaByExampleCommandHandler.TriggerFormulaByExample: calling SubmitOperationSignal for flowId: ${U}, isInExplicitTable: ${K}.`);this.xh.HSk(Y);this.Do.Cv(U,12);this.GQh.I7(Q,1);this.XK&&Object(w.f)("SIGNALSENT",U)}else this.Do.Cv(U,13,{reason:"Signal is null"})});return!0}QHj(Q,R,O,U){const K=[];for(const F of O){O=new b.Range(F.output.row,U.left,F.output.row,U.right,!0,!0);if(0<K.length){const I=K[K.length-1];if(I.bottom+
1===O.top){I.zvf(O);continue}}K.push(O)}this.mGd.dXj(Q,R,K);c.ULS.sendTraceTag(508036635,306,50,"FormulaByExampleCommandHandler.notifyLockManagerOnSignalSent: SignalLocksManager has been updated with the signal sent")}nCf(Q,R){return R?(R=this.xh.sl(Q,!1),R?this.Do.Exc(R.name,Q.left):(c.ULS.sendTraceTag(508036634,306,15,"FormulaByExampleCommandHandler.getColumnKeyFromEditRange: explicit table is null"),null)):this.Do.cPb(Q,Q.left,z.a.m0(this.xh.na))}rKi(Q,R,O,U,K,F,I){const P=this;return No(function*(){var Y,
ea,Ba=yield P.XDi(R,Q,U,I);if(!Ba)return null;let Fa,za=void 0,xa=void 0;if(K){const fa=P.xh.sl(Q,!1);if(!fa)return c.ULS.sendTraceTag(537161925,306,15,"FormulaByExampleCommandHandler.TriggerFormulaByExample: table returned null for given edit range."),P.Do.Cv(U,13,{reason:"Table returned null for given edit range"}),P.xh.h7(U,"table return null for table suggestion"),null;Fa=P.sFi(fa);if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)){xa=R.top-
1;const V=null===(ea=null===(Y=fa.U7)||void 0===Y?void 0:Y.HeadersList[Q.left-R.left])||void 0===ea?void 0:ea.Name;V&&(Y=Object(C.b)(V),za=`${fa.name}[[#Headers],[${Y}]]`)}}else P.xh.l0a()&&(Fa=P.rFi(R,Q),B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",!1)&&(xa=F?R.top:R.top-1,za=`\$${Q.toString().charAt(0)}\$${xa}`));if(!Fa)return P.xh.h7(U,"no column names found"),null;B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleReferenceRowFormula",
!1)&&!za&&(c.ULS.sendTraceTag(508347742,306,15,`FormulaByExampleCommandHandler.TriggerFormulaByExample: failed to generate referenceRowExpression. isHederLessTable: ${F}, isInExplicitTable: ${K}`),xa=za=void 0);Ba=Object(f.a)(new t,{formulasCount:1,examples:Ba.examples,additionalInputs:Ba.additionalInputs,columnNames:Fa,stateID:P.xh.pD,invocationMethod:O?0:1,guid:U.toString(),supportedFunctions:W,enableConditional:B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleConditionals",
!1),referenceRowExpression:za,referenceRowValue:xa,cultureInfoNames:B.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")?{userInterfaceCulture:void 0,dataCulture:P.xh.$.dataCultureTag}:void 0,enableExplanations:B.EwaSettings.isChangeGateEnabled("OfficeVSO:8697329_FormulaByExampleExplanationsAlwaysGenerated")||B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1)});c.ULS.sendTraceTag(528758225,306,50,"FormulaByExampleCommandHandler.getFormulaByExampleSignalFromTable: signal generated.");
return Ba})}XDi(Q,R,O,U){const K=this;return No(function*(){return yield K.YDi(Q,R,O,U)})}sFi(Q){var R;const O=[],U=Q.name;if(B.EwaSettings.isChangeGateEnabled("OfficeVSO:8180963_FBEFixColumnHeadersMetadata")){var K=null===(R=Q.U7)||void 0===R?void 0:R.HeadersList;if(!K)return c.ULS.sendTraceTag(508363682,306,15,"FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames."),null;for(var F of K)K=F.Index,Q=F.Name,Q=B.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?
Object(C.b)(Q):Q,O.push({column:K+1,name:`${U}[@[${Q}]]`})}else{F=z.a.Yfa(Q);Q=this.xh.lZa(Q);if(!F||!Q)return c.ULS.sendTraceTag(524940244,306,15,`FormulaByExampleCommandHandler.getColumnNamesMapFromTable: failed to generate columnNames. is tableRange null: ${!F}, is colNamesCurrentTable null: ${!Q}`),null;F=F.left;for(K of Q)Q=B.EwaSettings.isChangeGateEnabled("OfficeVSO:8202565_FBEescapeColumnHeaderNames")?Object(C.b)(K):K,O.push({column:F,name:`${U}[@[${Q}]]`}),F++}return O}rFi(Q,R){const O=[];
R=new b.Range(R.top,Q.left,R.top,Q.right,!0,!0);Q=this.xh.Mua("FormulaByExample.getColumnNamesMapFromInputRange",R);for(R=R.left;Q.$$mn();){const U={column:R++,name:`${b.Range.OT(Q.$$cu().range.left)+v.b}`};O.push(U)}return O}YDi(Q,R,O,U){const K=this;return No(function*(){const F=R.left;try{const I=yield K.hKi(Q,F,O);return yield K.Z6h(Q,F,I,U,O)}catch(I){return c.ULS.sendTraceTag(508909329,306,10,`FormulaByExampleCommandHandler.getByExamplesInputsFromRangeAsync: failed to generate byExampleInputs. ${I}`),
null}})}hKi(Q,R,O){const U=this;return No(function*(){const K=new Set,F=U.xh.Mua("FormulaByExample.getForbiddenColumnsFromRangeAsync",Q),I=P=>{var Y=P.range;const ea=Y.left;ea===R||K.has(ea)||(Y=new b.Range(Y.top,R,Y.top,R,!1,!1),U.fhj(P,Y)&&(K.add(ea),U.Do.sMc(O,ea-(U.xh.displayRtl?Q.right:Q.left))))};try{return yield U.n7g(F,I),K}catch(P){throw Error(`getForbiddenColumnsFromRangeAsync failed with reason: ${P}`);}})}Z6h(Q,R,O,U,K){const F=this;return No(function*(){const I=[],P=[],Y=Q.right,ea=new Set;
let Ba=[],Fa=!1,za=null;const xa=B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleTrackNonUniformColumns",!1)?new Set:null,fa=F.xh.Mua("FormulaByExample.createValidExamplesFromRangeAsync",Q);let V=!1;const ba=new Map,la=Ta=>{if(504848446!==U.uZ||Ta.range.top!==U.POc.top){var Ea=Ta.range.left,sa=Ea===R;sa&&Ta.text?za=F.Dgf(Ta):sa||O.has(Ea)||(Ta.text&&(Fa=!0),Ba.push(F.Dgf(Ta)));Ta=F.A4k(Ta,ba);V||(V=Ta);Ea===Y&&(Fa&&(za?(I.push({output:za,inputs:Ba}),ea.add(za.rawValueJson),
null===xa||void 0===xa?void 0:xa.add(za.numberFormatCategory)):P.length<F.oDj&&P.push({output:null,inputs:Ba})),Ba=[],Fa=!1,za=null)}};try{yield F.n7g(fa,la);if(ea.size<n.a)return c.ULS.sendTraceTag(509683013,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column does not have enough distinct examples with inputs."),F.xh.h7(K,"not enough examples with non-empty inputs"),null;if(xa){const Ta={["isUniformColumn"]:1===xa.size,["dataTypes"]:Array.from(xa).sort().join(","),["flowId"]:K};
c.ULS.sendTraceTag(507581650,306,20,`Formula By Example Uniform Column Data: ${JSON.stringify(Ta)}`);if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleSuppressNonUniformSignals",!1)&&1<xa.size)return c.ULS.sendTraceTag(507581649,306,50,"FormulaByExampleCommandHandler.createValidExamplesFromRange: column has non uniform data, suppressing signal."),F.xh.h7(K,"column has non uniform data"),null}if(F.xh.j0a()){const Ta=ba.get(R),Ea={["isFormulaUser"]:V,["hasFormulaColumn"]:Array.from(ba.entries()).some(sa=>
{[,sa]=sa;return"HasNonFormulaCell"!==sa&&1===sa.size}),["outputColumnDataState"]:Ta&&"HasNonFormulaCell"===Ta?"NonFormulaColumn":1===Ta.size?"FormulaColumn":"MixedFormulasColumn",["flowId"]:K};c.ULS.sendTraceTag(507557075,306,20,`Formula By Example Formula User And Columns Hypothesis Data: ${JSON.stringify(Ea)}`)}return{examples:I,additionalInputs:P}}catch(Ta){throw F.xh.h7(K,"createValidExamplesFromRangeAsync failed, log 4vv2r"),Error(`createValidExamplesFromRangeAsync failed with reason: ${Ta}`);
}})}n7g(Q,R){return No(function*(){const O=performance.now();let U=O;try{for(;Q.$$mn();){if(performance.now()-O>J)throw Error("Timeout");performance.now()-U>D&&(yield z.a.$bl(),U=performance.now());R(Q.$$cu())}}catch(K){throw Error(`Error while iterating over cells: ${K}`);}finally{Q&&Q.dispose()}})}A4k(Q,R){if(!this.xh.j0a())return!1;const O=Q.range.left;if(!Q.text||!Q.iC)return R.set(O,"HasNonFormulaCell"),!1;if("HasNonFormulaCell"===R.get(O))return!0;R.has(O)||R.set(O,new Set);R.get(O).add(Q.formulaBarText);
return!0}fhj(Q,R){const O=Q.UP,U=Q.range,K=this.xh.xze,F=this.xh.na;if(!F)return c.ULS.sendTraceTag(509743199,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned null. Expected to be an object of type Sheet."),!1;if(!(B.EwaSettings.isChangeGateEnabled("OfficeVSO:7251463_FBEFixJsCrashOnNullActiveSheet")||F instanceof u.a))return c.ULS.sendTraceTag(509743198,306,50,"FormulaByExampleCommandHandler.isDependingOn: this.ewaControl.activeItem returned object of type other then Sheet. Expected to be an object of type Sheet."),
!1;if(!this.xh.uFc(Q.cell.Vn,O))return!1;if(Q=this.xh.extractReferences(O,F.name,K,!0,U))for(const I of Q.Items)if(z.a.qyi(I.Range).equals(R))return!0;return!1}Dgf(Q){let R;if(1===Q.Xn.type){R=parseFloat(Q.Xn.value);var O=this.xh.Hma(Q.cell.Vn);Object(r.c)(O)?O=O.value.isDate?4:O.value.isTime?5:1:(c.ULS.sendTraceTag(522840207,0,10,`FormulaByExampleCommandHandler.createAugLoopCell: CalcManager's getNumberFormat method failed on the given cell, falling back to number format. failureReason: ${O.reason}`),
O=1)}else R=Q.text,O=0;return Object.assign(new m.a,{row:Q.range.top,column:Q.range.left,displayText:Q.text,rawValueJson:JSON.stringify(R),numberFormatCategory:O.toString()})}}Object(y.a)(M,"FormulaByExampleCommandHandler",null,[39])},1422:function(y,x,a){a.r(x);a.d(x,"FormulaByExampleAutoSuggestActor",function(){return u});y=a(0);var c=a(14),b=a(991),f=a(86),r=a(1027),d=a(1389),k=a(1088),t=a(1050),m=a(387),e=a(1),w=a(940),l=a(26);class u{constructor(n,v){this.bQc=this.bpd=this.XK=!1;this.VFa=null;
this.Ztc=!1;this.Wua=0;this.VF=null;this.dZb=new Map;this.zY=(B,z)=>{z.committed?(this.VF&&(this.Wua++,this.VF.ONg(this.Wua,this.Wua),this.VF.OPa(this.Wua,0)),this.tgg(z.kq,324156914)):this.pS()};this.D6=(B,z)=>{this.tgg(z.D$.range,504848446,z.nWd)};this.tgg=(B,z,C)=>{324156914===z&&this.oZg(B);if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")&&!this.ISd(B))this.pS(),this.xh.h7(this.Wua,"cell is invalid for FormulaByExample trigger - formula cell");else{var {gx:D,HU:J,
xM:W,xga:N,headerRow:M}=this.Yfa(B);D&&B.yi(D)?(this.YCc(B,324156914,D,J),e.EwaSettings.isChangeGateEnabled("OfficeVSO:8680199_ValidatorReportOrderFix")||this.ISd(B)?this.TMc(B,B,D,z,J,W,N,C,M):this.pS()):(this.pS(),this.xh.h7(this.Wua,D?"edited header cell":"no table found"))}};this.oZg=B=>{if(this.xh.j0a()){var z=new l.Range(B.top,B.left-1,B.bottom,B.left,!1,!1);(z=this.xh.UVi(z))&&(z.usedRange.yi(B)?this.Hpj(z,B.left,B)&&this.h9f(z,B.left-z.usedRange.left):this.h9f(z,B.left-z.usedRange.left))}};
this.h9f=(B,z)=>{this.dZb.has(B.name)?this.dZb.get(B.name).add(z):this.dZb.set(B.name,new Set([z]))};this.fnj=B=>{const z=this.xh.sl(B,!1);return z&&this.dZb.has(z.name)?this.dZb.get(z.name).has(B.left-z.usedRange.left):!1};this.h8d=(B,z)=>{B=z.destinationRange;if(1804571062===z.command||B.left!==B.right)this.pS();else{var C=new l.Range(B.top,B.right,B.top,B.right,!1,!1),{gx:D,HU:J,xM:W,xga:N,headerRow:M}=this.Yfa(C);D?(this.YCc(C,z.command,D,J),this.TMc(C,B,D,z.command,J,W,N,!1,M)):this.pS()}};this.KNc=
(B,z)=>{if((B=z.Z$h)&&1===B.length)if(B=B[0],e.EwaSettings.isChangeGateEnabled("OfficeVSO:8468987_FormulaByExamplePasteColumn"))if(B.I0)if(this.xh.FF(B))if((z=z.vo)&&1804571062!==z&&1766348718!==z){B.isSingle&&this.oZg(B);var {gx:C,HU:D,xM:J,xga:W,headerRow:N}=this.Yfa(B);if(C){c.ULS.sendTraceTag(507855043,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: passed all conditions to trigger FBE event.
        ribbonCommand = ${b.a[z]}
        destinationRange.height = ${B.height}`);var M=B.center;this.YCc(M,z,C,D);this.TMc(M,B,C,z,D,J,W,!1,N)}else this.pS(),c.ULS.sendTraceTag(507855044,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: no table contains the range")}else this.pS(),c.ULS.sendTraceTag(507872195,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste. ribbonCommand = ${b.a[z]}`);else this.pS(),c.ULS.sendTraceTag(507881249,306,50,"FormulaByExampleAutoSuggestActor.onPasteSucceededInner: destinationRange not fully contained in viewport");
else this.pS(),c.ULS.sendTraceTag(507881250,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single column. destinationRange.width = ${B.width}`);else if((z=z.vo)&&1804571062!==z&&1766348718!==z&&B.isSingle){var {gx:Q,HU:R,xM:O,xga:U,headerRow:K}=this.Yfa(B);Q?(this.YCc(B,z,Q,R),this.TMc(B,B,Q,z,R,O,U,!1,K)):this.pS()}else this.pS(),c.ULS.sendTraceTag(508376384,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: unsupported paste or not single cell. ribbonCommand = ${b.a[z]} destinationRange.isSingle = ${B.isSingle}`);
else this.pS(),c.ULS.sendTraceTag(508380383,306,50,`FormulaByExampleAutoSuggestActor.onPasteSucceededInner: not single range. destinationRanges?.length = ${null===B||void 0===B?void 0:B.length}`)};this.Rzd=()=>{var B=this.Huk(this.eP.originCell,this.eP.gx);if(0===B)this.pS(),this.Do.Cv(t.b,1),this.xh.h7(this.Wua,"output column doesn't have enough distinct examples");else{var z=this.Do.oGf();this.Do.Cv(z,3);this.eP.$Zd&&this.VF&&this.VF.ONg(z,this.eP.$Zd);c.ULS.sendTraceTag(537161929,306,50,`FormulaByExampleAutoSuggestActor.tryTriggeringFormulaByExample: triggering FormulaByExample for cell edit. Trigger kind: ${B}, FlowId: ${z}`);
this.XK&&Object(r.f)("EDITCOMMIT",z);var C=new f.a(1928326585,1,2,6,null);B={[d.b.ZAd]:this.eP.originCell,[d.b.uZ]:this.eP.uZ,[d.b.kve]:B,[d.b.Qxf]:z,[d.b.MWg]:this.eP.gx,[d.b.jXf]:this.eP.HU,[d.b.oYf]:this.eP.xM,[d.b.RWf]:this.eP.xga,[d.b.SRg]:this.eP.Uoj,[d.b.kbg]:this.eP.HU&&this.fnj(this.eP.originCell),[d.b.zOf]:this.eP.headerRow};this.xh.dh(C,B);this.pS()}};this.IXj=(B,z)=>{B=this.eP.oRh;z=z.kq.toString();B.has(z)&&(B.delete(z),0===B.size&&this.Rzd())};this.xh=n;this.XK=v;this.pS();this.xh.RW(this.zY);
e.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")&&this.xh.FQ(this.D6);this.Ztc=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8231994_FBECalcGridUnreliableFix");this.VF=this.xh.VF;this.Ztc||this.xh.tmd(this.IXj);e.EwaSettings.isChangeGateEnabled("OfficeVSO:7395435_FormulaByExampleTriggerOnCSEPaste")&&this.xh.Gkc(this.h8d);(this.bQc=e.EwaSettings.isChangeGateEnabled("OfficeVSO:8329262_FormulaByExamplePostPaste"))&&this.xh.Hkc(this.KNc);this.Do=t.a.getInstance(this.xh);
if(this.bpd=this.xh.l0a())this.xh.p9i(),this.Ije=e.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1)}Hpj(n,v,B){var z;n=w.a.Yfa(n);v=new l.Range(n.top,v,n.bottom,v,!1,!1);v=this.xh.Mua("FormulaByExampleAutoSuggestActor:isTableColumnBlank",v);try{for(;v.$$mn();){const C=v.$$cu();if(!C.range.equals(B)&&(null===(z=C.Xn)||void 0===z?0:z.value))return!1}}finally{v&&v.dispose()}return!0}Yfa(n){var v;const B=this.xh.sl(n,!1);if(B)return n=null===(v=B.U7)||
void 0===v?void 0:v.HeadersList,{gx:w.a.Yfa(B),HU:!0,xM:!1,xga:!n};if(this.bpd){const {W1b:z,xM:C,xga:D,headerRow:J}=this.ZRi(n);if(z)return{gx:z,HU:!1,xM:C,xga:D,headerRow:J}}return{gx:null,HU:!1,xM:!1,xga:!1}}ZRi(n){var v=new l.Range(n.top-this.Ije,n.left,n.bottom,n.right,!0,!0),B=this.xh.hUk(new m.a(v,w.a.m0(this.xh.na)),6);if(!B)return null;const z=new Map;for(var C of B)for(var D of C.table.interpretations)if(2===D.orientation&&.5<D.confidence){v=new l.Range(D.tableLocation.top+D.headerRowCount,
D.tableLocation.left+D.headerColumnCount,Math.max(D.tableLocation.bottom,v.bottom),D.tableLocation.right,!0,!0);n=!D.tableLocation.yi(n);B=0===D.headerRowCount;if(1===D.headerRowCount)for(D=v.left;D<=v.right;D++){C=new l.Range(v.top-1,D,v.top-1,D,!1,!1);const J=this.xh.kh(C);J?z.set(J.range.left,J.cell.text):c.ULS.sendTraceTag(507581085,306,15,`FormulaByExampleAutoSuggestActor.getRangeTableInnerRange: formatted cell for header row is null. table inner range: ${v} cell range: ${C}`)}return{W1b:v,xM:n,
xga:B,headerRow:z}}return{W1b:null,xM:!1,xga:!1,headerRow:null}}TMc(n,v,B,z,C,D,J,W,N){this.uMg(n,v,B,z,C,D,J,W,N);n=[];this.Ztc&&n.push(324156914);this.bQc&&n.push(237279923,-185374993,-958589048,808159687,42074747,-875588320,264209770);n.includes(z)?(this.M3b(),this.VFa=this.xh.rMa(()=>{e.EwaSettings.isChangeGateEnabled("OfficeVSO:8235022_FBEVerifyCellNotFormulaAfterConsistent")&&!this.ISd(this.eP.originCell)?(this.pS(),this.Do.Cv(t.b,1),this.xh.h7(this.Wua,"cell is invalid for FormulaByExample trigger - formula cell")):
this.Rzd()})):(this.M3b(),this.Rzd())}YCc(n,v,B,z){z?(z=this.xh.sl(n,!1),this.Do.pgg(v,z.name,n.left-(this.xh.da.rtl?B.right:B.left),n.top-B.top)):this.Do.qgg(v,B,n.left-(this.xh.da.rtl?B.right:B.left),n.top-B.top,w.a.m0(this.xh.WWc))}ISd(n){var v=this.xh.kh(n);if(!v)return c.ULS.sendTraceTag(524120778,306,15,`FormulaByExampleAutoSuggestActor.isCellValidForTriggeringFormulaByExample: formattedCell is null. investigation hints: is cell null = ${!n}`),this.Do.Cv(t.b,1,{reason:"Didn't trigger since the formattedCell is null."}),
!1;if(e.EwaSettings.isChangeGateEnabled("OfficeVSO:8666049_FBEUseClientGridFormulaMetadata"))return v.cell.iC?(this.Do.Cv(t.b,1,{reason:"Didn't trigger since edited cell content is a formula."}),!1):!0;n=this.xh.uFc(v.cell.Vn,v.UP);(v=null!==n&&!n)||this.Do.Cv(t.b,1,{reason:`Didn't trigger since edited cell content is a formula or isFormulaCell returned null. isFormulaText is null:${null==n}`});return v}Huk(n,v){n=n.left;v=new l.Range(v.top,n,v.bottom,n,!0,!0);return this.Guk(v)}Guk(n){var v;const B=
new Set;let z=0;n=this.xh.Mua("FormulaByExampleAutoSuggestActor:Table",n);try{for(;n.$$mn();){const C=n.$$cu();if(null===(v=C.Xn)||void 0===v?0:v.value)if(B.add(C.Xn.value),z++,B.size>=k.a)return 2}}finally{n&&n.dispose()}z>=k.a?(c.ULS.sendTraceTag(523368219,306,50,"FormulaByExampleAutoSuggestActor.searchForSufficientExamplesInOutputColumn: Table has sufficient example amount - but not enough distinct examples."),this.Do.Cv(t.b,1,{reason:"Didn't trigger since there aren't enough distinct outputs"})):
this.Do.Cv(t.b,1,{reason:"Didn't trigger since there aren't enough examples"});return 0}M3b(){this.VFa&&(this.VFa(),this.VFa=null,this.VF&&324156914===this.eP.uZ&&this.xh.h7(this.eP.$Zd,"consistent block cache callback cancelled"))}pS(){this.uMg(null,null,null,null,null,null,null);(this.bQc||this.Ztc)&&this.M3b()}uMg(n,v,B,z,C,D,J,W,N){this.eP={originCell:n,oRh:new Set(null===v||void 0===v?void 0:v.G5e(v.cz).map(M=>M.toString())),uZ:z,gx:B,HU:C,xM:D,xga:J,Uoj:W,headerRow:N,$Zd:324156914===z?this.Wua:
null}}}Object(y.a)(u,"FormulaByExampleAutoSuggestActor",null,[])},1423:function(y,x,a){x=a(476);a=a(1424);a=a.kv?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);x(a,{insert:"head",AC:!1});y.exports=a.oH||{}},1424:function(y,x,a){x=a(477)(!1);x.push([y.i,'.ewa-ac{position:absolute;z-index:102;margin-top:1px;width:auto}.ewa-ac .ewa-ac-param{white-space:nowrap;margin-bottom:3px;direction:ltr}.ewa-ac .ewa-ac-param function_param_table{position:absolute}.ewa-ac .ewa-ac-param .ewa-function-help-link{text-decoration:underline}.ewa-lb{position:absolute;border:1px solid #a2a6ab;overflow-x:hidden;overflow-y:auto;cursor:default;background-color:#fff;color:#262626;font-size:12px;font-family:"Segoe UI";z-index:102;height:auto;margin:0 8px;touch-action:manipulation;vertical-align:middle}.ewa-lb.ewa-fb-refactor{position:relative;margin:0}.ewa-lb table{left:0;right:0;border-collapse:collapse}.ewa-lb table td{white-space:nowrap}.ewa-lb table td div.clip16x16{margin:0 0 0 2px}.ewa-lb table td.list-item{height:24px;padding:0 8px}.ewa-lb table td.list-item-selected{background-color:#d3f0e0}@media screen and (-ms-high-contrast:active){.ewa-lb table td.list-item-selected{border:2px solid #fff}}.ewa-lb table.list-table-touch td.list-item{height:35px}div#suggested_cells_list_box{margin:0}div#suggested_cells_list_box .list-table .ewa-suggested-cell-name{float:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@font-face{font-family:"Segoe UI Semibold";font-weight:600;src:local("Segoe UI Semibold"),local("Segoe UI")}.ewa-lb table td.columnName-header{color:#666;font-size:12px;font-family:"Segoe UI Semibold";text-align:left;padding:3px 8px;text-overflow:ellipsis}.ewa-tt{background-color:#f7f7f7;border:1px solid #a2a6ab;color:#444;height:auto;vertical-align:middle;width:auto;z-index:102;font-size:8pt;margin:0;padding-bottom:3px;padding-top:2px}.ewa-root-ltr .ewa-tt{text-align:left;padding-left:5px;padding-right:7px}.ewa-root-rtl .ewa-tt{text-align:right;padding-left:7px;padding-right:5px}.ewa-dlg-function-link-container .ewa-fdb-help-link,.ewa-tt-ltr .ewa-fdb-help-link,.ewa-tt-rtl .ewa-fdb-help-link{color:#00f;text-decoration:underline}.ewa-function-link-container .ewa-function-udf-name,.ewa-function-link-container-udf .ewa-function-help-link{display:none}.ewa-root.rtl .ewa-function-link-container{text-align:left}',
""]);y.exports=x},1425:function(y,x,a){x=a(476);a=a(1426);a=a.kv?a.default:a;"string"===typeof a&&(a=[[y.i,a,""]]);x(a,{insert:"head",AC:!1});y.exports=a.oH||{}},1426:function(y,x,a){x=a(477)(!1);x.push([y.i,".ewa-fb-fluent .ewa-rteLine .formula-highlight-1,.ewa-gridKeyHandler .formula-highlight-1{color:#006cbe}.ewa-fb-fluent .ewa-rteLine .formula-highlight-1::selection{color:#b2e3ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2,.ewa-gridKeyHandler .formula-highlight-2{color:#bc2f32}.ewa-fb-fluent .ewa-rteLine .formula-highlight-2::selection{color:#ffcfe1}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3,.ewa-gridKeyHandler .formula-highlight-3{color:#7c53ac}.ewa-fb-fluent .ewa-rteLine .formula-highlight-3::selection{color:#e9d4ff}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4,.ewa-gridKeyHandler .formula-highlight-4{color:#0f700f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-4::selection{color:#98ff87}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5,.ewa-gridKeyHandler .formula-highlight-5{color:#bf0077}.ewa-fb-fluent .ewa-rteLine .formula-highlight-5::selection{color:#fcf}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6,.ewa-gridKeyHandler .formula-highlight-6{color:#b5490f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-6::selection{color:#ffda00}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7,.ewa-gridKeyHandler .formula-highlight-7{color:#00758f}.ewa-fb-fluent .ewa-rteLine .formula-highlight-7::selection{color:#3df5e8}",
""]);y.exports=x},191:function(y,x,a){function c(Ra,Tb){Object(Md.d)(()=>{var Dc;const Yc=Ra.getCellBounds(null===(Dc=Ra.kh(null))||void 0===Dc?void 0:Dc.cell,!0);Yc&&(Dc=Yc?new Sys.UI.Bounds(Yc.x+Yc.width,Yc.y+Yc.height,0,0):null)&&Tb.K6b(["DatePickerFloatie"],Dc,Qc.a.eh)})}function b(Ra){var Tb=Object(ab.f)(Ra);Ra=Object(Ib.a)(Ra);var Dc=Tb.fp,Yc=Tb.cellTextEditBox.EYf;Yc=Tb.fA||Yc&&Ra;Ra=f((Yc?Ra:Dc).$b.domElement);Dc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8597123_RemoveIndentationInFormulaBar");
Dc||(Ra.left+=12);if(Yc)Yc={top:0,left:0,right:innerWidth,bottom:innerHeight};else if(Dc&&(Ra.left+=12),Yc=f(Tb.domElement),Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7845089_fixFormulaAssistancePositoningInFreezePanes")&&Tb.Pg.Uo&&(Tb=Tb.Pg,Yc.top-=Tb.height,Yc.left-=Tb.width),{zoom:Tb}=Object(kb.a)(),1!==Tb)for(const Ad of[Ra,Yc])for(const he in Ad)Ad[he]*=Tb;return{target:Ra,bounds:Yc}}function f(Ra){const {top:Tb,left:Dc,right:Yc,bottom:Ad}=Ra.getBoundingClientRect();return{top:Tb,left:Dc,
right:Yc,bottom:Ad}}function r(Ra){var Tb;if(Ra){var Dc=new Ae(Ra.kind===hd.HighlightKind.CellRef);Ra=null===(Tb=null===Ra||void 0===Ra?void 0:Ra.rangeInfo)||void 0===Tb?void 0:Tb.positionKindInfo;if(!Ra)return Dc;Dc.sna=Ra.firstRow===hd.PositionKind.Absolute;Dc.rna=Ra.firstColumn===hd.PositionKind.Absolute;Dc.mxa=Ra.secondRow===hd.PositionKind.Absolute;Dc.lxa=Ra.secondColumn===hd.PositionKind.Absolute;return Dc}}function d(Ra,Tb){return Ra===Tb?{kind:"equal"}:{kind:"different",diff:La.a.k3e(Ra,Tb)}}
function k(Ra){[Ra.clientResult,Ra.serverResult].forEach(Tb=>{Object(bd.c)(Tb)||"success"!==Tb.kind||(Tb.value=La.a.y3(Tb.value),Tb.unformattedValue=La.a.y3(Tb.unformattedValue))})}function t(Ra,Tb,Dc){if(Ra.has(Tb))return Ra.get(Tb);Dc=Dc();Ra.set(Tb,Dc);return Dc}function m(Ra,Tb,Dc,Yc,Ad){if(!Yc)return Ad();if(Ra.has(Tb))return Ra.get(Tb);Yc=Ad();Ra.set(Tb,Yc);Ra.set(Dc,Yc);return Yc}function e(Ra){return JSON.stringify({text:Ra.text,index:Ra.index,length:Ra.length})}function w(Ra){return Object(bd.c)(Ra)?
"Undefined text":""===Ra?"Empty text":null}function l(Ra){return Object(bd.b)(Ra)&&Object(bd.b)(Ra.FormulaInfo)&&Object(bd.b)(Ra.FormulaInfo.Formula)&&(1===Ra.FormulaInfo.FormulaType||2===Ra.FormulaInfo.FormulaType)&&1<Ra.FormulaInfo.Formula.length&&Ra.FormulaInfo.Formula!==Ra.Text}function u(Ra){return{["formula"]:Ra.FormulaInfo.Formula,["formulaTokens"]:Ra.FormulaInfo.Formula,["formulaType"]:Ra.FormulaInfo.FormulaType,["value"]:Ra.Text,["unformattedValue"]:Ra.Value,["valueType"]:Ra.ValueType,["hasError"]:Ra.HasError,
["ifmt"]:Ra.Ifmt,["ifmtStamped"]:Ra.IfmtStamped,["row"]:Ra.Row,["col"]:Ra.Col}}function n(Ra,Tb){return Ra===Tb?{kind:"equal"}:Object(bd.c)(Ra)&&Object(bd.c)(Tb)?{kind:"empty",source:"both"}:Object(bd.c)(Ra)||Object(bd.c)(Tb)?{kind:"empty",source:Object(bd.c)(Ra)?"cse":"immediate"}:{kind:"different",diff:La.a.k3e(Ra,Tb)}}function v(Ra){return No(function*(){const Tb=yield Hb.a.resolve(na.wc),Dc=pc.Range.gi(Ra.row,Ra.col);return Object.assign({},Ra,{formula:Tb.anonymize(Ra.formula,Dc),formulaTokens:La.a.y3(Ra.formulaTokens),
value:La.a.y3(Ra.value),unformattedValue:La.a.y3(Ra.unformattedValue)})})}function B(Ra){if(Object(bd.b)(Ra)&&Object(bd.b)(Ra.table)&&Object(bd.b)(Ra.table.interpretations)){var Tb={sheetId:Ra.table.analyzedRange.sheetId,analyzedRange:Object(fb.gb)(Ra.table.analyzedRange.range),interpretations:Ra.table.interpretations.toArray().map(z)};a:{switch(Ra.metadataState){case 2:Ra=hd.RecognizedTablesMetadataState.Valid;break a;case 4:Ra=hd.RecognizedTablesMetadataState.Invalid;break a;case 6:Ra=hd.RecognizedTablesMetadataState.All;
break a}Ra=void 0}Tb={rangeTableInfo:Tb,metadataState:Ra}}else Tb=null;return Tb}function z(Ra){if(Ra){var Tb=Object(fb.gb)(Ra.tableLocation);var Dc=Ra.confidence,Yc=Ra.headerRowCount,Ad=Ra.headerColumnCount;a:{switch(Ra.orientation){case 0:Ra=hd.TableOrientation.none;break a;case 1:Ra=hd.TableOrientation.rowMajor;break a;case 2:Ra=hd.TableOrientation.columnMajor;break a}Ra=void 0}Tb={tableLocation:Tb,confidence:Dc,headerRowCount:Yc,headerColumnCount:Ad,orientation:Ra}}else Tb=null;return Tb}function C(Ra,
Tb,Dc){const Yc=Ra.pD,Ad=Ra.Jaa();Ra.rMa(()=>{const he=Ra.pD-Yc,re=Ra.Jaa(),Me=Ad===re,Ve=[],Hf=Ka.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FbeEcsMismatchesMaxExamplesPerLog",5);let Qf=0;for(const Vc of Tb){if(Ve.length>=Hf)break;var ia=Ra.kh(Vc.range);if(!ia){Qf++;continue}const ud=Vc.text,xe=Vc.value,fe=Hg[Vc.kind],Te=ia.text,Bf=ia.Xn.value;ia=Kg[ia.Xn.type];if(ud===Te)var Xb=fh.NoMismatch;else Xb=/^#+$/.test(Te),Xb=/^#+$/.test(ud)||Xb?xe===Bf?fh.NoMismatch:fh.HashesValueMismatch:fh.Mismatch;
Xb!==fh.NoMismatch&&Ve.push({["cseText"]:La.a.f_(ud),["cseValue"]:La.a.f_(xe),["cseKind"]:fe,["ecsText"]:La.a.f_(Te),["ecsValue"]:La.a.f_(Bf),["ecsType"]:ia,["isHashesValue"]:Xb===fh.HashesValueMismatch,["areValuesEqual"]:xe===Bf})}0<Ve.length&&oa.ULS.sendTraceTag(67707660,0,20,"ECS mismatch detected! "+JSON.stringify({["flowId"]:Dc,["stateIdDiff"]:he,["isSameRequestId"]:Me,["requestIdBeforeEvent"]:Ad,["requestIdAfterEvent"]:re,["correctCellsCount"]:Tb.length-Ve.length,["cellsWithMismatchCount"]:Ve.length,
["mismatches"]:Ve}));0<Qf&&oa.ULS.sendTraceTag(508704130,0,50,"FormulaByExampleEcsMismatchDetection:checkForEcsMismatch: "+Qf+" cells not loaded. flowId: "+Dc)})}function D(Ra){return pc.Range.gi(Ra.row+1,Ra.col+1)}function J(Ra,Tb){Ra=1===Ra.Xn.type?parseFloat(Ra.Xn.value):Ra.Xn.value;return hg(Tb)===Ra}function W(Ra){return"Table"===Ra.kind?Ra.formula:Ra.oGd}function N(Ra,Tb,Dc){if(Ra===Tb)return!0;if(!Ra||!Tb||Ra.kind!==Tb.kind||Ra.L_!==Tb.L_||Ra.sze!==Tb.sze||Ra.source.trigger!==Tb.source.trigger)return!1;
switch(Ra.kind){case "Success":return Dc?M(Ra,Tb):Ra.value===Tb.value&&Ra.index===Tb.index&&Ra.length===Tb.length&&Ra.color===Tb.color;case "Loading":return Ra.index===Tb.index&&Ra.length===Tb.length;default:return Ra}}function M(Ra,Tb){return Ra.L_===Tb.L_&&Ra.index===Tb.index&&Ra.length===Tb.length}function Q(Ra,Tb,Dc){if(Ra===Tb)return Dc;if(Tb.textContent!==Tb.parentElement.textContent)for(;null!==Tb.previousSibling;)Tb=Tb.previousSibling,Dc+=Tb.textContent.length,"div"===Tb.nodeName.toLowerCase()&&
(Dc+=1);return Q(Ra,Tb.parentElement,Dc)}function R(Ra,Tb){return Ra.text===Tb.text&&Ra.index===Tb.index&&Ra.length===Tb.length}a.r(x);var O={};a.r(O);a.d(O,"CellAutoCompleteControl",function(){return Xa});var U={};a.r(U);a.d(U,"CellAutoCompleteReadoutHandler",function(){return qb});var K={};a.r(K);a.d(K,"DatePickerCommandHandler",function(){return ya});var F={};a.r(F);a.d(F,"DatePickerControl",function(){return sc});var I={};a.r(I);var P={};a.r(P);a.d(P,"FormulaAssistanceManager",function(){return Vb});
var Y={};a.r(Y);a.d(Y,"FormulaAssistanceReadoutHandler",function(){return rg});var ea={};a.r(ea);a.d(ea,"FormulaAssistanceValuePreviewCommandHandler",function(){return yf});var Ba={};a.r(Ba);a.d(Ba,"FormulaAssistanceValuePreviewRequester",function(){return me});var Fa={};a.r(Fa);var za={};a.r(za);var xa={};a.r(xa);a.d(xa,"FormulaByExampleCardUIControl",function(){return tf});var fa={};a.r(fa);a.d(fa,"FormulaByExamplePluginTriggersManager",function(){return Zd});var V={};a.r(V);a.d(V,"FormulaByExamplePluginValidator",
function(){return ff});a.d(V,"FormulaByExamplePluginValidatorProxy",function(){return af});var ba={};a.r(ba);var la={};a.r(la);a.d(la,"FormulaByExampleSignalLocksManager",function(){return xc});var Ta={};a.r(Ta);a.d(Ta,"FormulaColumnPreviewManager",function(){return Gd});var Ea={};a.r(Ea);a.d(Ea,"FunctionInfoManager",function(){return Ud});var sa={};a.r(sa);a.d(sa,"GotoCtrlClick",function(){return Ff});var Ya={};a.r(Ya);var bb={};a.r(bb);a.d(bb,"KeptTelemetryHandler",function(){return Gf});var ra=
a(179),Da=a(0),oa=a(14),Ha=a(96),ka=a(263),wa=a(7),Za=a(13),ab=a(24),db=a(6);class mb extends ka.a{constructor(Ra,Tb){super(document.createElement("div"));this.Q0=this.Nsc=this.YLb=this.ZLb=this.Rsc=this.$Lb=!1;this.aT=null;this.visible=void 0;this.zoom=null;this.r7d=(Dc,Yc)=>{this.zy(Dc,Yc)};this.ZZa=()=>{this.Gi.$b.tR=!0};this.wMa=()=>{this.autoComplete(!0)};this.Sdg=()=>{this.Gi.$b.focus()};this.onActiveCellChanged=()=>{ab.f(this.$).inRangePicker||(this.Wm=!1)};this.$=Ra;this.zoom=Tb;ab.f(Ra)&&
ab.f(Ra).ha&&ab.f(this.$).ha.add_activeCellChanged(this.onActiveCellChanged)}get zoomManager(){return this.zoom.zoomManager}get GM(){return this.kI.GM}get Wm(){return this.kI.Wm}set Wm(Ra){this.kI.Wm=Ra}get Gi(){return this.aT}set Gi(Ra){(this.aT=Ra)&&this.aT.Sye.add(this)}get_visible(){return void 0!==this.visible?this.visible:this.visible=super.get_visible()}set_visible(Ra){if(this.visible===Ra)return Ra;this.visible=Ra;return super.set_visible(Ra)}zy(){this.RPa(!1);this.kI.zy()}dispose(){this.$&&
ab.f(this.$)&&ab.f(this.$).ha&&ab.f(this.$).ha.remove_activeCellChanged(this.onActiveCellChanged);this.$=null;super.dispose()}mq(Ra,Tb,Dc){Ra=!1;if((this.cLb||(void 0===Dc?0:Dc))&&!this.umb()&&this.get_visible()&&this.Wm)switch(this.vwe(Tb),Tb){case 1872288872:this.Wm=!1;Ra=!0;break;case -798660877:this.kI.rH(1);Ra=!0;break;case 137938150:this.kI.rH(-1);Ra=!0;break;case 2091832999:this.kI.rH(this.GM-1);Ra=!0;break;case 742457698:this.kI.rH(-(this.GM-1));Ra=!0;break;case 125627505:Ra=this.autoComplete(!1);
break;case 267796030:Ra=this.autoComplete(!1)}return Ra}RPa(Ra){if(this.Wm||Ra){var Tb=ab.f(this.$);Ra=this.aT.$b.domElement;var Dc=this.zoomManager.Pn(Ra.offsetHeight),Yc=this.zoomManager.Pn(Ra.offsetTop);Ra=this.zoomManager.Pn(Ra.offsetLeft);var Ad=Tb.fA,he=db.AFrameworkApplication.ra&&db.AFrameworkApplication.ra.$d.Fk;Tb=$get(this.$.$h+wa.a.Xoc,this.$.domElement);he&&(Tb=document.getElementById("EditorContainer"));var re=new Sys.UI.Point(Ad?this.kI.kGd:0,Ad?-5:mb.j_i);Dc=Tb.offsetTop+re.y+(Ad?
0:Dc+Yc);this.$.Hna||(Yc=$get(wa.a.yFa,this.$.domElement),Dc+=Yc&&!he?Yc.offsetHeight:0);Yc=this.domElement;Yc.style.top=Za.HelperMethods.ti(Dc);Yc.style.left=Za.HelperMethods.ti(Tb.offsetLeft+Ra+re.x)}}S7b(Ra){this.kI&&(Ra&&!this.Q0?(this.kI.Dka(this.Sdg),this.kI.ukc(this.ZZa),this.kI.pGb(this.wMa),this.Q0=!0):this.Q0&&(this.kI.Epa(this.Sdg),this.kI.HSc(this.ZZa),this.kI.k3b(this.wMa),this.Q0=!1))}vwe(Ra){switch(Ra){case -798660877:case 137938150:case 2091832999:case 742457698:this.$Lb=!0;break;
case 125627505:this.ZLb=!0;break;case 267796030:this.YLb=!0}}}mb.kGd=0;mb.j_i=1;Object(Da.a)(mb,"AutoCompleteControl",ka.a,[229]);var Ia=a(10);class pa extends Sys.EventArgs{constructor(Ra,Tb,Dc,Yc){Tb=void 0===Tb?0:Tb;Dc=void 0===Dc?"":Dc;Yc=void 0===Yc?"":Yc;super();this.length=Ra;this.selectedIndex=Tb;this.zP=Dc;this.description=Yc}}Object(Da.a)(pa,"ListEventArgs",Sys.EventArgs,[]);class lb{constructor(Ra,Tb){this.deh=Ra;this.ceh=Tb}get Ota(){return this.deh}get Upd(){return this.ceh}}Object(Da.a)(lb,
"CellAutoCompleteItem",null,[253]);var ha=a(1231),ua=a(551),fb=a(45),Ka=a(1),La=a(27);class ib extends ha.a{constructor(Ra,Tb,Dc){super(Ra,Tb);this.dy=null;this.zIc=0;this.jca=this.hob=null;this.kMa=(Yc,Ad)=>{if(Yc=this.dy.items)if(1===Yc.length&&this.dy.cLb.length<Yc[0].Ota.length&&this.dy.TJa&&La.a.aL(Yc[0].Ota,this.dy.cLb)&&(Ad.newValue=Yc[0].Ota),this.Gi&&Ka.EwaSettings.Ra(128)){let he=-1;1<Yc.length?he=this.dy.qAc(this.Gi.text,!0):1===Yc.length&&(this.dy.TJa||this.dy.mCc)&&(he=0);if(0<=he&&Yc.length>
he&&Yc[he].Upd){const re=fb.F(Yc[he].Upd);re&&ab.f(this.$).Yg.MKa(re)&&(Ad.mUf=!0,Ad.gaf=Yc[he].Upd)}}};this.X_b=()=>{this.dy.TJa=!1};this.Gi.aGb(this.kMa);this.dy=Dc;this.jca=this.Xk.Ek(this.Gi.$b.domElement);this.jca.Aa("mousedown",this.X_b)}get LEc(){return!1}get DKa(){return this.dy.Wm}set DKa(Ra){this.dy.Wm=Ra}get OCc(){return!1}get key(){return ua.a.Jsd}dispose(){this.Gi.zSc(this.kMa);super.dispose()}nua(Ra){Ra&&!this.dy.Wm||super.nua(Ra)}mq(Ra,Tb){this.dy.Gi=this.Gi;this.zIc=Ra.keyCode;if(this.Gi.isEditing){const Dc=
this.Gi.text;La.a.equals(this.hob,Dc,!1)||(this.hob=Dc)}else this.hob=null;if(237279923===Tb)return this.dy.Wm=!1;Ka.EwaSettings.Ra(128)&&17===this.zIc&&this.dy.TJa&&(this.dy.mCc=!0);return super.mq(Ra,Tb)}Tdg(){var Ra;if(!Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:5172529_CheckForShuttingDownInAutocompletionTimedCallback")||!db.AFrameworkApplication.Il)if(this.dy.Gi=this.Gi,this.dy.TJa=!1,this.Gi.isEditing){const Tb=!La.a.equals(this.hob,this.Gi.text,!0),Dc=this.Gi.CTd;Dc||!Tb&&229!==this.zIc?
Dc&&(this.dy.Wm&&(this.dy.Wm=!1),null===(Ra=this.dy.M1a)||void 0===Ra?void 0:Ra.cancel()):this.dy.cGh(this.zIc)}else this.hob=null}en(){}yl(){this.DKa=!1;this.dy.set_visible(!1);this.hob=null;this.dy.TJa=!1;this.dy.mCc=!1;this.dy.M1a&&this.dy.M1a.cancel()}cvg(Ra,Tb){return this.dy.mq(Ra,Tb)}}Object(Da.a)(ib,"CellAutoCompleteListAutoCompleteBehavior",ha.a,[]);var Yb=a(34),Wc=a(1070),Qc=a(69),Wb=a(16),Jc=a(142),ma=a(1090);class Hc extends Wc.a{constructor(Ra,Tb){super(Ra,Tb,new ma.a("list-item","list-item-selected",
"list-table","list-table-touch"));this.WAc=!1;this.aEb=this.P4=null;this.Zyf=!1;this.visible=void 0;this.ePa(!0);this.Zyf=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:5893822_FixFormulaBarXOffsetCrash")}get kGd(){const Ra=document.getElementById(this.$.$h+wa.a.iGd);return!this.Zyf||Ra?Wb.DOMElementExtensions.getBoundingClientRect(Ra).x:0}get Kl(){return this.aEb}set Kl(Ra){this.aEb=Ra}get Wm(){return void 0!==this.visible?this.visible&&0<this.P4.length:(this.visible=Wb.DOMElementExtensions.isVisible(this.Jm))&&
0<this.P4.length}set Wm(Ra){this.visible!==Ra&&(Wb.DOMElementExtensions.setVisible(this.Jm,Ra),Wb.DOMElementExtensions.setVisible(this.$wb,Ra),this.visible=Ra);const Tb=ab.f(this.$).view;Ra?this.WAc||(Tb.Wy(this.Tpd.r7d),this.WAc=!0):(this.P4.length=0,this.WAc&&(Tb.Kx(this.Tpd.r7d),this.WAc=!1))}lLc(){var Ra=460;const Tb=ab.f(this.$);var Dc=Tb.domElement,Yc=this.$wb.style;const Ad=this.Jm.offsetTop+this.Cu.offsetHeight*this.Cu.sectionRowIndex-this.Jm.scrollTop;Yc.width="auto";Yc.whiteSpace="nowrap";
Yc.position="absolute";const he=Dc.offsetLeft+Dc.offsetWidth-(this.domElement.offsetLeft+this.Jm.offsetLeft+this.Jm.offsetWidth+3);Dc=this.domElement.offsetLeft-3-(Dc.offsetLeft+this.kGd);Ra=Math.min(this.$wb.offsetWidth,Ra,Math.max(he,Dc));Wb.DOMElementExtensions.SH(this.$wb,Ra);Yc.whiteSpace="";Yc.position="absolute";Ad+3>this.Jm.offsetTop+this.Jm.offsetHeight||Ad<this.Jm.offsetTop||(Ra=this.Jm.offsetLeft-3-this.$wb.offsetWidth,Yc=this.Jm.offsetLeft+this.Jm.offsetWidth+3,Wb.DOMElementExtensions.updatePosition(this.$wb,
Dc>he!==Tb.rtl?Ra:Yc,Ad,!1))}rH(Ra){super.rH(Ra);this.lLc()}zy(){this.lLc()}nUa(){const Ra=this.Zq,Tb=this.Jm,Dc=3===Qc.a.eh||Yb.a.Gx,Yc=Dc?this.JLa:this.GM;this.Wm=!0;Tb.style.height="auto";this.Tpd.set_visible(!0);this.RFb(Ra,Dc);this.P4.length>Yc&&(Wb.DOMElementExtensions.cW(Tb,Math.floor(Tb.offsetHeight*Yc/this.P4.length)),Tb.style.overflowY="auto");Wb.DOMElementExtensions.SH(Tb,Ra.offsetWidth+(this.P4.length>Yc?Jc.a.Lx:0))}}Object(Da.a)(Hc,"AutoCompleteListBox",Wc.a,[]);class Kb extends Hc{constructor(Ra,
Tb,Dc,Yc){super(Ra,Tb);this.jhc=null;this.ji=Dc;this.dy=Yc;this.P4=[]}get Cu(){return this.jhc}set Cu(Ra){this.f8a(this.Cu);this.jhc=Ra;const Tb=this.f8a(this.Cu);this.Kl=Ra?Tb.innerText:null;this.yke(Ra)}get Wm(){return super.Wm}set Wm(Ra){super.Wm=Ra;Ra||(this.Cu=null)}get $wb(){return null}get Tpd(){return this.dy}dispose(){super.dispose();this.jhc=null}STk(Ra){this.hBa(!1);const Tb=document.createElement("table");Tb.classList.add(this.sya);Tb.LFh=wa.a.DFa;const Dc=document.createElement("tbody");
for(let Yc=0,Ad=this.P4.length;Yc<Ad;Yc++){const he=document.createElement("tr"),re=document.createElement("td");re.classList.add(this.L1a);const Me=document.createElement("span");Me.classList.add(Kb.Ksd);Me.setAttribute(wa.a.W2e,Ra[this.P4[Yc]].Ota);Me.innerText=Ra[this.P4[Yc]].Ota;re.appendChild(Me);he.appendChild(re);Dc.appendChild(he)}Tb.appendChild(Dc);this.ji.eO(this.Jm);this.Jm.appendChild(Tb);this.Zq=Wb.DOMElementExtensions.Uu(this.domElement,this.sya);this.hBa(!0);this.nUa()}Vti(Ra,Tb){if(Ra&&
Ra.length){var Dc=[];if(Tb)for(let Yc=0,Ad=Ra.length;Yc<Ad;Yc++)La.a.aL(Ra[Yc].Ota,Tb)&&Dc.push(Yc);this.P4=Dc;this.STk(Ra)}else this.Wm=!1,this.jhc=null}lLc(){}bOh(Ra,Tb,Dc){let Yc=Math.min(Ra,Math.max(200,Dc));Tb&&Ra<Dc&&(Yc+=Jc.a.Lx);Wb.DOMElementExtensions.SH(this.Jm,Yc);Tb&&(Yc-=Jc.a.Lx);return Yc}nUa(){super.nUa();var Ra=Wb.DOMElementExtensions.Uu(this.get_element(),this.sya),Tb=this.P4.length>this.GM,Dc=ab.f(this.$);if(Dc=Dc.kh(Dc.ha.qa.activeCell))for(Ra=this.bOh(Ra.offsetWidth,Tb,Dc.width),
Tb=this.Jm.getElementsByClassName(Kb.Ksd),Dc=0;Dc<Tb.length;Dc++)Tb[Dc].style.maxWidth=Za.HelperMethods.ti(Ra);else oa.ULS.sendTraceTag(537167964,0,15,"CellAutoCompleteListBox.AdjustHeightAndWidth: Can't retrive FormattedCell of the Current Active Cell.")}onItemClick(Ra){if(Ra=super.onItemClick(Ra)){const Tb=ab.f(this.$);Tb.Cz(!1);Tb.focus()}return Ra}}Kb.Ksd="ewa-suggested-cell-name";Object(Da.a)(Kb,"CellAutoCompleteListBox",Hc,[]);var pc=a(26),$b=a(77),Ib=a(137),Zb=a(183),Eb=a(54),ob=a(39),Na=a(323),
nb=a(19),Hb=a(97),na=a(5),Gb;let Xa=Gb=class extends mb{constructor(Ra,Tb,Dc,Yc,Ad){super(Ra,Ad);this.lRa=null;this.Isd=[];this.mCc=this.TJa=!1;this.gOe=this.As=null;this.Wnf=()=>{this.R9.Vti(this.items,this.lRa);this.raiseEvent("ACLBUpdated",new pa(this.items.length));this.show()};a(1423);this.Cj=Tb;this.domElement.className="ewa-ac";Tb=document.createElement("div");Tb.classList.add("ewa-lb");Tb.classList.add(nb.a.YG);Tb.id="suggested_cells_list_box";this.domElement.appendChild(Tb);Wb.DOMElementExtensions.setVisible(this.domElement,
!1);Na.d(this.style,this.$.isChromeRtl);this.faf=$get("suggested_cells_list_box",this.domElement);this.R9=new Kb(this.$,this.faf,Dc,this);this.S7b(!0);this.$.domElement.appendChild(this.domElement);Ib.b(this.$,he=>{this.vHb(Ra,he)});this.vHb(Ra,ab.f(Ra).sh);this.Efj=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8554518_ChangeHandleKeyDownConditionOrder");Yc.Aa(this)}Qmd(Ra){this.addHandler("ACLBUpdated",Ra)}oge(Ra){this.removeHandler("ACLBUpdated",Ra)}Cw(Ra){this.addHandler("ACLBSelectionChanged",
Ra)}$w(Ra){this.removeHandler("ACLBSelectionChanged",Ra)}azh(Ra){this.addHandler("ACLBMatchedItem",Ra)}Ajk(Ra){this.removeHandler("ACLBMatchedItem",Ra)}get kI(){return this.R9}get cLb(){return this.lRa}get Kl(){return this.R9.Kl}get items(){return this.As}get M1a(){return this.gOe}get activeCell(){return ab.f(this.$).ha.qa.activeCell}lVg(Ra){for(let Tb=0;Tb<Ra.length;Tb++)if(La.a.isLetter(Ra.charCodeAt(Tb)))return!0;return!1}umb(){return!this.items}dispose(){if(this.$){this.S7b(!1);const Ra=ab.f(this.$);
Ra&&Ra.view.Kx(this.r7d)}Ha.a.Ni([this.R9,this.M1a]);Ha.a.Ni(this.Isd);this.Isd=this.faf=this.R9=this.Gi=null;super.dispose()}mq(Ra,Tb){let Dc=!1;if(this.MHk())switch(Tb){case -798660877:if(1===this.items.length&&this.Kl)break;this.kI.rH(1);this.raiseEvent("ACLBSelectionChanged",new pa(this.items.length,this.qAc(this.Kl),this.Kl));Dc=this.autoComplete(!1);break;case 137938150:if(1===this.items.length&&this.Kl)break;this.kI.rH(-1);this.raiseEvent("ACLBSelectionChanged",new pa(this.items.length,this.qAc(this.Kl),
this.Kl));Dc=this.autoComplete(!1);break;case 2091832999:this.kI.rH(this.GM-1);Dc=this.autoComplete(!1);break;case 742457698:this.kI.rH(-(this.GM-1));Dc=this.autoComplete(!1);break;case 125627505:this.Gi.$b.caretPosition=this.Gi.text.length;this.Wm=!1;Dc=!0;break;case 267796030:this.autoComplete(!0);break;default:Dc=super.mq(Ra,Tb)}return Dc}show(){this.items&&this.items.length&&(this.R9.Cu=this.Kl?this.kI.Zq.rows[this.qAc(this.Kl)]:null,this.Wm=0<this.R9.P4.length,this.RPa(!0),this.R9.lLc())}cGh(Ra){const Tb=
!!this.Gi&&!$b.f(this.$.na);this.mCc=this.TJa=!1;this.Gi&&!this.Gi.isEditing?this.set_visible(!1):Tb&&!this.o8h(this.activeCell)&&this.jMk(Ra)}o8h(Ra){var Tb;return null===(Tb=Hb.a.Zg(na.rb))||void 0===Tb?void 0:Tb.jAd(Ra)}autoComplete(Ra){if(!this.Gi||!this.Wm)return!1;const Tb=this.lRa;if(this.Kl){var Dc=Wb.DOMElementExtensions.Gfa(Wb.DOMElementExtensions.Uu(this.R9.Cu,Kb.Ksd),wa.a.W2e,"");const Yc=Dc.substring(Tb.length,Dc.length);Ra?this.Gi.text=Dc:this.Gi.insertTextAt(Yc,Tb.length,this.Gi.text.length)}Dc=
ab.f(this.$);Dc.fA&&(Dc=Dc.sh,Dc.text=this.Gi.text,Dc.setCaretPosition(this.Gi.$b.caretPosition));Ra?this.Wm=!1:this.Gi.$b.selectRange(Tb.length,this.Gi.text.length);return!0}qAc(Ra,Tb){Tb=void 0===Tb?!1:Tb;if(!this.R9.Zq)return-1;const Dc=this.R9.Zq.children[0],Yc=Dc.children.length;let Ad;for(let he=0;he<Yc;++he)if(Ad=Dc.children[he],La.a.equals(Ad.innerText.trim(),Ra,Tb))return he;return-1}zth(Ra,Tb,Dc,Yc,Ad,he,re){const Me=Dc.originalText.replace(Gb.Nbg,String.fromCharCode(32)),Ve=new pc.Range(Ra.top-
1,Ra.left,Ra.bottom-1,Ra.right,!1,!1),Hf=re?re.my(Dc.range):null;(!Dc.kH||Dc.range.left===Ra.left)&&1<Me.length&&!Yc.Vg(Me.toUpperCase())&&La.a.aL(Me,Tb)&&!La.a.equals(Me,Tb,!0)&&!Gb.lxf(Tb)&&this.lVg(Me)&&(!Ad&&!Hf||!Ad&&Hf.equals(re.my(Ve))||Ad&&Dc.range.yi(he)&&Dc.range.top!==he.top)&&(Ra=Dc.formulaBarText,La.a.equals(Ra,Dc.text,!1)||!Ra)&&(Ra={},Ra.FirstRow=Dc.range.top-1,Ra.FirstColumn=Dc.range.left-1,Dc=new lb(Me,Ra),Yc.add(Me.toUpperCase(),Dc))}jMk(Ra){this.As=this.FVi();this.M1a&&this.M1a.cancel();
0<this.Gi.text.length&&0!==Ra?this.items&&((1<this.items.length||this.Wm)&&this.wei(),8!==Ra&&127!==Ra&&46!==Ra&&(1===this.items.length?this.B7i():this.R9.Cu&&this.autoComplete(!1))):this.Wm=!1}wei(){this.Wm?this.Wnf():this.gOe=Zb.AsyncMethodContext.$B(this.Wnf,500,Eb.a.RQh,this.M1a)}B7i(){oa.ULS.shipAssertTag(537167966,0,!this.umb()&&1===this.items.length,"Invalid Items");const Ra=this.items[0].Ota,Tb=this.Gi.text,Dc=Ra.substring(Tb.length,Ra.length);0<Dc.length&&(this.Gi.appendText(Dc),this.Gi.$b.selectRange(Tb.length,
this.Gi.text.length),this.raiseEvent("ACLBMatchedItem",new pa(this.items.length,0,Ra)),this.TJa=!0)}FVi(){this.As=null;const Ra=new ob.a(!1);var Tb=this.activeCell;this.lRa=this.Gi.text.replace(Gb.Nbg,String.fromCharCode(32));const Dc=this.Cj.my(Tb),Yc=Tb.yi(Dc);if(Gb.lxf(this.lRa)||!this.lVg(this.lRa))return this.items;const Ad=new pc.Range(1,Tb.left,Tb.top-1,Tb.left,!1,!1);var he=new pc.Range(Tb.top+1,Tb.left,Ia.a.gl,Tb.left,!1,!1);let re;const Me=ab.f(this.$);he=Me.ot("CellAutoCompleteControl.GetSuggestedCells",
he);try{const Ve=Me.ot("CellAutoCompleteControl.GetSuggestedCells2",Ad);try{for(const Hf of[Ve,he])for(;Hf.$$mn();)re=Hf.$$cu(),this.zth(Tb,this.lRa,re,Ra,Yc,Dc,this.Cj)}finally{Ve&&Ve.dispose()}}finally{he&&he.dispose()}this.As=Array(Ra.values.length);for(Tb=0;Tb<this.items.length;Tb++)this.items[Tb]=Ra.values[Tb];this.items.sort((Ve,Hf)=>Ve.Ota.localeCompare(Hf.Ota));return this.items}vHb(Ra,Tb){Ra&&Tb&&this.Isd.push(new ib(Ra,Tb,this))}MHk(){return this.Efj?this.cLb&&!this.umb()&&this.Wm?this.get_visible():
!1:this.cLb&&!this.umb()&&this.get_visible()&&this.Wm}static get Nbg(){return Gb.SPe||(Gb.SPe=new RegExp(String.fromCharCode(160),"g"))}static lxf(Ra){Ra=0<Ra.length?Ra.charCodeAt(0):-1;return 35===Ra||61===Ra||43===Ra||45===Ra||64===Ra}};Xa.SPe=null;Xa=Gb=Object(ra.__decorate)([Object(Hb.d)(na.I,{yk:"transient"}),Object(ra.__param)(0,Object(na.Lb)()),Object(ra.__param)(1,Object(na.hg)()),Object(ra.__param)(2,Object(na.kd)()),Object(ra.__param)(3,Object(na.J)()),Object(ra.__param)(4,Object(na.Lg)())],
Xa);Object(Da.a)(Xa,"CellAutoCompleteControl",mb,[228,229,230,2]);var Jb=a(12);let qb=class{constructor(Ra){this.Udb=null;this.zlg=(Tb,Dc)=>{1<Dc.length&&(Tb=Jb.a.instance.ia(858),this.ariaLiveNotifier.Ixg(Tb,Dc.length))};this.Alg=(Tb,Dc)=>{oa.ULS.shipAssertTag(537167961,0,0<=Dc.selectedIndex&&0<=Dc.length&&Dc.selectedIndex<Dc.length,"Invalid ListEventArgs: SelectedIndex/Length");oa.ULS.shipAssertTag(537167960,0,!!Dc.zP,"ListEventArgs: SelectedValue should not be null");this.ariaLiveNotifier.mbk(Dc.zP,
Dc.selectedIndex+1,Dc.length)};this.Blg=(Tb,Dc)=>{this.ariaLiveNotifier.xba(Dc.zP)};this.ariaLiveNotifier=Ra}dispose(){this.bwe();this.Udb=null}Aa(Ra){Ra&&(this.Udb=Ra,Ra.Qmd(this.zlg),Ra.Cw(this.Alg),Ra.azh(this.Blg))}bwe(){this.Udb&&(this.Udb.oge(this.zlg),this.Udb.$w(this.Alg),this.Udb.Ajk(this.Blg))}};qb=Object(ra.__decorate)([Object(Hb.d)(na.J),Object(ra.__param)(0,Object(na.l)())],qb);Object(Da.a)(qb,"CellAutoCompleteReadoutHandler",null,[722,2]);var Db=a(209),gb=a(66);let ya=class{constructor(Ra){this.Sqj=
Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8347550_DatePicker_VerboseLogs");this.v8h=Ra}Bi(){return!1}executeCommand(Ra,Tb){Ra=!1;Tb=Tb.command;switch(Tb){case 1159342996:this.Sqj&&oa.ULS.sendTraceTag(508117152,0,50,"DatePicker Invoked through Ribbon Command"),this.v8h.H6b(!0),Ra=!0}return Ra?gb.Task.Va(!0):Db.a(Tb)}ni(Ra,Tb){switch(Tb.command){case 1159342996:return Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePicker",!1);default:return!1}}Ji(){return!1}};ya=Object(ra.__decorate)([Object(Hb.d)(na.tb),
Object(ra.__param)(0,Object(na.ub)())],ya);Object(Da.a)(ya,"DatePickerCommandHandler",null,[39]);var Aa=a(128),sb=a(593),nc=a(98),Bb=a(1018),uc=a(279),Pc=a(621),wd=a(163),Md=a(152),Nd=a(2),ec=a(321),gc=a(239),Mb;let sc=Mb=class extends Bb.a{constructor(Ra,Tb,Dc,Yc){var Ad,he,re;super(Ra,Mb.featureName);this.GEc=!1;this.k$k=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8347550_DatePicker_VerboseLogs");this.dXk=new Date;this.ikc=Me=>{this.k$k&&oa.ULS.sendTraceTag(508101778,0,50,`[DatePicker-Ewa] ${Me}`)};
this.aXa=()=>{this.GEc&&Object(Md.d)(()=>{this.WJ.xI();this.GEc=!1;this.Wi.detach("scroll");this.da.view.Kx(this.aXa)})};this.onActiveCellChanged=()=>{const Me=this;return No(function*(){Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DatePickerFloatie",!1)&&(Me.aXa(),gc.a(()=>No(function*(){!Me.WJ.hUb()&&(yield Object(Pc.b)(Me.grid.kh(null)))&&(oa.ULS.sendTraceTag(508610529,0,100,"DatePickerControl.onActiveCellChanged: Date Picker Floatie is to be shown"),Me.aRg())}),100)())})};this.iMa=
(Me,Ve)=>{const Hf=this;return No(function*(){Hf.aXa();!Hf.CLb&&(yield Object(Pc.a)(Ve))&&(oa.ULS.sendTraceTag(509147206,0,50,"DatePickerControl.onCellEditStarted: Encountered Date in cell, Date Picker service already available, showing date picker"),Hf.Wrc.start(),Hf.H6b())})};this.hMa=()=>{this.Izd()};this.lA=()=>{var Me;Object(wd.g)(null===(Me=this.grid.sh)||void 0===Me?void 0:Me.text)&&this.Izd()};this.Cyk=Me=>{var Ve,Hf=this.da.sh,Qf=this.da.kh(null);if(Qf){var ia=null===(Ve=this.Ej)||void 0===
Ve?void 0:Ve.config;if(!ia){this.Uie("DatePickerControl.SetCellDate: calc config unavailable",Hf);return}Me=excelOnlineCalc.date.dateTime(Me.getFullYear(),Me.getMonth()+1,Me.getDate(),Me.getHours(),Me.getMinutes(),Me.getSeconds(),0,Me.getMilliseconds(),0);Me=ia.datepack.toNum(ia,Me);ia=ia.mathpack.toNumber(Me);this.CLb=!1;if(this.oTf||this.$.Bga){Me=this.ek.BLd(Qf,{ValidMembers:32,NumberFormat:4});if(!Me.success&&Me.XLa){this.Uie(`DatePickerControl.SetCellDate: Conversion to ribbon number format failed, LogData:  ${`
            reason: ${Me.reason},
            format: ${Me.XLa}`}`,Hf);return}Qf=this.ek.nxi(ia.toString(),Me.XLa,Qf.cell.d4);if(!Qf.success){this.Uie("DatePickerControl.SetCellDate:formatStringValueWithFormatString failed",Hf);return}Hf.text=Qf.lM;this.oTf=!1}else Hf.text=ia.toString();this.GEc?(Hf=Object(Nd.a)(new ec.a,{Text:Hf.text}),this.da.setCell(Hf,this.da.ha.qa.activeRange,0,127,null),this.aXa()):Hf.endEdit(!0,"DatePickerControl.SetCellDate",0);oa.ULS.sendTraceTag(509110228,0,50,"DatePickerControl.setCellDate: User selected Date using Date Picker")}this.Vha()};
this.Uie=(Me,Ve)=>{oa.ULS.sendTraceTag(508956939,0,10,Me);Ve.endEdit(!0,"DatePickerControl.SetCellDate Failed",0);this.Vha()};this.mhi=()=>{this.Wrc&&(this.Wrc.stop(),oa.ULS.sendTraceTag(508823174,0,50,`DatePickerControl: Time taken to render DatePicker: ${this.Wrc.ii}`))};this.Vha=Me=>{Object(Md.d)(()=>{this.ikc("DatePickerControl: Restoring Focus ");this.CLb=!1;Aa.FocusManager.instance().xr(sb.AFrame.G_);nc.a.Stb(Wb.DOMElementExtensions.YPb(this.$.ll),Qc.a.eh,Me,this.$,this.da)})};this.wtg=()=>
{this.ikc("DatePickerControl: Preserving Focus ");Aa.FocusManager.instance().xr(sb.AFrame.o1)};this.$=Ra;this.da=ab.f(this.$);this.Ej=Tb;this.ek=Dc;this.WJ=Yc;null===(Ad=this.da.sh)||void 0===Ad?void 0:Ad.Wx(this.hMa);null===(he=this.da.sh)||void 0===he?void 0:he.FQ(this.iMa);null===(re=this.da.sh)||void 0===re?void 0:re.fUa(this.lA);this.da.ha.add_activeCellChanged(this.onActiveCellChanged);this.Wrc=this.$.qh.Vl("DialogShown","DatePickerRender")}dispose(){var Ra,Tb,Dc;this.ikc("Dismissing DatePickerControl");
this.Izd();this.aXa();null===(Ra=this.da.sh)||void 0===Ra?void 0:Ra.nS(this.iMa);null===(Tb=this.da.sh)||void 0===Tb?void 0:Tb.Zw(this.hMa);null===(Dc=this.da.sh)||void 0===Dc?void 0:Dc.m5a(this.lA);this.da.ha.remove_activeCellChanged(this.onActiveCellChanged);super.dispose()}get Hk(){return uc.a.Xjf}aRg(){c(this.grid,this.WJ);this.GEc=!0;this.da.view.Wy(this.aXa);this.Wi.Aa("scroll",this.aXa)}H6b(Ra){this.oTf=void 0===Ra?!1:Ra;this.NCg(this.da.ha.qa.activeCell,!0)}Izd(){this.CLb&&(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8389936_datepicker_architecture_change")?
Object(Md.d)(()=>{appChrome.hideDatePicker();this.CLb=!1}):this.NCg(null,!1))}NCg(Ra,Tb){Ra=void 0===Ra?null:Ra;const Dc=()=>{this.Uvb(Ra,Ad=>{this.ikc(`DatePickerControl.renderDatePicker: ${Tb?"Showing":"Hiding"}  DatePicker at targetBounds: ${JSON.stringify(Ad)}`);appChrome.renderDatePicker(this.domElement,Ad.y,Ad.x,Ad.y+Ad.height,Ad.x+Ad.width,Tb,Tb?this.HEi():this.dXk,this.Cyk,this.Vha,this.wtg,this.avb,this.da.rtl)});(this.CLb=Tb)&&this.mhi()},Yc=()=>{Object(Md.d)(()=>{Dc()})};Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8389936_datepicker_architecture_change")&&
Object(Md.a)()&&window.requestIdleCallback?window.requestIdleCallback(Dc,{timeout:100}):Yc()}HEi(){var Ra,Tb=new Date,Dc=null===(Ra=this.da.kh(null))||void 0===Ra?void 0:Ra.cell;if((null===Dc||void 0===Dc?0:Dc.cellValue)&&this.Ej.aVf(Dc.Vn)&&1===Dc.UC){Ra=this.Ej.config;Dc=parseInt(Dc.cellValue,10);if(!Dc||0>=Dc)return Tb;Tb=Ra.mathpack.fromNumber(Dc);Tb=Ra.datepack.fromNum(Ra,Tb,0);Tb=new Date(Tb.yr,Tb.mon-1,Tb.dom)}return Tb}gs(){this.wtg()}Xt(){this.Vha()}};sc=Mb=Object(ra.__decorate)([Object(Hb.d)(na.ub),
Object(ra.__param)(0,Object(na.Lb)()),Object(ra.__param)(1,Object(na.E)()),Object(ra.__param)(2,Object(na.sc)()),Object(ra.__param)(3,Object(na.cb)())],sc);Object(Da.a)(sc,"DatePickerControl",Bb.a,[2]);var xd=a(362),xb=a(86);Object(Hb.b)(na.yc)(()=>No(function*(){const Ra=yield Hb.a.resolve(na.Lb);return(Tb,Dc,Yc)=>{if(Dc||(void 0===Yc?0:Yc))a:if(Dc){if(Tb&&(!Tb||Tb.startsWith("http://")||Tb.startsWith("https://"))){if(Ka.EwaSettings.Ra(147)&&(Dc=Hb.a.Zg(na.kf))&&Dc.MBa(Tb))break a;Za.HelperMethods.dm(Tb,
"_blank",xd.a)}}else Za.HelperMethods.i1(Ra.fL,"XLWAEndUser_"+Tb,Ra.gN);else Dc=new xb.a(-859308420,Qc.a.eh,Ra.Rh,0,null),Ra.Ma.dh(Dc,{[Qc.a.Ai]:wa.a.CI,[Qc.a.Wk]:"HelpID="+Tb})}}));var Lb=a(25),Rc=a(147),nd=a(242);class $d extends Sys.EventArgs{constructor(Ra,Tb){super();this.functionName=Ra;this.xzf=Tb}}Object(Da.a)($d,"FormulaAssistanceFunctionChangedEventArgs",Sys.EventArgs,[]);class Td extends Sys.EventArgs{constructor(Ra){super();this.pJg=Ra}}Object(Da.a)(Td,"FormulaAssistanceSelectedParameterChangedEventArgs",
Sys.EventArgs,[]);var He=a(301);class oc{constructor(Ra,Tb,Dc,Yc,Ad){this.bEc=this.uVa=!1;this.$=Ra;this.formulaAssistanceUIControl=Tb;this.Oyf=Dc;this.Mke=Yc;this.hMf=void 0===Ad?null:Ad;this.bEc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6592066_FixAutoCompleteCardFocusBug")}get Co(){return this.uVa}set Co(Ra){this.uVa!==Ra&&(Ra?He.a(this.$).Eq(this):He.a(this.$).FH(this),this.uVa=Ra)}get Hk(){return this.Mke}get Pi(){return this.formulaAssistanceUIControl.getRootElement(this.Oyf)}zp(Ra,Tb){Ra=
!1;Tb||(ab.f(this.$).fp.$b.tR=!0,Ra=this.formulaAssistanceUIControl.focus(this.Oyf));return Ra}Yp(Ra){const Tb=this.Pi;return!(void 0===Tb||null===Tb)&&Wb.DOMElementExtensions.Cn(Tb,Ra)}gs(){this.hMf&&this.hMf();const Ra=ab.f(this.$).fp.$b;this.selection=Ra.selection;Ra.removeSelection()}Xt(){ab.f(this.$).fp.$b.selection=this.selection}dispose(){He.a(this.$).FH(this)}}Object(Da.a)(oc,"FormulaAssistanceFocusManager",null,[59,2]);var ld=a(17),id=a(100),fc=a(154),vc=a(302),Tc=a(168);class Bd{constructor(Ra){this.k$=
Ra;this.w5=this.Woe=this.zv=!1;this.onKeyDown=Tb=>this.w5||"Space"!==Tb.code&&" "!==Tb.key||!Tb.altKey||!Tb.ctrlKey?!1:(this.Buc(),Tb.stopPropagation(),Tb.preventDefault(),!0);this.u1a=Tb=>{if(!this.w5)return!1;if(Tb.eventName===ld.a.zi){const Dc=Tb.La.ctrlKey?1:Tb.La.shiftKey?50:10;switch(Tb.La.keyCode){case id.a.U8a:this.fha(0,-Dc);break;case id.a.$Ba:this.fha(0,Dc);break;case id.a.cQa:this.fha(-Dc,0);break;case id.a.eyb:this.fha(Dc,0);break;case id.a.zZ:case id.a.fu:this.Woe=!0;break;default:return!1}}Tb.eventName===
ld.a.Rj&&this.Woe&&this.tfa(!0);Tb.La.preventDefault();return!0};this.X0b=Tb=>{if(!this.w5)return!1;Tb.La.preventDefault();this.tfa();return!0};this.onBlur=()=>{if(!this.w5)return!1;this.tfa();return!0};this.oD=fc.a.instance;this.eae=vc.a.instance}Aa(Ra){(this.root=Ra)&&!this.zv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.zv=!0)}detach(){this.root&&this.zv&&(this.root.addEventListener("keydown",this.onKeyDown,!0),this.zv=!1)}Buc(){this.root&&(this.k$.Jng("move",!0),this.root.focus(),
this.w5=!0,this.Woe=!1,this.wE(),this.G3d||this.cxd(),this.root.appendChild(this.G3d))}tfa(Ra){this.w5&&(this.w5=!1,this.k$.hOj(void 0===Ra?!1:Ra),this.Bfe(),this.afe())}wE(){this.oD.capture(this.u1a,null);this.eae.yD(ld.a.Zi,this.root,this.X0b,!0);this.root.addEventListener("blur",this.onBlur)}afe(){this.oD.releaseCapture();this.eae.KD(ld.a.Zi,this.root,this.X0b,!0);this.root.removeEventListener("blur",this.onBlur)}Bfe(){var Ra;null===(Ra=this.G3d)||void 0===Ra?void 0:Ra.remove()}fha(Ra,Tb){const Dc=
this.k$.getPosition();Dc.x+=Ra;Dc.y+=Tb;this.k$.setPosition(Dc)}cxd(){this.G3d=Tc.a(24,24,"ShapeQuadArrow_24x24x32","WACMoveArrowIcon",!0,"")}}Object(Da.a)(Bd,"FormulaAssistanceMoveAdapter",null,[]);var Fd=a(380);class le{constructor(Ra){this.k$=Ra;this.startOffset={x:0,y:0};this.uUg=!0;this.zv=!1}yna(){return this.zv&&!!this.handle}b3a(Ra){const Tb=this.k$.getPosition();this.uUg=Tb.renderDown;this.startOffset.x=Tb.x-Ra.clientPoint.x;this.startOffset.y=Tb.y-Ra.clientPoint.y;this.k$.Jng("drag");return!0}cza(Ra){this.k$.setPosition({x:Ra.clientPoint.x+
this.startOffset.x,y:Ra.clientPoint.y+this.startOffset.y,renderDown:this.uUg});return!0}bza(){}aza(){}Aa(Ra,Tb){this.handle=Tb;this.root=Ra;this.handle&&(this.handle.style.cursor="move",Fd.a.instance.Cba(this.handle,this,!1),this.zv=!0)}detach(){this.zv&&this.handle&&(this.handle.style.cursor="",Fd.a.instance.Qia(this.handle,this),this.zv=!1)}}Object(Da.a)(le,"FormulaAssistanceDragAdapter",null,[771]);class dc{get getPosition(){return this.oih}get setPosition(){return this.EUe}constructor(Ra){this.formulaAssistanceTelemetryManager=
Ra;this.zv=!1;this.Ylc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");this.V9b={[Uc.Drag]:0,[Uc.Move]:0};this.W$f=new Bd(this);this.Inf=new le(this)}Aa(Ra,Tb,Dc,Yc){this.oih=Dc;this.EUe=Yc;this.W$f.Aa(Ra);this.Inf.Aa(Ra,Tb);this.zv=!0}detach(){this.zv&&(this.Inf.detach(),this.W$f.detach(),this.zv=!1)}clear(){var Ra;null===(Ra=this.EUe)||void 0===Ra?void 0:Ra.call(this,null);this.detach();this.Rhe()}Jng(Ra,Tb){this.V9b[Ra]++;if(void 0===Tb?0:Tb)this.xbe=
document.activeElement}hOj(Ra){this.xbe&&((void 0===Ra||Ra)&&this.xbe.focus(),this.xbe=null)}Rhe(){const Ra=this.formulaAssistanceTelemetryManager.Oka,Tb=this.V9b[Uc.Drag],Dc=this.V9b[Uc.Move];0<Tb&&(this.formulaAssistanceTelemetryManager.Mda("d"),this.Ylc||(Ra.argumentAssistanceDragTotalCounter+=Tb),this.V9b[Uc.Drag]=0);0<Dc&&(this.formulaAssistanceTelemetryManager.Mda("m"),this.Ylc||(Ra.argumentAssistanceMoveTotalCounter+=Dc),this.V9b[Uc.Move]=0)}}Object(Da.a)(dc,"FormulaAssistanceDragControl",
null,[]);var Uc;(function(Ra){Ra.Drag="drag";Ra.Move="move"})(Uc||(Uc={}));Object(Da.b)("FormulaAssistanceDragMode",Uc);var kb=a(115);const rb=(Ra,Tb,Dc)=>{if(Ra){const Yc=Ra.ka.Ug(491);Yc?Yc.Mda("lm"):oa.ULS.sendTraceTag(523551513,0,50,"FormulaAssistanceExtensions: logHelpLinkClick getService returned a null formulaAssistanceManager");if(Dc)a:if(Dc){if(Tb&&(!Tb||Tb.startsWith("http://")||Tb.startsWith("https://"))){if(Ka.EwaSettings.Ra(147)&&(Ra=Hb.a.Zg(na.kf))&&Ra.MBa(Tb))break a;Za.HelperMethods.dm(Tb,
"_blank",xd.a)}}else Za.HelperMethods.i1(Ra.fL,"XLWAEndUser_"+Tb,Ra.gN);else Dc=new xb.a(-859308420,Qc.a.eh,Ra.Rh,0,null),Ra.Ma.dh(Dc,{[Qc.a.Ai]:wa.a.CI,[Qc.a.Wk]:"HelpID="+Tb})}};var cc;(function(Ra){Ra[Ra.ArgumentAssistanceCard=0]="ArgumentAssistanceCard";Ra[Ra.AutoCompleteMenu=1]="AutoCompleteMenu";Ra[Ra.ValuePreview=2]="ValuePreview"})(cc||(cc={}));class mc extends ka.a{constructor(Ra,Tb,Dc){super(mc.XGd());this.$=Ra;this.formulaAssistanceUIControl=Tb;this.formulaAssistanceTelemetryManager=Dc;
this.isExpanded=!0;this.JIc=this.sF=null;this.Osc=this.cF=!1;this.mfi=0;this.dpd=!1;this.setPosition=Yc=>{this.formulaAssistanceUIControl.setFixedPosition(Yc);this.formulaAssistanceUIControl.updatePosition(cc.ArgumentAssistanceCard)};this.getPosition=()=>this.formulaAssistanceUIControl.getPosition();this.tj=()=>{this.visible=!1};this.onIsExpandedChange=Yc=>{this.c5k(Yc);Yc?this.formulaAssistanceTelemetryManager.Mda("e"):this.formulaAssistanceTelemetryManager.Mda("c")};this.onDismissClick=()=>{this.dismiss();
this.grid.fp.$b.focus()};this.kle=Yc=>{var Ad=this.$;Yc=Yc.functionName;const he={};he[wa.a.zO]="ArgumentAssistanceCard";const re={};re.FunctionName=Yc;he[wa.a.Ovc]=re;Ad.ei(802602464,0,8,he);this.formulaAssistanceTelemetryManager.Mda("gf")};this.zy=()=>{this.formulaAssistanceUIControl.updatePosition(cc.ArgumentAssistanceCard)};this.yl=()=>{this.k$.clear();this.gZk();this.dpd=!1};this.VAk();this.sF=new oc(this.$,this.formulaAssistanceUIControl,cc.ArgumentAssistanceCard,uc.a.Nyf);this.grid=Object(ab.f)(Ra);
this.grid.view.Wy(this.zy);this.grid.ha.Cw(this.tj);this.k$=new dc(this.formulaAssistanceTelemetryManager);this.grid.cellTextEditBox.Wx(this.yl)}Cyh(Ra){this.addHandler("FAFunctionNameUpdated",Ra)}fjk(Ra){this.removeHandler("FAFunctionNameUpdated",Ra)}IAh(Ra){this.addHandler("FAParameterSelectionChangedOld",Ra)}Tkk(Ra){this.removeHandler("FAParameterSelectionChangedOld",Ra)}HAh(Ra){this.addHandler("FAParameterSelectionChanged",Ra)}Skk(Ra){this.removeHandler("FAParameterSelectionChanged",Ra)}get visible(){return this.cF}set visible(Ra){Ra||
this.dismiss();this.cF=Ra}dismiss(){this.cF=!1;this.formulaAssistanceUIControl&&(this.k$.detach(),this.formulaAssistanceUIControl.dismiss(this.domElement),this.JIc=null,this.sF.Co=!1)}show(Ra){this.cF=this.dpd=!0;Ra=this.h6j(Ra);this.formulaAssistanceUIControl&&(this.formulaAssistanceTelemetryManager.YOa(["argumentAssistanceRender"]),this.formulaAssistanceUIControl.renderArgumentAssistanceCard(this.domElement,Ra,()=>b(this.$)),this.Dnk(),this.s2j(Ra),this.k$.Aa(this.formulaAssistanceUIControl.getCalloutElement(cc.ArgumentAssistanceCard),
this.formulaAssistanceUIControl.getDraggableElement(cc.ArgumentAssistanceCard),this.getPosition,this.setPosition),this.sF.Co=!0,this.formulaAssistanceTelemetryManager.C4(["argumentAssistanceRender"]),this.formulaAssistanceTelemetryManager.XMb("argumentAssistanceOverall"))}mq(Ra,Tb){if(1872288872===Tb){if(this.visible)return this.Osc=!0;this.Osc&&(this.formulaAssistanceTelemetryManager.Mda("2ndEsc"),this.Osc=!1)}else this.Osc=!1;return!1}AZa(Ra){return this.visible&&1872288872===Ra?(this.formulaAssistanceTelemetryManager.Mda("esc"),
this.dismiss(),!0):!1}dispose(){this.$&&this.grid&&(this.grid.ha&&this.grid.ha.$w(this.tj),this.grid.view.Kx(this.zy),this.grid.cellTextEditBox.Zw(this.yl));Ha.a.Ng(this.sF);this.$=null}h6j(Ra){const Tb={isExpanded:!1,callbacks:null,functionRenderingInfo:null};Tb.functionRenderingInfo=Ra;Tb.isExpanded=this.isExpanded;this.Lfk(Tb);return Tb}Lfk(Ra){Ra.callbacks={onIsExpandedChange:null,onHelpLink:null,onFeedback:null,onDismissClick:null};Ra.callbacks.onHelpLink=this.oLi(Ra.functionRenderingInfo);Ra.callbacks.onIsExpandedChange=
this.onIsExpandedChange;Ra.callbacks.onFeedback=this.kle;Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8745608_FormulaAssistanceDismiss")&&(Ra.callbacks.onDismissClick=this.onDismissClick)}oLi(Ra){return()=>{Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7826644_formulaAssistanceHelpClickHandlerService")?(void Hb.a.resolve(na.yc).then(Tb=>Tb(Ra.helpID,Ra.isUDF)),this.formulaAssistanceTelemetryManager.Mda("lm")):this.$&&rb(this.$,Ra.helpID,Ra.isUDF)}}VAk(){const Ra=Rc.a.get(wa.a.o5e);Ra?this.isExpanded=
"false"!==Ra:(this.isExpanded=mc.f9h,this.formulaAssistanceTelemetryManager.jyk());this.formulaAssistanceTelemetryManager.kyk(this.isExpanded)}s2j(Ra){var Tb=Ra.functionRenderingInfo.functionName;this.JIc&&La.a.equals(this.JIc,Tb,!0)?(Tb=nd.a.map(Ra.functionRenderingInfo.signatures,Dc=>{let Yc="";0<=Dc.signatureParams.activeParam&&Dc.signatureParams.activeParam<Dc.signatureParams.params.length&&(Yc=Dc.signatureParams.params[Dc.signatureParams.activeParam]);return Yc}),this.raiseEvent("FAParameterSelectionChanged",
new Td(Tb))):(this.JIc=Tb,Ra=nd.a.map(Ra.functionRenderingInfo.signatures,Dc=>Dc.signatureParams.params.join(", ")),this.raiseEvent("FAFunctionNameUpdated",new $d(Tb,Ra)))}c5k(Ra){this.isExpanded=Ra;try{Rc.a.hG(wa.a.o5e,Ra.toString(),sb.AFrame.OBa)}catch(Tb){oa.ULS.sendTraceTag(512267714,0,15,`Failed setting ArgumentAssistanceCardCollapseState cookie with error message: ${Tb.message}`)}}static XGd(){return document.createElement("div")}Dnk(){const Ra=this.getPosition().renderDown?"rd":"ru";this.formulaAssistanceTelemetryManager.Mda(Ra)}gZk(){this.dpd&&
2===++this.mfi&&this.$.ei(953250532,-1,0,null)}}mc.f9h=!0;Object(Da.a)(mc,"FormulaArgumentAssistanceControl",ka.a,[746]);var Sa=a(925),pb=a(985);const Ac=[Object(pb.d)("featureNameField","FormulaSmartSuggestions"),Object(pb.d)("ver","1.0.0")],yd={eventName:"Office.Excel.FormulaSmartSuggestions.Seen",eventFlags:Sa.a,dataFields:[...Ac,Object(pb.a)("isFeatureSeen",!0)]},vb={eventName:"Office.Excel.FormulaSmartSuggestions.Tried",eventFlags:Sa.a,dataFields:[...Ac,Object(pb.a)("isFeatureTried",!0)]},Sc=
{eventName:"Office.Excel.FormulaSmartSuggestions.Succeeded",eventFlags:Sa.a,dataFields:[...Ac,Object(pb.a)("isFeatureSucceeded",!0)]};var hd=a(642),qc;(function(Ra){Ra[Ra.Dismissed=0]="Dismissed";Ra[Ra.Smart=1]="Smart";Ra[Ra.Simple=2]="Simple";Ra[Ra.Mixed=3]="Mixed"})(qc||(qc={}));Object(Da.b)("UIState",qc);class Lc extends ka.a{constructor(Ra,Tb,Dc){super(Lc.XGd());this.$=Ra;this.formulaAssistanceUIControl=Tb;this.formulaAssistanceTelemetryManager=Dc;this.XKa=Lb.a.RFc();this.sF=this.clearContentNotifier=
this.Gi=this.da=null;this.Psc=this.Qsc=this.Nsc=this.YLb=this.ZLb=this.Rsc=this.$Lb=!1;this.JQ=null;this.u7=0;this.kre=this.pYc=this.n7a=this.jec=this.cF=!1;this.j9b=qc.Dismissed;this.onRestoreFocus=()=>{};this.dismiss=()=>{this.cF=!1;this.Amb&&this.n7a&&this.m0a&&(this.Psc=!0);this.Awj();this.zga&&this.Gi.isEditing&&this.nSc();this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.dismiss(this.domElement),this.sF.Co=!1,this.j9b=qc.Dismissed)};this.A_i=()=>{this.raiseEvent("FAFocusOnSmartSuggestionsCard",
null)};this.dqb=()=>{var Yc;const Ad=this.da.ha.qa.selectedRanges,he=null===(Yc=this.formulaAssistanceTelemetryManager.dP)||void 0===Yc?void 0:Yc.kq;Ad.some(re=>re.contains(he))&&this.formulaAssistanceTelemetryManager.c_d++};this.lza=(Yc,Ad)=>{0==Ad.By&&(170==Ad.Wl.operation.operationName&&this.formulaAssistanceTelemetryManager.bJc++,this.$.userOperationManager.Hv(this.lza),this.OGc&&this.clearContentNotifier&&this.clearContentNotifier.ySc(this.dqb))};this.t8d=(Yc,Ad)=>{0==Ad.By&&(12==Ad.Wl.operation.operationName&&
this.$.userOperationManager.px(this.lza),this.$.userOperationManager.Hv(this.t8d))};this.FNj=()=>{this.dismiss();this.da.fp.$b.focus()};this.kle=()=>{const Yc={};Yc[wa.a.zO]=this.vpg?"SmartSuggestionsCard":this.lre?"FunctionAndSmartSuggestionsCard":"SimpleAutoCompleteCard";this.$.ei(802602464,0,8,Yc)};this.yl=()=>{this.m0a&&this.FCh()};this.pMj=(Yc,Ad)=>{this.Txb(Ad);this.Rsc=!0};this.tj=()=>{this.visible=!1};this.oMj=Yc=>{this.Nsc=!0;this.Tud(Yc)};this.aq=()=>{this.dismiss()};this.zy=()=>{this.formulaAssistanceUIControl.updatePosition(cc.AutoCompleteMenu)};
this.da=ab.f(this.$);this.sF=new oc(this.$,this.formulaAssistanceUIControl,cc.AutoCompleteMenu,uc.a.Qyf,this.A_i);this.da.view.Wy(this.zy);this.da.ha.Cw(this.tj);this.$.sa.Qm(this.aq);this.m0a=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:5523443_FormulaSuggestionsCardUserInteractionTelemetry");this.Amb=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6650011_LogSuggestionsDismissal");this.OGc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7629619_RefiningKeptTelemetry");!this.XKa&&this.OGc&&this.$.ka.Lh(313,
Yc=>{this.clearContentNotifier=Yc});this.m0a&&this.da.cellTextEditBox.Wx(this.yl)}Ayh(Ra){this.addHandler("FACardOpened",Ra)}djk(Ra){this.removeHandler("FACardOpened",Ra)}wyh(Ra){this.addHandler("FAFocusOnSmartSuggestionsCard",Ra)}$ik(Ra){this.removeHandler("FAFocusOnSmartSuggestionsCard",Ra)}zyh(Ra){this.addHandler("FormulaAutoCompleteShown",Ra)}cjk(Ra){this.removeHandler("FormulaAutoCompleteShown",Ra)}JAh(Ra){this.addHandler("SelectedRowChanged",Ra)}Ukk(Ra){this.removeHandler("SelectedRowChanged",
Ra)}Qmd(Ra){this.addHandler("ListBoxUpdated",Ra)}oge(Ra){this.removeHandler("ListBoxUpdated",Ra)}dispose(){this.$&&(this.$.userOperationManager.Hv(this.lza),this.$.userOperationManager.Hv(this.t8d),this.da&&(this.da.ha&&this.da.ha.$w(this.tj),this.da.cellTextEditBox&&this.m0a&&this.da.cellTextEditBox.Zw(this.yl),this.da.view.Kx(this.zy)),this.$.sa&&this.$.sa.hn(this.aq));this.OGc&&this.clearContentNotifier&&this.clearContentNotifier.ySc(this.dqb);Ha.a.Ng(this.sF);this.$=null}Qxh(Ra){this.addHandler("CVIC",
Ra)}yik(Ra){this.removeHandler("CVIC",Ra)}get visible(){return this.cF}set visible(Ra){Ra||this.dismiss();this.cF=Ra}get zga(){return this.jec}get lre(){var Ra,Tb;return(null===(Tb=null===(Ra=this.JQ)||void 0===Ra?void 0:Ra.items[0])||void 0===Tb?void 0:Tb.type)===hd.SuggestionKind.Smart}get vpg(){return 1===this.JQ.items.length&&this.lre}mq(Ra,Tb){if(!this.visible)return!1;this.vwe(Tb);let Dc;return(Dc=this.Q1i(Tb)).sBc?Dc.result:this.NHk(Tb)}AZa(Ra){if(!this.visible)return!1;let Tb=!1;switch(Ra){case 1872288872:this.zga&&
this.nSc();this.Amb&&this.lre&&(this.formulaAssistanceTelemetryManager.C4(["autoCompleteSmartSuggestionActiveDismissing"]),this.Qsc=!0);this.visible=!1;Tb=!0;break;case -798660877:this.Txb(this.IQb(this.u7+1));Tb=!0;break;case 137938150:this.Txb(this.IQb(this.u7-1));Tb=!0;break;case 2091832999:this.Txb(this.IQb(this.u7+8));Tb=!0;break;case 742457698:this.Txb(this.IQb(this.u7-8));Tb=!0;break;case 125627505:case 267796030:this.Tud(this.JQ.items[this.u7]),Tb=!0}return Tb}show(Ra){this.Gi=this.da.fp;
this.cF=!0;this.u7=0;this.JQ=Ra;0<this.JQ.items.length&&(this.render(),this.Txb(this.IQb(this.u7)),this.Amb?this.m0a&&(this.JQ.items[0].type===hd.SuggestionKind.Smart?(this.n7a||this.formulaAssistanceTelemetryManager.YOa(["autoCompleteSmartSuggestionActiveDismissing","autoCompleteSmartSuggestionAccepted"]),this.n7a=!0):this.n7a&&(this.Psc=!0)):this.JQ.items[0].type===hd.SuggestionKind.Smart&&this.m0a&&(this.n7a=!0));this.formulaAssistanceTelemetryManager.Pmk(Ra.items)}nSc(){this.jec=!1;this.Gi.Mzd()}NHk(Ra){return[1872288872,
-798660877,137938150,2091832999,742457698,125627505,267796030].includes(Ra)}Q1i(Ra){return this.zga?125627505===Ra||267796030===Ra?(this.Tud(this.JQ.items[this.u7]),{sBc:!0,result:!1}):!this.vpg||-798660877!==Ra&&137938150!==Ra?{sBc:!1}:{sBc:!0,result:!1}:{sBc:!1}}render(){this.formulaAssistanceTelemetryManager.YOa(["autoCompleteRender"]);this.formulaAssistanceUIControl&&(this.formulaAssistanceUIControl.renderAutoCompleteMenu(this.domElement,this.nKi(),()=>b(this.$)),this.g$j(),this.sF.Co=!0,this.dhi())}dhi(){this.formulaAssistanceTelemetryManager.C4(["autoCompleteRender"]);
this.formulaAssistanceTelemetryManager.XMb("autoCompleteOverall");const Ra=this.JQ.items.some(Dc=>Dc.type===hd.SuggestionKind.Smart),Tb=this.JQ.items.some(Dc=>Dc.type===hd.SuggestionKind.Simple);Ra&&Tb?this.formulaAssistanceTelemetryManager.XMb("autoCompleteOverallSimpleAndSmart"):Ra?this.formulaAssistanceTelemetryManager.XMb("autoCompleteOverallSmartOnly"):Tb&&this.formulaAssistanceTelemetryManager.XMb("autoCompleteOverallSimpleOnly")}g$j(){const Ra=this.j9b;this.j9b=this.nXi(this.JQ.items);Ra!==
qc.Dismissed&&Ra!==qc.Smart||this.j9b!==qc.Simple&&this.j9b!==qc.Mixed||this.raiseEvent("FormulaAutoCompleteShown")}U$j(){var Ra;if(0!==this.JQ.items.length){var Tb=0<=this.u7?this.u7:0,Dc=this.JQ.items[Tb];Dc={zP:Dc.label,description:null!==(Ra=Dc.detail)&&void 0!==Ra?Ra:"",selectedIndex:Tb+1,length:this.JQ.items.length};this.raiseEvent("SelectedRowChanged",Dc)}}Tud(Ra){if(this.Gi&&this.visible){var Tb=Ra.textEdit;this.lcj(this.Gi.text,Tb);this.Gi.$b.caretPosition=Tb.range.start.character+Tb.newText.length;
Ka.EwaSettings.xgj()&&this.Gi.lle();this.zga&&(this.jec=!1,this.m0a&&(this.Amb&&this.formulaAssistanceTelemetryManager.C4(["autoCompleteSmartSuggestionAccepted"]),this.kre=this.pYc=!0),this.XKa||this.tMg(),this.da.uHa.Uxk(),this.Gi.endEdit(!0,"FormulaAutoCompleteControl.CommitAutoCompletion",0),this.XKa&&this.tMg());this.visible=!1;this.raiseEvent("CVIC",{shouldRequestAutocompleteOnCommit:Ra.shouldRequestAutocompleteOnCommit});this.formulaAssistanceTelemetryManager.Omk(Ra.kind)}}tMg(){const Ra={kq:this.da.ha.qa.activeCell,
cellText:this.da.sh.text,committed:!0,kHa:null};this.XKa?this.formulaAssistanceTelemetryManager.lBk(Ra):(this.formulaAssistanceTelemetryManager.dP=Ra,this.formulaAssistanceTelemetryManager.b_d=this.$.sa.na.sheetId,this.formulaAssistanceTelemetryManager.aJc=this.$.ea.gk,this.$.userOperationManager.px(this.t8d),this.OGc&&this.clearContentNotifier&&this.clearContentNotifier.mmd(this.dqb))}FCh(){this.Amb&&this.Psc&&!this.Qsc&&!this.pYc&&(this.formulaAssistanceTelemetryManager.Rta.dismissSmartSuggestionImplicitlyCounter++,
this.Psc=!1);this.n7a&&(this.formulaAssistanceTelemetryManager.mU.smartSuggestionShownCounter++,this.n7a=!1,Object(Sa.b)(yd));this.pYc&&(this.formulaAssistanceTelemetryManager.mU.smartSuggestionSelectedCounter++,this.pYc=!1,Object(Sa.b)(vb));this.kre&&(this.formulaAssistanceTelemetryManager.mU.smartSuggestionCommittedCounter++,this.kre=!1)}nKi(){const Ra={completionItems:this.JQ.items,activeItemIndex:this.u7,callbacks:null};this.Wek(Ra);return Ra}Wek(Ra){Ra.callbacks={onCompletionItemSelected:null,
onCompletionItemCommitted:null,onFeedback:null,onDismiss:null,onRestoreFocus:null};Ra.callbacks.onCompletionItemSelected=this.pMj;Ra.callbacks.onCompletionItemCommitted=this.oMj;Ra.callbacks.onFeedback=this.kle;Ra.callbacks.onDismiss=this.FNj;Ra.callbacks.onRestoreFocus=this.onRestoreFocus}P6j(Ra){this.jec=!0;const Tb=Ra.textEdit.newText;this.Gi.N7(Tb.substring(this.Gi.text.length-Ra.textEdit.range.start.character,Tb.length))}Txb(Ra){const Tb=this.u7;this.u7=Ra;const Dc=this.JQ.items[Ra];this.zga&&
this.nSc();Tb!==Ra&&this.render();Dc.type!==hd.SuggestionKind.Smart||this.da.fp.text.includes("\n")||this.P6j(Dc);this.U$j()}IQb(Ra){return 0>Ra?0:Math.min(Ra,this.JQ.items.length-1)}lcj(Ra,Tb){this.Gi.text=Ra.substring(0,Tb.range.start.character)+Tb.newText+Ra.substring(Tb.range.end.character,Ra.length);this.da.fA&&(this.da.sh.text=this.Gi.text)}Awj(){this.$Lb&&(this.formulaAssistanceTelemetryManager.Rta.selectByArrowKeyCounter++,this.$Lb=!1);this.Rsc&&(this.formulaAssistanceTelemetryManager.Rta.selectByMouseHoverCounter++,
this.Rsc=!1);this.ZLb&&(this.formulaAssistanceTelemetryManager.Rta.commitByTabKeyCounter++,this.ZLb=!1);this.YLb&&(this.formulaAssistanceTelemetryManager.Rta.commitByEnterKeyCounter++,this.YLb=!1);this.Nsc&&(this.formulaAssistanceTelemetryManager.Rta.commitByMouseClickCounter++,this.Nsc=!1);this.Amb&&this.Qsc&&(this.formulaAssistanceTelemetryManager.Rta.dismissSmartSuggestionExplicitlyCounter++,this.Qsc=!1)}vwe(Ra){switch(Ra){case -798660877:case 137938150:case 2091832999:case 742457698:this.$Lb=
!0;break;case 125627505:this.ZLb=!0;break;case 267796030:this.YLb=!0}}static XGd(){return document.createElement("div")}nXi(Ra){return Ra.reduce((Tb,Dc)=>Tb|=Dc.type===hd.SuggestionKind.Simple?qc.Simple:qc.Smart,qc.Dismissed)}}Object(Da.a)(Lc,"FormulaAutoCompleteControl",ka.a,[744,2,745]);var bd=a(303),jd=a(355),Yd=a(252);class te{constructor(Ra,Tb){var Dc,Yc;this.pu=Ra;this.$=Tb;this.KZc=new Map;this.zwb=null;this.d_b=()=>{this.Vvc.resolve(this.pu.xx);this.m0g()};this.Ghg=()=>{this.Vvc.reject(null);
this.m0g()};this.yl=()=>{this.pu.MTc();this.kZd=null;this.KZc.clear();this.eYe()};this.lRj=(Ad,he)=>{if(he!==this.Z2f)oa.ULS.sendTraceTag(509678923,0,15,"onGetTableColHeadersSuccess called with a tableName different than the one saved for last request"),this.kPa.reject();else if(Object(Yd.a)(Ad))this.kPa.reject();else{var re=Ad.Result;Object(bd.b)(re)&&0!==re.length?(this.KZc.set(he,re),void this.kPa.resolve(Ad.Result)):this.kPa.reject()}};this.kRj=()=>{this.kPa.reject()};null===(Yc=null===(Dc=ab.f(this.$))||
void 0===Dc?void 0:Dc.cellTextEditBox)||void 0===Yc?void 0:Yc.Wx(this.yl);this.COk=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6476169_skipGetFieldInfoListContextIfContextLoaded")}getRichValueFieldListContext(Ra,Tb,Dc,Yc){const Ad={hla:Ra,xnf:Tb};var he;if(he=Object(bd.b)(this.kZd))he=this.kZd,he=!(Ad.hla.firstRow===he.hla.firstRow&&Ad.hla.firstColumn===he.hla.firstColumn&&Ad.hla.lastRow===he.hla.lastRow&&Ad.hla.lastColumn===he.hla.lastColumn&&Ad.hla.sheetName===he.hla.sheetName&&Ad.xnf===he.xnf);
he&&this.pu.MTc();this.kZd=Ad;this.COk&&this.pu.TTd||this.pu.Hjb(Object(fb.hb)(Ra),Dc,Yc,Tb);this.Vvc=new bd.a;this.pu.TTd?this.Vvc.resolve(this.pu.xx):this.kek();return this.Vvc.promise}getTableColHeaders(Ra){if(this.zwb&&3>=this.zwb.status&&Ra===this.Z2f)return this.kPa.promise;this.kPa=new bd.a;if(this.KZc.has(Ra))this.kPa.resolve(this.KZc.get(Ra));else{this.eYe();this.Z2f=Ra;const Tb=this.$.Gh.getItemByName(Ra).Hq;this.zwb=Object(jd.u)(this.$.pa.ta,Tb,Dc=>this.lRj(Dc,Ra),this.kRj,null,null)}return this.kPa.promise}dispose(){var Ra,
Tb;null===(Tb=null===(Ra=ab.f(this.$))||void 0===Ra?void 0:Ra.cellTextEditBox)||void 0===Tb?void 0:Tb.Zw(this.yl)}kek(){this.pu.zmd(this.d_b);this.pu.Eyh(this.Ghg)}m0g(){this.pu.Zfe(this.d_b);this.pu.hjk(this.Ghg)}eYe(){Object(bd.b)(this.zwb)&&(db.AFrameworkApplication.$i.HD(this.zwb.TC),this.zwb=null)}}Object(Da.a)(te,"ServerDataProvider",null,[]);var oe=a(87),Kd=a(1028);a(192);class Ee{constructor(Ra){this.S9h={};this.$=Ra}get R9h(){const Ra=[];if(!this.$.Gh||!this.$.Gh.items)return Ra;let Tb=0;
for(const Dc of this.$.Gh.items)if(Dc&&(3===Dc.type&&Dc.usedRange||2===Dc.type)){const Yc={tooltip:Dc.sheetName+oe.a.exclamation+Dc.usedRange.toString(),name:Dc.name,namedRange:this.QZh(Dc.usedRange),sheetName:Dc.sheetName,type:this.DZh(Dc.type)};Ra.push(Yc);this.S9h[Dc.name.toUpperCase()]=Yc;++Tb;if(!Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7395300_FixTableAutoCompleteMissingInfo")&&Tb===Kd.a.U9f){oa.ULS.sendTraceTag(537162076,0,15,`Maximum number of defined names reached for formula assistance: ${Kd.a.U9f}`);
break}}return Ra}QZh(Ra){if(null!=Ra&&void 0!=Ra)return{top:Ra.top,left:Ra.left,bottom:Ra.bottom,right:Ra.right,maxRows:Ra.maxRows,maxColumns:Ra.maxColumns,sheetName:void 0}}DZh(Ra){switch(Ra){case 2:return hd.DefinedNameInfoType.Table;case 3:return hd.DefinedNameInfoType.NamedRange;default:return hd.DefinedNameInfoType.Invalid}}}Object(Da.a)(Ee,"DefinedNameInfoManager",null,[]);var rc=a(158),fd=a(365),Ed=a(708),Rd=a(387);const Fe={index:0,length:0};class Ae{constructor(Ra){this.lxa=this.mxa=this.rna=
this.sna=!1;this.P0a=Ra}}Object(Da.a)(Ae,"MarqueeRangeData",null,[]);class We{constructor(Ra,Tb,Dc,Yc){this.kVk=Ra;this.BXg=Tb;this.KGc=void 0===Yc?!1:Yc;Dc?(this.P0a=Dc.P0a,this.sna=Dc.sna,this.rna=Dc.rna,this.mxa=Dc.mxa,this.lxa=Dc.lxa):oa.ULS.shipAssertTag(510255180,0,!1,"MarqueeMetadata.Ctor: rangeData is null")}}Object(Da.a)(We,"MarqueeMetadata",null,[]);a(1425);const ve=Lb.a.dA()?"rgba(0, 108, 190, {0});rgba(188, 47, 50, {0});rgba(124, 83, 172, {0});rgba(15, 112, 15, {0});rgba(191, 0, 119, {0});rgba(181, 73, 15, {0});rgba(0, 117, 143, {0})".split(";"):
"rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";"),Ze=ve.map(Ra=>String.format(Ra,1));class Oe{constructor(Ra,Tb,Dc,Yc){this.$=Ra;this.pluginScheduler=Tb;this.formulaAssistanceManager=Dc;this.formulaAssistanceTelemetryManager=Yc;this.c_a=this.sWg=!1;this.oS=null;this.hMa=()=>{this.c_a=!1;this.oS=null};this.da=ab.f(Ra);this.da.sh.Wx(this.hMa);this.$_g=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7686593_checkPotentialFormulaBeforeX10HighlightingEnabled")}f2(Ra,
Tb,Dc){var Yc;Ra.$b.addEventLogRecord("FormulaHighlightsControl.TryUpdateFormulaHighlights");if(this.sWg||Ra.zga)return!1;const Ad=isNullOrUndefined(Tb)?Ra.text:Tb;if(this.$_g){if(!wd.f(Ad))return this.bxe(Object(bd.b)(Tb))}else if(1>=Ad.length)return this.bxe(Object(bd.b)(Tb));Dc=this.BXi(Ra,Tb,Dc);Dc=null===(Yc=this.xJd(Ad,Dc))||void 0===Yc?void 0:Yc.formulaHighlights;if(!Dc)return oa.ULS.sendTraceTag(512349465,0,50,"FormulaHighlightsControl.tryUpdateFormulaHighlights: formulaHighlights is null (might be an invalid formula)"),
this.bxe(Object(bd.b)(Tb));const {i_c:he,Vwg:re,Twg:Me,dCj:Ve}=this.KEf(Dc,Ad);this.HDk(Ra,he,!!Tb);Tb=Ra.$b.text;if(!La.a.equals(Tb,Ad,!1))return oa.ULS.shipAssertTag(38114182,0,!1,`FormulaHighlightsControl.tryUpdateFormulaHighlights: The text we created is different from the original text. Setting the original text back. currentTextLength [${Tb.length}], updatedTextLength [${Ad.length}]`),Tb=Ra.$b.caretPosition,Ra.$b.text=Ad,Ra.$b.caretPosition=Tb,!0;this.highlightRanges(re,Me,3,Ve);return this.c_a=
!0}aag(Ra,Tb,Dc){if(!Ra||!Tb||!Dc)return oa.ULS.shipAssertTag(512349463,0,!!Ra,"FormulaHighlightsControl.MoveMarqueeRange: cellContentEditor is null"),oa.ULS.shipAssertTag(512349462,0,!!Tb,"FormulaHighlightsControl.MoveMarqueeRange: highlightState is null"),oa.ULS.shipAssertTag(512349461,0,!!Dc,"FormulaHighlightsControl.MoveMarqueeRange: newRange is null"),!1;const Yc=Object(rc.a)(We,Tb.metadata);if(!Yc)return oa.ULS.shipAssertTag(512349460,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: marqueeMetadata is null"),
!1;var Ad=Yc.kVk,he=Yc.BXg;let re=this.da.Yg.sVf(Dc)?Dc.Ayc(Yc.rna,Yc.sna):Dc.Sfa(Yc.rna,Yc.sna,Yc.lxa,Yc.mxa);if(!re)return oa.ULS.shipAssertTag(512349459,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: newText is null"),!1;const Me=he.indexOf("!");-1!==Me&&(re=he.substring(0,Me+1)+re);if(!Ra.$b.changeTextInExistingTextPart(Ad,he,re))return oa.ULS.shipAssertTag(38926105,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: failed to change the text part"),!1;Yc.BXg=re;Ad=!0;he=this.da.Pg.v$b;for(const Ve of he)(he=
ab.f(this.$).rh.rU(3,Ve,Tb.qla))?(he.range=Dc,he.metadata=Yc):(oa.ULS.shipAssertTag(512349458,0,!1,"FormulaHighlightsControl.MoveMarqueeRange: highlightStateInPane is null"),Ad=!1);this.da.rh.update(!1,!1);this.da.fA&&(this.da.cellTextEditBox.$b.text=Ra.text);this.da.cellTextEditBox.P1b(new fd.a({QEc:!0}));return Ad}glj(Ra){if(3!==Ra.ew)return oa.ULS.shipAssertTag(512349457,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: not HighlightDivIndex.Marquee."),!1;Ra=Object(rc.a)(We,Ra.metadata);
return Ra?Ra.P0a&&!Ra.KGc:(oa.ULS.shipAssertTag(512349456,0,!1,"FormulaHighlightsControl.IsMarqueeHighlightDraggable: marqueeMetadata is null."),!1)}ywb(Ra,Tb){oa.ULS.sendTraceTag(512349455,0,50,"FormulaHighlightsControl.suspendResumeFormulaHighlights: "+(Tb?"suspending":"resuming")+" formula highlights");Tb&&this.c_a&&(this.c_a=!1,this.highlightRanges(null,null),Ra.$b.FTh());this.sWg=Tb}dispose(){this.da&&this.da.sh&&this.da.sh.Zw(this.hMa)}pPf(Ra){this.formulaAssistanceTelemetryManager.YOa(["highlightPreviewRanges"]);
var Tb=this.xJd(Ra,Fe);if(isNullOrUndefined(Tb))this.bEc&&this.highlightRanges(null,null);else{var Dc=this.ZKd(),Yc=[],Ad=new ob.a(!1),he=[];Tb=Tb.formulaHighlights;for(const re of Tb)if(Tb=re.kind,Tb===hd.HighlightKind.CellRef||Tb===hd.HighlightKind.NamedRange||Tb===hd.HighlightKind.StructRef)Tb=fb.B(re.rangeInfo.range),Object(bd.b)(Tb)&&(Yc.push(new Rd.a(Tb,Dc)),this.$xc(Tb,Ad,1),he.push(new We(re.span.start,Ra.substring(re.span.start,re.span.end),r(re),!0)));this.highlightRanges(Yc,Ad,3,he);this.formulaAssistanceTelemetryManager.C4(["highlightPreviewRanges"],
!0)}}rWi(Ra,Tb){Tb=void 0===Tb?[]:Tb;var Dc;const Yc=null===(Dc=this.xJd(Ra,Fe))||void 0===Dc?void 0:Dc.formulaHighlights.filter(Me=>!Tb.includes(Me.kind));if(!Yc)return null;const {i_c:Ad,Vwg:he,Twg:re}=this.KEf(Yc,Ra);return{i_c:Ad,highlightRanges:Me=>Me?this.highlightRanges(he,re,28):this.GTh()}}GTh(){this.highlightRanges(null,null,28)}W4k(Ra,Tb){Ra&&this.formulaAssistanceTelemetryManager.pGd.formulaHighlightsCounter++;Tb&&this.formulaAssistanceTelemetryManager.pGd.parenthesesCouplingCounter++}bxe(Ra){this.$_g&&
!this.c_a||this.highlightRanges(null,null);return this.c_a&&(this.c_a=!1,Ra)?!0:!1}BXi(Ra,Tb,Dc){let Yc=Dc;Object(bd.b)(Tb)?Object(bd.b)(Dc)||(Yc={index:Tb.length,length:0}):Yc=Ra.$b.selection;return Yc}xJd(Ra,Tb){if(this.Anj({content:Ra,selection:Tb}))return this.oS.result;this.formulaAssistanceTelemetryManager.YOa(["formulaHighlightsRequest"]);const Dc=this.pluginScheduler.syncRequester().formulaHighlighting({content:Ra,caretPosition:Tb.index,selectionLength:Tb.length},this.formulaAssistanceManager.b4a,
null);this.oS={content:Ra,selection:Tb,result:Dc};this.formulaAssistanceTelemetryManager.C4(["formulaHighlightsRequest"]);return Dc}$xc(Ra,Tb,Dc){let Yc=Tb.getItem(Ra.toString());Yc||(Yc=ve[Tb.count%ve.length],Tb.add(Ra.toString(),Yc));return String.format(Yc,Dc)}TFb(Ra,Tb,Dc,Yc,Ad,he){Ad=void 0===Ad?null:Ad;he=void 0===he?null:he;oa.ULS.shipAssertTag(512349453,0,Dc<=Yc,"FormulaHighlightsControl.AddTextPart: startIndex cannot be larger than endIndex");Dc<Yc&&(Tb=Tb.substring(Dc,Yc),Dc=Lb.a.dA()&&
Ad?(Ze.indexOf(Ad)+1).toString():null,Ra.push(Object(Nd.a)(new Ed.a,{text:Tb,color:Ad,backgroundColor:he,highlightClass:Dc})))}highlightRanges(Ra,Tb,Dc,Yc){Dc=void 0===Dc?3:Dc;Yc=void 0===Yc?null:Yc;oa.ULS.shipAssertTag(508350945,0,3===Dc||null===Yc,"FormulaHighlightsControl.HighlightRanges: marqueeMetadatas param was passed although the divIndex isn't maquee");const Ad=3===Dc&&Object(bd.b)(Yc);Ra&&Ra.length?(oa.ULS.sendTraceTag(512349452,0,50,"FormulaHighlightsControl.HighlightRanges: number of ranges to highlight: "+
Ra.length),Ra.reverse(),Ad&&Yc.reverse(),this.da.rh.BP(Ra,[Dc],!0,(he,re)=>{if(he&&he.range&&re){oa.ULS.shipAssertTag(512349448,0,Tb.Vg(he.range.toString()),`FormulaHighlightsControl.HighlightRanges: The range '${he.range.toString()}' doesn't exist in the range to color dictionary`);var Me=this.$xc(he.range,Tb,.1),Ve=this.$xc(he.range,Tb,1);this.$.frame&&this.$.frame.oM&&this.$.frame.oM.YX||(re.style.background=Me);re.style.borderColor=Ve;Ad&&(re.setAttribute(wa.a.DSb,he.qla.toString()),he.metadata=
Yc[he.qla])}else oa.ULS.shipAssertTag(512349451,0,!!he,"FormulaHighlightsControl.HighlightRanges: state is null"),oa.ULS.shipAssertTag(512349450,0,!!he.range,"FormulaHighlightsControl.HighlightRanges: state.Range is null"),oa.ULS.shipAssertTag(512349449,0,!!re,"FormulaHighlightsControl.HighlightRanges: div is null")})):0!==this.da.rh.yHd([Dc]).length&&(Ra=this.$.qh.vi("UserAction","HideRangesHighlightsStopwatch"),this.da.rh.zq([Dc]),this.da.rh.Tub(new Rd.a(null,this.ZKd()),[Dc]),Ra.stop())}HDk(Ra,
Tb,Dc){const Yc=Ra.$b;Yc.tR=!0;var Ad=Yc.selection;const he=Ad.index;Ad=he+Ad.length;Yc.setTextFromTextParts(Tb);Tb=Yc.text.length;Yc.selectRange(Math.min(he,Tb),Math.min(Ad,Tb));Dc&&Ra.P1b(new fd.a);Yc.tR=!1}PPi(){return this.da.oB&&this.da.oB.eV?this.da.oB.eV:this.$.na}ZKd(){return this.PPi().sheetId}KEf(Ra,Tb){const Dc=[],Yc=new ob.a(!1),Ad=[],he=[],re=[];let Me=!1;var Ve=!1;let Hf=0;const Qf=this.ZKd();for(const ia of Ra){this.TFb(Ad,Tb,Hf,ia.span.start);switch(ia.kind){case hd.HighlightKind.CellRef:case hd.HighlightKind.StructRef:case hd.HighlightKind.NamedRange:Ra=
fb.B(ia.rangeInfo.range);if(isNullOrUndefined(Ra)){oa.ULS.sendTraceTag(512349464,0,10,`FormulaHighlightsControl.tryUpdateFormulaHighlights: Received formula highlight with undefined range, HighlightKind:${ia.kind.toString()}`);this.TFb(Ad,Tb,ia.span.start,ia.span.end);break}Ve=this.$xc(Ra,Yc,1);this.TFb(Ad,Tb,ia.span.start,ia.span.end,Ve,null);Dc.push(new Rd.a(Ra,Qf));he.push({Start:ia.span.start,End:ia.span.end});Ve=Ad.length-1;re.push(new We(Ve,Ad[Ve].text,r(ia)));Ve=!0;break;case hd.HighlightKind.Parentheses:this.TFb(Ad,
Tb,ia.span.start,ia.span.end,null,"rgb(229, 229, 229)"),Me=!0}Hf=ia.span.end}this.TFb(Ad,Tb,Hf,Tb.length);this.W4k(Ve,Me);return{i_c:Ad,Vwg:Dc,Twg:Yc,dCj:re}}Anj(Ra){return Object(bd.b)(this.oS)&&this.oS.content===Ra.content&&this.oS.selection.index===Ra.selection.index&&this.oS.selection.length===Ra.selection.length}}Object(Da.a)(Oe,"FormulaHighlightsControl",null,[742,2]);var Nf=a(93),Zf=a(79),Rb=a(765);Object(Hb.b)(na.zc,{yk:"singleton"})(Ra=>No(function*(){var Tb,Dc=yield Hb.a.resolve(na.Lb,Ra);
const Yc=yield Hb.a.resolve(na.hg,Ra),Ad=yield Hb.a.resolve(na.Cf,Ra);var he=null!==(Tb=null===Ra||void 0===Ra?void 0:Ra.va)&&void 0!==Tb?Tb:0;he=yield Object(Nf.e)(Zf.GetServiceTaskFactory.create(Dc.ka,449,Dc.xa,he));const re=yield Hb.a.resolve(Rb.k,Ra),Me=yield Hb.a.resolve(na.E,Ra);Tb=yield Hb.a.resolve(na.Ac,Ra);const Ve=yield Hb.a.resolve(Rb.h,Ra),Hf=yield Hb.a.resolve(na.Rc,Ra);Dc=new Vb(Dc,Hf,Me,re,he,Ve,Ad.Hwd(Dc,Yc));Tb.f6e(Dc.GOb);Tb.g6e(Dc.Cfa);Tb.h6e(Dc.Cfa);return Dc}));class Vb{constructor(Ra,
Tb,Dc,Yc,Ad,he,re){this.$=Ra;this.uF=Tb;this.Ej=Dc;this.pluginScheduler=Yc;this.formulaAssistanceUIControl=Ad;this.formulaAssistanceTelemetryManager=he;this.pu=re;this.DSd=this.isCellContentOnlyEqualDuringEdit=!1;this.UWb=null;this.KIc=-1;this.Zoa=0;this.Li=(Me,Ve)=>{Ve.Hl||Ve.YTb||this.pluginScheduler.notifier().notifyWorkbookClosing()};this.onActiveCellChanged=(Me,Ve)=>{this.da.isEditing||this.da.Pp||this.Xbg(null===Ve||void 0===Ve?void 0:Ve.cell)};this.onFunctionInfoLoaded=()=>{this.u3g();this.eAa()};
this.Rdg=(Me,Ve)=>{var Hf=this.Gi;Me=Hf.text;Hf=Hf.$b.caretPosition;0<this.Zoa&&this.formulaAssistanceTelemetryManager.Rta.commitWhileRequestPending++;this.formulaAssistanceTelemetryManager.YOa(["argumentAssistanceComputation","argumentAssistanceOverall"]);Ve.shouldRequestAutocompleteOnCommit?this.EJg(Me,Hf):this.Rnk(Me,Hf)};this.yl=()=>{this.isCellContentOnlyEqualDuringEdit&&(this.formulaAssistanceTelemetryManager.mU.isCellContentOnlyEqualDuringEditCounter++,this.isCellContentOnlyEqualDuringEdit=
!1);this.DSd&&(this.formulaAssistanceTelemetryManager.mU.isCellContentFormulaCounter++,this.DSd=!1);Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6103891_dismissControlOnEditEnded")&&this.Hzd()};this.kMa=(Me,Ve)=>{Object(Md.d)(()=>{this.Wrk(Ve.newValue)})};this.Xo=()=>{this.c2g()};this.c2g=()=>{const Me=this.Q9h.R9h;this.pluginScheduler.notifier().setDefinedNamesInfo(Me);oa.ULS.sendTraceTag(512278605,0,50,`FormulaAssistanceManager.updateDefinedNamesList updated defined names info with ${null===Me||
void 0===Me?void 0:Me.length} names}`)};this.ldg=(Me,Ve)=>{this.pluginScheduler.notifier().setActiveCellFormat(Ve)};this.uF=Tb;this.formulaAssistanceUIControl=Ad;this.pluginScheduler=Yc;this.da=ab.f(this.$);this.Q9h=new Ee(Ra);this.da.za.Uy(this.Xo);this.c2g();this.G$a=new mc(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.Jja=new Lc(this.$,this.formulaAssistanceUIControl,this.formulaAssistanceTelemetryManager);this.wPk=Lb.a.qUb(Ra);this.Iej=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.AuthoringPerCharExp",
!1);this.epj=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.x10AutocompleteWrapperPluginIsEnabled",!1);this.J$a=new Oe(this.$,this.pluginScheduler,this,this.formulaAssistanceTelemetryManager);na.zc.Ha()||Ra.ka.ph(464,this);this.Ej=Dc;this.Faj();this.da.cellTextEditBox.Wx(this.yl);this.uF.tkc(this.onFunctionInfoLoaded);this.uF.Fna?this.u3g():this.uF.Jhb({})}get Cfa(){return this.Jja}get GOb(){return this.G$a}get cD(){return this.J$a}get b4a(){return this.Gi.Zmj?hd.PluginGroup.Python:
hd.PluginGroup.Excel}get Gi(){return this.da.fp}get Yg(){return this.da.Yg}dispose(){var Ra;if(this.$){const Tb=this.da;Tb&&(Tb.ha&&Tb.ha.CNa(this.onActiveCellChanged),Tb.za&&Tb.za.Ix(this.Xo));this.$.Au(this.Li)}null===(Ra=this.Ej)||void 0===Ra?void 0:Ra.Thk(this.ldg);this.da.cellTextEditBox.Zw(this.yl);this.Jja.yik(this.Rdg);this.uF&&this.uF.cge(this.onFunctionInfoLoaded);this.Gi&&this.Gi.zSc(this.kMa);Ha.a.Ng(this.G$a);Ha.a.Ng(this.Jja);this.Jja=this.G$a=this.uF=this.$=null}vok(){this.KIc=-1;this.UWb=
null}Hzd(){this.Jja.visible=!1;this.G$a.visible=!1}mq(){this.eAa();return!1}eAa(){if(!this.Gi.SY)if(this.formulaAssistanceTelemetryManager.gqd.formulaAssistanceRequestAttemptedCounter++,this.FIk()){var Ra=this.Gi,Tb=Ra.text;Ra=Ra.$b.caretPosition;Tb.startsWith("=")&&(this.DSd=!0,1===Tb.length&&(this.isCellContentOnlyEqualDuringEdit=!0));this.formulaAssistanceTelemetryManager.YOa("argumentAssistanceComputation autoCompleteComputation autoCompleteComputationNoResult argumentAssistanceOverall autoCompleteOverall autoCompleteOverallSmartOnly autoCompleteOverallSimpleOnly autoCompleteOverallSimpleAndSmart".split(" "));
this.EJg(Tb,Ra);this.Iej&&this.cok(Tb,Ra)}else this.formulaAssistanceTelemetryManager.gqd.formulaAssistanceRequestOptimizedCounter++}EJg(Ra,Tb){const Dc=this.pluginScheduler.batchRequester().functionSuggestionAndArgumentAssistance({functionSuggestion:{content:Ra,caretPosition:Tb},argumentAssistance:{content:Ra,caretPosition:Tb},inCellSuggestion:{content:Ra,caretPosition:Tb}},this.b4a,null);this.Zoa+=1;this.UWb=Ra;this.KIc=Tb;Dc.then(Yc=>{--this.Zoa;"Done"===Yc.kind&&(this.DLf(Yc.payload.argumentAssistance),
this.F0i(Yc.payload.functionSuggestion,Ra));return null})}cok(Ra,Tb){Tb={content:Ra,caretPosition:Tb,enableAutocompleteWrapperPlugin:this.epj&&!this.wPk};Tb=this.pluginScheduler.requester().runPerCharacterExperiment(Tb,this.b4a,null);this.Zoa+=1;Tb.then(Dc=>{--this.Zoa;if("Done"===Dc.kind)for(const Yc of Dc.payload.results)Yc.kind===hd.PerCharacterExperimentResultKind.AutocompleteWrapperPluginResult&&this.da.uHa.rMg(Yc.value,Ra);return null})}Rnk(Ra,Tb){const Dc={content:Ra,caretPosition:Tb};this.UWb=
Ra;this.KIc=Tb;Ra=this.pluginScheduler.requester().argumentAssistance(Dc,this.b4a,null);this.Zoa+=1;Ra.then(Yc=>{--this.Zoa;"Done"===Yc.kind&&this.DLf(Yc.payload)})}FIk(){var Ra=this.Gi;const Tb=Ra.text;Ra=Ra.$b.caretPosition;return this.Jja.visible&&La.a.equals(Tb,this.UWb,!0)&&!wd.e(Tb)&&Ra===this.KIc?!1:!0}bsk(){void this.pluginScheduler.requester().runExperiment({},this.b4a,null)}DLf(Ra){Ra&&this.Gi.isEditing?(this.formulaAssistanceTelemetryManager.C4(["argumentAssistanceComputation"]),this.G$a.show(Ra)):
this.G$a.dismiss()}F0i(Ra,Tb){Ra&&0<Ra.items.length&&this.Gi.isEditing&&this.Gi.text===this.UWb?this.Yg.aY(this.da.ha.qa.activeCell)?(this.formulaAssistanceTelemetryManager.mU.smartSuggestionWouldSuggestInsidePivotCounter++,this.Jja.dismiss()):(this.formulaAssistanceTelemetryManager.C4(["autoCompleteComputation"]),this.Jja.show(Ra)):this.Jja.dismiss();this.da.uHa.rMg(Ra,Tb);Ra&&0!==Ra.items.length||this.formulaAssistanceTelemetryManager.C4(["autoCompleteComputationNoResult"])}Wrk(Ra){Ra={content:Ra,
isCellContentOnlyEqualDuringEdit:this.isCellContentOnlyEqualDuringEdit};void this.pluginScheduler.requester().runAuthoringExperiment(Ra,this.b4a,null)}Xbg(Ra){var Tb;const Dc=this.da.ha.qa.activeCell;if(Dc){var Yc=this.Ej.gqc(Dc,!1);if(Yc){var Ad=this.$.sa,he=Yc.sheet.index;0>=Ad.count||0>he||he>=Ad.count?oa.ULS.sendTraceTag(512278608,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged invalid sheet index. ewaSheetsCount = ${Ad.count}, currentSheetIndex = ${he}.`):(he=Ad=null,void 0!==this.Ej&&
null!==this.Ej&&(Ra=null!==(Tb=null===Ra||void 0===Ra?void 0:Ra.cell)&&void 0!==Tb?Tb:this.da.za.yx(Dc))&&(Tb=this.Ej.FGf(Ra.Vn),void 0!==Tb&&null!==Tb&&(Ad=Tb.FormatString,he=Tb.Builtin)),this.pluginScheduler.notifier().setActiveCell({colIndex:Yc.range.col,rowIndex:Yc.range.row,sheetIndex:this.$.sa.getItem(Yc.sheet.index).sheetId,docName:Yc.sheet.document.name,docPath:Yc.sheet.document.path,formatString:Ad,builtIn:he}),oa.ULS.sendTraceTag(512278607,0,50,`FormulaAssistanceManager.NotifyActiveCellChanged sent notification to the scheduler. col: ${Yc.range.col}, row: ${Yc.range.row}`))}else oa.ULS.sendTraceTag(537162002,
0,50,"FormulaAssistanceManager.NotifyActiveCellChanged ISheetGridCell location is null")}else oa.ULS.sendTraceTag(512278609,0,50,"FormulaAssistanceManager.NotifyActiveCellChanged activeCell range is null")}u3g(){const Ra=this.uF.wzf;this.pluginScheduler.notifier().setFunctionsInfo(Ra);oa.ULS.sendTraceTag(512278606,0,50,`FormulaAssistanceManager.updateSchedulerFunctionList update functions info with ${null===Ra||void 0===Ra?void 0:Ra.length} functions}`)}Faj(){this.da.ha.eUa(this.onActiveCellChanged);
this.Ej.cxh(this.ldg);const Ra=this.da.kh(null);this.Xbg(Ra);this.Gi.aGb(this.kMa);this.bsk();this.Jja.Qxh(this.Rdg);this.pluginScheduler.setServerDataProvider(new te(this.pu,this.$));this.eAa();this.$.Lp(this.Li)}}Object(Da.a)(Vb,"FormulaAssistanceManager",null,[726,2]);var Cc;let rg=Cc=class{constructor(Ra,Tb){this.ariaLiveNotifier=Ra;this.$=Tb;this.kYa=this.lIa=this.Wva=null;this.Clg=(Dc,Yc)=>{this.lbk(Yc.functionName,Yc.xzf)};this.Elg=(Dc,Yc)=>{this.ibk(Yc.xzf,Yc.pJg,Yc.Eql)};this.Dlg=(Dc,Yc)=>
{Dc=[];for(var Ad of Yc.pJg)void 0!==Ad&&null!==Ad&&(Yc=Ad.trim())&&Dc.push(Yc);if(Dc.length){Ad="";for(Yc=0;Yc<Dc.length;Yc++){const he=this.rrd(Dc[Yc]),re=Cc.xae(Yc,Dc.length);Ad+=he+re;re&&(Ad+=this.ariaLiveNotifier.$1a)}this.ariaLiveNotifier.readText(Ad)}};this.Flg=(Dc,Yc)=>{this.ariaLiveNotifier.nbk(Yc.zP,Yc.description,Yc.selectedIndex.toString(),Yc.length.toString())};this.ylg=(Dc,Yc)=>{this.ariaLiveNotifier.Ixg(Yc.description,Yc.length)};this.rhg=()=>{this.ariaLiveNotifier.E4a(Jb.a.instance.ia(884),
wa.a.DFa)};this.hhg=()=>{this.ariaLiveNotifier.readText(Jb.a.instance.ia(885))};this.nhg=()=>{this.ariaLiveNotifier.readText(Jb.a.instance.ia(886))}}dispose(){this.bwe();this.kYa=this.lIa=this.Wva=null}f6e(Ra){Ra&&(this.Wva=Ra,this.Wva.Cyh(this.Clg),this.Wva.IAh(this.Elg),this.Wva.HAh(this.Dlg))}g6e(Ra){Ra&&(this.lIa=Ra,this.lIa.Ayh(this.rhg),this.lIa.wyh(this.hhg),this.lIa.zyh(this.nhg))}h6e(Ra){Ra&&(this.kYa=Ra,this.kYa.JAh(this.Flg),this.kYa.Qmd(this.ylg))}bwe(){var Ra,Tb,Dc;this.Wva&&(this.Wva.fjk(this.Clg),
this.Wva.Tkk(this.Elg),this.Wva.Skk(this.Dlg));this.kYa&&(this.kYa.Ukk(this.Flg),this.kYa.oge(this.ylg));null===(Ra=this.lIa)||void 0===Ra?void 0:Ra.djk(this.rhg);null===(Tb=this.lIa)||void 0===Tb?void 0:Tb.$ik(this.hhg);null===(Dc=this.lIa)||void 0===Dc?void 0:Dc.cjk(this.nhg)}lbk(Ra,Tb){if(Tb){let Dc="";for(let Yc=0;Yc<Tb.length;Yc++)Dc+=Ra+this.ariaLiveNotifier.$1a+this.rrd(Tb[Yc])+Cc.xae(Yc,Tb.length);Dc+=Jb.a.instance.ia(883)+this.ariaLiveNotifier.$1a;this.ariaLiveNotifier.readText(Dc)}}ibk(Ra,
Tb,Dc){if(Ra){let Ad="",he=0;if(Tb){for(let re=0;re<Tb.length;re++){if(Dc>=Ra[re].split(this.$.listSeparator).length){he++;continue}var Yc=Tb[re].trim();if(!Yc)return;Yc=this.rrd(Yc);const Me=Cc.xae(re-he,Tb.length-he);Ad+=Yc+Me;Me&&(Ad+=this.ariaLiveNotifier.$1a)}this.ariaLiveNotifier.readText(Ad)}}}rrd(Ra){if(!Ra)return"";var Tb=Ra.split(this.$.listSeparator);Ra="";for(const Dc of Tb){if(Cc.Hhj(Dc))Ra+=Dc;else{const Yc=(Tb=Cc.fmj(Dc))?Dc.replace("[","").replace("]",""):Dc;Ra+=String.format(Tb?Jb.a.instance.$g(59):
Jb.a.instance.$g(58),Yc)}Ra+=this.ariaLiveNotifier.$1a}return Ra}static xae(Ra,Tb){return Ra>=Tb||1===Tb?(oa.ULS.shipAssertTag(537161997,0,Ra<Tb,"FormulaAssistanceControl.PositionInList: requested item index >= list length."),""):String.format(Jb.a.instance.$g(55),Ra+1,Tb)+"\r\n"}static Hhj(Ra){return La.a.contains(Ra,Kd.a.yof,!0)}static fmj(Ra){return Ra.trimStart().startsWith(Kd.a.t_j)||Ra.trimEnd().endsWith(Kd.a.s_j)}};rg=Cc=Object(ra.__decorate)([Object(Hb.d)(na.Ac),Object(ra.__param)(0,Object(na.l)()),
Object(ra.__param)(1,Object(na.Lb)())],rg);Object(Da.a)(rg,"FormulaAssistanceReadoutHandler",null,[725,2]);let yf=class{constructor(Ra){this.formulaAssistanceValuePreview=Ra}Bi(){return!1}executeCommand(Ra,Tb){Ra=!1;Tb=Tb.command;switch(Tb){case -46938080:this.formulaAssistanceValuePreview.trigger(),Ra=!0}return Ra?gb.Task.Va(!0):Db.a(Tb)}ni(Ra,Tb){return-46938080===Tb.command}Ji(){return!1}};yf=Object(ra.__decorate)([Object(Hb.d)(na.Bc),Object(ra.__param)(0,Object(Rb.i)())],yf);Object(Da.a)(yf,"FormulaAssistanceValuePreviewCommandHandler",
null,[39]);var jg=a(122),If=a(35),cf=a(62);class Nb{constructor(Ra,Tb){this.$=Ra;this.da=Tb;this.isEnabled=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ValuePreviewValidation",!1);this.UTb=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile")}get vxi(){Object(bd.c)(this.dJe)&&(this.dJe=Hb.a.resolve(na.wc,{va:1}));return this.dJe}iSh(Ra,Tb,Dc,Yc,Ad){const he=this;return No(function*(){if(he.isEnabled&&("Success"===Tb.kind||"Failure"===Tb.kind)){var re=Tb.evaluatedFormula;
if(!Object(bd.c)(re)&&""!==re){var Me={};Me.locale=he.HFf();var Ve=he.da.ha.qa.activeCell;Object(bd.b)(Ve)?Me.anonymizationOrigin="activeCell":(Me.anonymizationOrigin="A1",Ve=pc.Range.gi(0,0));try{const Hf=yield he.vxi;Me.formula=Hf.anonymize(Ra.text,Ve);Me.subFormula=Hf.anonymize(re,Ve)}catch(Hf){Me.formula="FAIL",Me.subFormula="FAIL"}Me.clientResult=he.kR(Tb);try{const Hf=he.fMd(),Qf=yield Yc(Ra.text,re,Ad),ia=he.fMd();Me.serverResult=he.kR(Qf);Me.diagnostics=he.RWh(Me.clientResult,Me.serverResult);
Me.stateId={beforeX10:Dc,beforeServer:Hf,server:Qf.stateId,afterServer:ia}}catch(Hf){Me.diagnostics={kind:"error",message:Hf}}he.UTb&&"Success"===Tb.kind&&(Me.isVolatile=Tb.isVolatile);k(Me);oa.ULS.sendTraceTag(508831819,1,20,`ValuePreviewResultValidator.checkClientResultVsServer, result: ${JSON.stringify(Me)}`)}}})}fMd(){return{latest:this.$.ea.gk,successful:this.$.ea.pD}}HFf(){const Ra={ui:this.$.qca,data:this.$.dataCultureTag},Tb=Hb.a.Zg(na.wd);Object(bd.b)(Tb)&&(Ra.calcLcid=Tb.hk.Lcid);return Ra}kR(Ra){switch(Ra.kind){case "Failure":return{kind:"failure",
reason:Ra.reason};case "Success":return{kind:"success",value:Ra.value,unformattedValue:Ra.unformattedValue,operKind:Ra.operKind};default:return{kind:"unexpected"}}}RWh(Ra,Tb){return"unexpected"===Ra.kind||"unexpected"===Tb.kind?{kind:"unexpected"}:"success"===Ra.kind&&"success"===Tb.kind?this.WWh(Ra,Tb):"failure"===Ra.kind&&"failure"===Tb.kind?{kind:"equal"}:{kind:"failure",source:"failure"===Ra.kind?"client":"server"}}WWh(Ra,Tb){const Dc=d(Ra.value,Tb.value);if("equal"===Dc.kind)return Dc;const Yc=
Ra.unformattedValue,Ad=Tb.unformattedValue,he=d(Yc,Ad);return 2===Ra.operKind&&2===Tb.operKind&&2===Math.abs(Yc.length-Ad.length)&&(Ra=Yc.length>Ad.length?"client":"server",Yc.trim()===Ad.trim())?{kind:"padded",source:Ra}:{kind:"different",diff:Dc.diff,unformatted:he}}}Object(Da.a)(Nb,"ResultValidator",null,[]);var Bc=a(196),Ob=a(320),zc=a(32);class od{constructor(Ra){this.A$f=Ra;this.P6=Object.assign({},Qb);this.GMb=[];this.NKc=-1;(this.z$f=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:5999949_formulaTelemetryMetriThresholds"))&&
Ra&&(this.P6.countAboveThresholds={},Ra.forEach(Tb=>this.P6.countAboveThresholds[Tb]=0))}static get Vte(){return zc.a.Tg.qk.m}w7a(){this.NKc=od.Vte}kfa(Ra,Tb){Tb=void 0===Tb?null:Tb;if(-1!==this.NKc||Object(bd.b)(Tb))Ra?(this.OFb(od.Vte-(Tb||this.NKc)),this.NKc=-1):this.P6.failedCount++}Hwf(){this.P6.excludingFirstAction=od.Gwf(this.GMb);this.GMb.push(this.P6.firstAction);this.P6.includingFirstAction=od.Gwf(this.GMb)}OFb(Ra){this.P6.count?1E3>this.P6.count&&this.GMb.push(Ra):this.P6.firstAction=Ra;
this.z$f&&this.A$f&&this.A$f.forEach(Tb=>{Ra>Tb&&this.P6.countAboveThresholds[Tb]++});this.P6.count++}static Gwf(Ra){const Tb=Object.assign({},ce);0<Ra.length&&(Ob.b(Ra),Tb.median=Ra[Math.floor(.5*Ra.length)],Tb.P75=Ra[Math.floor(.75*Ra.length)],Tb.P95=Ra[Math.floor(.95*Ra.length)],Tb.max=Ra[Ra.length-1],Tb.average=Ra.reduce((Dc,Yc)=>Dc+Yc)/Ra.length);return Tb}}Object(Da.a)(od,"PerformanceMeasurement",null,[]);const ce={average:0,max:0,median:0,P75:0,P95:0},Qb={count:0,countAboveThresholds:void 0,
failedCount:0,firstAction:0,includingFirstAction:Object.assign({},ce),excludingFirstAction:Object.assign({},ce)};class Xc{constructor(Ra){this.$=Ra;this.QGa=this.oLb=null;this.usage={};this.WTc={};this.performance={};this.details={};this.zPc=-1;this.Li=(Tb,Dc)=>{Dc.Hl||Dc.YTb||this.$.sendBeaconTraceTag(388818255,50,!1,this.mue())};this.editBox=Object(ab.f)(this.$).sh;Ra.Lp(this.Li)}static getInstance(Ra){return Xc.instance||(Xc.instance=new Xc(Ra))}set trigger(Ra){this.oLb=Ra;this.zPc=od.Vte}set CFg(Ra){this.QGa=
Ra}z3b(Ra){Object(bd.c)(this.details.color)&&(this.details.color={});Object(bd.c)(this.details.color[Ra])&&(this.details.color[Ra]=0);this.details.color[Ra]++}setResult(Ra,Tb){if(Object(bd.c)(this.oLb))oa.ULS.sendTraceTag(512258439,0,15,"ValuePreviewTelemetry.setResult - currentTrigger undefined");else if("Failure"!==Ra.kind||Ra.timeout){var Dc=Tb===this.editBox?"cellEditor":"formulaBar",Yc=this.oLb;Tb=this.QGa;var Ad=this.zPc;Object(bd.c)(this.usage[Dc])&&(this.usage[Dc]={});Object(bd.c)(this.usage[Dc][Yc])&&
(this.usage[Dc][Yc]={success:0,error:0,loading:0,timeout:0});Dc=this.usage[Dc][Yc];switch(Ra.kind){case "Success":8===Ra.operKind?Dc.error++:(this.Tck(Ra.value),Dc.success++);this.oLb=this.QGa=null;this.zPc=-1;this.C4(Tb,Ad);break;case "Loading":Dc.loading++;break;case "Failure":this.oLb=this.QGa=null,this.zPc=-1,Ra.timeout&&Dc.timeout++}}}Tck(Ra){if(!Object(bd.c)(this.QGa)){Object(bd.c)(this.WTc[this.QGa])&&(this.WTc[this.QGa]=[]);var Tb=this.WTc[this.QGa];1E3>Tb.length&&Tb.push(Ra.length)}}C4(Ra,
Tb){if(-1!==Tb){Ra=null!==Ra&&void 0!==Ra?Ra:"cache";this.UGf(`${Ra}_request`).kfa(!0,Tb);var Dc=this.UGf(`${Ra}_overall`);window.requestAnimationFrame(()=>{Dc.kfa(!0,Tb)})}}UGf(Ra){return this.performance[Ra]=this.performance[Ra]||new od(md)}mue(){const Ra={};Object.keys(this.performance).forEach(Tb=>{this.performance[Tb].Hwf();var Dc=this.performance[Tb];Ra[Tb]={metrics:Dc.P6,durations:Dc.GMb}});return`{"usage":${JSON.stringify(this.usage)},"resultLengths":${JSON.stringify(this.WTc)},"performance":${JSON.stringify(Ra)},"details":${JSON.stringify(this.details)}}`}}
Object(Da.a)(Xc,"ValuePreviewTelemetry",null,[]);const md=[50,80,100,130,150,170,200],ie=(Ra,Tb)=>{Tb=void 0===Tb?!1:Tb;const Dc=Xc.instance;if(Object(bd.c)(Ra))return Tb&&Dc.z3b("none"),null;if("string"==typeof Ra){Ra=Bc.a.vLc[Ra.toLowerCase()];if(Object(bd.c)(Ra))return Tb&&Dc.z3b("badString"),null;Tb&&Dc.z3b("string");return Ra}if("number"==typeof Ra)return Tb&&Dc.z3b("number"),null;Tb&&Dc.z3b("other");return null};class me{constructor(Ra,Tb){this.$=Ra;this.pluginScheduler=Tb;this.oS=new Pe(e);
this.AXc=!0;this.gij=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8544629_ValuePreviewFailureCaching");this.UTb=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.wHc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8561808_ValuePreviewSnapshotActiveCell");this.arf=(Dc,Yc,Ad)=>{const he=this;return No(function*(){return new Promise((re,Me)=>{const Ve={Formula:Yc,IsWholeFormula:Dc===Yc,ActiveCell:he.tUi(Ad)};var Hf=he.$.pa.ta;re=he.AWj(re);Me=he.zWj(Me);const Qf=
Hf.Za(1,null);Qf.evaluationParameters=Ve;cf.h(Hf,"EvaluatePartialFormula",Qf,re,Me,null,null,128)})})};this.AWj=Dc=>Yc=>{if(Object(bd.c)(Yc.Result))Dc({kind:"Failure",reason:"No result",stateId:Yc.StateId});else{var Ad=Yc.Result,he=w(Ad.Value);Object(bd.b)(he)?Dc({kind:"Failure",reason:he,stateId:Yc.StateId}):Dc({kind:"Success",value:Ad.Value,unformattedValue:Ad.UnformattedValue,operKind:Ad.OperKind,color:Ad.Color,stateId:Yc.StateId})}};this.zWj=Dc=>Yc=>{Yc=jg.a.Qj(Yc.data);Yc=If.a.Kh(Yc);Dc(`Request failed, Errors: ${Yc}`)};
this.da=Object(ab.f)(this.$);this.formulaAssistanceManager=na.zc.Ha()?Hb.a.Zg(na.zc):Ra.ka.Ug(464);this.EFg=new Nb(this.$,this.da);this.BC=Xc.getInstance(Ra)}clearCache(){this.oS.clear()}eie(Ra,Tb,Dc){Dc=void 0===Dc?!1:Dc;const Yc=this;return No(function*(){Yc.AXc=Dc;const Ad=Yc.request(Ra);let he;const re=new Promise(Me=>{he=window.setTimeout(()=>{Me({kind:"Failure",timeout:!0})},Tb)});return Promise.race([Ad,re]).finally(()=>{window.clearTimeout(he)})})}request(Ra){const Tb=this;return No(function*(){return t(Tb.oS,
Ra,()=>No(function*(){var Dc;let Yc=null;var Ad=null;Tb.wHc&&(Yc=Object(fb.p)(Tb.da.ha.qa.activeCell,Tb.$),Ad={sheetName:null===(Dc=Tb.$.na)||void 0===Dc?void 0:Dc.sheetId,namedObjectName:null,firstRow:Yc.FirstRow,firstColumn:Yc.FirstColumn});Ad=Tb.wHc?Object.assign({},Ra,{activeCell:Ad}):Ra;Dc=Tb.EFg.fMd();Ad=yield Tb.pluginScheduler.requester().valuePreview(Ad,Tb.formulaAssistanceManager?Tb.formulaAssistanceManager.b4a:hd.PluginGroup.Excel,null);if("Done"!==Ad.kind)return"Superseded"===Ad.kind&&
Tb.oS.delete(Ra),null;Ad=Ad.payload;if(Object(bd.c)(Ad))return{kind:"Failure"};Tb.AXc&&(Tb.BC.CFg="client",void Tb.EFg.iSh(Ra,Ad,Dc,Tb.arf,Yc));switch(Ad.kind){case "Failure":return Tb.gij&&Tb.oS.delete(Ra),{kind:"Failure"};case "Success":return Tb.UTb&&Ad.isVolatile&&Tb.oS.delete(Ra),Tb.H9k(Ad);case "Unavailable":return void Tb.Dzj(Ra.text,Ad),Tb.oS.delete(Ra),Tb.Ynk({text:Ra.text,index:Ad.index,length:Ad.length},Ra,Ra.text,Ad.evaluatedFormula,Yc,!Ad.isVolatile)}}))})}H9k(Ra){Ra=Object.assign({},
Ra,{color:ie(Ra.color,this.AXc)});const Tb=w(Ra.value);return Object(bd.b)(Tb)?(oa.ULS.sendTraceTag(509871621,1,15,`FormulaAssistanceValuePreviewRequester.validateClientSuccessResult: formula failure:${Tb}, kind:${Ra.kind}`),{kind:"Failure"}):Ra}Ynk(Ra,Tb,Dc,Yc,Ad,he){const re=this;return No(function*(){return m(re.oS,Ra,Tb,he,()=>(new Promise((Me,Ve)=>No(function*(){try{const Hf=yield re.arf(Dc,Yc,Ad);re.AXc&&(re.BC.CFg="server");"Success"===Hf.kind?Me({kind:"Success",value:Hf.value,index:Ra.index,
length:Ra.length,color:Hf.color,operKind:Hf.operKind}):(oa.ULS.sendTraceTag(508831818,1,50,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula failed, ${Hf.reason}`),Me({kind:"Failure"}))}catch(Hf){oa.ULS.sendTraceTag(520495426,1,15,`FormulaAssistanceValuePreviewRequester.requestFromServer: evaluatePartialFormula rejected, ${Hf}`),Ve(Hf)}}))).catch(()=>{re.oS.delete(Ra);re.oS.delete(Tb);return{kind:"Failure"}}))})}Dzj(Ra,Tb){return No(function*(){var Dc=yield Hb.a.resolve(na.wc,
{va:1});const Yc=pc.Range.gi(0,0),Ad=Dc.anonymize(Ra,Yc);Dc=Dc.anonymize(Tb.evaluatedFormula,Yc);oa.ULS.sendTraceTag(507799744,1,50,`FormulaAssistanceValuePreviewRequester.logUnavailableResult: ${JSON.stringify({formula:Ad,evaluatedFormula:Dc,reason:Tb.reason})}`)})}tUi(Ra){const Tb=Object(fb.p)(this.da.ha.qa.activeCell,this.$);if(this.wHc&&Object(bd.b)(Ra)){const Dc=Object(fb.e)(Ra,Tb);0<Dc.length&&oa.ULS.sendTraceTag(507777487,1,20,`FormulaAssistanceValuePreviewRequester.getSheetCell: cell diffs: ${Dc.join(",")}`)}return this.wHc?
Ra:Tb}}Object(Da.a)(me,"FormulaAssistanceValuePreviewRequester",null,[]);class Pe{constructor(Ra){this.z_c=Ra;this.map=new Map}has(Ra){Ra=this.z_c(Ra);return this.map.has(Ra)}get(Ra){Ra=this.z_c(Ra);return this.map.get(Ra)}set(Ra,Tb){Ra=this.z_c(Ra);this.map.set(Ra,Tb);return this}delete(Ra){Ra=this.z_c(Ra);return this.map.delete(Ra)}clear(){this.map.clear()}}Object(Da.a)(Pe,"RequestMap",null,[]);Object(Hb.b)(na.Cc,{yk:"singleton"})(Ra=>No(function*(){const Tb=yield Hb.a.resolve(na.Lb,Ra),Dc=yield Hb.a.resolve(Rb.k,
Ra);return new me(Tb,Dc)}));Object(Hb.b)(na.Dc)(Ra=>No(function*(){yield Hb.a.resolve(na.Rb,Ra);return excelOnlineCalc.FormulaAuthoringHelperSingletonGlobal.instance()}));var gf;let tf=gf=class extends Bb.a{constructor(Ra){super(Ra,gf.featureName)}get Hk(){return uc.a.lGd}show(Ra,Tb,Dc,Yc,Ad,he,re,Me){he=void 0===he?null:he;return this.Uvb(void 0===re?null:re,Ve=>{appChrome.renderFormulaSuggestionCard(Ra,Tb,this.domElement,Ve.y,Ve.x,Ve.y+Ve.height,Ve.x+Ve.width,Dc,Yc,Ad,he,this.avb,Me?{explanationKey:Me.explanationKey,
replacements:Me.explanationReplacements,notifyExplanationSuccessful:Me.X6d}:void 0)})}lSg(Ra,Tb,Dc,Yc,Ad,he,re,Me,Ve,Hf,Qf){return this.Uvb(Qf,ia=>{appChrome.renderRowNumberingSuggestionCard(Ra,Tb,this.domElement,ia.y,ia.x,ia.y+ia.height,ia.x+ia.width,Dc,Yc,Ad,he,re,Me,Ve,Hf,this.avb)})}I7(Ra,Tb,Dc){Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.k4&&Ra.equals(this.RZd)||(this.k4&&document.body.removeChild(this.k4),this.RZd=Ra,
Ra=this.grid.kh(Ra),Ra=this.grid.getCellBounds(Ra.cell,!0),this.k4=document.createElement("div"),this.k4.setAttribute("style",`position:fixed;
        left: ${Ra.x+Ra.width}px;
        top: ${Ra.y+Ra.height/2}px`),document.body.appendChild(this.k4)),Ra=new xb.a(-847286761,0,this.$.Rh,0,null),this.$.Ma.dh(Ra,{["CalloutName"]:15,["Target"]:this.k4,["NewState"]:Tb,["Reason"]:Dc}))}};tf=gf=Object(ra.__decorate)([Object(Hb.d)(na.Fc),Object(ra.__param)(0,Object(na.Lb)())],tf);Object(Da.a)(tf,"FormulaByExampleCardUIControl",Bb.a,[728]);class Qe{constructor(Ra,Tb){this.pluginScheduler=Ra;this.VF=Tb}Xnk(Ra,Tb){const Dc=this;return No(function*(){var Yc;let Ad=null;Dc.VF.OPa(Tb,0);
var he={context:Object(fb.gb)(Ra)};he=yield Dc.pluginScheduler.requester().columnFormulaSuggestion(he,hd.PluginGroup.Excel,Tb.toString());"Done"===he.kind&&(null===(Yc=he.payload)||void 0===Yc?0:Yc.suggestions)&&he.payload.suggestions[0]&&(Yc=he.payload.suggestions[0],"ColumnFormulaSuggestion"===Yc.kind?(Dc.VF.OPa(Tb,1,{formula:Yc.metadata.rawFormula,eYa:Yc.metadata.anonymizedFormula}),Ad=Dc.qKi(Yc)):Dc.VF.OPa(Tb,2,{errorMessage:Yc.reason}));Dc.VF.WMb(Tb);return Ad})}dIj(){return No(function*(){return!0})}qKi(Ra){if(!Ra||
!Ra.evalResults)return null;const Tb=Ra.evalResults.map(Dc=>{if("FormulaSuggestionEvalFailureResult"===Dc.kind)return{kind:"failure",cell:Object(fb.db)(Dc.cell),value:Dc.error};let Yc;switch(Dc.value.kind){case "number":Yc=Dc.value.num;break;case "string":Yc=Dc.value.text;break;case "boolean":Yc=Dc.value.flag}return{kind:"success",cell:Object(fb.db)(Dc.cell),value:Yc,format:Dc.formatted}});return{flowId:Number(Ra.suggestionID),columnRange:Object(fb.db)(Ra.columnRange),tableName:Ra.tableName,tableColumnName:Ra.tableColumnName,
suggestions:[{formula:Ra.formula,cells:Tb}]}}}Object(Da.a)(Qe,"FormulaByExamplePluginCommunicator",null,[743]);var Ca=a(280);class yb{constructor(Ra,Tb){this.da=Ra;this.Ej=Tb;this.tof=new Set;this.zY=(Dc,Yc)=>{if(Dc=this.da.Yg.sl(Yc.kq,!1))if(Yc=this.rXi(Dc,Yc.kq.left))this.tof.has(Yc)?(this.Fsh(),this.da.sh.v1(this.zY)):this.tof.add(Yc)};this.Fsh=()=>{Ca.a.UU("XLS-FormulaByExample-Treatment;XLS-FormulaByExample-Control")};this.rXi=(Dc,Yc)=>{const Ad=this.Ej.lZa(Dc);if(!Ad)return null;const he=Dc.usedRange,
re=Yc-he.left;return 0>re||re>=Ad.count?(oa.ULS.sendTraceTag(537161876,306,10,`FormulaByExampleSuggestionCache.getUniqueTableColumnIdentifier: invalid inputs. tableRange: ${he}, columnNumber: ${Yc}, `+`areAllTableHeadersAvailable: ${this.Ej.C2e(Dc,Ad)}`),null):(Yc=Ad.ma(re))?Dc.name+"_"+Yc:null};this.da.sh.RW(this.zY)}}Object(Da.a)(yb,"FormulaByExampleScorecardTriggerReporter",null,[]);var wc;(function(Ra){Ra.PreviewAlreadyShowing="PreviewAlreadyShowing";Ra.StrictDataMismatch="StrictDataMismatch";
Ra.LackingPrefetchedResults="LackingPrefetchedResults";Ra.RangeNotLoaded="RangeNotLoaded";Ra.InvalidCalcResults="InvalidCalcResults";Ra.ErrorsInEvaluation="ErrorsInEvaluation";Ra.InternalPreviewError="InternalPreviewError";Ra.WorkbookModelUpdateFailed="WorkbookModelUpdateFailed";Ra.Unknown="Unknown"})(wc||(wc={}));Object(Da.b)("FormulaPreviewErrorKind",wc);class dd{constructor(Ra,Tb,Dc,Yc){this.$=Ra;this.da=Tb;this.$$e=Dc;this.nGd=Yc;this.M6b=!1;this.qVc=()=>{oa.ULS.sendTraceTag(537161889,306,50,
"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const Ad={};Ad[wa.a.zO]="FormulaByExampleCard";this.$.ei(802602464,0,8,Ad)};this.oOc=Ad=>{this.M6b=!0;oa.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${Ad}`)};this.jRb=()=>{}}ENk(Ra,Tb,Dc){const Yc=this;return No(function*(){try{const Ad=Object(fb.E)(Tb.columnRange),he=yield Yc.nGd.GNk(Dc.formula,Ad,Me=>{Yc.jRb(Me,Ra,
Tb,Dc)});if(!he.success)return{kpa:"UNSEEN",Nnc:`FormulaByExampleUIManager.showFormulaPreview failed: ${he.error}`};const re=he.n1;Yc.$$e.show(Dc.formula,Ad.toString(),()=>re.KTa("CardUI"),()=>re.SWa("CardUI"),Yc.$.isFeedbackEnabled?Yc.qVc:null,()=>Yc.oOc(Tb.flowId),Ra,void 0);return re.XTc.then(Me=>{Yc.$$e.hide();return Me})}catch(Ad){return{kpa:"UNSEEN",Nnc:`FormulaByExampleUIManager.showSuggestionPreview failed: ${Ad}`}}})}}Object(Da.a)(dd,"FormulaByExampleUIManager",null,[]);var vd=a(189);Object(Hb.b)(na.Gc)(Ra=>
No(function*(){const Tb=yield Hb.a.resolve(na.Lb,Ra),Dc=yield Hb.a.resolve(na.Kc,Ra),Yc=yield Hb.a.resolve(na.E,Ra),Ad=yield Hb.a.resolve(na.Fc,Ra),he=ab.f(Tb);let re=null;if(yield Lb.a.l0a(Tb))re=(yield Hb.a.resolve(na.gg,Ra)).Zfa();const Me=yield Hb.a.resolve(Rb.k,Ra),Ve=yield Hb.a.resolve(na.Hc);return new Zd(Tb,he,new yb(he,Yc),Ad,re,Dc,Me,Ve)}));class Zd{constructor(Ra,Tb,Dc,Yc,Ad,he,re,Me){this.$=Ra;this.da=Tb;this.BG=Yc;this.P7a=Ad;this.nGd=he;this.VFa=null;this.requestId=1;this.y3j=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginCommunication",
!1);this.fTk=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionValidation",!1);this.eTk=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExamplePluginSuggestionShowing",!1);this.zY=(Ve,Hf)=>{const Qf=Hf.kq;if(Hf.committed){var ia=this.requestId++;this.M3b();this.VFa=this.da.za.rMa(()=>{void this.Nrg.Xnk(Qf,ia).then(Xb=>void this.HUj(Xb,Qf))})}};(this.Kxi=Lb.a.tKa(this.$))&&this.y3j&&(this.Nrg=new Qe(re,Me.rKf("Plugin")),this.da.sh.RW(this.zY),
this.Ebh=new dd(this.$,this.da,this.BG,this.nGd),this.Ije=Ka.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleRowsBelowRangeTableToQuery",1))}HUj(Ra,Tb){const Dc=this;return No(function*(){if(Dc.fTk&&Ra&&Ra.suggestions&&0<Ra.suggestions.length){const Ad=Ra.suggestions[0];if(Dc.iNi(Tb)&&Dc.eTk){var Yc=yield Dc.Ebh.ENk(Tb,Ra,Ad);"UNSEEN"!==Yc.kpa&&("ACCEPT"===Yc.kpa&&Dc.OEh(Dc.oCf(Tb),Ad.formula,Tb),yield Dc.Nrg.dIj())}}})}OEh(Ra,Tb,Dc){Tb=Object(Nd.a)(new ec.a,{Text:Tb});this.da.setCell(Tb,
Dc,1,127,null,0,{range:Ra,origin:Dc},2)}iNi(Ra){Ra=this.oCf(Ra);return null===Ra||void 0===Ra?void 0:Ra.pk(this.da.Hp)}oCf(Ra){const Tb=this.Yfa(Ra);return Tb?new pc.Range(Tb.gx.top,Ra.left,Tb.gx.bottom,Ra.right,!0,!0):null}Yfa(Ra){const Tb=this.da.Yg.sl(Ra,!1);if(Tb)return{gx:Object(vd.a)(Tb),HU:!0,xM:!1};if(this.P7a){const {W1b:Dc,xM:Yc}=this.GLi(Ra);if(Dc)return{gx:Dc,HU:!1,xM:Yc}}return null}GLi(Ra){const Tb=new pc.Range(Ra.top-this.Ije,Ra.left,Ra.bottom,Ra.right,!0,!0),Dc=this.P7a.iJa(new Rd.a(Tb,
Object($b.d)(this.$.na)),6);if(!Dc)return null;for(const Yc of Dc)for(const Ad of Yc.table.interpretations)if(2===Ad.orientation&&.5<Ad.confidence)return{W1b:this.b3h(Ad,Tb),xM:!Ad.tableLocation.yi(Ra)};return{W1b:null,xM:!1}}b3h(Ra,Tb){return new pc.Range(Ra.tableLocation.top+Ra.headerRowCount,Ra.tableLocation.left+Ra.headerColumnCount,Math.max(Ra.tableLocation.bottom,Tb.bottom),Ra.tableLocation.right,!0,!0)}M3b(){var Ra;null===(Ra=this.VFa)||void 0===Ra?void 0:Ra.call(this);this.VFa=null}}Object(Da.a)(Zd,
"FormulaByExamplePluginTriggersManager",null,[]);const Re={y1:null,Jpa:null,formula:null,eYa:null,errorMessage:null};let ff=class{constructor(){this.Mrb=new Map;this.tob=new Map;this.tFd=new Map}rKf(Ra){return new af(this,Ra)}OPa(Ra,Tb,Dc,Yc){Tb=Tb?this.Mrb:this.tob;if(!Tb.has(Ra))if(0===Dc)Tb.set(Ra,Object.assign({},Re));else return;const Ad=Tb.get(Ra);switch(Dc){case 0:Ad.y1=performance.now();break;case 2:case 1:Ad.Jpa=performance.now(),Tb.set(Ra,Object.assign({},Ad,Yc))}}WMb(Ra){if("BothComplete"===
this.rAc(Ra))this.A5f(Ra);else{const Tb=window.setTimeout(()=>{"BothComplete"!==this.rAc(Ra)&&(this.Mrb.has(Ra)||this.tob.has(Ra))&&this.A5f(Ra)},15E3);this.tFd.set(Ra,Tb)}}A5f(Ra){var Tb=this.Mrb.get(Ra);const Dc=this.tob.get(Ra),Yc="BothComplete"===this.rAc(Ra)&&(null===Tb||void 0===Tb?void 0:Tb.formula)===(null===Dc||void 0===Dc?void 0:Dc.formula)&&(null===Tb||void 0===Tb?void 0:Tb.errorMessage)===(null===Dc||void 0===Dc?void 0:Dc.errorMessage),Ad="AwaitTask failed - no annotation found"===(null===
Tb||void 0===Tb?void 0:Tb.errorMessage)&&(null===Dc||void 0===Dc?void 0:Dc.y1)&&!(null===Dc||void 0===Dc?0:Dc.Jpa);Yc||Ad?oa.ULS.sendTraceTag(84165970,306,20,`FBE plugin validator compared successfully: ${JSON.stringify({["flowID"]:Ra,["pluginStartTime"]:Tb.y1,["pluginEndTime"]:Tb.Jpa,["legacyStartTime"]:Dc.y1,["legacyEndTime"]:Dc.Jpa,["pluginRequestDuration"]:Tb.Jpa-Tb.y1,["legacyRequestDuration"]:Dc.Jpa-Dc.y1,["firstStartReported"]:Tb.y1<Dc.y1?"Plugin":"Legacy",["error"]:Tb.errorMessage,["formula"]:Tb.eYa})}`):
this.Vkj(null===Dc||void 0===Dc?void 0:Dc.errorMessage)&&(Tb={["flowId"]:Ra,["pluginStartTime"]:null===Tb||void 0===Tb?void 0:Tb.y1,["pluginEndTime"]:null===Tb||void 0===Tb?void 0:Tb.Jpa,["legacyStartTime"]:null===Dc||void 0===Dc?void 0:Dc.y1,["legacyEndTime"]:null===Dc||void 0===Dc?void 0:Dc.Jpa,["successfulFlows"]:this.rAc(Ra),["pluginError"]:null===Tb||void 0===Tb?void 0:Tb.errorMessage,["legacyError"]:null===Dc||void 0===Dc?void 0:Dc.errorMessage,["pluginFormula"]:null===Tb||void 0===Tb?void 0:
Tb.eYa,["legacyFormula"]:null===Dc||void 0===Dc?void 0:Dc.eYa},oa.ULS.sendTraceTag(84165957,306,20,`FBE plugin validator comparison failure: ${JSON.stringify(Tb)}`));this.Mrb.delete(Ra);this.tob.delete(Ra);if(Tb=this.tFd.get(Ra))clearTimeout(Tb),this.tFd.delete(Ra)}rAc(Ra){var Tb,Dc,Yc,Ad;const he=null===(Tb=this.Mrb.get(Ra))||void 0===Tb?void 0:Tb.y1;Tb=null===(Dc=this.Mrb.get(Ra))||void 0===Dc?void 0:Dc.Jpa;Dc=null===(Yc=this.tob.get(Ra))||void 0===Yc?void 0:Yc.y1;Ra=null===(Ad=this.tob.get(Ra))||
void 0===Ad?void 0:Ad.Jpa;return he&&Tb&&Dc&&Ra?"BothComplete":he&&Tb?"PluginComplete":Dc&&Ra?"LegacyComplete":"NoneComplete"}Vkj(Ra){return"signal lock"!==Ra&&"AL is undefined"!==Ra&&"tableRange does not intersect loaded range"!==Ra&&"table return null for table suggestion"!==Ra&&"column has non uniform data"!==Ra&&"consistent block cache callback cancelled"!==Ra}};ff=Object(ra.__decorate)([Object(Hb.d)(na.Hc)],ff);Object(Da.a)(ff,"FormulaByExamplePluginValidator",null,[]);class af{constructor(Ra,
Tb){this.l5g=Ra;this.DGc="Plugin"===Tb;this.DGc||(this.y3f=new Map)}OPa(Ra,Tb,Dc){(Ra=this.qKf(Ra))&&this.l5g.OPa(Ra,this.DGc,Tb,Dc)}WMb(Ra){(Ra=this.qKf(Ra))&&this.l5g.WMb(Ra)}ONg(Ra,Tb){this.DGc||this.y3f.set(Ra,Tb)}qKf(Ra){return this.DGc?Ra:this.y3f.get(Ra)}}Object(Da.a)(af,"FormulaByExamplePluginValidatorProxy",null,[]);var xf=a(940);Object(Hb.b)(na.Ic,{yk:"singleton"})(Ra=>No(function*(){const Tb=yield Hb.a.resolve(na.Lb,Ra),Dc=yield Lb.a.l0a(Tb),[Yc,Ad,he,re,Me]=yield Promise.all([Hb.a.resolve(na.E,
Ra),Hb.a.resolve(na.p,Ra),Dc?Hb.a.resolve(na.gg,Ra):Promise.resolve(null),Hb.a.resolve(na.sc,Ra),Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBEPersistentCache",!1)?Hb.a.resolve(na.qd):Promise.resolve(null)]);let Ve,Hf;Ve=yield Hb.a.resolve(na.Gc,Ra);Hf=yield Hb.a.resolve(na.Hc,Ra);return new xf.a(Tb,Yc,Ad,he,re,Ve,Dc,Me,Hf)}));class eg extends Map{constructor(Ra){super();this.voa=Ra}set(Ra,Tb){if(!this.has(Ra)&&this.size>=this.voa){const [Dc]=this.entries().next().value;this.delete(Dc)}return super.set(Ra,
Tb)}has(Ra){if(super.has(Ra)){const Tb=this.get(Ra);this.delete(Ra);super.set(Ra,Tb);return!0}return!1}}Object(Da.a)(eg,"LimitedSizeHotMap",Map,[]);const Ab=Ra=>`${Ra.top}_${Ra.left}`;let xc=class{constructor(Ra){this.xh=Ra;this.T3a=new Map;this.zrb=new Map;this.lEj=Ka.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMinRowsForLocks",3);this.qDj=Ka.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaxLocksPerSession",3);this.IOa=new eg(this.qDj);this.Imc=!1;
this.dXj=(Tb,Dc,Yc)=>{if(Yc.reduce((re,Me)=>re+Me.bottom-Me.top+1,0)<this.lEj)oa.ULS.sendTraceTag(508036641,0,50,"FormulaByExampleSignalLocksManager.onSignalSent: not enough rows to lock by");else{this.IOa.has(Dc)&&this.IOa.delete(Dc);for(const re of Yc){var Ad=this.xh.Mua("FormulaByExampleSignalLocksManager.onSignalSent",re);const Me={K4f:re,Z_d:new Map};try{for(;Ad.$$mn();){const Ve=Ad.$$cu(),Hf=Ve.Xn.value;Me.Z_d.set(Ab(Ve.range),Hf)}}finally{Ad&&Ad.dispose()}if(he)he.L4f.push(Me);else{Ad=Yc[0].clone();
Yc.reduce((Ve,Hf)=>{Ve.union(Hf);return Ve},Ad);var he={sheetId:xf.a.m0(this.xh.na),columnId:Dc,XPk:Ad,L4f:[Me]}}}this.T3a.set(Tb,he);this.zrb.set(Tb,window.setTimeout(()=>{this.T3a.has(Tb)&&(this.T3a.delete(Tb),this.zrb.delete(Tb),oa.ULS.sendTraceTag(508036640,0,50,`FormulaByExampleSignalLocksManager.onSignalSent: pending lock timed out, deleting lock for column ${he.columnId}`))},2E4))}};this.rPj=Tb=>{const Dc=this.zrb.get(Tb);Dc&&(window.clearTimeout(Dc),this.zrb.delete(Tb));this.T3a.has(Tb)&&
(oa.ULS.sendTraceTag(508036639,0,50,`FormulaByExampleSignalLocksManager.onFormulaFound: pending lock found and deleted for column ${this.T3a.get(Tb).columnId}`),this.T3a.delete(Tb))};this.sPj=Tb=>{const Dc=this.zrb.get(Tb);Dc&&(window.clearTimeout(Dc),this.zrb.delete(Tb));if(Tb=this.T3a.get(Tb))this.IOa.set(Tb.columnId,Tb),oa.ULS.sendTraceTag(508036638,0,50,`FormulaByExampleSignalLocksManager.onFormulaNotFound: pending lock found, column locked: ${Tb.columnId}`),this.t5g()};this.onBlockCacheItemChanged=
(Tb,Dc)=>{Dc=Dc.Ti.block;Tb=Dc.jj;Dc=this.lNi(Tb,xf.a.m0(Dc.na));for(const Yc of Dc){Dc=Yc.L4f;for(const Ad of Dc)if(Ad.K4f.yi(Tb)){Dc=Ad.K4f.clone().pk(Tb);Dc=this.xh.Mua("FormulaByExampleSignalLocksManager.onBlockCacheItemChanged",Dc);try{for(;Dc.$$mn();){const he=Dc.$$cu(),re=he.Xn.value,Me=Ab(he.range);Ad.Z_d.has(Me)&&Ad.Z_d.get(Me)!==re&&(this.IOa.delete(Yc.columnId),oa.ULS.sendTraceTag(508036637,0,50,`FormulaByExampleSignalLocksManager.onBlockCacheItemChanged: existing lock's rows content changed, column unlocked: ${Yc.columnId}, columnChanged: ${he.range.left}`),
this.t5g())}}finally{Dc&&Dc.dispose()}}}}}Zfj(Ra){return this.IOa.has(Ra)}t5g(){!this.Imc&&0<this.IOa.size?(this.xh.Vy(this.onBlockCacheItemChanged),this.xh.Ncb(this.onBlockCacheItemChanged),this.Imc=!0):this.Imc&&0===this.IOa.size&&(this.xh.Fy(this.onBlockCacheItemChanged),this.xh.Y2b(this.onBlockCacheItemChanged),this.Imc=!1)}lNi(Ra,Tb){const Dc=[];for(const Yc of this.IOa.values())Yc.sheetId===Tb&&Yc.XPk.yi(Ra)&&Dc.push(Yc);return Dc}};xc=Object(ra.__decorate)([Object(Hb.d)(na.Jc),Object(ra.__param)(0,
Object(na.Ic)())],xc);Object(Da.a)(xc,"FormulaByExampleSignalLocksManager",null,[721]);var eb=a(1229),Ub=a(322),Fc=a(1089),rd=a(138);Object(Hb.b)(na.Kc,{yk:"singleton"})(Ra=>No(function*(){const [Tb,Dc,Yc]=yield Promise.all([Hb.a.resolve(na.Lb,Ra),Hb.a.resolve(na.sc,Ra),Hb.a.resolve(na.E,Ra)]),Ad=ab.f(Tb);return new Gd(Ad,Ad.QM,Yc,Dc)}));class Gd{constructor(Ra,Tb,Dc,Yc){this.da=Ra;this.QM=Tb;this.Ej=Dc;this.ek=Yc;this.cHa=[];this.Ygb=[]}GNk(Ra,Tb,Dc){var Yc=!0,Ad=!0;Yc=void 0===Yc?!1:Yc;Ad=void 0===
Ad?!1:Ad;const he=this;return No(function*(){if(he.QM.isActive)return ue("PreviewAlreadyShowing");var re=yield he.$qf(Tb,Ra,Ad,void 0);if(!re.success)return re.error;re=re.results;if(Yc&&!he.C5g(re))return ue("StrictDataMismatch");if(!he.m3g(re))return ue("WorkbookModelUpdateFailed");try{const Me=yield he.QM.N7(Tb,Ve=>{he.jRb(Ve,Ra,Tb,Yc,Ad,Me,Dc)});return{success:!0,n1:Me}}catch(Me){return ue("InternalPreviewError",Me)}})}$qf(Ra,Tb,Dc,Yc){const Ad=this;return No(function*(){const he=Ra.pk(Ad.da.Hp);
if(!he)return{success:!1,error:ue("RangeNotLoaded")};const re=new pc.Range(he.top,he.left,he.top,he.left,!0,!0),Me=yield Ad.Ej.J4(null,he,re,Tb,!0);if(!Ad.vFc(Me))return{success:!1,error:ue("InvalidCalcResults")};const Ve=Ad.Qqf(Me);return 0===Ve.size||1===Ve.size&&Ve.has("Unavailable")?{success:!0,results:Me}:Dc?Ad.mji(Ve,Tb,Yc,he,re):{success:!1,error:ue("ErrorsInEvaluation",Ve)}})}mji(Ra,Tb,Dc,Yc,Ad){const he=this;return No(function*(){if(!(1===Ra.size&&Ra.has("PreviousFailure")||2===Ra.size&&
Ra.has("PreviousFailure")&&Ra.has("Unavailable")))return{success:!1,error:ue("ErrorsInEvaluation",Ra)};var re=he.h$g(Dc);re=yield he.Ej.J4(re,Yc,Ad,Tb,!0);if(!he.vFc(re))return{success:!1,error:ue("InvalidCalcResults")};const Me=he.Qqf(re);return 0===Me.size||1===Me.size&&Me.has("Unavailable")?{success:!0,results:re}:{success:!1,error:ue("ErrorsInEvaluation",Me)}})}jRb(Ra,Tb,Dc,Yc,Ad,he,re){const Me=Ra.Ti.block,Ve=Dc.pk(Me.jj);Ve&&(this.cHa.push(Me),this.Ygb.push(Ve),this.kwh(Ve),void he.XTc.then(()=>
{this.cBg(Ve)}),this.Ej.nkc(()=>{const Hf=this;return No(function*(){const Qf=yield Hf.UKj(Tb,Yc,Ad);null===re||void 0===re?void 0:re(Ra,Qf)})}))}kwh(Ra){this.Aaf(Ra,!0)}cBg(Ra){this.Aaf(Ra,!1)}Aaf(Ra,Tb){for(let Yc=Ra.top;Yc<=Ra.bottom;Yc++)for(let Ad=Ra.left;Ad<=Ra.right;Ad++){var Dc=pc.Range.gi(Yc,Ad);if(Dc=this.da.kh(Dc))Dc.cell.Dqe=Tb&&!Dc.cell.OY}}UKj(Ra,Tb,Dc){const Yc=this;return No(function*(){if(!Yc.cHa.length)return null;const Ad=Yc.Ygb.reduce((re,Me)=>{re.union(Me);return re}),he=yield Yc.$qf(Ad,
Ra,Dc,Yc.cHa.map(re=>re.jj));if(!he.success)return Yc.cHa=[],Yc.Ygb=[],ue("ErrorsInEvaluation",he.error);if(Tb&&!Yc.C5g(he.results))return Yc.cHa=[],Yc.Ygb=[],ue("StrictDataMismatch");if(!Yc.m3g(he.results))return Yc.cHa=[],Yc.Ygb=[],ue("WorkbookModelUpdateFailed");Yc.cBg(Ad);for(const re of Yc.cHa)Yc.QM.mYb(re);Yc.cHa=[];Yc.Ygb=[];return null})}m3g(Ra){Ra=Ra.results;for(const Dc of Ra){var Tb=Dc.value.formatted;const Yc=Se(Dc.value.value.kind);Ra=this.da.kh(Ce(Dc.value.cell));Tb=this.ek.v$(Tb,Yc,
Fc.a,Ra);if(Object(Ub.c)(Tb))Ra=Ra.cell,Ra.OY=Tb.value.text,Ra.u1b=Tb.value.numFmt;else return!1}return!0}C5g(Ra){const Tb=new Set;Ra=Ra.results;for(const Yc of Ra.entries()){const [Ad,he]=Yc;if(!Object(eb.a)(he)){var Dc=Ce(he.reason.cell);if(this.da.mj.Pxa(Dc)){Ra.splice(Ad,1);Tb.add("Contains hidden rows");continue}if(!this.da.FF(Dc)){Ra.splice(Ad,1);Tb.add("Contains unavailable cells outside of view");continue}return{success:!1,cSc:["Unexpected unavailable cell"]}}Dc=he.value;const re=this.da.kh(Ce(Dc.cell)),
Me=re.Xn.type;if(0!==Me)if(2===Me){if(2!==Dc.value.kind||Dc.value.value!==re.Xn.value)return{success:!1,cSc:["String value mismatch"]}}else{if(1===Me&&(1!==Dc.value.kind||Dc.value._valueXL!==parseFloat(re.Xn.value)))return{success:!1,cSc:["Number value mismatch"]};if(4===Me&&(8!==Dc.value.kind||Dc.value.type!==parseFloat(re.Xn.value)))return{success:!1,cSc:["Error value mismatch"]}}}return{success:!0,cSc:Array.from(Tb)}}h$g(Ra){const Tb=[];for(const Dc of Ra){Ra=new rd.a("FormulaColumnPreviewManager.GenerateConstantCellsCloneWrites",
this.da,Dc);try{for(;Ra.moveNext();){const Yc=Ra.get_current();Tb.push({row:Yc.cell.gH,column:Yc.cell.oK,Xn:Yc.Xn,formulaBarText:Yc.Xn.value,text:Yc.cell.text,Vn:Yc.cell.Vn})}}finally{Ra&&Ra.dispose()}}return Tb}Qqf(Ra){const Tb=new Set;Ra=Ra.results;for(const Dc of Ra)Object(eb.a)(Dc)||Tb.add(Dc.reason.kind);return Tb}vFc(Ra){return(Ra=Ra.results)&&Ra.length?!0:!1}}Object(Da.a)(Gd,"FormulaColumnPreviewManager",null,[727]);const ue=(Ra,Tb)=>({success:!1,error:{kind:Ra,data:Tb}}),Ce=Ra=>new pc.Range(Ra.row+
1,Ra.col+1,Ra.row+1,Ra.col+1,!0,!0),Se=Ra=>{switch(Ra){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var of=a(38),jf=a(419),bf=a(212),pf=a(262);Object(Hb.b)(na.Rc,{yk:"singleton"})(Ra=>No(function*(){var Tb;const Dc=yield Hb.a.resolve(na.Lb,Ra);if(na.zc.Ha())return new Ud(Dc);const Yc=yield Hb.a.resolve(na.hg,Ra),Ad=yield Hb.a.resolve(na.Cf,Ra);var he=null!==(Tb=null===Ra||void 0===Ra?void 0:Ra.va)&&void 0!==Tb?Tb:0;Tb=yield Object(Nf.e)(Zf.GetServiceTaskFactory.create(Dc.ka,
449,Dc.xa,he));he=yield Hb.a.resolve(Rb.k,Ra);const re=yield Hb.a.resolve(na.E,Ra),Me=yield Hb.a.resolve(na.Ac,Ra),Ve=yield Hb.a.resolve(Rb.h,Ra),Hf=new Ud(Dc);let Qf=Dc.ka.Ug(464);Qf||(Qf=new Vb(Dc,Hf,re,he,Tb,Ve,Ad.Hwd(Dc,Yc)),Me.f6e(Qf.GOb),Me.g6e(Qf.Cfa),Me.h6e(Qf.Cfa));return Hf}));class Ud extends of.a{constructor(Ra){super();this.$hh=[];this.Azf={};this.IGd={};this.N2=null;this.Lja=[];this.lYa={};this.hUd=this.abd=!1;this.Hnj=Lb.a.Gnj();this.Nhg=(Tb,Dc)=>{oa.ULS.sendTraceTag(537161987,0,50,
"FunctionInfoManager.OnGetFunctionListPartialSucceeded");this.zhg(Tb,!!Dc&&1!==Dc.FilterType,!0)};this.Mhg=()=>{oa.ULS.sendTraceTag(537161986,0,50,"FunctionInfoManager.OnGetFunctionListPartialFailed -  reset varaible to ensure we will re-issue the webservice call");this.N2=null};this.yhg=Tb=>{oa.ULS.sendTraceTag(537161985,0,50,"FunctionInfoManager.OnFullFunctionListLoaded - full list was loaded");this.mee(Tb.$va,!0,!1)};this.Lhg=Tb=>{oa.ULS.sendTraceTag(537161984,0,50,"FunctionInfoManager.OnGetFunctionListFullSucceeded");
this.zhg(Tb,!0,!1)};this.fh=Ra}tkc(Ra){this.addHandler("FunctionInfoLoaded",Ra)}cge(Ra){this.removeHandler("FunctionInfoLoaded",Ra)}get Fna(){return this.abd}get wzf(){return this.N2}get exc(){return this.Lja}get $(){return this.fh}dispose(){const Ra=Hb.a.Zg(na.wd);Ra&&Ra.dge(this.yhg);this.fh=null;super.dispose()}kie(){this.abd=!1;this.N2=null;this.hUd=!0;this.Hnj&&this.Jhb(null)}Jhb(Ra,Tb){Tb=void 0===Tb?!1:Tb;if(this.Fna)this.bwg();else{oa.ULS.sendTraceTag(537161991,0,50,`Retrieving the list of function names for culture '${this.$.ua.UICultureTag}' from the server.`);
let Yc=null;(Yc=Hb.a.Zg(na.wd))||oa.ULS.sendTraceTag(537161990,0,50,"instantaneousSupportInformationManager == null");if((null===Yc||void 0===Yc?0:Yc.$va)&&0<Yc.$va.length)Ka.EwaSettings.Ra(114)?Yc.dxi(this.Lhg):this.mee(Yc.$va,!0,!1);else{var Dc=this.$.pa.ta.Jh();Ra&&(this.$.ea.Ph||Tb)&&!this.hUd&&(Tb?jf.a(this.$.userOperationManager,(Ad,he,re)=>cf.p(this.$.pa.ta,Ra,pf.c(Ad,this.Nhg),pf.b(he,this.Mhg),re,Ra,Dc),Ad=>new bf.a(130,0,Ad,16),null):cf.p(this.$.pa.ta,Ra,this.Nhg,this.Mhg,null,Ra,Dc));!this.Fna&&
this.$.ea.Ph&&(Yc?(oa.ULS.sendTraceTag(537161989,0,50,`FunctionInfoManager.EnsureFunctionInfoAsync - Functions not loaded yet, wait for them. IsFullyLoaded=${this.Fna}, IsSessionActive=${this.$.ea.Ph}`),Yc.K0e(this.yhg)):(oa.ULS.sendTraceTag(537161988,0,50,"FunctionInfoManager.EnsureFunctionInfoAsync - instantaneousSupportInformationManager is null"),cf.p(this.$.pa.ta,{FilterType:0},this.Lhg,null,null,null,Dc),this.hUd=!1))}}}mEf(Ra){return 0>Ra||Ra>=this.N2.length?null:this.N2[Ra]}nEf(Ra){return ob.a.gj(this.IGd,
Ra.toUpperCase())}Jjb(Ra){return ob.a.gj(this.lYa,Ra)}FWf(Ra){return!Ra.GroupUI}zhg(Ra,Tb,Dc){const Yc=Yd.a(Ra);oa.ULS.sendTraceTag(537161955,0,50,`FunctionInfoManager.OnFunctionListSucceeded: areNonStatusMessagesPresentInResult=${Yc}`);Yc?(ab.f(this.$).endEdit(!1,"FunctionInfoManager.OnFunctionListSucceeded"),this.$.ea.Yw(Ra.Errors)):this.mee(Ra.Result,Tb,Dc)}mee(Ra,Tb,Dc){oa.ULS.sendTraceTag(537161954,0,50,`FunctionInfoManager.RefreshFunctionList: functionsInfo count = ${Ra.length}, isCategorized = ${Tb}, partialResult = ${Dc} IsFullyLoaded = ${this.Fna}`);
this.Fna||(this.N2=Ra,this.IKh(Tb),this.abd=!Dc,this.bwg())}bwg(){this.raiseEvent("FunctionInfoLoaded")}IKh(Ra){var Tb=Jb.a.instance.ia(1032),Dc=[];this.lYa={};this.Lja=[];this.lYa[Tb]=Dc;const Yc=Jb.a.instance.ia(1033),Ad=[];this.Lja.push(Tb);this.Lja.push(Yc);for(let re=0,Me=this.N2.length;re<Me;re++){Tb=this.N2[re];Tb.IsCompatibility||Ad.push(Tb);var he=Tb.NameUI;const Ve=Tb.NameDataStrings;this.Azf[Ve.toUpperCase()]||(this.Azf[Ve.toUpperCase()]=Tb);this.IGd[he.toUpperCase()]||(this.IGd[he.toUpperCase()]=
Tb);if(!this.FWf(Tb)){if(Ra){he=Tb.GroupUI;let Hf=ob.a.gj(this.lYa,he);Hf||(Hf=[],this.lYa[he]=Hf,this.Lja.push(he));Hf.push(Tb)}Tb.IsCommonlyUsed&&Dc.push(Tb);Tb.IsCompatibility||this.$hh.push(Ve)}}this.lYa[Yc]=Ad;Ra&&(Ud.Yzg(Dc,[2,3,0,5,4,9,1,7,8,6]),Dc=Array(14),Dc[0]=0,Dc[1]=1,Dc[2]=7,Dc[3]=11,Dc[4]=5,Dc[5]=2,Dc[6]=6,Dc[7]=10,Dc[8]=9,Dc[9]=3,Dc[10]=4,Dc[11]=13,Dc[12]=12,Dc[13]=8,Ud.Yzg(this.Lja,Dc),Dc=[],Dc.push(...this.Lja),Dc.splice(13,1),this.Lja=Dc);Dc=(re,Me)=>re.NameUI.localeCompare(Me.NameUI);
this.N2=[...this.N2];this.N2.sort((re,Me)=>re.NameDataStrings.localeCompare(Me.NameDataStrings));for(let re=1,Me=this.Lja.length;re<Me&&Ra;re++)this.lYa[this.Lja[re]].sort(Dc);for(let re=0,Me=this.N2.length;re<Me;re++)this.N2[re].FunctionIndex=re}static Yzg(Ra,Tb){const Dc=[...Ra];for(let Yc=0;Yc<Dc.length&&Yc<Tb.length;Yc++)Ra[Yc]=Dc[Tb[Yc]]}}Object(Da.a)(Ud,"FunctionInfoManager",of.a,[723,724,2]);let Ff=class{constructor(Ra,Tb){this.$=Ra;this.pluginScheduler=Tb;this.da=Object(ab.f)(this.$)}dispose(){}};
Ff=Object(ra.__decorate)([Object(Hb.d)(na.Tc),Object(ra.__param)(0,Object(na.Lb)()),Object(ra.__param)(1,Object(Rb.k)())],Ff);Object(Da.a)(Ff,"GotoCtrlClick",null,[2]);Object(Hb.b)(na.od,{yk:"singleton"})(()=>No(function*(){return Uf}));const Uf=(Ra,Tb)=>No(function*(){if(l(Ra)&&l(Tb)){var Dc=u(Ra),Yc=u(Tb),Ad=yield v(Dc),he=yield v(Yc);var re=n(Dc.value,Yc.value);"different"===re.kind&&(Dc=n(Dc.unformattedValue,Yc.unformattedValue),re={kind:"different",diff:re.diff,unformatted:Dc});Ad={cse:Ad,immediate:he,
diagnostic:re,cellValueFix:Ka.EwaSettings.AEc()};oa.ULS.sendTraceTag(507646813,1,20,`ImmediateCellComparison.compareCells, result: ${JSON.stringify(Ad)}`)}});let Gf=class{constructor(Ra,Tb){this.$=Ra;this.clearContentNotifier=Tb;this.keptData={suggestionsKept:0,suggestionsCommitted:0,suggestionsChanged:0,suggestionsReverted:0,suggestionsDeleted:0};this.yl=(Dc,Yc)=>{this.f5g()&&Yc.committed&&Yc.kq.equals(this.nya.suggestion.kq)&&this.nya.suggestion.cellText!==Yc.cellText&&this.keptData.suggestionsChanged++};
this.dqb=()=>{var Dc;if(this.f5g()){var Yc=this.da.ha.qa.selectedRanges,Ad=null===(Dc=this.nya)||void 0===Dc?void 0:Dc.suggestion.kq;Yc.some(he=>he.contains(Ad))&&this.keptData.suggestionsDeleted++}};this.lza=(Dc,Yc)=>{0===Yc.By&&(170===Yc.Wl.operation.operationName&&this.keptData.suggestionsReverted++,this.$.userOperationManager.Hv(this.lza))};this.da=ab.f(this.$)}fKd(){this.keptData.suggestionsKept=this.sMi();return this.keptData}Ong(Ra){this.keptData.suggestionsCommitted++;this.nya={suggestion:Ra,
stateId:this.$.ea.gk};this.fq()}fq(){this.da.cellTextEditBox.Wx(this.yl);this.clearContentNotifier.mmd(this.dqb);this.$.userOperationManager.px(this.lza)}$o(){this.da.cellTextEditBox.Zw(this.yl);this.clearContentNotifier.ySc(this.dqb)}f5g(){this.$o();if(null!==this.nya&&1===this.$.ea.gk-this.nya.stateId)return!0;this.nya=null;return!1}sMi(){return this.keptData.suggestionsCommitted-(this.keptData.suggestionsChanged+this.keptData.suggestionsDeleted+this.keptData.suggestionsReverted)}};Gf=Object(ra.__decorate)([Object(Hb.d)(na.Bd,
{yk:"transient"}),Object(ra.__param)(0,Object(na.Lb)()),Object(ra.__param)(1,Object(na.V)())],Gf);Object(Da.a)(Gf,"KeptTelemetryHandler",null,[]);var lg=a(1377),Pa=a(420),lc=a(1004);class Gc extends Pa.a{constructor(Ra){super();this.$=Ra;this.Bl()}create(){(Ra=>Hb.a.resolve(na.E).then(Tb=>setTimeout(()=>Ra(Tb),0)))(Ra=>{Ra=this.$.ka.Ug(294)||this.$.ka.ph(294,new lc.RelativeAndAbsoluteReferencesManager(Ra));this.Yj(Ra)})}static Aa(Ra){Ra.ka.ph(295,new Gc(Ra))}}Object(Da.a)(Gc,"RelativeAndAbsoluteReferencesManagerFactory",
Pa.a,[]);var Cd=a(9),Qd=a(40),ge=a(897);class ye extends Pa.a{constructor(Ra){super();this.LIg="formulaAssistance";this.$=Ra;this.Bl()}create(){let Ra=this.$.ka.Ug(448);if(Ra)this.Yj(Ra);else if(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8428325_ExtractChunkLoading"))void Object(ge.a)(this.LIg,{va:this.hh}).then(()=>{Ra=this.$.ka.Ug(448);Ra||(Ra=this.$.ka.ph(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.$.isFeedbackEnabled})),this.$.uoc(()=>{const Tb={};
Tb.isFeedbackAllowed=this.$.isFeedbackEnabled;Ra.updateContext(Tb)}));this.Yj(Ra)});else{const Tb=Nf.d(Hb.a.resolve(na.Fb,{va:this.hh}));Qd.TaskExtensions.Ua(Tb,()=>{Qd.TaskExtensions.Ua(Nf.d(Tb.result.Vt().loadScript(this.LIg)),()=>{Ra=this.$.ka.Ug(448);Ra||(Ra=this.$.ka.ph(448,formulaAssistance.FormulaAssistanceUIFactoryGlobal.create({isFeedbackAllowed:this.$.isFeedbackEnabled})),this.$.uoc(()=>{const Dc={};Dc.isFeedbackAllowed=this.$.isFeedbackEnabled;Ra.updateContext(Dc)}));this.Yj(Ra)},this.$.xa,
3)},this.$.xa,3)}}static Aa(Ra){Ra.ka.ph(449,new ye(Ra))}}Object(Da.a)(ye,"FormulaAssistanceUIControlFactory",Pa.a,[]);var $e=a(1086),qf=a(221),h=a(255),Z=a(61);class E{constructor(Ra){this.scheduler=Ra;this.Oyb=void 0}bRf(){const Ra=this;return No(function*(){Ra.Oyb||(Ra.Oyb=yield Hb.a.resolve(na.p));return Ra.Oyb})}registerOnAnnotation(Ra,Tb,Dc,Yc){const Ad=this;return No(function*(){var he;const re=(Ve,Hf)=>{(0,Ad.scheduler.alAnnotationNotifier()[Ra])(Hf.annotation).catch(Qf=>{oa.ULS.sendTraceTag(508048724,
0,10,`IALInterop.onAnnotationReceived: Failed to send annotation to x10 handlers. ${Qf}`)})},Me=null!==(he=Ad.Oyb)&&void 0!==he?he:yield Ad.bRf();return null===Me||void 0===Me?void 0:Me.register(Me.e5().B7(Dc).A7(()=>{}).activateAnnotation({annotationType:Tb,bB:Yc,pY:re}).build())})}signal(Ra){const Tb=this;return No(function*(){var Dc;const Yc=null!==(Dc=Tb.Oyb)&&void 0!==Dc?Dc:yield Tb.bRf();return null===Yc||void 0===Yc?void 0:Yc.twb(Ra)})}}Object(Da.a)(E,"ALProvider",null,[]);class aa{constructor(Ra){this.h$k=
Ra;this.value=void 0}MO(){void 0===this.value&&(this.value=this.h$k());return this.value}reset(){this.value=void 0}}Object(Da.a)(aa,"ResettableLazy",null,[]);class Ja{constructor(){this.JVd=new Map;this.Utj=new aa(()=>No(function*(){return(yield Hb.a.resolve(na.gg,{va:0})).Zfa()}));this.JVd.set(hd.PluginFactoryName.FormulaByExamplePlugin,new aa(()=>No(function*(){const Ra=yield Hb.a.resolve(na.Lb);return Lb.a.l0a(Ra)})));this.JVd.set(hd.PluginFactoryName.TestPlugin,new aa(()=>No(function*(){return!0})))}getRecognizedRangeTablesInfo(Ra,
Tb,Dc,Yc,Ad){const he=this;return No(function*(){var re,Me;if(null===(Me=yield null===(re=he.JVd.get(Yc))||void 0===re?void 0:re.MO())||void 0===Me||!Me)return oa.ULS.sendTraceTag(507794771,306,50,`x10TableIntelligenceService.getRecognizedRangeTablesInfo: plugin ${Yc} is not licensed for user`),[];re=Tb?new Rd.a(Object(fb.B)(Tb),Ra):null;a:{switch(Dc){case hd.RecognizedTablesMetadataState.Valid:Me=2;break a;case hd.RecognizedTablesMetadataState.Invalid:Me=4;break a;case hd.RecognizedTablesMetadataState.All:Me=
6;break a}Me=void 0}return(yield he.Utj.MO()).iJa(re,Me,Ad).map(B)})}}Object(Da.a)(Ja,"X10TableIntelligenceProvider",null,[]);class tb extends Pa.a{constructor(Ra){super();this.$=Ra;this.Wqc=null;this.Bl()}create(){oa.ULS.sendTraceTag(537154643,0,50,"PluginSchedulerFactory.Create: Loading scheduler slice");$e.a.then(this.M4h(),Ra=>{this.Yj(Ra)})}M4h(){if(this.Wqc)return this.Wqc;const Ra=h.a.ogb(Z.b(),qf.a.none,"LoadResource","x10Scheduler loading");if(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:5789323_disableSchedulerForIE")&&
Yb.a.IU){const Tb=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();this.$.ka.ph(413,Tb);Ra.setResult(Tb);return this.Wqc=Ra.task}(Tb=>Hb.a.resolve(na.E,{va:this.hh}).then(Dc=>setTimeout(()=>Tb(Dc),0)))(()=>{this.ivj(Tb=>{const Dc=excelOnlineCalc.PluginSchedulerSingletonGlobal.instance();Tb=Tb.Vt();Tb=Nf.c(gb.Task.Va(Tb));Dc.registerALProvider(new E(Dc));Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8479330_enableTableIntelligenceInX10")&&Dc.registerTableIntelligenceProvider(new Ja);const Yc=
this.MYi();Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7913510_sendSchedulerFeaturesNOtification")&&Dc.notifier().setSchedulerFeatures(Yc.map(Ad=>hd.SchedulerFeature[Ad]));Promise.all([excelOnlineCalc.x10.ensureGroupAttached(Tb,hd.PluginAttachGroup.Core,Yc),Lb.a.qUb(this.$)?excelOnlineCalc.x10.ensureGroupAttached(Tb,hd.PluginAttachGroup.SmartSuggestionsAutoComplete,Yc):0]).then(Ad=>Ad.some(he=>0<he)).then(Ad=>{this.$.ka.ph(413,Dc);Ra.setResult(Dc);this.$.ka.Lh(491,he=>{he.gZ.anyPluginInitialized=
Ad})})})});return this.Wqc=Ra.task}ivj(Ra){void Hb.a.resolve(na.Fb,{va:this.hh}).then(Tb=>Ra(Tb))}MYi(){const Ra=[];S.forEach((Tb,Dc)=>{Tb(this.$)&&Ra.push(Dc)});return Ra}static Aa(Ra){Ra.ka.ph(414,new tb(Ra))}}Object(Da.a)(tb,"PluginSchedulerFactory",Pa.a,[]);const S=new Map([["ArgumentAssistance",()=>!0],["SimpleAutoComplete",()=>!0],["SmartSuggestionsAutoComplete",Ra=>Lb.a.qUb(Ra)],["ValuePreview",()=>Lb.a.Dna()],["ColoredReferences",()=>!0],["ParenthesisCoupling",()=>!0],["SyntaxErrors",()=>
Lb.a.pUb()],["EnumAutoComplete",()=>!0],["GotoCtrlClick",()=>Lb.a.KWf()]]);var Wa=a(208);const zb={selectByArrowKeyCounter:0,selectByMouseHoverCounter:0,commitByTabKeyCounter:0,commitByEnterKeyCounter:0,commitByMouseClickCounter:0,commitWhileRequestPending:0,dismissSmartSuggestionExplicitlyCounter:0,dismissSmartSuggestionImplicitlyCounter:0},hc={formulaAssistanceRequestAttemptedCounter:0,formulaAssistanceRequestOptimizedCounter:0},cd={argumentAssistanceCardInitialMode:void 0,argumentAssistanceCollapseCounter:0,
argumentAssistanceExpandCounter:0,argumentAssistanceLearnMoreCounter:0,argumentAssistanceDragCounter:0,argumentAssistanceDragTotalCounter:0,argumentAssistanceMoveCounter:0,argumentAssistanceMoveTotalCounter:0,argumentAssistanceCardIsInitialModeDefault:!1},ta={smartSuggestionShownCounter:0,smartSuggestionSelectedCounter:0,smartSuggestionCommittedCounter:0,smartSuggestionKeptCounter:0,smartSuggestionChangedCounter:0,smartSuggestionDeletedCounter:0,smartSuggestionRevertedCounter:0,isCellContentOnlyEqualDuringEditCounter:0,
isCellContentFormulaCounter:0,smartSuggestionWouldSuggestInsidePivotCounter:0},wb={parenthesesCouplingCounter:0,formulaHighlightsCounter:0},ic={dialogCommittedCounter:0,dialogShownCounter:0,argsDialogOpenedByRibbonCounter:0,argsDialogOpenedByDialogCounter:0,argsDialogCommittedCounter:0},Oa={argumentAssistanceFlight:void 0,autoCompleteUIFlight:void 0,smartFormulaBarAutoCompletePluginFlight:void 0,anyPluginInitialized:void 0,formulaAssistanceRedesignFlight:void 0,smartFormulaSuggestionsFeatureEnabled:void 0,
parenthesesCouplingFlight:void 0,coloredReferencesFlight:void 0,uILocale:void 0,dataLocale:void 0,country:void 0,formulaAssistanceUiPositionFlight:void 0,argumentAssistanceUxFlight:void 0};var Cb;(function(Ra){Ra.RenderDown="rd";Ra.RenderUp="ru";Ra.Expand="e";Ra.Collapse="c";Ra.Drag="d";Ra.Move="m";Ra.GiveFeedback="gf";Ra.InitialModeExpanded="ie";Ra.InitialModeCollapsed="ic";Ra.LearnMore="lm";Ra.ESC="esc";Ra.SecondESC="2ndEsc"})(Cb||(Cb={}));Object(Da.b)("argumentAssistanceUsageActions",Cb);var yc=
a(65),Nc=a(44),Id=a(106);const ke={["argumentAssistanceOverall"]:[50,80,100,130,150,170,200],["autoCompleteOverall"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteOverallSimpleAndSmart"]:[50,80,100,130,150,170,200],["autoCompleteOverallSmartOnly"]:[50,80,100,130,150,170,200],["autoCompleteOverallSimpleOnly"]:[50,80,100,130,150,170,200],["tryUpdateHighlightsFromCellContentEditor"]:[50,80,100,130,150,170,200],["autoCompleteComputation"]:[50,80,100,130,150,170,200,250,300,350,400],["autoCompleteComputationNoResult"]:[50,
80,100,130,150,170,200,250,300,350,400]};class Ie{constructor(Ra,Tb){this.$=Ra;this.BTg=Tb;this.XKa=Lb.a.RFc();this.dP=null;this.aJc=-1;this.b_d=null;this.c_d=this.bJc=0;this.Oka=Object.assign({},cd);this.mU=Object.assign({},ta);this.Rta=Object.assign({},zb);this.gqd=Object.assign({},hc);this.pGd=Object.assign({},wb);this.gZ=Object.assign({},Oa);this.CHb={};this.Yib=Object.assign({},ic);this.jHb=[];this.Ylc=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7376612_argumentAssistanceOrderedActionsTelemetry");
this.CWa={};this.yl=(Dc,Yc)=>{null!=this.dP&&(1==Math.abs(this.aJc-this.$.ea.gk)&&(Dc=this.$.sa.na.sheetId,Yc.committed&&Yc.kq.equals(this.dP.kq)&&this.b_d===Dc&&this.dP.cellText!==Yc.cellText&&this.bJc++),1<=Math.abs(this.aJc-this.$.ea.gk)&&(this.dP=null,this.aJc=-1,this.b_d=null));0<Object.keys(this.CWa).length&&(oa.ULS.sendTraceTag(509658956,0,50,`FormulaAssistanceTelemetryManager.onEditEnded: current edit's completion items data: ${JSON.stringify(this.CWa)}`),this.CWa={})};this.Li=(Dc,Yc)=>{Yc.Hl||
Yc.YTb||(this.rNg(),this.sDk(),this.$.sendBeaconTraceTag(88392384,50,!1,"{0}",this.getJsonForLogging()))};this.Drb=new Id.a;Ra.Lp(this.Li);this.XKa||ab.f(this.$).fp.Wx(this.yl);this.rNg();this.fzj()}dispose(){!this.XKa&&this.$&&ab.f(this.$).fp.Zw(this.yl)}YOa(Ra){Ra.forEach(Tb=>{this.Drb.Vg(Tb)||this.Drb.ga(Tb,new od(ke[Tb]));this.Drb.ma(Tb).w7a()})}C4(Ra,Tb){Tb=void 0===Tb?!0:Tb;Ra.forEach(Dc=>{this.Drb.Vg(Dc)&&this.Drb.ma(Dc).kfa(Tb)})}kyk(Ra){this.Mda(Ra?"ie":"ic")}jyk(){this.Oka.argumentAssistanceCardIsInitialModeDefault=
!0}XMb(Ra){window.requestAnimationFrame(()=>{this.C4([Ra])})}Pmk(Ra){Ra.forEach(Tb=>{Tb=hd.CompletionItemKind[Tb.kind];this.x5g(Tb);this.CHb[Tb].shownCounter++;this.CWa[Tb].shownCounter++})}Omk(Ra){Ra=hd.CompletionItemKind[Ra];this.x5g(Ra);this.CHb[Ra].committedCounter++;this.CWa[Ra].committedCounter++}Mda(Ra){if(this.Ylc){const Tb=this.jHb.length;0===Tb||this.jHb[Tb-1][0]!==Ra?this.jHb.push([Ra,1]):this.jHb[Tb-1][1]++}else switch(Ra){case "e":this.Oka.argumentAssistanceExpandCounter++;break;case "c":this.Oka.argumentAssistanceCollapseCounter++;
break;case "d":this.Oka.argumentAssistanceDragCounter++;break;case "m":this.Oka.argumentAssistanceMoveCounter++;break;case "lm":this.Oka.argumentAssistanceLearnMoreCounter++;break;case "ie":this.Oka.argumentAssistanceCardInitialMode="Expanded";break;case "ic":this.Oka.argumentAssistanceCardInitialMode="Collapsed"}}lBk(Ra){this.BTg.Ong(Ra)}fzj(){oa.ULS.sendTraceTag(509140996,0,50,`FormulaAssistanceTelemetryManager.SessionDetails: ${yc.a.li(this.gZ)}`)}getJsonForLogging(){return"{"+this.kX("SessionDetails",
this.gZ)+","+this.kX("ArgumentAssistanceUsage",this.Oka)+","+this.kX("argumentAssistanceOrderedActions",this.jHb)+","+this.kX("FormulaSuggestionsUsage",this.mU)+","+this.kX("FunctionDialogUsage",this.Yib)+","+this.kX("AutocompleteCardInteraction",this.Rta)+","+this.kX("AutocompleteRenderOptimization",this.gqd)+","+this.kX("AutocompleteUsageByKind",this.CHb)+","+this.kX("FormulaHighlightsUsage",this.pGd)+","+this.ZTi()+"}"}sDk(){if(this.XKa){var Ra=this.BTg.fKd();this.mU.smartSuggestionKeptCounter=
Ra.suggestionsKept;this.mU.smartSuggestionChangedCounter=Ra.suggestionsChanged;this.mU.smartSuggestionDeletedCounter=Ra.suggestionsDeleted;this.mU.smartSuggestionRevertedCounter=Ra.suggestionsReverted}else this.mU.smartSuggestionChangedCounter=this.bJc,this.mU.smartSuggestionDeletedCounter=this.c_d,this.mU.smartSuggestionKeptCounter=this.mU.smartSuggestionCommittedCounter-this.bJc-this.c_d;for(Ra=0;Ra<this.mU.smartSuggestionKeptCounter;Ra++)Object(Sa.b)(Sc)}rNg(){this.gZ.argumentAssistanceFlight=
"T";this.gZ.autoCompleteUIFlight=this.QDf("Microsoft.Office.Excel.","AutoCompleteNewUI");this.gZ.smartFormulaBarAutoCompletePluginFlight="T";this.gZ.formulaAssistanceRedesignFlight="T";this.gZ.coloredReferencesFlight="T";this.gZ.parenthesesCouplingFlight="T";this.gZ.formulaAssistanceUiPositionFlight="T";this.gZ.smartFormulaSuggestionsFeatureEnabled=Lb.a.qUb(this.$);this.gZ.argumentAssistanceUxFlight="T";this.gZ.uILocale=this.$.qca;this.gZ.dataLocale=this.$.dataCultureTag;this.gZ.country=JSON.parse(this.$.ua.SessionStartInfoJson).LocationCountry}ZTi(){const Ra=
new Wa.a;for(const Tb of this.Drb)Tb.value.Hwf(),Ra.add(`"${Tb.key}":${yc.a.li(Tb.value.P6)}`);return`"PerfMeasurements": {${Ra.toArray().join(",")}}`}QDf(Ra,Tb){return La.a.contains(this.$.ua.FlightHolder.FlightId,Tb,!0)?Ka.EwaSettings.getBooleanFeatureGate(Ra+Tb,!1)?"T":"C":"None"}kX(Ra,Tb){return`"${Ra.toString()}":${Nc.c(Tb)}`}x5g(Ra){this.CHb[Ra]||(this.CHb[Ra]={shownCounter:0,committedCounter:0});this.CWa[Ra]||(this.CWa[Ra]={shownCounter:0,committedCounter:0})}}Object(Da.a)(Ie,"FormulaAssistanceTelemetryManager",
null,[753]);class Le extends Pa.a{constructor(Ra){super();this.$=Ra;this.Bl()}static Aa(Ra){Ra.ka.ph(492,new Le(Ra))}create(){void Hb.a.resolve(na.Bd).then(Ra=>{var Tb;this.Yj(null!==(Tb=this.$.ka.Ug(491))&&void 0!==Tb?Tb:this.$.ka.ph(491,new Ie(this.$,Ra)))})}}Object(Da.a)(Le,"FormulaAssistanceTelemetryManagerFactory",Pa.a,[]);var wf=a(894),Kf=a(1389);class cg extends Bb.a{constructor(Ra){super(Ra,cg.featureName);this.Ecj=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType")}static init(Ra){cg.Wa?
oa.ULS.sendTraceTag(509122372,1,15,"FormulaSuggestionUIControl.init: unexpected call after already being inited."):cg.Wa=new cg(Ra)}static instance(){return cg.Wa}get Hk(){return uc.a.lGd}show(Ra,Tb,Dc,Yc,Ad,he,re,Me){he=void 0===he?null:he;return this.Uvb(void 0===re?null:re,Ve=>{appChrome.renderFormulaSuggestionCard(Ra,Tb,this.domElement,Ve.y,Ve.x,Ve.y+Ve.height,Ve.x+Ve.width,Dc,Yc,Ad,he,this.avb,Me?{explanationKey:Me.explanationKey,replacements:Me.explanationReplacements,notifyExplanationSuccessful:Me.X6d}:
void 0)})}lSg(Ra,Tb,Dc,Yc,Ad,he,re,Me,Ve,Hf,Qf){return this.Uvb(Qf,ia=>{appChrome.renderRowNumberingSuggestionCard(Ra,Tb,this.domElement,ia.y,ia.x,ia.y+ia.height,ia.x+ia.width,Dc,Yc,Ad,he,re,Me,Ve,Hf,this.avb)})}I7(Ra,Tb,Dc){Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FBECurtainLifterCalloutForTestingOnlyEnabled",!1)&&(this.k4&&Ra.equals(this.RZd)||(this.k4&&document.body.removeChild(this.k4),this.RZd=Ra,Ra=this.grid.kh(Ra),Ra=this.grid.getCellBounds(Ra.cell,!0),this.k4=document.createElement("div"),
this.k4.setAttribute("style",`position:fixed;
        left: ${Ra.x+Ra.width}px;
        top: ${Ra.y+Ra.height/2}px`),document.body.appendChild(this.k4)),Ra=new xb.a(-847286761,0,this.$.Rh,0,null),this.$.Ma.dh(Ra,{["CalloutName"]:15,["Target"]:this.k4,["NewState"]:Tb,["Reason"]:Dc}))}}Object(Da.a)(cg,"FormulaByExampleCardUIControl",Bb.a,[728]);class Bg extends wf.a{constructor(Ra){super(Ra)}Qs(){oa.ULS.sendTraceTag(528758224,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler init flow started.");const Ra=Zf.GetServiceTaskFactory.Bj(this.$.ka,
453,454,1),Tb=Object(Nf.d)(Hb.a.resolve(na.Ic,{va:this.hh})),Dc=Object(Nf.d)(Hb.a.resolve(na.Jc,{va:this.hh}));Qd.TaskExtensions.Ua(Qd.TaskExtensions.Ln([Ra,Tb,Dc],this.xa),()=>{const Yc=new Kf.a(Tb.result,Ra.result,cg.instance(),Dc.result);this.cr([Yc]);oa.ULS.sendTraceTag(537161924,0,50,"FormulaByExampleCommandHandlerFactory.CreateCommandHandlersAsync: FormulaByExampleCommandHandler initialized successfully")},this.xa)}static Aa(Ra){wf.a.sx(455,new Bg(Ra))}}Object(Da.a)(Bg,"FormulaByExampleCommandHandlerFactory",
wf.a,[]);var dh=a(107),Sf=a(1027);class eh{constructor(Ra,Tb,Dc,Yc,Ad){this.kind=Ra;this.value=Tb;this.formatted=Dc;this.numFmt=Yc;this.cellStyle=Ad}get displayText(){var Ra;return null!==(Ra=this.formatted)&&void 0!==Ra?Ra:this.value}}Object(Da.a)(eh,"CloneEvaluatedEdit",null,[]);class Rg{constructor(Ra,Tb,Dc){this.status=Ra;this.pNb=void 0===Tb?null:Tb;this.dsb=Dc}}Object(Da.a)(Rg,"FormulaByExampleFormulaEvalResult",null,[]);var Dg=a(1050),Kg;(function(Ra){Ra[Ra.none=0]="none";Ra[Ra.number=1]="number";
Ra[Ra.string=2]="string";Ra[Ra.boolean=3]="boolean";Ra[Ra.error=4]="error"})(Kg||(Kg={}));Object(Da.b)("CellValueType",Kg);var Hg;(function(Ra){Ra[Ra.none=0]="none";Ra[Ra.number=1]="number";Ra[Ra.string=2]="string";Ra[Ra.boolean=4]="boolean";Ra[Ra.error=8]="error";Ra[Ra.range=16]="range";Ra[Ra.array=32]="array";Ra[Ra.missing=64]="missing";Ra[Ra.blank=128]="blank";Ra[Ra.rich=256]="rich"})(Hg||(Hg={}));Object(Da.b)("OperKind",Hg);var fh;(function(Ra){Ra[Ra.NoMismatch=0]="NoMismatch";Ra[Ra.Mismatch=
1]="Mismatch";Ra[Ra.HashesValueMismatch=2]="HashesValueMismatch"})(fh||(fh={}));Object(Da.b)("EcsMismatchResult",fh);class Vh extends Set{constructor(Ra){super();this.voa=Ra}add(Ra){if(this.has(Ra))return this;if(this.size>=this.voa){const Tb=this.entries().next().value[0];this.delete(Tb)}return super.add(Ra)}has(Ra){const Tb=super.has(Ra);return Tb?(this.delete(Ra),super.add(Ra),!0):Tb}}Object(Da.a)(Vh,"LimitedSizeSet",Set,[]);var Yf=a(626);class Eg{constructor(Ra,Tb){this.xh=null;this.qPg=this.vWf=
this.XK=!1;this.XZd=null;this.Ybe=(Dc,Yc,Ad)=>{if(!this.vFc(Dc))return Object(Sf.h)(Yc,"Result object from EvalOnClone API is empty or null.",this.Do,8),new Rg(2);const he=this.D9k(Dc,Yc);if(!Ad&&"OnlyPreviousFailureFound"===he.reason)return new Rg(4);if(!he.success)return Object(Sf.h)(Yc,`Evaluated results from calc do not match the user data in the grid or had errors from calc. reason: ${he.reason}`,this.Do,8),oa.ULS.sendTraceTag(537161880,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone:Formula results from Calc.ts do not match grid data."),
new Rg(2);this.Do.Cv(Yc.flowId,11);oa.ULS.sendTraceTag(537161879,0,50,"FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: EvalFormulaRange CSE: Result received from calc.");return new Rg(0,Dc.results,he.dsb)};this.xh=Ra;this.XK=Tb;this.Do=Dg.a.getInstance(this.xh);this.vWf=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6327953_FormatOutputResultsOfFBE_V2");this.qPg=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7549840_DontShowFBESuggestionsWithErrorInTriggerCell")}jhe(Ra){this.XZd&&this.A2g(this.XZd,
!0,void 0,void 0,Ra)}uAk(Ra,Tb,Dc,Yc,Ad){Dc=void 0===Dc?null:Dc;Yc=void 0===Yc?!1:Yc;Tb=Ra.range.pk(Tb);return Tb?this.Yqf(Ra,Tb,Dc).then(he=>{this.XK&&!Yc&&Ra.flowId&&Object(Sf.f)("CALCULATIONED",Ra.flowId,Ad);if(2===he.status)return he;oa.ULS.sendTraceTag(537161881,0,50,"FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: evalFormulaRangeOnClone CSE: Result received from calc.");this.XZd=he;return this.A2g(he,Yc,Ra.flowId,Ad)}).catch(he=>{Object(Sf.h)(Ra,`failed to setFormulaPreviewOnRangeModel, error in calc API: ${he.toString()}`,
this.Do,8);return Promise.reject(`FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Unable to EvalFormulaRange, e: ${he.toString()}`)}):(Object(Sf.h)(Ra,"Annotation range does not intersect loaded range",this.Do,6),Promise.reject("FormulaByExampleModelUpdater:setFormulaPreviewOnRangeModel: Annotation range does not intersect loaded range."))}Yqf(Ra,Tb,Dc){Dc=void 0===Dc?null:Dc;const Yc=this;return No(function*(){let Ad,he;const re=Eg.qxi(Dc);Yc.Do.Cv(Ra.flowId,7);try{return Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7974673_FBECircularReferenceFixCalcMitigation")?
(Ad=yield Yc.xh.J4(null,Tb,Ra.originCell,Ra.formula,!0),he=Yc.Ybe(Ad,Ra,!1),4===he.status&&(oa.ULS.sendTraceTag(508683744,0,50,`FormulaByExampleModelUpdater:EvalFormulaRangeOnClone: previous failure found, with no other errors, retry with cloneWrites. flow id: ${Ra.flowId}`),Ad=yield Yc.xh.J4(re,Tb,Ra.originCell,Ra.formula,!0),he=Yc.Ybe(Ad,Ra,!0))):(Ad=yield Yc.xh.J4(re,Tb,Ra.originCell,Ra.formula,!0),he=Yc.Ybe(Ad,Ra,!0)),he}catch(Me){return Object(Sf.h)(Ra,`failed to EvalFormulaRangeOnClone, error in calc API: ${Me.toString()}`,
Yc.Do,8),Promise.reject(`FormulaByExampleModelUpdater:EvalFormulaOnRange: Unable to EvalFormulaRange, e: ${Me.toString()}`)}})}M4e(Ra,Tb,Dc){var Yc;if(Ra){var Ad=[];for(const Me of Ra){if(!xf.a.bFc(Me))continue;var he=Me;Ra=D(he.value.cell);var re=this.xh.kh(Ra);if(!re)continue;he=this.QId(he);re=re.cell;const Ve=re.OY;(null===(Yc=he.cellStyle)||void 0===Yc?0:Yc.HorizontalAlignment)&&re.O1(he.cellStyle.HorizontalAlignment,!0,!0);Ve||oa.ULS.sendTraceTag(508179167,0,50,`FormulaByExampleModelUpdater:applyFormulaCSE: cell CSE failed for flow ${Dc}`);
re.text=Ve;re.formulaBarText=Tb;Ad.push({text:Ve,value:he.value,kind:he.kind,range:Ra})}C(this.xh,Ad,Dc)}}static qxi(Ra){const Tb=Dc=>({row:Dc.cell.gH,column:Dc.cell.oK,Xn:Dc.Xn,formulaBarText:Dc.Xn.value,text:Dc.cell.text,Vn:Dc.cell.Vn});return Ra?Ra.map(Tb):null}vFc(Ra){return(Ra=Ra.results)&&Ra.length?!0:!1}A2g(Ra,Tb,Dc,Yc,Ad){var he=Ra.pNb;for(const re of he){if(!xf.a.bFc(re)){"Unavailable"!==re.reason.kind&&(Ra.status|=2);continue}he=re.value.cell;if(!he){Ra.status|=2;continue}he=D(he);if(Ad&&
!he.yi(Ad))continue;he=this.xh.kh(he);if(!he){Ra.status|=2;continue}const Me=he.cell,Ve=this.QId(re);Me.OY=Ve.displayText;Me.u1b=Ve.numFmt;Me.Ftg=Ve.cellStyle;Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")&&(Me.sqk=J(he,re));Ra.status|=1}this.XK&&!Tb&&Dc&&Object(Sf.f)("MODELUPDATED",Dc,Yc);return Ra}D9k(Ra,Tb){let Dc=null,Yc=!1,Ad=!1,he=!1,re=!1,Me=!1,Ve=!1,Hf=!1,Qf=!1,ia=!1;Ra=Ra.results;const Xb=new Vh(5);var Vc=Ra.entries();for(const ud of Vc){Vc=ud[0];const xe=this.E9k(ud[1],
Tb);xe.wnb&&(Yc=xe.aMb);xe.MXd&&(Ad=!0,he||(he=xe.isInViewport),Me||(Me=xe.isInViewport&&!xe.DUb));re||(re=xe.DUb);Ve||(Ve=xe.JNf);Dc=null!==Dc&&void 0!==Dc?Dc:xe.BVa;Hf||(Hf=xe.kZf);Qf||(Qf=xe.zYf);xe.aMb&&(xe.u3e||xe.t3e)&&Xb.add(`grid: ${xe.u3e}, clone: ${xe.t3e}`);(xe.MXd||xe.DUb)&&Ra.splice(Vc,1);ia||xe.o9f||(ia=!0)}Yc?this.Do.Cv(Tb.flowId,10):this.Do.Cv(Tb.flowId,9);return Dc?{success:!1,reason:Dc}:Hf?{success:!1,reason:"OnlyPreviousFailureFound"}:{success:!0,dsb:{["hasUnavailableCells"]:Ad,
["hasUnexpectedUnavailableCellsInViewport"]:Me,["hasHiddenRows"]:re,["hasUnavailableCellsInViewport"]:he,["hasErrorCells"]:Ve,["hasNumFmtInSuggestion"]:Qf,["formattedResultsGridComparisons"]:[...Xb],["renderedPreviewIsDirty"]:ia}}}E9k(Ra,Tb){var Dc;const Yc={wnb:!1,MXd:!1,isInViewport:!1,DUb:!1,kZf:!1,BVa:null,JNf:!1,aMb:!1,zYf:!1,o9f:!1};if(!xf.a.bFc(Ra)){Ra=Ra.reason;var Ad=pc.Range.gi(Ra.cell.row+1,Ra.cell.col+1);Yc.wnb=Ad.equals(Tb.originCell);this.vwf(Yc,Ad);if("Unavailable"===Ra.kind)return Yc.MXd=
!0,Yc;if("PreviousFailure"===Ra.kind)return Yc.kZf=!0,Yc;Yc.BVa=JSON.stringify({kind:Ra.kind,innerKind:Ra.innerKind});Yc.BVa=null!==(Dc=Yc.BVa)&&void 0!==Dc?Dc:"failure in calc";return Yc}var he=D(Ra.value.cell);Yc.wnb=he.equals(Tb.originCell);this.vwf(Yc,he);Dc=this.xh.kh(he);if(!Dc){if(Yc.isInViewport&&!Yc.DUb)return Yc.BVa="formatted grid cell is null",Yc;oa.ULS.sendTraceTag(509682371,0,50,"FormulaByExampleModelUpdater:validateCalcResultMatchesCellData: did not fail suggestion when a formatted grid cell is null as this cell is hidden or not in view.");
return Yc}Ad=this.QId(Ra,this.vWf?Dc:null);if(8===Ad.kind)return Yc.JNf=!0,this.qPg&&Yc.wnb&&(Yc.BVa=`suggestion has error of kind ${Ad.value} in cell.`),Yc;const re=Dc.text;if(!re)return Yc.aMb=!0,Yc;const Me=Ad.displayText;Yc.aMb=J(Dc,Ra);Yc.t3e=La.a.f_(Me);Yc.u3e=La.a.f_(re);Yc.o9f=Dc.cell.u1b?Dc.cell.u1b===Ra.value.value.numFmt:Dc.cell.OY===Ra.value.value.formattedText;Yc.aMb||(he=Tb.NVf(he)?Yc.wnb?"MODIFIEDEXAMPLE":"EXAMPLE":Yc.wnb?"MODIFIEDRESTOFRANGE":"RESTOFRANGE",Object(Sf.g)(Yc.zYf?"numFmtMismatch":
"textMismatch",re,Me.toString(),Dc.cell.Vn,"evalFormulaOnCloneToShowPreview",Tb,he,J(Dc,Ra),Dc.cell.numFmt,Ad.numFmt),Yc.BVa="data strings do not match");return Yc}vwf(Ra,Tb){Ra.isInViewport=this.xh.FF(Tb);Ra.DUb=this.xh.mj.Pxa(Tb)}QId(Ra,Tb){const Dc=Ra.value.value,Yc=hg(Ra).toString();if(Tb&&!Dc.formattedText&&""!==Dc.formattedText){Ra=Ra.value.formatted;var Ad=qg(Dc.kind);Ra=this.xh.v$(Ra,Ad,Fc.a,Tb);Object(Ub.c)(Ra)&&(Dc.formattedText=Ra.value.text,Dc.numFmt=Ra.value.numFmt,Ad=new Yf.a,Ad.HorizontalAlignment=
0===Tb.cell.horizontalAlignment?Ra.value.horizontalAlignment:null,Dc.cellStyle=Ad)}return new eh(Dc.kind,Yc,Dc.formattedText,Dc.numFmt,Dc.cellStyle)}}Object(Da.a)(Eg,"FormulaByExampleModelUpdater",null,[]);const hg=Ra=>{Ra=Ra.value.value;return 1===Ra.kind?Ra._valueXL:8===Ra.kind?Ia.a.Fuc[Ra.type-1]:Ra.value},qg=Ra=>{switch(Ra){case 1:return 1;case 2:return 2;case 8:return 4;case 4:return 3;default:return 0}};var jh=a(1228),dg=a(1227);class Wh extends dg.a{constructor(Ra,Tb,Dc,Yc){super(Ra,Tb,Dc,
Yc);this.kind="Table"}get table(){void 0===this.Rbb&&(this.Rbb=this.xh.sl(this.originCell,!1));return this.Rbb}set table(Ra){this.Rbb=Ra}get gx(){return this.table?xf.a.Yfa(this.table):null}}Object(Da.a)(Wh,"FormulaByExampleTableSuggestion",dg.a,[796]);var Ch=a(1087),Fg=a(1159),Qa=a(1088),Ma=a(1230),$c=a(1189),de=a(1362);class Be{constructor(Ra){this.zLf=!1;this.xh=Ra}Esh(Ra){"ACCEPT"===Ra?this.xh.ei(-458824895,-1,0,null):"DECLINE"===Ra?this.xh.ei(-1726708382,-1,0,null):"IGNORE"===Ra&&(this.zLf?this.xh.ei(-1227021552,
-1,0,null):this.zLf=!0)}}Object(Da.a)(Be,"FormulaByExampleSurveyManager",null,[]);const nf=[Object(pb.d)("featureNameField","FormulaByExample"),Object(pb.d)("ver","1.0.0")],Tf={eventName:"Office.Excel.FormulaByExample.Seen",eventFlags:Sa.a,dataFields:[...nf,Object(pb.a)("isFeatureSeen",!0)]},Xf={eventName:"Office.Excel.FormulaByExample.Tried",eventFlags:Sa.a,dataFields:[...nf,Object(pb.a)("isFeatureTried",!0)]},zg={eventName:"Office.Excel.FormulaByExample.Succeeded",eventFlags:Sa.a,dataFields:[...nf,
Object(pb.a)("isFeatureSucceeded",!0)]};var $f=a(141),Ng=a(140);class pg extends Sys.EventArgs{constructor(Ra){super();this.suggestion=Ra}}Object(Da.a)(pg,"FormulaByExampleAnnotationArrivedEventArgs",Sys.EventArgs,[]);class Ug{constructor(Ra,Tb,Dc){this.formulaByExampleManager=Ra;this.Fqa=Tb;this.Do=Dc;this.PAf=Yc=>"Table"===Yc.kind?this.Do.Exc(Yc.table.name,Yc.column):this.Do.cPb(Yc.gx,Yc.column,Yc.sheetId);this.g7d=(Yc,Ad)=>{Yc=Ad.suggestion;Ad=this.PAf(Yc);this.IJb.has(Ad)&&this.IJb.get(Ad).g7d(W(Yc))};
this.tPj=(Yc,Ad)=>{Yc=Ad.suggestion;Ad=this.PAf(Yc);let he;this.IJb.has(Ad)?(he=this.IJb.get(Ad),he.pZg(W(Yc),Yc.anonymizedFormula,Yc.flowId)):(he=new Og(Ad,Yc),this.IJb.set(Ad,he))};this.IJb=new Map;this.formulaByExampleManager.yxh(this.g7d);this.Fqa.zxh(this.tPj)}}Object(Da.a)(Ug,"FormulaByExamplePostSuggestionSpiesManager",null,[]);class Og{constructor(Ra,Tb){this.tod=Ra;this.YIc=null;this.eee=new Map;this.pZg(W(Tb),Tb.anonymizedFormula,Tb.flowId)}pZg(Ra,Tb,Dc){this.CWf(Ra)||(this.eee.set(Ra,new bh(Ra,
Tb,Dc,!0)),this.YIc=Ra)}g7d(Ra){if(this.YIc){var Tb=this.SHf(this.YIc);Tb?(Ra!==this.YIc&&(Tb.anc=!0,this.D5f(Tb)),this.CWf(Ra)&&(Ra=this.SHf(Ra),Ra.U7i(),Ra.anc&&(Ra.aje=!0),this.D5f(Ra))):oa.ULS.sendTraceTag(508687501,306,50,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: failed to get latest rejected formula records for column ${this.tod}`)}else oa.ULS.sendTraceTag(508687502,306,15,`FormulaByExampleColumnSpy.onFormulaAnnotationForColumn: unexpected state - latest rejected formula is null for column ${this.tod}`)}SHf(Ra){return this.eee.get(Ra)}CWf(Ra){return this.eee.has(Ra)}D5f(Ra){oa.ULS.sendTraceTag(137687059,
306,20,`FormulaByExampleColumnSpy.logRejectedFormulaRecords: ${JSON.stringify({["anonymousColumnId"]:this.tod,["suggestionFlowId"]:Ra.dTk,["formulaAnonymized"]:Ra.eYa,["inPatternEditsPostSuggestion"]:Ra.E7i,["brokePattern"]:Ra.anc,["resumedPattern"]:Ra.aje,["latestEditInPattern"]:Ra.XIc})}`)}}Object(Da.a)(Og,"ColumnSpy",null,[]);class bh{constructor(Ra,Tb,Dc,Yc){this.mDa=Ra;this.hdc=Tb;this.Zph=Dc;this.CKe=0;this.sgd=this.c6c=!1;this.UNe=Yc}get formula(){return this.mDa}get eYa(){return this.hdc}get dTk(){return this.Zph}get E7i(){return this.CKe}U7i(){this.CKe++}get anc(){return this.c6c}set anc(Ra){if(this.c6c=
Ra)this.XIc=!1}get aje(){return this.sgd}set aje(Ra){if(this.sgd=Ra)this.XIc=!0}get XIc(){return this.UNe}set XIc(Ra){this.UNe=Ra}}Object(Da.a)(bh,"ColumnSpyFormulaRecords",null,[]);class mh extends of.a{constructor(Ra,Tb,Dc){super();this.TSg=Dc;this.dP=this.bH=this.Fqa=this.LLa=this.xh=null;this.c1a=this.XK=!1;this.n1=null;this.M6b=!1;this.qOb=null;this.sQg=!1;this.T9f=2E3;this.$yf=null;this.D4g=0;this.upd=!1;this.dDc=[];this.VF=null;this.qCj=1E4;this.WLj=Yc=>{oa.ULS.sendTraceTag(520987789,306,50,
`FormulaByExampleManager.onCloseCallback: closeReason = ${$c.a[Yc]}`)};this.Ixi=(Yc,Ad)=>{var he,re,Me,Ve,Hf,Qf;oa.ULS.sendTraceTag(528758222,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation received.");(Yc=Ad.annotation)?(Ad=parseInt(Yc.guid,10),0>Ad||Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7417755_FormulaByExampleVerifyDuplicatedAnnotation")&&!this.Do.lWf(Ad)||(oa.ULS.sendTraceTag(526984792,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: received annotation's flowId: ${Ad}, containsRowPlaceholder: ${null===
(re=null===(he=Yc.generatedFormula)||void 0===he?void 0:he.formula)||void 0===re?void 0:re.includes(Ch.b)}`),this.Do.Cv(Ad,14),he=this.L3j(Ad),re=this.xh,re=he.HU?new Wh(re,Yc,Ad,he):new Ch.a(re,Yc,Ad,he),this.VF&&(this.VF.OPa(Ad,1,{formula:null===(Me=Yc.generatedFormula)||void 0===Me?void 0:Me.formula,eYa:null===(Ve=Yc.generatedFormula)||void 0===Ve?void 0:Ve.anonymizedFormula}),this.VF.WMb(Ad)),this.raiseEvent("fbeaa",new pg(re)),Object(de.b)(re)||this.xh.l0a()?(this.XK&&!this.c1a&&Object(Sf.f)("ANNOTATIONRECEIVED",
re.flowId),null!=re.errorMessage?(oa.ULS.sendTraceTag(527005666,306,10,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived with error message: ${re.errorMessage}, flowId: ${re.flowId}`),this.Do.Cv(re.flowId,15,{reason:"Annotation arrived with error message"})):re.formula?(null===(Qf=this.TSg)||void 0===Qf?void 0:Qf.rPj(re.flowId),oa.ULS.sendTraceTag(509679808,306,20,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with a formula suggestion arrived. flowId: ${re.flowId} isTableSuggestion: ${Object(de.b)(re)}}`),
this.Do.Cv(re.flowId,16,{ELc:re.formula}),this.dP=re,(Me=this.Fqa.oea(re))?this.sQg||1!==re.invocationMethod?re.$D<Qa.a?oa.ULS.sendTraceTag(528758220,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have enough examples to prompt a suggestion."):(oa.ULS.sendTraceTag(527005665,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation with formula suggestion arrived. trying to suggest/apply it. flowID: ${re.flowId}`),0===re.invocationMethod?
this.tAk(Me):(Ve=Object(Sf.c)(re.flowId),Ve>this.T9f?(oa.ULS.sendTraceTag(509636688,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation arrived after the maximal wait time for suggestions. flowId: ${re.flowId}, duration: ${Ve}`),this.Do.Cv(re.flowId,6,{reason:"annotation arrived after the maximal wait time for suggestions"})):(Ve=this.qQg(Me,he),Ve.value?this.n_g(Me,!1,`${(null===he||void 0===he?0:he.uZ)?xf.a.hId(he.uZ):"UnknownCommand"} - UponAnnotationReceived`,he):(oa.ULS.sendTraceTag(509636687,
306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: shouldShowPreview returned false for suggestion with flowId: ${re.flowId}, reason: ${Ve.reason}`),this.Do.Cv(re.flowId,6,{reason:Ve.reason}))))):oa.ULS.sendTraceTag(523850754,306,50,"FormulaByExampleManager.formulaByExampleAnnotationHandler: session supports suggestions from cache only. returning early after caching suggestion."):oa.ULS.sendTraceTag(509678998,306,15,`FormulaByExampleManager.formulaByExampleAnnotationHandler: failed to cache suggestion for flowId: ${re.flowId}.`)):
(oa.ULS.sendTraceTag(528758221,306,50,`FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation does not have any formula suggestions. deleting existing entry, if any. flowId: ${re.flowId}`),this.Fqa.Qgb(re),this.bH.I7(re.originCell,2),this.Do.Cv(re.flowId,15),null===(Hf=this.TSg)||void 0===Hf?void 0:Hf.sPj(re.flowId))):oa.ULS.sendTraceTag(509204251,306,10,"FormulaByExampleManager.formulaByExampleAnnotationHandler: range table suggestions should not be created in this session."))):oa.ULS.sendTraceTag(537161922,
306,15,"FormulaByExampleManager.formulaByExampleAnnotationHandler: annotation is null.")};this.qVc=()=>{oa.ULS.sendTraceTag(537161889,306,50,"FormulaByExampleManager.SendByExampleFeedback: opening send feedback dialog after click on card.");const Yc={};Yc[wa.a.zO]="FormulaByExampleCard";this.xh.ei(802602464,0,8,Yc)};this.oOc=Yc=>{this.M6b=!0;oa.ULS.sendTraceTag(537161888,306,50,`FormulaByExampleManager.OnShowFormula: user clicked ShowFormula button in the card for flow ${Yc}`)};this.jRb=Yc=>{oa.ULS.sendTraceTag(528758219,
306,50,"FormulaByExampleManager.HandleNewBlocksDuringPreview: new block arrived during preview mode.");const Ad=Yc.Ti.block,he=this.dP.gx,re=this.dP.range.pk(Ad.jj);this.LLa.jhe(re);const Me=(new pc.Range(he.top,he.left,he.bottom,he.right,!0,!0)).pk(Ad.jj),Ve=Array.from(this.xh.Mfa(Me,Ad));oa.ULS.sendTraceTag(537161886,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting skeleton for preview cells in new block ${Yc.Ti.hash}.`);this.dDc.includes(Yc.Ti.hash)||this.uxe(re,!0);const Hf=
()=>{this.Zqf(this.dP,Me,Ve).then(Qf=>{oa.ULS.sendTraceTag(537161885,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: putting calculated data into model and demanding re-render for block ${Yc.Ti.hash}.`);this.dDc.includes(Yc.Ti.hash)||this.uxe(re,!1);Qf.dsb.renderedPreviewIsDirty&&this.xh.mYb(Yc.Ti.block);oa.ULS.sendTraceTag(512508567,306,50,`FormulaByExampleManager.handleNewBlocksDuringPreview: new FormulaByExample suggestion block rendered during preview. results: ${JSON.stringify({["flowId"]:this.dP.flowId,
["originalFlowId"]:this.dP.JY.flowId,["formulaAnonymized"]:this.dP.anonymizedFormula,["originalFormulaAnonymized"]:this.dP.JY.anonymizedFormula,["annotationRange"]:this.dP.range.toString(),["previewCellsMetadata"]:Qf.dsb})}`);return!0}).catch(Qf=>{Object(Sf.h)(this.dP,`Exception when rendering new block during preview. ${Qf}`);oa.ULS.sendTraceTag(537161884,306,50,`FormulaByExampleManager.HandleNewBlocksDuringPreview: caught exception: ${Qf}.`)})};if(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8198794_FBEPreviewAwaitsDataFlushToCalc")){const Qf=
()=>{this.xh.Sfe(Qf);Hf()};this.xh.nkc(Qf)}else Hf()};this.QAg=()=>{this.xh.Hv(this.s8d);this.s8d=null};this.o3a=(Yc,Ad)=>{0!=Ad.By||Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8190374_FixDDARequestCloseFBE")&&576===Ad.Wl.operation.operationName||(this.c1a&&this.n1.oga(`UserOperation: ${xf.a.Hbh(Ad.Wl.operation.operationName)}`),this.xh.Hv(this.o3a))};this.YRj=Yc=>{oa.ULS.sendTraceTag(528023709,306,20,`FormulaByExampleManager.onImmediateUndo: undo operation queued following a formula by example suggestion application. flowId=${Yc.suggestion.flowId} originalFlowId=${Yc.suggestion.JY.flowId} isTableSuggestion=${Object(de.b)(Yc.suggestion)}`);
this.Fqa.zNg(Yc,"UNDO")};this.sQg=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:6169955_ShowFormulaByExampleSuggestionsUponArrivalFromServer");this.T9f=Ka.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FormulaByExampleMaximalWaitingTimeForSuggestionsMs",2E3);this.upd=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8582031_FormulaByExampleAsYouType");this.xh=Ra;this.qOb=new Map;this.bH=Tb;this.Do=Dg.a.getInstance(this.xh);this.pbe=!1;Ra.k0a()?this.init():oa.ULS.sendTraceTag(537161923,306,10,"FormulaByExampleManager.Ctor: not expected to be constructed when FG is off.")}KYj(Ra,
Tb){const Dc=Tb.POc;this.qOb.set(Ra,Tb);this.pbe=!1;const Yc=this.Fqa.CXi(Tb,Ra);if(Yc){this.Do.Cv(Ra,4);Yc.suggestion.flowId=Ra;Yc.suggestion.originCell=Dc;var Ad=this.qQg(Yc,Tb);Ad.value?(oa.ULS.sendTraceTag(529109774,306,50,"FormulaByExampleManager.onUserInput: A cached formula suggestion found for current input."),this.n_g(Yc,!0,`${Tb.uZ?xf.a.hId(Tb.uZ):"UnknownCommand"} - FromCache`,Tb)):(this.Do.Cv(Ra,6,{reason:Ad.reason}),this.u$k(Ra,Yc.suggestion,Dc))}else this.Do.Cv(Ra,5)}yxh(Ra){this.addHandler("fbeaa",
Ra)}u$k(Ra,Tb,Dc){Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7041480_FormulaByExampleFlowAggregatorFixed")&&this.xh.evalFormula(Tb.formula,Dc,xf.a.m0(this.xh.na),excelOnlineCalc.calc.evalFormulaFormatOrigin()).then(Yc=>{var Ad=this.xh.kh(Dc);const he=Ad.text;Ad=Ad.cell.Vn;Yc=Yc.value.value.toString();La.a.equals(he,Yc,!1)?this.Do.Cv(Ra,10):(Object(Sf.g)("textMismatch",he,Yc,Ad,"evalFormulaToVeriySuggestionWithoutShowingPreview",Tb,Tb.NVf(Dc)?"MODIFIEDEXAMPLE":"MODIFIEDRESTOFRANGE",null),this.Do.Cv(Ra,
9))}).catch(Yc=>{Yc=`Failed to evalFormula, error in calc API: ${Yc.toString()}`;oa.ULS.sendTraceTag(512341207,306,50,`FormulaByExampleMangaer.verifySuggestionOnEditedCell: ${Yc}`);this.Do.Cv(Ra,9,{reason:Yc})})}dispose(){this.xh.Hv(this.o3a);this.QAg();this.xh.F1k();super.dispose()}init(){const {FormulaByExampleAutoSuggestActor:Ra}=a(1422);this.xh.c9g(this.WLj,{annotationType:jh.a.getTypeName(),bB:!1,pY:this.Ixi});this.XK=Object(Sf.a)(this.xh);new Ra(this.xh,this.XK);this.Fqa=new de.a(this.xh,this.bH,
this.Do);this.LLa=new Eg(this.xh,this.XK);this.$yf=new Be(this.xh);Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7959804_FormulaByExampleSpies")&&new Ug(this,this.Fqa,this.Do);this.VF=this.xh.VF;oa.ULS.sendTraceTag(528758223,306,50,"FormulaByExampleManager.init: init complete.")}L3j(Ra){if(!this.qOb.has(Ra))return null;const Tb=this.qOb.get(Ra);this.qOb.delete(Ra);return Tb}tAk(Ra){const Tb=Ra.suggestion;this.LLa.Yqf(Tb,Tb.range,null).then(Dc=>{this.Ood(Ra,1===Dc.status?Dc.pNb:null,!1);return null}).catch(()=>
{oa.ULS.sendTraceTag(537161921,306,50,"FormulaByExampleManager.setFormulaOnRangeExplicit: client estimation failed for explicit by example flow.");this.Ood(Ra,null,!1)})}n_g(Ra,Tb,Dc,Yc){oa.ULS.sendTraceTag(527713160,306,20,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: starting flow to show a formula suggestion. isFromCache: ${Tb} isTableSuggestion: ${Object(de.b)(Ra.suggestion)} flowId: ${Ra.suggestion.flowId})}`);const Ad=Ra.suggestion;this.XK&&!this.c1a&&Object(Sf.f)("CALCULATIONSTART",
Ad.flowId,Tb);const he=this.eEf(Ad.gx);var re=Promise.resolve();Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8198743_FormulaByExampleTier1Langs")&&Ad.formula&&(re=this.xh.localizeEnglishFormula(Ad.formula,this.xh.WWc,Ad.originCell).then(Te=>{if(Object(Ub.c)(Te))return Ad.Mxi=Te.value,Promise.resolve();Te=`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to print formula. error: ${JSON.stringify(Te.reason.kind)}`;oa.ULS.sendTraceTag(508160210,306,10,Te);return Promise.reject(Te)}));
re=re.then(()=>this.Zqf(Ad,this.xh.getLoadedRange(),he,Tb));let Me=0,Ve=null,Hf=null,Qf=!1,ia=!1,Xb=void 0,Vc=!1,ud=null,xe=!1;const fe=re.then(Te=>{const Bf={FirstRow:Ad.range.top,FirstColumn:Ad.range.left,LastRow:Ad.range.bottom,LastColumn:Ad.range.right};let Cf=void 0;if(this.upd&&504848446===Yc.uZ){const Lf=Te.pNb.find(df=>D(df.value.cell).equals(Ad.originCell));Cf=hg(Lf).toString()}return this.xh.N7(Ad.range,this.jRb,Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8618122_NLNPreviewChange")?{PreviewCellsRange:Bf,
RetainCellTextOnPreview:!0}:void 0,Cf?{OY:Cf,qqe:Yc.qqe}:void 0).then(Lf=>{this.c1a=!0;this.n1=Lf;this.n1.kAh((Ga,hb)=>{this.bH.hide();Me++;1===Me?Ve=hb.reason:Hf=hb.reason});this.n1.jAh(()=>{const Ga=this.yqg(Ad,Ad.generatedFormula.explanationReplacements);this.LLa.jhe();({ASd:xe,Gje:ud}=this.NQg(Ad,Lf,df,"Success"===Ga.kind?{explanationKey:Ad.generatedFormula.explanationKey,explanationReplacements:Ga.explanationReplacements,X6d:hb=>{Vc=hb}}:void 0));xe||(this.n1.oga("CardUI failure"),this.Bie());
Qf=!0});if(this.n1.didPrime)this.LLa.jhe(),ia=!0;else if(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8560939_FormulaByExampleAsYouTypeVerifiesContentOnEndEdit")&&Cf){const Ga=(hb,jc)=>{oa.ULS.sendTraceTag(6370629,306,20,JSON.stringify({flowId:Ad.flowId,fjl:Cf===jc.cellText,gjl:jc.committed}));this.xh.v1(Ga)};this.xh.RW(Ga)}let df=null;df=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7858168_FBEHideFeedbackButton")?this.xh.isFeedbackEnabled?this.qVc:null:this.qVc;const T=this.yqg(Ad,Ad.generatedFormula.explanationReplacements);
"Failure"===T.kind&&"FG disabled"!==T.failureReason&&oa.ULS.sendTraceTag(507593605,306,10,`FormulaByExampleManager.tryDisplayFormulaSuggestionPreview: failed to parse explanation replacements. error: ${T.failureReason}, flowId: ${Ad.flowId}`);({ASd:xe,Gje:ud}=this.NQg(Ad,Lf,df,"Success"===T.kind?{explanationKey:Ad.generatedFormula.explanationKey,explanationReplacements:T.explanationReplacements,X6d:Ga=>{Vc=Ga}}:void 0));if(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8329602_AbortPreviewIfCardFailedToRender")&&
!xe)return this.n1.oga("CardUI failure"),this.Bie(),Promise.reject("Failed to show card UI");this.xh.px(this.o3a);this.bH.I7(Ad.originCell,0);this.XK&&xf.a.YGg(()=>{var Ga,hb;Object(Sf.f)("PREVIEWRENDERED",Ad.flowId,Tb);const jc={["flowId"]:Ad.flowId,["originalFlowId"]:Ad.JY.flowId,["displayTrigger"]:Dc,["formulaAnonymized"]:Ad.anonymizedFormula,["originalFormulaAnonymized"]:Ad.JY.anonymizedFormula,["annotationRange"]:Ad.range.toString(),["isFullyInViewport"]:this.xh.FF(Ad.range),["isCachedSuggestion"]:Tb,
["exampleCount"]:Ad.$D,["originalExampleCount"]:Ad.JY.$D,["seenCount"]:Ra.J4b,["previewCellsMetadata"]:Te.dsb,["previewShownDurations"]:Object(Sf.e)(Tb,Ad.flowId),["isSuggestionOnTable"]:Object(de.b)(Ad),["isNewRowPrediction"]:!Object(de.b)(Ad)&&Ad.VUb,["sheetId"]:Ad.sheetId,["areAllHeadersLoaded"]:Object(de.b)(Ad)?null===(Ga=Ad.table.U7)||void 0===Ga?void 0:Ga.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(hb=Ad.gx)||void 0===hb?void 0:hb.toString(),["dataCulture"]:this.xh.$.dataCultureTag,
["UICulture"]:this.xh.$.qca};this.xh.j0a()&&(Xb=this.ySh(Te.pNb,Ad.originCell));oa.ULS.sendTraceTag(84165903,306,50,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: Suggestion shown, awaiting user decision. flowData: ${JSON.stringify(jc)}`)},this.xh.xa);return Lf.XTc})});Promise.all([re,fe]).then(Te=>{var [Bf,Cf]=Te;this.pbe=!0;this.R1i(Bf,Cf,Ra,Tb,Dc,{["softIgnoreCount"]:Me,["softIgnoreReasons"]:[Ve,Hf],["didReshow"]:Qf,["didPrime"]:ia},{Tii:Xb},Vc,ud)}).catch(Te=>{Object(Sf.h)(Ad,`Failed to show formula preview due to a promise (model update or preview render) rejection. rejection reason: ${Te}`);
oa.ULS.sendTraceTag(537161920,306,15,`FormulaByExampleManager.TryDisplayFormulaSuggestionPreview: failed to show formula preview due to promise rejection. rejection reason: ${Te}`);this.bH.I7(Ad.originCell,5,Te);Ra.state=Fg.b.unseen})}NQg(Ra,Tb,Dc,Yc){if(Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExample.ShowRowNumberingCard",!1)&&this.aoj(Ra.anonymizedFormula)){const Ad={isAcceptAsValues:!1,maxTooltipOpenDurationMS:0,isFurtherExplanationHyperlinkClicked:!1,disableApplyAsValue:Ra.range.cz>
this.qCj};return{ASd:this.bH.lSg(Ra.formula,Ra.range.toString(),()=>{Tb.KTa("CardUI")},()=>{Ad.isAcceptAsValues=!0;Tb.KTa("CardUI")},Ad.disableApplyAsValue,()=>Tb.SWa("CardUI"),he=>{Ad.maxTooltipOpenDurationMS=Math.max(Ad.maxTooltipOpenDurationMS,he)},()=>{Ad.isFurtherExplanationHyperlinkClicked=!0},Dc,()=>this.oOc(Ra.flowId),Ra.originCell),Gje:Ad}}return{ASd:this.bH.show(Ra.formula,Ra.range.toString(),()=>{Tb.KTa("CardUI")},()=>Tb.SWa("CardUI"),Dc,()=>this.oOc(Ra.flowId),Ra.originCell,Yc),Gje:null}}aoj(Ra){return/^ROW\(\) [-+] \d+$/.test(Ra)||
"ROW()"===Ra}yqg(Ra,Tb){var Dc;if(!Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FormulaByExampleExplanations",!1))return{kind:"Failure",failureReason:"FG disabled"};if(!Tb||0===Tb.length)return{kind:"Failure",failureReason:"No explanation replacements"};const Yc=[];for(const re of Tb){if(!["ColumnName","LeftColumnName","RightColumnName","ColumnNames"].includes(re.replacementPlaceHolder)){Yc.push(re);continue}Tb=[];"ColumnNames"!==re.replacementPlaceHolder?Tb.push(re.replacementValue):
Tb=re.replacementValue.split(", ");let Me=0;for(const Ve of Tb){if(Object(de.b)(Ra)){var Ad=this.xh.extractReferences(`=${Ve}`,this.xh.na.name,this.xh.xze,!0,Ra.originCell);if(!Ad||!Ad.Items||1!==Ad.Items.length)return{kind:"Failure",failureReason:`Failed to extract singular ref from column replacement. refs non null: ${!!Ad}, refs count: ${null===(Dc=null===Ad||void 0===Ad?void 0:Ad.Items)||void 0===Dc?void 0:Dc.length}`};const Hf=Ad.Items[0];Ad=Ra.table.U7.HeadersList.find(Qf=>Qf.Index===Hf.Range.FirstColumn);
if(!Ad)return{kind:"Failure",failureReason:`Failed to find header for column replacement index in grid. ref: ${Hf.Range.FirstColumn}`};Tb[Me]=Ad.Name}else{Ad=Ve.replace(Ch.b,"");var he=Object(fb.C)(`${Ad}:${Ad}`);if(!he)return{kind:"Failure",failureReason:`Failed to parse column replacement ref. columnLetter: ${Ad}, columnName: ${Ve}`};he=Ra.headerRow.get(he.left);Tb[Me]=he?he:Ad}Me++}Yc.push({replacementPlaceHolder:re.replacementPlaceHolder,replacementValue:Tb.join(", ")})}return{kind:"Success",
explanationReplacements:Yc}}ySh(Ra,Tb){const Dc=this.xh.Mua("FormulaByExampleManager:checkIfPreviewResultsEqualOtherColumn",this.dP.gx);let Yc=null,Ad=!0,he=0;const re=[Tb.left];let Me;try{for(;Dc.$$mn();){const Ve=Dc.$$cu();Me&&Me!==Ve.range.top&&(Ad=!1,Yc=null);Me=Ve.range.top;if(Ad)he++;else if(re.length===he)return!1;if(!re.includes(Ve.range.left)){if(!Yc){const Hf=new pc.Range(Ve.range.top,Tb.left,Ve.range.bottom,Tb.left,!0,!0),Qf=Ra.find(ia=>D(ia.value.cell).equals(Hf));Yc=hg(Qf).toString()}Ve.Xn.value.toString()===
Yc||"0"===Yc&&""===Ve.Xn.value.toString()||re.push(Ve.range.left)}}}catch(Ve){throw Error(`Error while iterating over cells: ${Ve}`);}finally{Dc&&Dc.dispose()}return!0}Zqf(Ra,Tb,Dc,Yc){return this.LLa.uAk(Ra,Tb,void 0===Dc?null:Dc,this.c1a,Yc).then(Ad=>{oa.ULS.sendTraceTag(537161887,306,50,`FormulaByExampleManager.EvaluateFormulaAndUpdateModel: model update completed. result: ${Ad.status}.`);switch(Ad.status){case 3:case 1:return 3===Ad.status&&Object(Sf.h)(Ra,"Preview shown, but only partially. some cells failed to evaluate."),
Promise.resolve(Ad);case 2:return Promise.reject("Calc estimation or model update failed");default:return Promise.reject("Calc estimation failed")}})}R1i(Ra,Tb,Dc,Yc,Ad,he,re,Me,Ve){const Hf=this.M6b;this.Bie();const Qf=Dc.suggestion;this.XK&&Object(Sf.f)("USERINPUTARRIVED",Qf.flowId,Yc);const ia=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8215633_FixFBEFreezeFrameBigTable")?Qf.range.pk(this.xh.getLoadedRange()):Qf.range;this.uxe(ia,!1);this.bH.hide();xf.a.YGg(()=>{var Xb,Vc;this.XK&&Object(Sf.f)("PREVIEWREMOVEDWITHCSE",
Qf.flowId,Yc);const ud={["flowId"]:Qf.flowId,["originalFlowId"]:Qf.JY.flowId,["caller"]:Tb.Nnc,["displayTrigger"]:Ad,["formulaAnonymized"]:Qf.anonymizedFormula,["originalFormulaAnonymized"]:Qf.JY.anonymizedFormula,["suggestionOutcome"]:Tb.kpa,["annotationRange"]:Qf.range.toString(),["isFullyInViewport"]:this.xh.FF(Qf.range),["isCachedSuggestion"]:Yc,["showFormulaClicked"]:Hf,["exampleCount"]:Qf.$D,["originalExampleCount"]:Qf.JY.$D,["seenCount"]:Dc.J4b,["previewCellsMetadata"]:Ra.dsb,["previewShownDurations"]:this.XK?
Object(Sf.e)(Yc,Qf.flowId):"none",["previewRemovedDurations"]:this.XK?Object(Sf.d)(Yc,Qf.flowId):"none",["isSuggestionOnTable"]:Object(de.b)(Qf),["isNewRowPrediction"]:!Object(de.b)(Qf)&&Qf.VUb,["sheetId"]:Qf.sheetId,["areAllHeadersLoaded"]:Object(de.b)(Qf)?null===(Xb=Qf.table.U7)||void 0===Xb?void 0:Xb.IsFullTableHeaders:"nonTableSuggestion",["tableRange"]:null===(Vc=Qf.gx)||void 0===Vc?void 0:Vc.toString(),["dataCulture"]:this.xh.$.dataCultureTag,["UICulture"]:this.xh.$.qca,["previewEvents"]:he,
["Hypotheses"]:{["areHypothesesEnabled"]:this.xh.j0a(),["isNewColumnHeuristic"]:Qf.JTj,["previewEqualsOtherColumn"]:re.Tii},["formulaExplanation"]:{explanationSuccessful:Me,explanationKey:Qf.generatedFormula.explanationKey},["RowNumbering"]:Ve?{["isAcceptAsValues"]:Ve.isAcceptAsValues,["maxTooltipOpenDurationMS"]:Ve.maxTooltipOpenDurationMS,["isFurtherExplanationHyperlinkClicked"]:Ve.isFurtherExplanationHyperlinkClicked,["disableApplyAsValue"]:Ve.disableApplyAsValue}:null};oa.ULS.sendTraceTag(388780100,
306,Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7896248_XLFBELogLevelImportant")?20:50,`FormulaByExampleManager.handlePreviewResult: FormulaByExample flow results: ${JSON.stringify(ud)}`);Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&xf.a.sendOtelEvent(Tf);Object(Sf.b)(Qf.flowId)},this.xh.xa);oa.ULS.sendTraceTag(523842074,306,50,`FormulaByExampleManager.handlePreviewResult: User ${Tb.kpa} the formula via ${Tb.Nnc}`);this.Fqa.zNg(Dc,Tb.kpa,null===Ve||void 0===Ve?void 0:
Ve.isAcceptAsValues);"ACCEPT"===Tb.kpa&&(this.Ood(Dc,Ra.pNb,null===Ve||void 0===Ve?void 0:Ve.isAcceptAsValues),Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&xf.a.sendOtelEvent(Xf));"DECLINE"===Tb.kpa&&(this.D4g++,3===this.D4g&&dh.Health.instance.recordQosError($f.a.Jxi,[Ng.a.Lxi],!0,!0,!1,!1,{jna:!0}));this.$yf.Esh(Tb.kpa);this.xh.Hv(this.o3a)}Bie(){this.c1a=!1;this.n1=null;this.M6b=!1}Ood(Ra,Tb,Dc){const Yc=Ra.suggestion;Dc?(Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8656119_FormulaByExample_RowNumbering_ApplyFormulaCSE")&&
this.LLa.M4e(Tb,null,Yc.flowId),this.xh.J4(null,Yc.range,Yc.originCell,Yc.formula,!0).then(Ad=>{Ad=Ad.results.map(he=>[this.uZh(he)]);this.xh.Vah({FirstRow:Yc.range.top-1,FirstColumn:Yc.range.left-1,LastRow:Yc.range.bottom-1,LastColumn:Yc.range.right-1,SheetName:this.xh.WWc.name,NamedObjectName:"Table"===Yc.kind?Yc.table.name:null},Ad);oa.ULS.sendTraceTag(507604995,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied values on table, range: ${Yc.range}`)}).catch(Ad=>{oa.ULS.sendTraceTag(507585377,
306,10,`FormulaByExampleManager.applySuggestionOnRange: failed to apply values on table, range: ${Yc.range} error: ${Ad}`);this.xh.lp()})):(Dc=Object(Nd.a)(new ec.a,{Text:Yc.formula}),this.xh.setCell(Dc,Yc.originCell,1,127,null,0,{range:Yc.range,origin:Yc.originCell},2),this.LLa.M4e(Tb,Yc.formula,Yc.flowId),oa.ULS.sendTraceTag(537161883,306,50,`FormulaByExampleManager.applyFormulaSuggestionOnRange: applied formula on table, range: ${Yc.range}`));this.s8d=(Ad,he)=>{0===he.By&&(170==he.Wl.operation.operationName?
this.YRj(Ra):Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7705932_FBESendsOtelEvents")&&xf.a.sendOtelEvent(zg),this.QAg())};this.xh.px(this.s8d)}uZh(Ra){if(!xf.a.bFc(Ra))throw Error("FormulaByExampleManager.convertEvalOnCloneResultToString: EvalOnCloneResult is not successful.");return hg(Ra).toString()}qQg(Ra,Tb){const Dc=Ra.suggestion;Tb=this.Nfj(Dc.flowId,Tb.uZ);return Tb.value?Ra.state===Fg.b.decline?(this.bH.I7(Ra.suggestion.originCell,6,Ma.a.lbh),oa.ULS.sendTraceTag(528758217,306,50,`FormulaByExampleManager.shouldShowPreview: user declined this suggestion before, not showing again. flowId: ${Dc.flowId}`),
{value:!1,reason:"User declined this suggestion before."}):Dc.$D<Qa.a?(this.bH.I7(Ra.suggestion.originCell,6,Ma.a.Y$g),oa.ULS.sendTraceTag(528758215,306,50,`FormulaByExampleManager.shouldShowPreview: cached suggestion does not have enough examples. not showing preview. flowId: ${Dc.flowId}`),{value:!1,reason:"Cached suggestion does not have enough examples."}):Ra.state===Fg.b.ignore&&2<=Ra.J4b?(this.bH.I7(Ra.suggestion.originCell,6,Ma.a.kbh),oa.ULS.sendTraceTag(528758216,306,50,`FormulaByExampleManager.shouldShowPreview: user saw suggestion at least twice and ignored last time. not showing again. flowId: ${Dc.flowId}`),
{value:!1,reason:"User saw suggestion at least twice and ignored last time"}):Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7654591_FormulaByExampleForbiddenFormulas")&&this.Fqa.djj(Dc)?(oa.ULS.sendTraceTag(509195993,306,20,`FormulaByExampleManager.shouldShowPreview: suggestion is forbidden. not showing preview. flowId: ${Dc.flowId}, anonymizedFormula: ${Dc.anonymizedFormula}`),{value:!1,reason:"Suggestion is forbidden as it wasn't wanted before."}):Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7300192_FBETextCellsUnsupported")&&
this.eEf(Dc.range).some(Yc=>this.xh.vXd(Yc.cell.Vn))?{value:!1,reason:"At least 1 cell in the loaded suggestion range is formatted as Text"}:Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7464540_FBENoneValueTypesUnsupported")&&0===Dc.L9h?{value:!1,reason:"suggestion's default value type cannot be none."}:Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:7669810_ValidateRangeIsInsideTableUponShowingSuggestion")&&Object(de.b)(Dc)&&!Dc.table?{value:!1,reason:"table suggestion's table object is null."}:{value:!0}:
(this.bH.I7(Ra.suggestion.originCell,6,Ma.a.U8g),{value:!1,reason:Tb.reason})}uxe(Ra,Tb){if(Ra)for(let Yc=Ra.top;Yc<=Ra.bottom;Yc++)for(let Ad=Ra.left;Ad<=Ra.right;Ad++){var Dc=pc.Range.gi(Yc,Ad);if(Dc=this.xh.kh(Dc))Dc.cell.Dqe=Tb&&!Dc.cell.OY}}Nfj(Ra,Tb){if(this.pbe)return oa.ULS.sendTraceTag(528758218,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview again as preview already was shown for the current edit. flowId: ${Ra}`),{value:!1,reason:"Preview already shown for the latest edit."};
if(this.c1a)return oa.ULS.sendTraceTag(527005664,306,50,`FormulaByExampleManager.shouldShowPreview: can't show preview for this suggestion as preview is already showing. flowId: ${Ra}`),{value:!1,reason:"Preview is already showing."};if(this.upd){if(504848446===Tb&&!this.xh.isEditing())return oa.ULS.sendTraceTag(507855E3,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. can't show preview for this suggestion as user is not editing. flowId: ${Ra}`),{value:!1,reason:"User is not editing."};
if(324156914===Tb)return oa.ULS.sendTraceTag(507836041,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX enabled. preview shown only when editing, or by priming. flowId: ${Ra}`),{value:!1,reason:"After edit preview only handled by preview priming."}}else if(this.xh.isEditing())return oa.ULS.sendTraceTag(524813027,306,50,`FormulaByExampleManager.shouldShowPreview: AsYouType UX disabled. can't show preview for this suggestion as user is editing. flowId: ${Ra}`),{value:!1,reason:"User is editing."};
return{value:!0}}eEf(Ra){const Tb=[];this.dDc=[];const Dc=this.xh.I$(Ra,this.xh.activeItemName);for(const Yc of Dc)Tb.push(...this.xh.Mfa(Ra.pk(Yc.jj),Yc)),this.dDc.push(Yc.Ci);return Tb}}Object(Da.a)(mh,"FormulaByExampleManager",of.a,[752,2]);class Tg extends Pa.a{constructor(Ra){super();this.$=Ra;this.Bl()}create(){oa.ULS.sendTraceTag(528758214,0,50,"FormulaByExampleManagerFactory.Create: starting service creation flow.");const Ra=Object(Nf.d)(Hb.a.resolve(na.Jc,{va:this.hh})),Tb=Object(Nf.d)(Hb.a.resolve(na.Ic,
{va:this.hh}));Qd.TaskExtensions.Ua(Qd.TaskExtensions.Ln([Tb,Ra],this.xa),()=>{oa.ULS.sendTraceTag(528758213,0,50,"FormulaByExampleManagerFactory.Create: augmentationLoopManager and calcManager creation tasks resolved.");cg.init(this.$);const Dc=new mh(Tb.result,cg.instance(),Ra.result);this.Yj(this.$.ka.Ug(453)||this.$.ka.ph(453,Dc));oa.ULS.sendTraceTag(537161882,0,50,"FormulaByExampleManagerFactory.Create: FormulaByExampleManager initialized successfully")},this.xa)}static Aa(Ra){Ra.ka.ph(454,new Tg(Ra))}}
Object(Da.a)(Tg,"FormulaByExampleManagerFactory",Pa.a,[]);var Vg=a(230);class nh{constructor(Ra,Tb,Dc){this.$=Ra;this.Pyf=Tb;this.ariaLiveNotifier=Dc;this.UTb=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8501487_ValuePreviewDetectVolatile");this.N9i();this.editBox=Object(ab.f)(this.$).sh}get BC(){return Xc.getInstance(this.$)}get zoomManager(){this.QEa||(this.QEa=Object(kb.a)());return this.QEa}dispose(){this.hide()}show(Ra,Tb,Dc,Yc){Yc=Object.assign({},Tb,{L_:Ra,sze:Dc,source:Yc});if(!this.Jvb(Yc))return!1;
this.QAa(Yc)&&this.hide();this.ZJ=Yc;this.BC.setResult(Tb,Ra);this.HP();Dc&&this.d6i();return!0}hide(Ra){if(!this.ZJ||Object(bd.b)(Ra)&&Ra!==this.ZJ.L_)return!1;Ra=this.ZJ.sze;this.Ybi();Ra&&this.dhk();this.ZJ=void 0;return!0}Jvb(Ra){return!this.ZJ||!N(this.ZJ,Ra,this.UTb)}QAa(Ra){return this.ZJ&&!M(this.ZJ,Ra)}d6i(){const Ra=this.ZJ.length;0!==Ra&&this.ZJ.L_.$b.formatText(this.ZJ.index,Ra,{background:"rgba(202,234,216,0.6)"})}dhk(){const Ra=this.ZJ.L_;Ra.$b.formatText(0,Ra.text.length,{background:!1});
Ra.f2(null)}HP(){let Ra;switch(this.ZJ.kind){case "Success":Ra={isLoaded:!0,value:this.ZJ.value,textColor:this.ZJ.color};break;case "Loading":Ra={isLoaded:!1,value:null,textColor:null};break;default:return}this.j7k();this.Pyf.renderValuePreview(this.uA,this.T8b,Ra);this.u2j(Ra)}Ybi(){this.Pyf.dismiss(this.uA)}N9i(){this.uA=document.createElement("div");this.T8b=document.createElement("div");this.T8b.style.position="absolute";this.T8b.style.visibility="hidden";this.$.domElement.appendChild(this.T8b)}j7k(){var Ra=
this.ZJ.L_;const Tb=this.ZJ.index,Dc=this.ZJ.length;var Yc=this.ZJ.source;let Ad;switch(Yc.trigger){case "hover":Ad=Ra.$b.getBounds(Yc.index,1);break;case "shortcut":Ad=Ra.$b.getBounds(Yc.index);break;case "selection":Yc=Ra.text.substring(Tb,Tb+Dc).indexOf("\n"),-1!==Yc?Ad=Ra.$b.getBounds(Tb,Yc):(Yc=Ra.$b.getBounds(Tb),Ra=Ra.$b.getBounds(Tb,Dc),Ad={left:Yc.left,top:Yc.top,width:Ra.right-Yc.left,height:Ra.height})}this.i7k(Ad)}i7k(Ra){const Tb=new Vg.a(this.T8b.style);Tb.LH.left=this.hYc(Ra.left);
Tb.LH.top=this.hYc(Ra.top);Tb.LH.width=this.hYc(Ra.width);Tb.LH.height=this.hYc(Ra.height);Tb.Zda()}hYc(Ra){var Tb=this.ZJ.L_;Tb=Object(bd.b)(this.zoomManager)&&Tb===this.editBox;return Za.HelperMethods.ti(Tb?this.zoomManager.Pn(Ra):Ra)}u2j(Ra){var {isLoaded:Tb,value:Dc}=Ra;Tb?this.ariaLiveNotifier.readText(String.format(Jb.a.instance.$g(179),Dc)):this.ariaLiveNotifier.readText(Jb.a.instance.ia(866))}}Object(Da.a)(nh,"FormulaAssistanceValuePreviewControl",null,[2]);class wh{constructor(Ra){this.cache=
Ra}clearCache(){this.cache=void 0}}Object(Da.a)(wh,"Cacheable",null,[]);class oh extends wh{constructor(Ra,Tb){super();this.$=Ra;this.callbacks=Tb;this.Bgg=(Dc,Yc)=>{const Ad=this.da.fp;if(!(0<(Ad.isEditing?Ad.$b.selection:{index:0,length:0}).length))switch(Yc.state){case 0:this.onHoverEnter(Dc,Yc.event);break;case 1:this.onHoverLeave(Dc);break;case 2:this.PRj(Dc);break;default:return oa.ULS.shipAssertTag(521446489,0,!1,"FormulaAssistanceValuePreviewHandler.onHoverChange unxpected HoverState"),Yc}};
this.zgg=(Dc,Yc)=>{const Ad=Yc.selection;Yc={source:"selection",text:Yc.text,index:Ad.index,length:Ad.length};if(0<Ad.length)this.onSelectionChange(Dc,Yc);else this.J8d(Dc,Yc)};this.da=Object(ab.f)(this.$);this.editBox=this.da.cellTextEditBox;this.fq(this.editBox);this.formulaBar=Object(Ib.a)(this.$);Object(bd.b)(this.formulaBar)?this.fq(this.formulaBar):Object(Ib.b)(this.$,Dc=>{this.formulaBar=Dc;this.fq(this.formulaBar);oa.ULS.sendTraceTag(509870663,1,50,"FormulaAssistanceValuePreviewHandler: formulaBar async")})}get BC(){return Xc.getInstance(this.$)}dispose(){this.$o(this.editBox);
this.$o(this.formulaBar)}trigger(){const Ra=this.da.fp,Tb=Ra.$b.selection;this.onSelectionChange(Ra,{source:"shortcut",text:Ra.text,index:Tb.index,length:Tb.length})}fq(Ra){Ra.Imd(this.Bgg);Ra.umd(this.zgg)}$o(Ra){null===Ra||void 0===Ra?void 0:Ra.hge(this.Bgg);null===Ra||void 0===Ra?void 0:Ra.DSc(this.zgg)}onHoverEnter(Ra,Tb){var Dc=new Sys.UI.Point(Tb.clientX,Tb.clientY);{Tb=Ra.$b.Ll;var Yc=void 0,{x:Ad,y:he}=Dc;Yc=void 0===Yc?document:Yc;Dc=-1;let re=null;void 0!==Yc.caretPositionFromPoint?(Yc=
Yc.caretPositionFromPoint(Ad,he),null!==Yc&&(Dc=Yc.offset,re=Yc.offsetNode)):void 0!==Yc.caretRangeFromPoint&&(Yc=Yc.caretRangeFromPoint(Ad,he),null!==Yc&&(Dc=Yc.startOffset,re=Yc.startContainer));null===re||-1===Dc?(oa.ULS.sendTraceTag(521446491,0,15,"getEditorCaretPositionFromPoint - failed to get relevant range"),Tb=-1):Tb.contains(re)?Tb=Q(Tb,re,Dc):(oa.ULS.sendTraceTag(521446490,0,15,"getEditorCaretPositionFromPoint - relavant node not inside root"),Tb=-1)}if(-1!==Tb)this.onSelectionChange(Ra,
{source:"hover",text:Ra.text,index:Tb,length:0})}onHoverLeave(Ra){this.J8d(Ra)}PRj(Ra){this.J8d(Ra)}onSelectionChange(Ra,Tb){this.PHk(Tb)&&!Ra.zga&&(this.cache=Tb,this.callbacks.G8d(Ra,{index:Tb.index,length:Tb.length,trigger:Tb.source}),this.BC.trigger=Tb.source)}J8d(Ra,Tb){this.LHk(Tb)&&(this.clearCache(),this.callbacks.aba(Ra))}PHk(Ra){return!this.cache||!R(this.cache,Ra)}LHk(Ra){return this.cache&&Ra?"shortcut"!==this.cache.source||!R(this.cache,Ra):!0}}Object(Da.a)(oh,"FormulaAssistanceValuePreviewHandler",
wh,[2]);class gh{constructor(Ra){this.$=Ra;this.c7b=0;this.L7a=!1;this.mya=null;this.yl=()=>{this.da.cellTextEditBox.v1(this.yl);this.oca()};this.da=Object(ab.f)(Ra)}onShow(){this.L7a||(this.mya=performance.now())}onHide(){this.L7a||null===this.mya||(400<performance.now()-this.mya&&(this.c7b++,this.mya=null),2===this.c7b&&this.nve())}nve(){this.da.isEditing?this.da.cellTextEditBox.RW(this.yl):this.oca()}oca(){this.$.ei(1684822464,-1,0,null);this.L7a=!0}}Object(Da.a)(gh,"ValuePreviewSurveyHandler",
null,[]);class lh{constructor(Ra,Tb,Dc,Yc){this.$=Ra;this.requester=Tb;this.mMk=200;this.jEg=3E3;this.wga=Ka.EwaSettings.isChangeGateEnabled("OfficeVSO:8550405_ValuePreviewDismissOnScroll");this.G8d=(Ad,he)=>{const re=this;return No(function*(){const Me={text:Ad.text,index:he.index,length:he.length};void re.Kug(Me,re.mok(Me),Ad,0===Me.length,he.trigger)})};this.aba=()=>{this.hide()};this.reset=()=>{this.handler.clearCache();this.requester.clearCache();this.hide()};this.wH=()=>{this.handler.clearCache();
this.requester.clearCache()};this.zy=()=>{this.hide(this.da.sh)};this.KMc=Ad=>{this.hide(Ad)};this.da=Object(ab.f)(this.$);this.control=new nh(this.$,Dc,Yc);this.handler=new oh(this.$,{G8d:this.G8d,aba:this.aba});this.gca=new gh(this.$);this.fq()}get BC(){return Xc.getInstance(this.$)}trigger(){this.handler.trigger()}dispose(){this.$o();this.handler.dispose();this.control.dispose()}fq(){this.da.sh.RW(this.reset);this.da.ha.add_activeCellChanged(this.reset);this.$.ea.EL(this.wH);this.wga&&(this.da.view.Wy(this.zy),
this.da.cellTextEditBox.E0e(this.KMc),Object(Ib.b)(this.$,Ra=>{Ra.E0e(this.KMc)}))}$o(){var Ra;this.da.sh.v1(this.reset);this.da.ha.remove_activeCellChanged(this.reset);this.$.ea.TM(this.wH);this.wga&&(this.da.view.Kx(this.zy),this.da.cellTextEditBox.MBg(this.KMc),null===(Ra=Object(Ib.a)(this.$))||void 0===Ra?void 0:Ra.MBg(this.KMc))}Kug(Ra,Tb,Dc,Yc,Ad){const he=this;return No(function*(){const re=Object.assign({},Ra,{L_:Dc,hXc:Yc,trigger:Ad});he.Yv=re;const Me=yield Tb;Object(bd.c)(Me)||he.Enj(re)&&
void he.hOd(Me)})}hOd(Ra){const Tb=this;return No(function*(){const Dc=Tb.Yv.text,Yc=Tb.Yv.L_,Ad=Tb.Yv.hXc,he=Tb.Yv.trigger;switch(Ra.kind){case "Failure":Tb.BC.setResult(Ra,Yc);Tb.hide();break;case "Success":Tb.show(Ra);break;case "Loading":Tb.show(Ra);void Tb.Kug({text:Dc,index:Ra.index,length:Ra.length},Ra.promise,Yc,Ad,he);break;default:return Ra}})}mok(Ra){const Tb=this.requester.eie(Ra,this.jEg,!0);let Dc;const Yc=new Promise(Ad=>{Dc=window.setTimeout(()=>{Ad(Object.assign({},Ra,{kind:"Loading",
promise:Tb}))},this.mMk)});return Promise.race([Tb,Yc]).finally(()=>{window.clearTimeout(Dc)})}show(Ra){const Tb=this.Yv.index,Dc=this.Yv.L_,Yc=this.Yv.hXc,Ad=this.Yv.trigger;this.Yv=void 0;if(this.Onj(Ra)&&(Ra=this.control.show(Dc,Ra,Yc,{trigger:Ad,index:Tb}),!this.wga||Ra))this.gca.onShow()}hide(Ra){Ra=this.control.hide(Ra);this.Yv=void 0;if(!this.wga||Ra)this.gca.onHide()}Enj(Ra){var Tb;if(Tb=this.Yv)Tb=this.Yv,Tb=Tb.text===Ra.text&&Tb.index===Ra.index&&Tb.length===Ra.length&&Tb.L_===Ra.L_&&Tb.hXc===
Ra.hXc;return Tb}Onj(Ra){switch(Ra.kind){case "Success":return Object(bd.b)(Ra.value)&&""!==Ra.value;case "Loading":return!0;default:return Ra}}}Object(Da.a)(lh,"FormulaAssistanceValuePreview",null,[770,2]);var Sh=a(259);class ih extends Pa.a{constructor(Ra){super();this.$=Ra;this.Bl()}static Aa(Ra){Ra.ka.ph(497,new ih(Ra))}create(){let Ra=this.$.ka.Ug(496);Ra&&this.Yj(Ra);const Tb=Zf.GetServiceTaskFactory.Bj(this.$.ka,448,449,this.hh);var Dc=na.zc.Ha();const Yc=Dc?Sh.a.Va(void 0):Object(Nf.d)(Hb.a.resolve(na.Rc,
{va:this.hh}));Dc=Dc?Object(Nf.d)(Hb.a.resolve(na.zc,{va:this.hh})):Sh.a.Va(void 0);const Ad=Ka.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FixMigrate2AriaLiveNotifier",!1)?Object(Nf.d)(Hb.a.resolve(na.l,{va:this.hh})):Zf.GetServiceTaskFactory.Bj(this.$.ka,211,212,this.hh),he=Object(Nf.d)(Hb.a.resolve(na.Cc));Qd.TaskExtensions.Ua(Qd.TaskExtensions.Ln([Tb,Yc,Ad,he,Dc],this.xa),()=>{Ra=this.$.ka.Ug(496);Ra||(Ra=new lh(this.$,he.result,Tb.result,Ad.result),this.$.ka.ph(496,Ra));this.Yj(Ra)},
this.xa,3)}}Object(Da.a)(ih,"FormulaAssistanceValuePreviewFactory",Pa.a,[]);class di extends wf.a{constructor(Ra){super(Ra)}Qs(){const Ra=Zf.GetServiceTaskFactory.Bj(this.$.ka,496,497,this.hh);Qd.TaskExtensions.Ua(Ra,()=>{this.cr([new yf(Ra.result)])},this.xa)}static Aa(Ra){wf.a.sx(515,new di(Ra))}}Object(Da.a)(di,"FormulaAssistanceValuePreviewCommandHandlerFactory",wf.a,[]);String(Ba);String(Fa);window.___1708742454388_closurehack=Ba;window.___1708742454388_closurehack=Fa;Cd.a.Qg(Gc.Aa);(()=>{Cd.a.Qg(Ra=>
{ye.Aa(Ra)})})();(()=>{Cd.a.Qg(Ra=>{tb.Aa(Ra)})})();(()=>{Cd.a.Qg(Ra=>{Le.Aa(Ra)})})();(()=>{Cd.a.Qg(Ra=>{Tg.Aa(Ra);Bg.Aa(Ra)})})();(()=>{Cd.a.Qg(Ra=>{ih.Aa(Ra);na.Bc.Ha()||di.Aa(Ra)})})();String(O);String(U);String(K);String(F);String(I);String(P);String(Y);String(ea);String(Fa);String(za);String(xa);String(fa);String(V);String(ba);String(la);String(Ta);String(Ea);String(sa);String(Ya);String(bb);String(lg);window.___1708742503437_closurehack=O;window.___1708742503437_closurehack=U;window.___1708742503437_closurehack=
K;window.___1708742503437_closurehack=F;window.___1708742503437_closurehack=I;window.___1708742503437_closurehack=P;window.___1708742503437_closurehack=Y;window.___1708742503438_closurehack=ea;window.___1708742503438_closurehack=Fa;window.___1708742503438_closurehack=za;window.___1708742503438_closurehack=xa;window.___1708742503438_closurehack=fa;window.___1708742503438_closurehack=V;window.___1708742503438_closurehack=ba;window.___1708742503438_closurehack=la;window.___1708742503438_closurehack=
Ta;window.___1708742503438_closurehack=Ea;window.___1708742503438_closurehack=sa;window.___1708742503438_closurehack=Ya;window.___1708742503438_closurehack=bb;window.___1708742503438_closurehack=lg},940:function(y,x,a){a.d(x,"a",function(){return D});y=a(0);var c=a(189),b=a(24),f=a(25),r=a(77),d=a(45),k=a(152),t=a(479),m=a(127),e=a(925),w=a(1229);a(118);var l=a(70),u=a(213),n=a(62),v=a(212),B=a(35),z=a(47),C=a(14);class D{constructor(J,W,N,M,Q,R,O,U,K){this.$=J;this.Ej=W;this.Bo=N;this.MH=M;this.ek=
Q;this.Yij=O;this.indexedDB=U;this.da=b.f(J);this.VF=null===K||void 0===K?void 0:K.rKf("Legacy")}lp(){const J=B.a.Yi(1,0,0,0,0,0,"FormulaByExampleApplyAsValueFailed");z.a(this.da.$).lp(J)}Vah(J,W){const N=new v.a(163,0,(M,Q,R)=>{const O=this.$.pa.ta,U=O.Za(0);U.rangeToSet=J;U.rangeValues=W;return n.h(O,"SetRange",U,(K,F,I)=>{C.ULS.sendTraceTag(507585379,306,20,"FormulaByExampleServiceProxy.SetRange: the operation has succeeded");M(K,F,I)},(K,F,I)=>{C.ULS.sendTraceTag(507585378,306,10,"FormulaByExampleServiceProxy.SetRange: the operation has failed");
Q(K,F,I)},R,this.$.pa.ta.Jh(),0)},65);this.$.userOperationManager.enqueueOperation(N,null)}RW(...J){return this.da.sh.RW(...J)}v1(...J){return this.da.sh.v1(...J)}FQ(...J){return this.da.sh.FQ(...J)}nS(...J){return this.da.sh.nS(...J)}sl(...J){return this.da.Yg.sl(...J)}UVi(J){return u.a(this.$,J,!1)}N7(...J){return this.da.QM.N7(...J)}mYb(...J){return this.da.QM.mYb(...J)}getLoadedRange(){return this.da.Hp}isEditing(){return this.da.isEditing}I$(...J){return this.da.za.I$(...J)}getActiveCell(){return this.da.ha.qa.activeCell}Jaa(){return this.da.za.Jaa}Ix(...J){return this.da.za.Ix(...J)}Uy(...J){return this.da.za.Uy(...J)}Vy(...J){return this.da.za.Vy(...J)}Fy(...J){return this.da.za.Fy(...J)}Ncb(...J){return this.da.za.Ncb(...J)}Y2b(...J){return this.da.za.Y2b(...J)}Gkc(...J){return this.da.Gkc(...J)}Hkc(...J){this.Xrk(W=>
{W.Hkc(...J)})}kh(...J){return this.da.kh(...J)}Mfa(...J){return this.da.Mfa(...J)}FF(...J){return this.da.FF(...J)}setCell(...J){return this.da.setCell(...J)}Mua(...J){return this.da.ot(...J)}get mj(){return this.da.mj}rMa(...J){return this.da.za.rMa(...J)}evalFormula(...J){return this.Ej.evalFormula(...J)}J4(...J){return this.Ej.J4(...J)}uFc(...J){return this.Ej.uFc(...J)}vXd(...J){return this.Ej.vXd(...J)}lZa(...J){return this.Ej.lZa(...J)}oFh(...J){return this.Ej.C2e(...J)}extractReferences(...J){return this.Ej.extractReferences(...J)}Hma(...J){return this.Ej.Hma(...J)}tmd(...J){return this.Ej.tmd(...J)}nkc(...J){return this.Ej.nkc(...J)}Sfe(...J){return this.Ej.Sfe(...J)}localizeEnglishFormula(...J){return this.Ej.localizeEnglishFormula(...J)}ei(...J){return this.$.ei(...J)}dh(...J){return this.$.Ma.dh(...J)}Lp(...J){return this.$.Lp(...J)}sendBeaconTraceTag(...J){return this.$.sendBeaconTraceTag(...J)}Hv(...J){return this.$.userOperationManager.Hv(...J)}px(...J){return this.$.userOperationManager.px(...J)}get isFeedbackEnabled(){return this.$.isFeedbackEnabled}get xa(){return this.$.xa}get na(){return this.$.na}get activeItemName(){return this.da.$.activeItemName}get WWc(){var J;
return null===(J=this.$.sa)||void 0===J?void 0:J.na}get pD(){return this.$.ea.pD}get displayRtl(){return this.$.na.displayRtl}get xze(){return this.$.workbookContext.WorkbookFileName}IYi(){return l.a(this.$)}static bFc(J){return Object(w.a)(J)}static sendOtelEvent(...J){return Object(e.b)(...J)}static Hbh(...J){return m.a(...J)}static YGg(...J){Object(k.c)(...J)}static hId(...J){return Object(t.a)(...J)}static $bl(){return Object(k.f)()}static qyi(...J){return Object(d.G)(...J)}static m0(...J){return Object(r.d)(...J)}l0a(){return this.Yij}tKa(){return f.a.tKa(this.$)}k0a(){return f.a.k0a(this.$)}j0a(){return f.a.j0a()}static Yfa(...J){return Object(c.a)(...J)}p9i(){this.P7a=
this.MH.Zfa()}hUk(...J){var W;return null===(W=this.P7a)||void 0===W?void 0:W.iJa(...J)}eGd(...J){return this.ek.eGd(...J)}v$(...J){return this.ek.v$(...J)}Wgj(){var J=[];return!!this.indexedDB&&this.indexedDB.jl(...J)}u$i(...J){this.indexedDB.initialize(...J)}xKi(...J){return this.indexedDB.MYa(...J)}btk(...J){this.indexedDB.W5a(...J)}deleteDatabase(...J){return this.indexedDB.deleteDatabase(...J)}c9g(J,W){this.Bo.register(this.Bo.e5().B7("FormulaByExample").A7(J).activateAnnotation(W).build())}bhj(){return!!this.Bo}F1k(){this.Bo.unregister(...["FormulaByExample"])}HSk(...J){this.Bo.twb(...J)}h7(J,
W){this.VF&&(this.VF.OPa(J,2,{errorMessage:W}),this.VF.WMb(J))}Xrk(J){this.$.ka.Lh(254,J)}}Object(y.a)(D,"FormulaByExampleServiceProxy",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.edt.js.map/b1dc6904707fe5c145e6b79abf7ba56f/EwaTS.edt.js.map