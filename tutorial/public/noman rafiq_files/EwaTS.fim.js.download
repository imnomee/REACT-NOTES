'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[20],{486:function(y,x,a){a.r(x);var c={};a.r(c);a.d(c,"FileOperationsCommandHandler",function(){return sb});var b={};a.r(b);var f={};a.r(f);a.d(f,"SaveToHostCommandHandler",function(){return dc});var r={};a.r(r);a.d(r,"SaveToHostManager",function(){return Uc});var d={};a.r(d);a.d(d,"SharedFilePickerFactory",function(){return vb});var k={};a.r(k);a.d(k,"UploadFromDesktopCommandHandler",function(){return Sc});var t=
a(179),m=a(0),e=a(14),w=a(1048),l=a(6),u=a(159),n=a(934),v=a(107),B=a(236),z=a(17),C=a(100),D=a(154),J=a(325),W=a(34);class N{static get Gpg(){return N.$v}static get Hpg(){return N.Yai}}N.Yai="<div class='\"\"' id='OpenInAppDialog'> <div class='PrivacyDialogTitle UIFontDialogTitle' id='OpenInAppTitle'> <label id='OpenInAppTitle' class='\"\"' style='font-size:20px; font-weight:600; color:#107C41' >{0}</label> </div> <div class='WACDialogRow' id='InfoMessageArea'> <label id='InfoMessageAreaLine1' class='\"\"' style='font-size:14px; font-weight:400 ; color:#252423' >{1}</label> <br/> </div> <br/> <div class='AppInstallButton' id='LinkToInstall' role='button' tabIndex='0' style='padding: 3px 8px; background: #107C41; width: 160px; height: 32px; text-align: left'> <div class='\"\"' id='AppstoreLink' style='display:inline-block; padding-top:4px; vertical-align:top;'> <label id='AppstoreLinkTitle' class='PrivacyDialogTitle' unselectable='on' style='font-size: 15px; margin-left:8px; color: #ffffff; font-weight: 600; position: relative; top: 4px;' >{2}</label> </div> </div> <div class='WACDialogRow' id='GetAppLink'> <label id='GetAppLinkText' class='\"\"' style='font-size:14px; font-weight:400 ; color:#252423' >{3}</label> <label id='GetAppLinkButton' class='\"\"' style='font-size:14px; font-weight:400 ; color:#107C41' >{4}</label> </div>";
N.$v="<div class='\"\"' id='OpenInAppDialog'> <div class='PrivacyDialogTitle UIFontDialogTitle' id='OpenInAppTitle'> <label id='OpenInAppTitle' class='\"\"' style='font-size:16pt' >{0}</label> </div> <div class='WACDialogRow' id='InfoMessageArea'> <label id='InfoMessageAreaLine1' class='\"\"' style='font-size:12pt' >{1}</label> <br/> </div> <br/> <div class='AppInstallButton' id='LinkToInstall' role='button' tabIndex='0'> <div class='clip32x32' id='BottomInfoIconClip' unselectable='on' style='display: inline-block; pointer-events:none;' role='img'> <img id='BottomIconInfo' class='{3}' role='presentation' src={2} /> </div> <div class='\"\"' id='AppstoreLink' style='display:inline-block; padding-top:4px; vertical-align:top;'> <label id='AppstoreLinkTitle' class='PrivacyDialogTitle' unselectable='on' style='font-size: 14pt; margin-left:8px' >{4}</label> </div> </div>";
Object(m.a)(N,"OpenInAppDialogHtml",null,[]);var M=a(478),Q=a(354),R=a(21),O=a(20),U=a(23),K=a(168);class F extends B.a{constructor(){super();this.AJb=this.KR=null;this.yRg=!0;this.dPb=null;this.Seg=()=>{this.hide();return!0};this.Weg=()=>{e.ULS.sendTraceTag(508826523,306,50,"OpenInAppDialog.onClickiOSStoreButton: Get iOS Excel App");this.openUrl(this.Rq,"_top");return!0};this.VZb=()=>{e.ULS.sendTraceTag(592547856,306,50,"MouseClick: Open with redirection timer");this.JXb("GetExcelAppButtonClick");
if(this.jH)return this.SZj(),!0;if(R.AFrameworkApplication_AppSettingsManager.fa.la("OpenInAppAnonUrlFixMobile")){var Oa=R.AFrameworkApplication_AppSettingsManager.fa.Xa("UnauthenticatedClientUrl");e.ULS.sendTraceTag(508850783,306,50,"OpenInAppDialog.onClickHandler: clientUrlEmpty:"+(!this.QA||!this.QA.length)+" UnauthenticatedClientUrlEmpty:"+(!Oa||!Oa.length));this.QA&&this.QA.length||!Oa||!Oa.length||(this.QA=Oa,this.u6="ms-excel:ofe|u|"+Oa)}if(W.a.hw){e.ULS.sendTraceTag(579109377,306,50,"Android intent scheme is being used to open android app from browser");
this.QA&&this.QA.length||e.ULS.sendTraceTag(575484678,306,15,"ClientUrl is null");if(R.AFrameworkApplication_AppSettingsManager.fa&&R.AFrameworkApplication_AppSettingsManager.fa.la("PassCampaignDetailsWithUrlEncoding")){e.ULS.sendTraceTag(556654609,306,50,"OpenInAppDialog.onClickHandler: Intent without package name is being used");this.Rq="https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.microsoft.office.excel%26utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac";R.AFrameworkApplication_AppSettingsManager.fa.la("MiniWACInEditMode")&&
(this.Rq="https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dcom.microsoft.office.excel%26utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3DminiwacEdit");Oa=R.AFrameworkApplication_AppSettingsManager.fa.Xa("UnauthenticatedClientUrl");if(R.AFrameworkApplication_AppSettingsManager.fa.la("AddClientUrlToStoreUrlReferrer")&&Oa&&0<Oa.length){e.ULS.sendTraceTag(508876317,306,50,"OpenInAppDialog.onClickHandler: Adding clientUrl to playstore url referrer");Oa="utm_source=wac&utm_medium=web&utm_content="+
encodeURIComponent(Oa);let yc="https://play.google.com/store/apps/details?id=com.microsoft.office.excel&utm_source=wac&utm_medium=web&utm_campaign=miniwac&referrer="+encodeURIComponent(Oa);R.AFrameworkApplication_AppSettingsManager.fa.la("MiniWACInEditMode")&&(yc="https://play.google.com/store/apps/details?id=com.microsoft.office.excel&utm_source=wac&utm_medium=web&utm_campaign=miniwacEdit&referrer="+encodeURIComponent(Oa));this.Rq=encodeURIComponent(yc)}Oa="intent:"+this.QA+"#Intent;scheme=ms-excel;action=android.intent.action.VIEW;S.browser_fallback_url="+
this.Rq+";end"}else R.AFrameworkApplication_AppSettingsManager.fa&&R.AFrameworkApplication_AppSettingsManager.fa.la("PassCampaignDetailsFix1")?(e.ULS.sendTraceTag(556654610,306,50,"OpenInAppDialog.onClickHandler: Intent without package name is being used"),this.Rq+="&utm_source=wac&utm_medium=web&utm_campaign=miniwac",Oa="intent:"+this.QA+"#Intent;scheme=ms-excel;action=android.intent.action.VIEW;S.browser_fallback_url="+this.Rq+";end"):R.AFrameworkApplication_AppSettingsManager.fa&&R.AFrameworkApplication_AppSettingsManager.fa.la("PassCampaignDetailsFix2")?
(e.ULS.sendTraceTag(556654611,306,50,"OpenInAppDialog.onClickHandler: Intent without package name is being used"),this.Rq+="%26utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac",Oa="intent:"+this.QA+"#Intent;scheme=ms-excel;action=android.intent.action.VIEW;S.browser_fallback_url="+this.Rq+";end"):R.AFrameworkApplication_AppSettingsManager.fa&&R.AFrameworkApplication_AppSettingsManager.fa.la("UseIntentWithoutPackageName")?(e.ULS.sendTraceTag(571867905,306,50,"OpenInAppDialog.onClickHandler: Intent without package name is being used"),
this.Rq+="&referrer=utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac",Oa="intent:"+this.QA+"#Intent;scheme=ms-excel;action=android.intent.action.VIEW;S.browser_fallback_url="+this.Rq+";end"):(e.ULS.sendTraceTag(573368028,306,50,"S.market_referrer is being used in openInApp intent"),Oa="intent:"+this.QA+"#Intent;scheme=ms-excel;package=com.microsoft.office.excel;action=android.intent.action.VIEW;S.market_referrer=utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac;end");let Cb=
R.AFrameworkApplication_AppSettingsManager.fa.Xa("OpenInAppAndroidTarget");if(!Cb||"_top"!==Cb&&"_blank"!==Cb&&"_self"!==Cb&&"_parent"!==Cb)Cb="_top";R.AFrameworkApplication_AppSettingsManager.fa.la("OpenInAppAndroidMitigation1")?window.open(Oa,Cb):R.AFrameworkApplication_AppSettingsManager.fa.la("OpenInAppAndroidMitigation2")?(window.setTimeout(()=>{this.openUrl(decodeURIComponent(this.Rq),Cb)},100),this.openUrl("ms-excel:ofe|u|"+this.QA,Cb)):this.openUrl(Oa,Cb)}else this.VMb?this.openUrl(this.u6,
"_top"):9<=W.a.ZPd?(e.ULS.sendTraceTag(578586572,306,50,"OpenInAppDialog.onClickHandler: Open in app directly if installed for iOS version 9 or above"),this.yRg?(this.openUrl(this.Rq,"_blank"),window.setTimeout(()=>{this.yRg=!1;this.BRh();e.ULS.sendTraceTag(572002759,306,50,"OpenInAppDialog.onClickHandler: Changing iOS dialog from appstore to app")},200)):(e.ULS.sendTraceTag(572301960,306,50,"OpenInAppDialog.onClickHandler: Open-in-app button clicked in iOS"),this.openUrl(this.u6,"_top"))):(e.ULS.sendTraceTag(578586573,
306,50,"OpenInAppDialog.onClickHandler: Open in app if installed, else redirection to appstore for iOS version below 9."),this.openUrl(this.u6,"_top"),window.setTimeout(()=>{this.openUrl(this.Rq,"_blank")},500));return!0};this.h3a=Oa=>Oa.La.keyCode===C.a.fu||Oa.La.keyCode===C.a.aCa?(e.ULS.sendTraceTag(592547855,306,50,"KeyPress: Open with redirection timer"),Oa.Qh.click(),!0):!1;1===O.AFrameworkApplicationConstants.ra.$d.Om&&(this.QA=O.AFrameworkApplicationConstants.ra.$d.QA,this.u6="ms-excel:ofe|u|"+
this.QA,this.Rq=R.AFrameworkApplication_AppSettingsManager.fa.Xa("AppUrl"),this.jH=R.AFrameworkApplication_AppSettingsManager.fa.la("IsMeetingLiveSession"),this.VMb=R.AFrameworkApplication_AppSettingsManager.fa.la("EnableiOSTwoButtonDialog"),W.a.qaa||W.a.Un?(this.Rq="itms-apps://apps.apple.com/app/apple-store/id586683407?mt=8&pt=80423&ct=miniWAC",R.AFrameworkApplication_AppSettingsManager.fa.la("MiniWACInEditMode")&&(this.Rq="itms-apps://apps.apple.com/app/apple-store/id586683407?mt=8&pt=80423&ct=miniWACEdit")):
W.a.hw&&(R.AFrameworkApplication_AppSettingsManager.fa.la("UseAppAndroidMarketURL")&&this.jH?(e.ULS.sendTraceTag(528818529,306,100,"Using app android market url"),this.Rq=R.AFrameworkApplication_AppSettingsManager.fa.Xa("WildFireMarketUrlExcelAndroid")):W.a.LUb?this.Rq=R.AFrameworkApplication_AppSettingsManager.fa.Xa("WildFireUrlChinaStoreAndroid"):4<W.a.ood.k2a&&(this.Rq=R.AFrameworkApplication_AppSettingsManager.fa.Xa("WildFireUrlExcelAndroid"))))}JXb(Oa){if("undefined"!==typeof Map){const Cb=new Map;
Cb.set("EntryPoint",Oa);v.Health.instance.recordKpiUsage("OpenInAppDialog",Q.b.FailureBased,"xlminiwac",Cb)}else e.ULS.sendTraceTag(571801891,0,15,"OpenInAppDialog.LogUsageKpiOpenInAppDialog: KPI Usage not supported")}openUrl(Oa,Cb){let yc=document.getElementById("link");yc||(yc=document.createElement("a"),yc.id="link",yc.style.visibility="hidden",yc.href="",document.body.appendChild(yc));yc.target=Cb;yc.href=Oa;yc.click()}SZj(){e.ULS.sendTraceTag(528818530,306,50,"OpenInAppForLiveFiles API invoked");
const Oa={};Oa[M.a.w9d]=this.u6;Oa[M.a.Rq]=this.Rq;O.AFrameworkApplicationConstants.BI().execute(Cb=>{Cb.sendMessage(u.a.openInMobileApp,Oa)})}BRh(){const Oa=document.getElementById("WACDialogPanel"),Cb=Oa.offsetWidth,yc=document.getElementById("OpenInAppTitle"),Nc=document.getElementById("InfoMessageAreaLine1"),Id=document.getElementById("AppstoreLinkTitle");yc.innerText=Object(U.a)("OpenInMobileIOSOpenAppHeaderText");Nc.innerText=Object(U.a)("OpenInMobileIOSOpenAppDialogText");Id.innerText=Object(U.a)("OpenInMobileIOSOpenAppButtonText");
Oa.style.width=Cb+"px"}Im(){const Oa=R.AFrameworkApplication_AppSettingsManager.fa.Xa("Application");R.AFrameworkApplication_AppSettingsManager.fa.la("MiniWACInEditMode")?this.Po=!this.VMb||W.a.hw?B.a.UA(N.Gpg,String.format(Object(U.a)("OpenInMobileAppTitle"),Oa),String.format(Object(U.a)("OpenInMobileDialogText"),Oa),O.AFrameworkApplicationConstants.kE,Object(K.c)(R.AFrameworkApplication_AppSettingsManager.fa.Xa("AppIcon")),String.format(Object(U.a)("OpenInMobileAppStoreDisplayText"),Oa)):B.a.UA(N.Hpg,
String.format(Object(U.a)("OpenInMobileAppTitle"),Oa),String.format(Object(U.a)("OpenInMobileDialogText"),Oa),String.format(Object(U.a)("OpenInMobileAppStoreDisplayText"),Oa),Object(U.a)("OpenInAppiOSTwoButtonDialogDoNotHaveDialogText"),Object(U.a)("OpenInAppiOSTwoButtonDialogOpenAppstoreText")):this.Po=!this.VMb||W.a.hw||this.jH?B.a.UA(N.Gpg,this.jH||!W.a.hw?Object(U.a)("OpenInMobileIOSOpenAppstoreHeaderText"):Object(U.a)("OpenInMobileAppHeader"),this.jH?String.format(Object(U.a)("OpenInMobileAppInUnifiedUIHostDialogText"),
Oa):W.a.hw?String.format(Object(U.a)("OpenInMobileDialogText"),Oa):Object(U.a)("OpenInMobileIOSOpenAppstoreDialogText"),O.AFrameworkApplicationConstants.kE,Object(K.c)(R.AFrameworkApplication_AppSettingsManager.fa.Xa("AppIcon")),this.jH?String.format(Object(U.a)("OpenInMobileAppInUnifiedUIHostButtonText"),Oa):String.format(Object(U.a)("OpenInMobileAppStoreDisplayText"),Oa)):B.a.UA(N.Hpg,Object(U.a)("OpenInAppiOSTwoButtonDialogTitle"),Object(U.a)("OpenInAppiOSTwoButtonDialogMessageBody"),Object(U.a)("OpenInAppiOSTwoButtonDialogButtonText"),
Object(U.a)("OpenInAppiOSTwoButtonDialogDoNotHaveDialogText"),Object(U.a)("OpenInAppiOSTwoButtonDialogOpenAppstoreText"));this.Lk="OpenInAppDialog";this.Bh=5;this.initializeAndShow("",null,null);this.KV(this.KR)}VK(Oa){super.VK(Oa);document.getElementById("WACDialogBodyPanel").style.padding="0 4px 0 24px";Oa=document.getElementById("WACDialogPanel");const Cb=Oa.offsetWidth;Oa.style.maxWidth="90%";Oa.style.left=(Cb-Oa.offsetWidth)/2+"px";this.KR=document.getElementById("LinkToInstall");J.a.instance.ya(z.a.click,
this.KR,this.VZb);D.a.instance.ya(z.a.Rj,this.KR,this.h3a);!this.VMb||W.a.hw||this.jH||(this.dPb=document.getElementById("GetAppLinkButton"),J.a.instance.ya(z.a.click,this.dPb,this.Weg));R.AFrameworkApplication_AppSettingsManager.fa.isChangeGateEnabled("OfficeVSO:7124961_OpenInAppDialogCloseButtonFix")&&(this.AJb=document.getElementById("WACDialogTitlePanel").lastChild,J.a.instance.ya(z.a.click,this.AJb,this.Seg))}dispose(){this.KR&&(J.a.instance.Na(z.a.click,this.KR,this.VZb),D.a.instance.Na(z.a.Rj,
this.KR,this.h3a),this.KR=null);R.AFrameworkApplication_AppSettingsManager.fa.isChangeGateEnabled("OfficeVSO:7124961_OpenInAppDialogCloseButtonFix")&&this.AJb&&(J.a.instance.Na(z.a.click,this.AJb,this.Seg),this.AJb=null);this.VMb&&!W.a.hw&&!this.jH&&this.dPb&&(J.a.instance.Na(z.a.click,this.dPb,this.Weg),this.dPb=null);super.dispose()}}Object(m.a)(F,"OpenInAppDialog",B.a,[]);var I=a(242),P=a(763),Y=a(182),ea=a(229),Ba=a(217),Fa=a(7),za=a(253),xa=a(95),fa=a(69),V=a(90),ba=a(419),la=a(212),Ta=a(63),
Ea=a(62),sa=a(366),Ya=a(97),bb=a(5),ra=a(93),Da=a(40),oa=a(689),Ha=a(1484),ka=a(644),wa=a(428),Za=a(12),ab=a(1);class db extends Ha.a{constructor(Oa,Cb){super(Oa,void 0,void 0,Cb)}get r2a(){return Za.a.instance.Ba(421)}get nJc(){return Za.a.instance.Ba(422)}get mJc(){return"DownloadOdsLink"}get fXb(){return ab.EwaSettings.isChangeGateEnabled("OfficeVSO:8202697_isDownloadAsODSLinkFixEnabled")?null:"#"}get rob(){return Za.a.instance.Ba(423)}get t$f(){return!0}n5f(){e.ULS.sendTraceTag(537162658,0,50,
"DownloadACopyAsOdsDialog.LogDialogDisplayed - ODS download dialog displayed")}p5f(){e.ULS.sendTraceTag(537162657,0,50,"DownloadACopyAsOdsDialog.LogDownloadLinkClicked - ODS download dialog link clicked")}gJc(){ka.a.showHelp(wa.a.aJj);return!0}}Object(m.a)(db,"DownloadACopyAsOdsDialog",Ha.a,[]);class mb{constructor(Oa,Cb){this.dialog=null;this.Zfg=()=>{this.dialog&&this.dialog.hide()};this.wJj=Oa;this.ih=Cb;this.ih.cGb(this.Zfg)}$5e(Oa){this.dialog=Oa}bAd(){this.wJj.Apg(-1059172980)}dispose(){this.ih.a3b(this.Zfg)}}
Object(m.a)(mb,"DownloadACopyAsOdsDialogDownloadBehavior",null,[100,2]);class Ia{constructor(Oa){this.calculationMode=0;this.calculationMode=Oa}}Object(m.a)(Ia,"MacroRecorderWorkbookCalculationModeSetPayload",null,[65]);class pa{constructor(Oa){this.calculateType=0;this.calculateType=Oa}}Object(m.a)(pa,"MacroRecorderWorkbookRecalculatedPayload",null,[65]);var lb=a(79),ha=a(422);class ua{static get QZj(){return ua.PZj}}ua.PZj="<div class='\"\"' id='OpenInAppDialog'> <div class='PrivacyDialogTitle UIFontDialogTitle' id='OpenInAppTitle'> <label id='OpenInAppTitle' class='\"\"' style='font-size:16pt' >{0}</label> </div> <div class='WACDialogRow' id='InfoMessageArea'> <label id='InfoMessageAreaLine1' class='\"\"' style='font-size:12pt' >{1}</label> <br/> </div> <br/> <div class='AppInstallButton' id='LinkToInstall' role='button' tabIndex='0'> <div class='clip32x32' id='BottomInfoIconClip' unselectable='on' style='display: inline-block; pointer-events:none;' role='img'> <img id='BottomIconInfo' class='{3}' role='presentation' src={2} /> </div> <div class='\"\"' id='AppstoreLink' style='display:inline-block; padding-top:4px; vertical-align:top;'> <label id='AppstoreLinkTitle' class='PrivacyDialogTitle' unselectable='on' style='font-size: 14pt; margin-left:8px' >{4}</label> </div> </div>";
Object(m.a)(ua,"OpenInAppDialogCopyHtml",null,[]);class fb extends ha.a{constructor(Oa){super(Oa);this.KR=null;this.VZb=()=>{e.ULS.sendTraceTag(574993313,306,50,"MouseClick: Open with redirection timer");if(this.$.ua.IsMeetingLiveSession)return this.M3c(),!0;W.a.hw?(e.ULS.sendTraceTag(574993312,306,50,"Android intent scheme is being used to open android app from browser"),this.QA&&this.QA.length||e.ULS.sendTraceTag(537162595,306,15,"ClientUrl is null"),this.openUrl("intent:"+this.QA+"#Intent;scheme=ms-excel;action=android.intent.action.VIEW;S.browser_fallback_url="+
this.Rq+";end","_top")):9<=W.a.ZPd?(e.ULS.sendTraceTag(537162594,306,50,"OpenInAppDialog.onClickHandler: Open in app directly if installed for iOS version 9 or above"),this.openUrl(this.u6,"_top"),window.setTimeout(()=>{this.openUrl(this.Rq,"_blank")},9E3)):(e.ULS.sendTraceTag(537162593,306,50,"OpenInAppDialog.onClickHandler: Open in app if installed, else redirection to appstore for iOS version below 9."),this.openUrl(this.u6,"_top"),window.setTimeout(()=>{this.openUrl(this.Rq,"_blank")},500));return!0};
this.h3a=Cb=>Cb.La.keyCode===C.a.fu||Cb.La.keyCode===C.a.aCa?(e.ULS.sendTraceTag(537162592,306,50,"KeyPress: Open with redirection timer"),Cb.Qh.click(),!0):!1;1===l.AFrameworkApplication.ra.$d.Om&&(this.QA=this.$.workbookContext.ClientUrl,this.u6="ms-excel:ofe|u|"+this.QA,this.Rq=l.AFrameworkApplication.fa.Xa("AppUrl"),W.a.qaa?this.Rq="itms-apps://"+l.AFrameworkApplication.fa.Xa("WildFireUrlExceliOS")+"&referrer=utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac":W.a.hw&&(ab.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UseAppAndroidMarketURL",
!1)&&this.$.ua.IsMeetingLiveSession?(e.ULS.sendTraceTag(529397969,306,100,"Using app android market url"),this.Rq=l.AFrameworkApplication.fa.Xa("WildFireMarketUrlExcelAndroid")):W.a.LUb?this.Rq=l.AFrameworkApplication.fa.Xa("WildFireUrlChinaStoreAndroid"):4<W.a.ood.k2a&&(this.Rq=l.AFrameworkApplication.fa.Xa("WildFireUrlExcelAndroid")+"&referrer=utm_source%3Dwac%26utm_medium%3Dweb%26utm_campaign%3Dminiwac")))}get ki(){return"OpenInAppDialogCopy"}openUrl(Oa,Cb){let yc=document.getElementById("link");
yc||(yc=document.createElement("a"),yc.id="link",yc.style.visibility="hidden",yc.href="",document.body.appendChild(yc));yc.target=Cb;yc.href=Oa;yc.click()}M3c(){e.ULS.sendTraceTag(529397968,306,50,"OpenInAppForLiveFiles API invoked");bb.id.Ha()?void Ya.a.resolve(bb.id,{va:1}).then(Oa=>{const Cb={};Cb.OpenInAppUrl=this.u6;Cb.StoreUrl=this.Rq;Oa.sendMessage("UI_OpenInMobileApp",Cb)}):Da.TaskExtensions.Ua(lb.GetServiceTaskFactory.Bj(this.$.ka,21,137,1),Oa=>{const Cb={};Cb.OpenInAppUrl=this.u6;Cb.StoreUrl=
this.Rq;Oa.result.sendMessage("UI_OpenInMobileApp",Cb)},this.$.xa)}RZj(){e.ULS.sendTraceTag(529397967,306,100,"OpenInAppDialogHandler invoked")}Im(){this.Po=B.a.UA(ua.QZj,Za.a.instance.ia(662),Za.a.instance.ia(663),l.AFrameworkApplication.kE,K.c(l.AFrameworkApplication.fa.Xa("AppIcon")),Za.a.instance.ia(664));this.Lk="OpenInAppDialog";this.Bh=5;this.initializeAndShow("",this.RZj.bind(this),null);this.KV(this.KR)}VK(Oa){super.VK(Oa);document.getElementById("WACDialogBodyPanel").style.padding="0 4px 0 24px";
this.KR=document.getElementById("LinkToInstall");J.a.instance.ya(z.a.click,this.KR,this.VZb);D.a.instance.ya(z.a.Rj,this.KR,this.h3a)}dispose(){this.KR&&(J.a.instance.Na(z.a.click,this.KR,this.VZb),D.a.instance.Na(z.a.Rj,this.KR,this.h3a),this.KR=null);super.dispose()}}Object(m.a)(fb,"OpenInAppDialogCopy",ha.a,[]);var Ka=a(187);class La{constructor(Oa){this.R6i="itms-apps://";this.S6i="apps.apple.com/app/apple-store/id586683407?mt=8&pt=80423&ct=miniWAC";this.fah=Cb=>{1==Cb&&this.M3c()};this.$=Oa;
this.QA=l.AFrameworkApplication.ra.$d.QA;this.u6="ms-excel:ofe|u|"+this.QA;this.Rq=l.AFrameworkApplication.fa.Xa("AppUrl");W.a.qaa||W.a.Un?this.Rq=this.R6i+this.S6i:W.a.hw&&(l.AFrameworkApplication.fa.la("UseAppAndroidMarketURL")?(e.ULS.sendTraceTag(523534414,306,100,"OpenInAppDialogReact: Using app android market url"),this.Rq=l.AFrameworkApplication.fa.Xa("WildFireMarketUrlExcelAndroid")):W.a.LUb?this.Rq=l.AFrameworkApplication.fa.Xa("WildFireUrlChinaStoreAndroid"):4<W.a.ood.k2a&&(this.Rq=l.AFrameworkApplication.fa.Xa("WildFireUrlExcelAndroid")))}M3c(){e.ULS.sendTraceTag(523534413,
306,50,"OpenInAppDialogReact: OpenInAppForLiveFiles API invoked");bb.id.Ha()?void Ya.a.resolve(bb.id,{va:1}).then(Oa=>{const Cb={};Cb[M.a.w9d]=this.u6;Cb[M.a.Rq]=this.Rq;Oa.sendMessage("UI_OpenInMobileApp",Cb)}):Da.TaskExtensions.Ua(lb.GetServiceTaskFactory.Bj(this.$.ka,21,137,1),Oa=>{const Cb={};Cb[M.a.w9d]=this.u6;Cb[M.a.Rq]=this.Rq;Oa.result.sendMessage("UI_OpenInMobileApp",Cb)},this.$.xa)}Im(){e.ULS.sendTraceTag(523534412,0,50,"initializeAndShowDialog: React Edit in app dialog opened.");const Oa=
new Ka.a;Oa.Bh=0;Oa.Yh(1,Za.a.instance.ia(668));Oa.Io(Za.a.instance.ia(666),Za.a.instance.ia(667),0,this.fah)}}Object(m.a)(La,"OpenInAppDialogReact",null,[]);var ib=a(421);class Yb extends ib.a{constructor(Oa){super(Oa);this.sessionId=Oa.ua.UserSessionId;this.ILh=Oa.ua.BuildVersion}get ki(){return"WACSessionIdDialog"}iR(){return{[Yb.Jxk]:Za.a.instance.ia(669),[Yb.Kxk]:this.sessionId,[Yb.id]:"WACSessionIdDialog",[Yb.prd]:Za.a.instance.ia(670),[Yb.buildVersion]:this.ILh}}Im(){const Oa=this.iR();this.Bh=
5;this.initializeAndShow(Za.a.instance.ia(1026),this.oal.bind(this),Oa)}oal(){e.ULS.sendTraceTag(521434688,306,100,"Show WACSessionIdDialogHandler invoked")}}Yb.id="id";Yb.Jxk="sessionIdLabel";Yb.Kxk="sessionIdValue";Yb.prd="buildLabel";Yb.buildVersion="buildVersion";Object(m.a)(Yb,"WACSessionIdDialog",ib.a,[]);var Wc=a(32),Qc=a(35),Wb=a(401),Jc=a(13),ma=a(209),Hc=a(262),Kb=a(24),pc=a(47),$b=a(282),Ib=a(429),Zb=a(306),Eb=a(8),ob=a(170),Na=a(1342),nb=a(92),Hb=a(36),na=a(342),Gb=a(287);class Xa{KIa(Oa,
Cb){Oa=Qc.a.Yi(12,1,671,0,0,0,"Blank");Oa.Description=String.format(Za.a.instance.ia(672),Cb);return Oa}uxc(Oa){switch(Oa){case 1:case 2:return 0;default:return 2}}}Object(m.a)(Xa,"ReloadCloseConfirmation",null,[414]);var Jb=a(177),qb=a(671),Db=a(75),gb=a(66),ya=a(304),Aa;let sb=Aa=class extends ea.a{constructor(Oa,Cb,yc,Nc,Id){Id=void 0===Id?null:Id;super();this.J8b=[Za.a.instance.ia(2295),Za.a.instance.ia(2296),Za.a.instance.ia(2297),Za.a.instance.ia(2298)];this.YWk=["AnimFxEntranceScale_16","Snow_DOL_16",
"Wand1_16","AutoSave2_16"];this.LGj=["SaveFluent_20","FlashFluent_20","VictoryHandFluent_20","WandFluent_20"];this.LCg=["RenameColumn_32","CloudFont_20"];this.IHg=0;this.ZGc=!1;this.$=Oa;this.businessBar=Nc;this.VZj=Cb;this.UId=Id;this.isToastShown=!1;this.PU=yc}get Ph(){return this.$.ea.Ph}get ZVf(){return l.AFrameworkApplication.HKa()&&this.$.Tj.get(58)&&this.$.ea.sn.get(30)?!0:!1}get workbookContext(){return this.$.workbookContext}get wtc(){return this.$.workbookContext.FullDocumentInfo}get clientWorkflow(){return Db.a(this.$)}get th(){return this.$.th}w4i(){var Oa,
Cb;return null!==(Cb=null===(Oa=this.$.workbookContext.LoadBlockingFloatingObjectsInfo)||void 0===Oa?void 0:Oa.LoadBlockType)&&void 0!==Cb?Cb:!1}Bi(){return!1}executeCommand(Oa,Cb,yc,Nc){const Id=this.wtc,ke=this.$,Ie=Cb.command,Le=this.VZj,wf=this.$.$h,Kf=yc.SourceControlId;ke.ms.x_e(Ie);Le.CWc(Cb.startTime.getTime().toString());Oa=null;switch(Ie){case 1455037301:this.$.Tna?Le.lff():Le.Evd();break;case -2044628748:case 2004484710:this.$.Tna?Le.lff():Le.openInExcelClient();break;case 213236505:"ContextMenu.ShowOpenInAppDialogOnMobile"===
Kf?(this.JXb("CellLongPress"),e.ULS.sendTraceTag(576495705,0,50,"FileOperationsCommandHandler.ExecuteCommand: Open-in-app dialog invoked from cell long press")):(this.JXb("PencilIcon"),e.ULS.sendTraceTag(576495704,0,50,"FileOperationsCommandHandler.ExecuteCommand: Open-in-app dialog invoked from pencil icon in toolbar"));this.showOpenInAppDialog();break;case 924877417:e.ULS.sendTraceTag(520372316,0,50,"User clicked the reload button");const cg=Db.a(this.$).ij.activityState;pc.a(ke).Dy(new $b.a(Eb.a.bD,
5,()=>{cg[Gb.a.Aw]=Eb.a.yp}));break;case 480922297:ab.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShowWacSessionIdDialogOnMobile",!1)&&(new Yb(this.$)).Im();break;case -2028960985:Le.fUg();break;case -1059172980:new db(Le.zrd(Ie),new mb(Le,ke.ih));break;case -1285148982:this.clientWorkflow.ij.activityState[Hb.a.nld]=!0;this.Z_c(!1);break;case -75280711:this.Z_c(!1);break;case -455164169:this.Z_c(!0);break;case -1388494670:void Ya.a.resolve(bb.Td).then(Dg=>{Dg.XBj();this.Z_c(!1)});break;
case 810888577:l.AFrameworkApplication.accessTokenTtl=(new Date).getTime();e.ULS.sendTraceTag(537162656,0,50,`FileOperationsCommandHandler.ExecuteCommand: Set AccessTokenTtl to ${l.AFrameworkApplication.accessTokenTtl}`);break;case -1804063550:case 1700376090:case -974518828:Cb=0;Fa.a.r9d in yc&&(Cb=yc[Fa.a.r9d]);Le.Apg(Ie,Cb);break;case -1339961039:Cb=!1;yc&&Fa.a.d4b in yc&&(Cb=yc[Fa.a.d4b]);this.reloadWorkbook(!1,Cb);break;case -8805455:const Bg=this.workbookContext;if(this.w4i())if(ab.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UsePromisesInsteadOfTasks",
!1))void Ya.a.resolve(bb.Id,{va:0}).then(Dg=>Dg.FS());else{const Dg=Object(ra.d)(Ya.a.resolve(bb.Id,{va:0}));Da.TaskExtensions.Ua(Dg,()=>{Dg.result.FS()},this.$.xa,3)}else ke.isEditMode||(Aa.Acf(ke),Oa=Da.TaskExtensions.Ua(bb.ec.Ha()?Object(ra.d)(this.PU(0)):this.UId.value,Dg=>{Dg=Dg.result;var Kg=Dg.isEnabled();Kg&&oa.a(Dg,u.a.Vff,Ta.a.Al.FCf(),this.$.ea.sn.get(2))?e.ULS.sendTraceTag(537162655,0,50,"FileOperationsCommandHandler.ExecuteCommand: ReloadInEditMode ribbon command was procesed through SendMessageIfOptionSet()"):
Kg&&l.AFrameworkApplication.p4g?(Kg={},Kg[w.a.C1b]=l.AFrameworkApplication.userSessionId,Kg[l.AFrameworkApplication.BEj]=Wc.a.Tg.Wh.getTime().toString(),e.ULS.sendTraceTag(537162654,0,50,"FileOperationsCommandHandler.ExecuteCommand: processing ReloadInEditMode ribbon command whike UseEditModePostMessage flag is ON"),Dg.sendMessage(u.a.editMode,Kg)):Id.CopyAndEditUrl?this.q_h():(this.th.supportsEditing||Bg.EditUrl)&&this.reloadWorkbookInEditMode()},this.xa,3));break;case -723527778:ke.isEditMode&&
(this.$.ea.P9j(),Aa.Acf(ke),this.reloadWorkbookInViewMode());break;case 1783960667:case -1355155015:const dh=ke.pa.ta.Jh(),Sf=-1355155015===Ie?1:0,eh=()=>new pa(Sf);Oa=ba.a(this.$.userOperationManager,(Dg,Kg,Hg)=>Ea.z(ke.pa.ta,Sf,null,Dg,Kg,Hg,null,dh),Dg=>new la.a(128,0,Dg,void 0,eh),Cb);Kb.f(ke).Um.MT(!1);break;case -1158102843:Oa=Kb.f(ke).Um.recalcSheet(Cb);Kb.f(ke).Um.MT(!1);break;case -988468372:Nc=parseInt(yc[fa.a.Ai],10);if(0<=Nc&&3>Nc)this.setCalculationMode(Cb,Nc);else return e.ULS.sendTraceTag(537162652,
0,10,`SetCalculationMode , unexpected menuItemId: ${yc[fa.a.Ai]}`),ma.a(Ie);break;case 257398710:za.a.ntw(Id.ReportAbuseUrl,ke);break;case -1966746939:e.ULS.sendTraceTag(508925790,0,50,"User pressed Ctrl S");this.$.isEditMode&&!this.isToastShown&&(this.IHg++,void appChrome.isRenameCalloutVisible().then(Dg=>{const Kg=()=>Kb.f(this.$).focus(),Hg=()=>appChrome.api.dispatch(appChrome.actions.setDocumentTitleFlyoutOpened(!0));this.ZVf&&2===yc.invokedBy?this.ZGc||(e.ULS.sendTraceTag(507900105,0,50,"FileOperationsCommandHandler.ExecuteCommand: Opening rename callout on proactive trigger."),
this.ZGc=!0,appChrome.showRenameFileCallout(Hg,Kg,Za.a.instance.ia(2416),this.LCg[0],Za.a.instance.ia(2418))):this.ZVf&&2===this.IHg&&!this.ZGc&&1===yc.invokedBy?(e.ULS.sendTraceTag(508118336,0,50,"FileOperationsCommandHandler.ExecuteCommand: Opening rename callout on CTRL+S trigger."),this.ZGc=!0,appChrome.showRenameFileCallout(Hg,Kg,Za.a.instance.ia(2415),this.LCg[1],Za.a.instance.ia(2417))):Dg||this.AKk()}),this.isToastShown=!0,setTimeout(()=>{this.isToastShown=!1},Aa.Tte));break;case 1800405051:this.Ksk();
break;case -48469327:this.saveACopy();break;case 214430355:Cb=!1;yc&&Fa.a.LAd in yc&&(Cb=yc[Fa.a.LAd]);if(!this.sIk(Cb,yc))break;l.AFrameworkApplication.Cga?this.businessBar.xm(42,null):this.businessBar.xm(Cb?22:23,null);break;case 1389557314:Oa=Da.TaskExtensions.Ua(bb.ec.Ha()?Object(ra.d)(this.PU(0)):this.UId.value,Dg=>{oa.a(Dg.result,u.a.wti,null,this.$.ea.sn.get(6))||za.a.ntw(Id.FileVersionUrl,ke)},this.xa,3);break;case 2145659238:this.closeWorkbook();break;case 1773624819:Kf===wf+Fa.a.H1f?Le.Htj():
Le.Gtj();break;case 512141517:Kf===wf+Fa.a.G1f?Le.Qtj():Le.Ptj();break;case -1224038235:const Rg=n.a.On in yc?!yc[n.a.On]:xa.k(ke.ea.workbookContext.Options);yc[n.a.Description]=Rg?Za.a.instance.ia(571):Za.a.instance.ia(572);Oa=ba.a(this.$.userOperationManager,(Dg,Kg,Hg)=>{var fh=this.$.pa.ta,Vh=!Rg;const Yf=fh.Za(9,null);Yf.isReadOnlyRecommended=Vh;return Ea.h(fh,"SetReadOnlyRecommended",Yf,Dg,Kg,Hg,null,0)},Dg=>new la.a(129,0,Dg),Cb);break;case 1118926154:if(this.$.isEditMode){const Dg=new Y.a;
this.$.ka.Lh(53,Kg=>{Kg?(Kg.ns.ytj(this.$.$h+Fa.a.GYd),Dg.setResult(!0)):e.ULS.sendTraceTag(537162649,0,50,"Ignoring RibbonCommand.LaunchFileMenuShortcut, the ribbonManager is null.")});Oa=Dg.task}break;case -1698025133:Le.openInBrowser();break;case 520859864:Oa=Da.TaskExtensions.Ua(Object(ra.d)(Ya.a.resolve(bb.mf,{va:Nc.Ufa()})),Dg=>{Dg.result||e.ULS.sendTraceTag(537162648,0,10,"FileMenuCommandHandler::ExecuteCommand Failed to create SaveToHostManager")},this.$.xa,3);break;default:Oa=ma.a(Ie)}return Oa||
gb.Task.Va(!0)}JXb(Oa){if(Jc.HelperMethods.saa){const Cb=new Map;Cb.set("EntryPoint",Oa);v.Health.instance.recordKpiUsage(Zb.a.OZj,Q.b.FailureBased,Ib.a.jEj,Cb)}else e.ULS.sendTraceTag(537162647,0,15,"FileOperationsCommandHandler.LogUsageKpiOpenInAppDialog: KPI Usage not supported")}showOpenInAppDialog(){var Oa;l.AFrameworkApplication.isMobileMode&&(this.$.ua.IsMeetingLiveSession&&ab.EwaSettings.isChangeGateEnabled("OfficeVSO:7492428_OpenInAppExcelReactDialogChangegate")||ab.EwaSettings.isChangeGateEnabled("OfficeVSO:7937775_enableExcelLiveOpenInAppDialogInTeamsTab")&&
l.AFrameworkApplication.isMobileMode&&"teams"===(null===(Oa=this.$.ua.UiHost)||void 0===Oa?void 0:Oa.toLowerCase())?(e.ULS.sendTraceTag(522859990,0,50,"FileOperationsCommandHandler.ShowOpenInAppDialog: SD-side open-in-app React dialog used"),(new La(this.$)).Im()):ab.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UseOpenInAppDialogCopyMobile",!1)?(e.ULS.sendTraceTag(574993315,0,50,"FileOperationsCommandHandler.ShowOpenInAppDialog: SD-side open-in-app dialog used"),(new fb(this.$)).Im()):
(e.ULS.sendTraceTag(574993314,0,50,"FileOperationsCommandHandler.ShowOpenInAppDialog: Git-side open-in-app dialog used"),l.AFrameworkApplication.isMobileMode&&(new F).Im()))}sIk(Oa,Cb){return l.AFrameworkApplication.isMobileMode&&!V.a(this.$.ua,29)?(this.showOpenInAppDialog(),e.ULS.sendTraceTag(577300448,0,50,"FileOperationsCommandHandler.ShouldPromptEditInBrowser: Open-in-app dialog invoked from cell double tap"),this.JXb("CellDoubleTap"),e.ULS.sendTraceTag(537162646,0,50,"FileOperationsCommandHandler.ShouldPromptEditInBrowser: User attempted to edit in reading view in mobile browser "),
!1):l.AFrameworkApplication.mGc&&(Oa&&Wb.c(this.workbookContext.WorkbookFileName)||!this.workbookContext.FullDocumentInfo.HostEditUrl)?(e.ULS.sendTraceTag(537162645,0,50,`FileOperationsCommandHandler.ShouldPromptEditInBrowser: User attempted to edit in reading view a non-editable format .${Wb.d(this.workbookContext.WorkbookFileName)?"xls":"csv"}, HostEditUrl ${this.workbookContext.FullDocumentInfo.HostEditUrl?"not ":""}empty. Skipped prompt to edit`),!1):I.a.any([25,26,30,31,57,32,34],yc=>this.businessBar.N5(yc))?
(e.ULS.sendTraceTag(537162644,0,50,"FileOperationsCommandHandler.ShouldPromptEditInBrowser: User attempted to edit in reading view after opening in Edit by default"),!1):Cb&&Fa.a.q8j in Cb&&!Oa?!1:!0}ni(Oa,Cb){Oa=!1;switch(Cb.command){case 2145659238:case 1455037301:case 2004484710:case -2028960985:case -1355155015:case 1118926154:case -1698025133:case -2044628748:case -974518828:case 1389557314:case 214430355:case -1339961039:case -8805455:case -723527778:case 1783960667:case -1158102843:case 257398710:case -988468372:case 213236505:case 1773624819:case 512141517:Oa=
!0;break;case 480922297:case 520859864:Oa=ab.EwaSettings.isChangeGateEnabled("OfficeVSO:3773098_SaveDeferredActionDispatcherEnabled")?!0:!1;break;case 924877417:Oa=!0;break;case -1285148982:case -75280711:case -455164169:Oa=ab.EwaSettings.Ra(106);break;case -1388494670:Oa=ab.EwaSettings.Ra(106);break;case 810888577:Oa=ab.EwaSettings.Ra(243);break;case -1224038235:Oa=this.$.ea.e_;break;case -1804063550:case -1059172980:case 1800405051:case -48469327:Oa=!0;e.ULS.shipAssertTag(537162642,0,this.$.iaa,
"Command execute requested for SaveAs or Copy operation when data duplication is disallowed.");break;case 1700376090:Oa=ab.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DownloadAsCSV",!1);e.ULS.shipAssertTag(507847963,0,this.$.iaa,"Command execute requested for DownloadAsCsv operation when data duplication is disallowed.");break;case -1966746939:Oa=this.$.isEditMode}return Oa}Ji(){return!1}Ksk(){if(this.Ph){var Oa=this.$;pc.a(Oa).Dy(new $b.a(Eb.a.bD,5,()=>{Oa.rP(!1,!0);const Cb=this.clientWorkflow.ij.activityState;
Cb[Gb.a.Aw]=Eb.a.Qpa;Cb[ob.a.p3]=2;Cb[Hb.a.Jz]=Oa.isEditMode;Cb[ob.a.hta]=!1}))}}AKk(){const Oa=Math.floor(Math.random()*this.J8b.length),Cb=this.J8b[Oa],yc=ya.a.IA.AK.mX(Cb,!1);e.ULS.sendTraceTag(508925789,0,50,"AutoSave toast message is shown. Message: '{0}', Index:{1}",Cb,Oa);yc.image=5;yc.u0=ab.EwaSettings.isChangeGateEnabled("OfficeVSO:8736339_NewAutoSaveIconsAndStrings")?this.LGj[Oa]:this.YWk[Oa];ya.a.IA.AK.eF(yc)}saveACopy(){if(this.Ph){var Oa=this.$;pc.a(Oa).Dy(new $b.a(Eb.a.bD,5,()=>{Oa.rP(!1,
!1);const Cb=this.clientWorkflow.ij,yc=Cb.activityState;yc[Gb.a.Aw]=Eb.a.yHg;yc[qb.a.wFb]=this.th.hasUnsupportedFeaturesForEdit;yc[ob.a.hta]=!1;Cb.Sy(Qc.a.ufa(this.businessBar.gBd,[-502303485]))}))}}Z_c(Oa){pc.a(this.$).Dy(new $b.a(Eb.a.bqa,2,()=>{this.$.rP(!0,!0);var Cb=Db.a(this.$).ij;const yc=this.$.isEditMode,Nc=this.$.ea.Tlb;var Id=ab.EwaSettings.isChangeGateEnabled("OfficeVSO:8609965_SilentReloadInCollabModeInClient");Id=Qc.a.Yi(1,1,0,0,0,(Id?yc||Nc:yc)?-315732528:-2087635043,(Id?yc||Nc:yc)?
"DeploymentInvalidEditSession":"InvalidOrTimedOutSession");Id.ForceVersionUpgrade=Oa;Cb.Sy([Id]);Cb=Db.a(this.$).ij.activityState;Cb[Gb.a.Aw]=Eb.a.bqa;Cb[Hb.a.Jz]=yc;Cb[Hb.a.jld]=Nc;Cb[ob.a.hta]=!1}))}closeWorkbook(){if(this.Ph){var Oa=this.$;Ta.a.Al.bXc("2145659238")?Da.TaskExtensions.Ua(bb.ec.Ha()?Object(ra.d)(this.PU(0)):this.UId.value,Cb=>{Cb.result.sendMessage(u.a.jwf,{})},this.xa,3):pc.a(Oa).Dy(new $b.a(Eb.a.bD,5,()=>{Oa.rP(!0,!1);const Cb=this.clientWorkflow.ij.activityState;Cb[ob.a.o9]=!1;
Cb[ob.a.hta]=!1;this.th.inViewerFromWebPart?(sa.a.vce(Oa,this.clientWorkflow.ij),Oa.ms.gI("InViewerFromWebPart"),Cb[Gb.a.Aw]=Eb.a.Vaa):(Cb[Gb.a.Aw]=Eb.a.jq,Oa.wj&32?Cb[ob.a.p3]=0:(Cb[ob.a.p3]=1,Cb[ob.a.ojc]=new Na.a),Cb[Jb.a.UYe]=!0)}))}}q_h(){const Oa=this.th.vbaRemovedDuringConversion;e.ULS.sendTraceTag(537162636,0,50,`FileOperationsCommandHandler.CopyAndEditWorkbook: vbaRemovedDuringConversion = ${Oa}`);const Cb=this.$;Oa?pc.a(Cb).Dy(new $b.a(Eb.a.bD,5,()=>{const yc=Qc.a.Yi(3,0,0,1265,0,1069271157,
"XLSMacroFailure");this.clientWorkflow.ij.Sy([yc]);this.clientWorkflow.ij.activityState[Gb.a.Aw]=Eb.a.lxb})):l.AFrameworkApplication.hideHeader?Jc.HelperMethods.dm(this.wtc.CopyAndEditUrl,"_blank",void 0,"FileOperationCommandHandler.CopyAndEditUrl"):za.a.ntw(this.wtc.CopyAndEditUrl,Cb)}reloadWorkbookInEditMode(){if(this.Ph)if(Ta.a.Al.U5&&Ta.a.Al.pee(),l.AFrameworkApplication.mGc&&!l.AFrameworkApplication.NU)Jc.HelperMethods.dm(this.$.cIb(!0),Ba.a.blank,void 0,"FileOperationCommandHandler.BuildHostUrl");
else{var Oa=this.$,Cb=!1,yc=this.th.hasUnsupportedFeaturesForEdit,Nc=this.workbookContext.FileWasRepaired;Oa.ea.HBc=!1;Wb.d(this.workbookContext.WorkbookFileName)?(Cb=!0,e.ULS.sendTraceTag(537162634,0,50,`FileOperationsCommandHandler.ReloadWorkbookInEditMode: working on an XLS file, unsupported features = ${yc}`)):Wb.a(this.workbookContext.WorkbookFileName)&&(Cb=!0,e.ULS.sendTraceTag(537162633,0,50,"FileOperationsCommandHandler.ReloadWorkbookInEditMode: working on an CSV file"));var Id=Oa.Tj.get(59);
Id=!(Oa.ea.th.supportsEditing&&Id);if(Cb&&!yc||Id&&(Cb||yc)){let ke;ke=Id?yc?-2066104278:816071846:ab.EwaSettings.isChangeGateEnabled("OfficeVSO:4035916_RemoveConvertInTeams")&&V.a(this.$.ua,25)&&!this.$.DVb?765011943:-213064907;Cb=()=>{const Ie=Qc.a.veb([ke]);this.clientWorkflow.ij.Sy(Ie);this.clientWorkflow.ij.activityState[Gb.a.Aw]=Eb.a.lxb}}else Cb=()=>{Oa.rP(!0,!1);var ke=this.clientWorkflow.ij;const Ie=ke.activityState;Ie[ob.a.p3]=1;Ie[na.a.ujc]=P.a.dLc;Ie[Hb.a.Jz]=!0;Ie[qb.a.wFb]=this.th.hasUnsupportedFeaturesForEdit;
Ie[ob.a.hta]=!!this.workbookContext.EditUrl;Ie[nb.a.Jda]=this.workbookContext.EditUrl;if(!this.wtc.CopyAndEditUrl){const Le=[ab.EwaSettings.isChangeGateEnabled("OfficeVSO:4035912_RemoveEditACopyInTeams")&&V.a(this.$.ua,25)&&!this.$.DVb?-943219229:1821390342];ke.Sy(Qc.a.ufa(this.businessBar.gBd,Le))}Nc&&!yc?(Wb.b(this.workbookContext.WorkbookFileName)&&ab.EwaSettings.isChangeGateEnabled("OfficeVSO:5693008_CGForFlightODFRepairEnabled")?(ke=Qc.a.veb([-425642652]),e.ULS.sendTraceTag(537162631,0,50,"FileOperationsCommandHandler.ReloadWorkbookInEditMode: working on an .ods file")):
ke=Qc.a.veb([108482388]),this.clientWorkflow.ij.Sy(ke),Ie[Gb.a.Aw]=Eb.a.NHg):this.$.ea.ZNf?(e.ULS.sendTraceTag(546111811,0,50,"Password-To-Modify Workbook: User trying to switch to edit-mode."),Ie[Gb.a.Aw]=Eb.a.I0b):Ie[Gb.a.Aw]=this.$.ea.VFc?Eb.a.iXb:Eb.a.lxb};pc.a(Oa).Dy(new $b.a(Eb.a.bD,5,Cb))}}reloadWorkbookInViewMode(){if(this.Ph){Ta.a.Al.U5&&Ta.a.Al.pee();var Oa=this.$;Oa.ea.HBc=!0;W.a.Un&&Kb.f(Oa).sh.$b.blur();pc.a(Oa).Dy(new $b.a(Eb.a.bD,5,()=>{Oa.rP(!Oa.ea.isNamedObjectViewMode,!1);const Cb=
this.clientWorkflow.ij.activityState;Cb[Gb.a.Aw]=Eb.a.wua;Cb[ob.a.p3]=1;Cb[ob.a.o9]=!0;Cb[Hb.a.Jz]=!1;Cb[Hb.a.tFb]=!0;Cb[na.a.ujc]=P.a.dLc}))}}reloadWorkbook(Oa,Cb){if(this.Ph){var yc=this.$;yc.tX&65536&&(yc.ea.HBc=!1,pc.a(yc).Dy(new $b.a(Eb.a.bD,5,()=>{yc.rP(Oa,!0);const Nc=this.clientWorkflow.ij.activityState;Nc[Gb.a.Aw]=Eb.a.FG;Nc[Hb.a.qld]=this.workbookContext.NovMode;Cb||(Nc[ob.a.p3]=1,Nc[ob.a.ojc]=new Xa)})))}}setCalculationMode(Oa,Cb){e.ULS.sendTraceTag(537162629,0,50,`SetCalculationMode ,calculation mode chosen : ${Cb} `);
const yc=this.$.ea.workbookContext.CalcMode;this.$.ea.workbookContext.CalcMode=Cb;const Nc=()=>new Ia(Cb);return ba.a(this.$.userOperationManager,(Id,ke,Ie)=>{var Le=this.$.pa.ta;Id=Hc.c(Id,Aa.EWj(this.$,yc));ke=Hc.b(ke,Aa.DWj(this.$,yc));const wf=Le.Za(9,null);wf.calc_type=Cb;return Ea.h(Le,"SetCalculationOptions",wf,Id,ke,Ie,null,0)},Id=>new la.a(197,0,Id,void 0,Nc),Oa)}static Acf(Oa){Oa.ih&&0<Oa.ih.h1&&Oa.ih.yDd(Cb=>{Cb.TJ()})}static EWj(Oa,Cb){return yc=>{Qc.a.Jk(yc.Errors)&&(Oa.ea.workbookContext.CalcMode=
Cb,e.ULS.sendTraceTag(537162628,0,50,`OnSetCalcModeSuccess: successCallback was called with errors for SetCalculationMode. reverting calc mode to ${Cb}.  Error id names: ${Qc.a.Kh(yc.Errors)}`))}}static DWj(Oa,Cb){return()=>{Oa.ea.workbookContext.CalcMode=Cb;e.ULS.sendTraceTag(537162627,0,50,`OnSetCalcModeFailure: failedCallback was called for SetCalculationMode. reverting calc mode to ${Cb})`)}}};sb.Tte=5E3;sb=Aa=Object(t.__decorate)([Object(Ya.d)(bb.ec),Object(t.__param)(0,Object(bb.Lb)()),Object(t.__param)(1,
Object(bb.je)()),Object(t.__param)(2,Object(bb.id)({k6:!0})),Object(t.__param)(3,Object(bb.C)())],sb);Object(m.a)(sb,"FileOperationsCommandHandler",ea.a,[39]);var nc=a(208),Bb=a(44);class uc{constructor(Oa,Cb){this.start=Oa;this.end=Cb}}Object(m.a)(uc,"SliceByteRange",null,[]);var Pc=a(123),wd=a(237),Md=a(31),Nd=a(106);class ec{constructor(Oa,Cb,yc,Nc){this.tEb=null;this.Lbb=0;this.Wgc=1E3;this.J8=Oa;this.grh=Cb;this.Ahh=yc;this.i9c=Nc}SOk(){this.tEb=ec.h6h(this.J8);const Oa=this.J8.slice(this.tEb.ma(0).start,
this.tEb.ma(0).end);this.Hxe(Oa,0)}Hxe(Oa,Cb){const yc=ec.mLi(this.J8.size,this.tEb.ma(Cb));this.Lbb++;ec.g7h(this.grh,Oa,Nc=>{if(Nc.status===wd.a.dsh)this.hXj(Cb);else if(Nc.status===wd.a.zWa){e.ULS.sendTraceTag(508822418,231,50,"MSO:BlobSlicer: File created successfully");try{var Id;let ke,Ie=Bb.d(Nc.responseText);({hz:ke}=Ie);if(!Ie.returnValue)throw Error.create("Unable to deserialize OneDriveItem response json");(Id=ke)?this.Ahh(Id):(e.ULS.sendTraceTag(508822417,231,10,"MSO:BlobSlicer: OneDriveItem is null"),
this.i9c(2))}catch(ke){e.ULS.sendTraceTag(508822416,231,10,"Exception while parsing OneDriveItemResponse {0}",ke.message),this.i9c(2)}}else this.Eqk(Oa,Cb,Nc.status)},yc)}hXj(Oa){e.ULS.sendTraceTag(508822415,231,50,"MSO:BlobSlicer Slice uploaded successfully. SliceNumber {0}, UploadAttempts {1}",Oa,this.Lbb);this.YEg();var Cb=this.tEb.ma(Oa+1);Cb=this.J8.slice(Cb.start,Cb.end);this.Hxe(Cb,Oa+1)}Eqk(Oa,Cb,yc){1>this.Lbb&&ec.Rnj(yc)?(e.ULS.sendTraceTag(508822414,231,10,"MSO:BlobSlicer: Retrying Slice upload request. Failure statusCode: {0}, attempts {1}",
yc,this.Lbb),l.AFrameworkApplication.pp.Ol(new Pc.a(2,1,this.Wgc,()=>{this.Hxe(Oa,Cb)},42)),this.Wgc*=2):(e.ULS.sendTraceTag(508822413,231,10,"MSO:BlobSlicer: Slice upload request failed, aborting the upload. Failure statusCode: {0}, attempts {1}",yc,this.Lbb),this.YEg(),this.i9c(1,yc))}YEg(){this.Lbb=0;this.Wgc=1E3}static h6h(Oa){const Cb=new nc.a;Oa=Oa.size;const yc=Math.ceil(Oa/5242880);let Nc=0,Id;for(let ke=0;ke<yc;ke++)Id=Math.min(Nc+5242880,Oa),Cb.add(new uc(Nc,Id)),Nc=Id;return Cb}static mLi(Oa,
Cb){const yc=new Nd.a;yc.ga("Content-Range",String.format("bytes {0}-{1}/{2}",Cb.start,Cb.end-1,Oa));yc.ga("Accept","application/json");return yc}static g7h(Oa,Cb,yc,Nc){const Id=new XMLHttpRequest;Id.open("PUT",Oa,!0);if(Nc)for(const ke of Nc)Id.setRequestHeader(ke.key,Md.a.cna(ke.value));Id.onreadystatechange=()=>{4===Id.readyState&&yc(Id)};Id.send(Cb)}static Rnj(Oa){switch(Oa){case wd.a.cie:case wd.a.Pcj:case wd.a.dIh:case wd.a.Dxk:case wd.a.Vyi:return!0;default:return!1}}}Object(m.a)(ec,"BlobSlicer",
null,[]);var gc=a(124);const Mb=()=>"%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M12.9993%2017C12.9993%2016.4484%2012.5522%2016.0013%2012.0006%2016.0013C11.4491%2016.0013%2011.002%2016.4484%2011.002%2017C11.002%2017.5515%2011.4491%2017.9986%2012.0006%2017.9986C12.5522%2017.9986%2012.9993%2017.5515%2012.9993%2017ZM12.7401%209.1467C12.6901%208.78066%2012.3761%208.49876%2011.9964%208.49906C11.5822%208.49939%2011.2467%208.83545%2011.247%209.24966L11.2506%2013.7513L11.2575%2013.853C11.3075%2014.2191%2011.6215%2014.501%2012.0012%2014.5007C12.4154%2014.5003%2012.7509%2014.1643%2012.7506%2013.7501L12.747%209.24846L12.7401%209.1467ZM13.9693%203.65888C13.113%202.11108%2010.8878%202.1111%2010.0316%203.65893L2.28634%2017.6604C1.45678%2019.16%202.5414%2020.9995%204.25518%2020.9995H19.7462C21.46%2020.9995%2022.5446%2019.16%2021.715%2017.6603L13.9693%203.65888ZM11.3442%204.38501C11.6296%203.86907%2012.3713%203.86906%2012.6567%204.38499L20.4025%2018.3865C20.679%2018.8863%2020.3175%2019.4995%2019.7462%2019.4995H4.25518C3.68392%2019.4995%203.32238%2018.8863%203.5989%2018.3865L11.3442%204.38501Z%22%20fill%3D%22%23817400%22%2F%3E%0A%3C%2Fsvg%3E%0A",
sc=(Oa,Cb)=>{appChrome.PRIToastManager.showToastForUploadFile("",Oa,Cb);Oa=new Pc.a(2,l.AFrameworkApplication.fa&&l.AFrameworkApplication.fa.isChangeGateEnabled("FixEarlyToastDismissIssue")?1:2,8E3,xd,0);l.AFrameworkApplication.pp.Ol(Oa)},xd=()=>{appChrome.PRIToastManager.dismissToast()},xb=Oa=>{const Cb='\\/:*?"<>|'.split(""),yc=new Sys.StringBuilder("");if(!Oa||""===Oa)return e.ULS.sendTraceTag(508672207,231,10,"MSO:InsertFileUploaderUtils: Empty File Name"),sc(Object(U.a)("UploadFileWithEmptyFileName"),
Mb()),!1;if(250<Oa.length)return e.ULS.sendTraceTag(508672206,231,10,"MSO:InsertFileUploaderUtils: File Name larger than limit"),Oa=String.format(Object(U.a)("UploadFileWithLargerFileName"),250),sc(Oa,Mb()),!1;let Nc=!1;for(let Id=0;Id<Cb.length;Id++)yc.append(Cb[Id]),yc.append(" "),gc.a(Oa,Cb[Id])&&(Nc=!0);return Nc?(e.ULS.sendTraceTag(508672205,231,10,"MSO:InsertFileUploaderUtils: Invalid character in File Name"),Oa=String.format(Object(U.a)("UploadFileWithInvalidCharacterInFileName"),yc.toString()),
sc(Oa,Mb()),!1):!0};var Lb=a(247),Rc=a(81),nd=a(60);class $d{constructor(){this.vEe=this.Nfc=this.J8=null;this.Y9a=0;this.eoh=1E3;this.jeh=""}A9j(Oa){this.NHc()?e.ULS.sendTraceTag(508822472,231,10,"MSO:CloudFileUploadManager:QueueFileUpload There is already an upload in progress"):Oa?(e.ULS.sendTraceTag(508822470,231,50,"MSO:CloudFileUploadManager: File Queued of size: {0} and type: {1}",Oa.size.toString(),Oa.type),this.J8=Oa,appChrome.PRIToastManager.showToastForUploadFile("",Object(U.a)("UploadFileProcessStartedMessage"),
null,!0),this.Yif()):e.ULS.sendTraceTag(508822471,231,10,"MSO:CloudFileUploadManager:QueueFileUpload Invalid upload context")}NHc(){return!!this.J8}Yif(){let Oa=l.AFrameworkApplication.fa.isChangeGateEnabled("UsePopsServiceForUploadFeature")?String.format("{0}UploadFileToHostHandler.ashx?action=uploadFile&{1}",this.jeh,l.AFrameworkApplication.qo):String.format("UploadFileToHostHandler.ashx?action=uploadFile&{0}",l.AFrameworkApplication.qo);Oa=Rc.a.a_(Oa,"filename",this.J8.name);const Cb=["request-id"];
this.Y9a++;const yc={};yc.ismsa=l.AFrameworkApplication.fa.la("IsO365ConsumerHost");try{this.Dph=Date.now(),l.AFrameworkApplication.$i.Ou(Oa,1,null,yc,!1,2,Nc=>{this.S6h(Nc)},Nc=>{this.Aqk(Nc)},null,void 0,void 0,void 0,3E4,void 0,void 0,void 0,void 0,Cb)}catch(Nc){e.ULS.sendTraceTag(508822469,231,10,"MSO:CloudFileUploadManager: Exception when creating uploadSession {0}",Nc.message),this.e_b(0)}}Aqk(Oa){2>this.Y9a?(e.ULS.sendTraceTag(508822468,231,10,"MSO:CloudFileUploadManager: CreateUploadSession request failed with code: {0}, with correlation and request id {1} and attempts {2}",
Oa.data.httpStatus,Oa.data.responseHeaders,this.Y9a),this.Yif()):(e.ULS.sendTraceTag(508822467,231,10,"MSO:CloudFileUploadManager: CreateUploadSession request failed with code: {0}, with correlation and request id {1} and attempts {2}",Oa.data.httpStatus,Oa.data.responseHeaders,this.Y9a),this.e_b(0,Oa.data.httpStatus))}S6h(Oa){e.ULS.sendTraceTag(508822466,231,50,"MSO:CreateUploadSessionRequestSucceeded:CloudFileUploadManager CloudAttachment request succeeded with code: {0}, with correlation and request id {1} and message {2} and attempts {3}",
Oa.data.httpStatus,Oa.data.responseHeaders,Oa.data.responseData,this.Y9a);try{var Cb;let yc,Nc=Bb.d(Oa.data.responseData);({hz:yc}=Nc);if(!Nc.returnValue)throw Error.create("Unable to deserialize uploadSession response json");(Cb=yc)&&Cb.uploadUrl&&""!==Cb.uploadUrl?this.D7k(Cb.uploadUrl):(e.ULS.sendTraceTag(507901398,231,10,"createUploadSessionRequestSucceeded: upload session created: {0}",Cb?!0:!1),this.e_b(0))}catch(yc){e.ULS.sendTraceTag(508822465,231,10,"MSO:CreateUploadSessionRequestSucceeded:CloudFileUploadManager Exception while parsing OneDriveItemResponse {0}",
yc.message),this.e_b(0)}}D7k(Oa){this.vEe=new ec(this.J8,Oa,Cb=>{this.gXh(Cb)},(Cb,yc)=>{this.e_b(Cb,yc)});l.AFrameworkApplication.pp.Ol(new Pc.a(2,1,this.eoh,()=>{this.vEe.SOk()},42))}gXh(Oa){this.NHc()?(this.Nfc=Oa,this.YY(!0)):e.ULS.sendTraceTag(508822464,231,15,"MSO:CloudFileUploadManager:CompleteUpload There is no upload in progress")}e_b(Oa,Cb){Cb=void 0===Cb?0:Cb;this.NHc()?(e.ULS.sendTraceTag(507901397,231,10,"onFileUploadFailed: failureType {0} with status {1}",Oa,Cb),Oa=this.Ejb(Cb),sc(Oa,
Mb()),this.YY(!1)):e.ULS.sendTraceTag(508822435,231,15,"MSO:CloudFileUploadManager:OnFileUploadFailed There is no upload in progress, failureType {0}",Oa)}Ejb(Oa){switch(void 0===Oa?0:Oa){case 507:return Object(U.a)("UploadFileInsufficientStorageError");default:return Object(U.a)("UploadFileInternalServerError")}}YY(Oa){this.NHc()?(Oa&&(e.ULS.sendTraceTag(508703698,231,50,"MSO:CloudFileUploadManager: File successfully uploaded"),Oa=Date.now()-this.Dph,e.ULS.sendTraceTag(508044241,231,50,"TimeTaken: {0} to upload a file of Size:{1}",
Oa,this.J8.size.toString()),this.J8.name!==this.Nfc.name&&e.ULS.sendTraceTag(508672208,231,50,"MSO:CloudFileUploadManager: Renamed file name"),appChrome.PRIToastManager.dismissToast(),nd.a.V4(this.Nfc.webUrl),Lb.a.dispatch("fileUploadedSuccessfully")),this.J8=null,this.Y9a=0,this.Nfc=null):e.ULS.sendTraceTag(508822434,231,15,"MSO:CloudFileUploadManager: There is no upload in progress")}}Object(m.a)($d,"CloudFileUploadManager",null,[806]);var Td=a(42),He=a(139),oc=a(1282),ld=a(1498),id=a(188);class fc extends ld.a{constructor(Oa,
Cb,yc,Nc,Id,ke,Ie,Le,wf){super(Oa,Cb,yc,Nc,Id,"WACUploadFrame",l.AFrameworkApplication.userSessionId,ke,void 0,void 0===Ie?null:Ie,void 0===wf?!1:wf,"false");this.kRd()}ia(){return id.a.create().toString()}yKg(){}hNf(){}x3a(){}}Object(m.a)(fc,"FileUploadFrame",ld.a,[]);class vc extends oc.a{constructor(Oa,Cb,yc){super(Oa,Cb,yc);this.u8=this.EFe=null;this.BOj=Nc=>{Nc?(Nc=Nc.split("/"),Nc=Nc[Nc.length-1].split("\\"),Nc=Nc[Nc.length-1]):Nc=null;this.i$b(Nc,this.Up)&&this.aVh.A9j(this.Up.AO.files[0])};
this.pYb=0;this.KGb=new nc.a}get Idb(){return this.u8||(this.u8=Td.a.instance.resolve("Common.Utils.IAriaNotifier"))}get aVh(){return this.EFe||(this.EFe=Td.a.instance.resolve("Common.App.UploadFromPC.ICloudFileUploadManager"))}wBk(Oa){this.pYb=Oa}dyk(Oa){this.KGb=Oa}get L7k(){return"InsertFile"}showDialog(){var Oa;if((Oa=this.KGb)&&Oa.count){var Cb=new Sys.StringBuilder(""),yc=Oa.count;for(let Nc=0;Nc<yc-1;Nc++)Cb.append("."),Cb.append(Oa.ma(Nc)),Cb.append(", ");Cb.append(".");Cb.append(Oa.ma(yc-
1));Oa=Cb.toString()}else Oa="";""===Oa?sc(Object(U.a)("UnableToOpenFilePickerDialog"),Mb()):void 0!==window.self.FormData&&null!==window.self.FormData?(this.aHa=!1,this.Up=new fc(document.body,Object(He.a)(this,this.w3a,"onUploadFrameInitialized"),Object(He.a)(this,this.Wia,"uploadResponseReceived"),this.fa,!1,Oa,void 0,void 0,!0)):W.a.gA||W.a.YO||this.E2a&&W.a.KI?e.ULS.sendTraceTag(508699840,231,50,"MSO:InsertFileUploader: Dialog not rendered for OpenFilePickerDirectly: {0}",W.a.gA||W.a.YO):e.ULS.sendTraceTag(508822474,
231,50,"MSO:InsertFileUploader: Dialog not rendered")}w3a(Oa){this.Up=Oa;this.aHa||(this.$1c?(e.ULS.sendTraceTag(508703702,231,50,"MSO:InsertFileUploader: Insert file uploader frame opened"),Oa.pMb(this.BOj)):this.finalizeUpload(Oa,null))}i$b(Oa,Cb){if(!this.bra(Oa,Cb))return!1;if(!this.M9k(Oa))return e.ULS.sendTraceTag(508703700,231,10,"MSO:InsertFileUploader: Invalid File Extension"),sc(Object(U.a)("UploadFileWithInvalidExtension"),Mb()),!1;Oa=this.bsi(this.Up);Cb=this.pYb;e.ULS.sendTraceTag(508822419,
231,50,"{0}:Size:{1}",this.L7k,Oa);if(!(0<Oa&&Oa<=1048576*Cb))return e.ULS.sendTraceTag(508703699,231,10,"MSO:InsertFileUploader: Invalid File Size"),Oa=String.format(Object(U.a)("UploadFileLargerThanMaxSize"),this.pYb),sc(Oa,Mb()),!1;e.ULS.sendTraceTag(508822473,231,50,"MSO:InsertFileUploader: Cloud File Upload of size: {0}",Oa);return!0}M9k(Oa){Oa=RegExp("\\.([a-zA-Z0-9]{1,5})$").exec(Oa);return this.KGb.contains(Oa&&2===Oa.length?Oa[1]:null)}bra(Oa){return xb(Oa)}finalizeUpload(){this.E7k()}bsi(Oa){return Oa.AO.files[0].size}Wia(){}E7k(){this.d0b();
this.Idb.xAa(Object(U.a)("UploadCompletedText"),!0)}}Object(m.a)(vc,"InsertFileUploader",oc.a,[807]);var Tc=a(278);class Bd{constructor(){this.Mh=null}get name(){return"Common.App.UploadFromPC"}init(){}dispose(){}ao(Oa){this.Mh=Oa;this.Mh.register(806,"Common.App.UploadFromPC.ICloudFileUploadManager").hi().mi(()=>new $d);this.Mh.register(807,"Common.IInsertFileUploader").hi().mi(()=>new vc(null,l.AFrameworkApplication.pp,l.AFrameworkApplication.fa))}static main(){Tc.a.instance.Lo(new Bd,7)}}Object(m.a)(Bd,
"FileUploaderPackage",null,[12,13]);Object(Ya.b)(bb.sd,{yk:"singleton"})(()=>{Type.registerNamespace("Common.App.UploadFromPC");Bd.main();return Td.a.instance.resolve("Common.IInsertFileUploader")});var Fd=a(28),le=a(134);let dc=class{constructor(Oa,Cb){this.YFd=(yc,Nc,Id,ke,Ie)=>1===Id?32:yc===Fd.a.oAa&&2===Id?(yc=this.$.pa.ta.Jh(),Ea.D(this.$.pa.ta,Ie[0],Ie[1],null,null,yc),32):8;this.$=Oa;this.Wp=Cb;bb.lf.Ha()&&this.Wp.Hh(Fd.a.oAa,le.a.frame,this.YFd)}Bi(){return!1}executeCommand(Oa,Cb,yc){Oa=
2;switch(Cb.command){case -309686558:Oa=this.Wp.Xj(Fd.a.saveACopy,2,yc);break;case 617689800:Oa=this.Wp.Xj(Fd.a.saveToCloudStorage,2,yc);break;case -1244760097:Oa=this.Wp.Xj(Fd.a.saveToSharePoint,2,yc)}return 2===Oa&&Cb?ma.a(Cb.command):gb.Task.Va(!0)}ni(Oa,Cb){Oa=!1;switch(Cb.command){case -1244760097:case -309686558:case 617689800:Oa=!0,e.ULS.shipAssertTag(537153984,0,this.$.iaa,"Command execute requested for SaveAs operation when data duplication is disallowed.")}return Oa}Ji(){return!1}};dc=Object(t.__decorate)([Object(Ya.d)(bb.lf),
Object(t.__param)(0,Object(bb.Lb)()),Object(t.__param)(1,Object(bb.f)()),Object(t.__param)(2,Object(bb.ab)())],dc);Object(m.a)(dc,"SaveToHostCommandHandler",null,[39]);let Uc=class{constructor(Oa,Cb){this.$=Oa;this.Wp=Cb}Bi(Oa){switch(Oa){case -309686558:return 8===this.Wp.Gk(Fd.a.saveACopy,1,null);case 617689800:return 8===this.Wp.Xj(Fd.a.saveToCloudStorage,1,null);case -1244760097:return 8===this.Wp.Xj(Fd.a.saveToSharePoint,1,null)}return!1}dispose(){this.$=null}};Uc=Object(t.__decorate)([Object(Ya.d)(bb.mf),
Object(t.__param)(0,Object(bb.Lb)()),Object(t.__param)(1,Object(bb.f)())],Uc);Object(m.a)(Uc,"SaveToHostManager",null,[765,2]);var kb=a(420),rb=a(901),cc=a(526),mc=a(133),Sa;(function(Oa){Oa[Oa.iql=0]="myFiles";Oa[Oa.recent=1]="recent";Oa[Oa.Ohl=2]="currentFolder";Oa[Oa.Esl=3]="yourPhone"})(Sa||(Sa={}));Object(m.b)("SharedFilePickerLandingLocation",Sa);class pb{constructor(Oa){this.RZa=this.qsb=null;this._initialized=!1;this.IPd=Oa}uXa(Oa){this._initialized||(Oa.Tq(u.a.Zxg),Oa.Ip(u.a.Zxg,Object(He.a)(this,
this.nVj,"onReceivedPickerResponse")),this._initialized=!0)}Lyc(Oa){return this.RZa=new Promise((Cb,yc)=>{const Nc={};Nc[M.a.wrg]=Oa;this.qsb=(Id,ke)=>{""===ke?(e.ULS.sendTraceTag(572548163,306,50,"Resolving Promise with Picker Data"),Cb(Id)):("Canceled"===ke?e.ULS.sendTraceTag(572548164,306,50,ke):e.ULS.sendTraceTag(556901065,306,10,ke),yc(ke))};this.IPd.execute(Id=>{this.uXa(Id);Id.sendMessage(u.a.e_j,Nc)})})}nVj(Oa){this.qsb(Oa.Values[M.a.wvk],void 0===Oa.Values[M.a.U$d]||null===Oa.Values[M.a.U$d]?
"":Oa.Values[M.a.U$d])}UWd(){return l.AFrameworkApplication.fa.la("UiHostCommonFilePicker")}Owd(Oa,Cb,yc,Nc,Id,ke,Ie){var Le=void 0===Le?null:Le;const wf={};wf[M.a.hvk]=Oa;wf[M.a.titleText]=Cb;wf[M.a.aDh]=yc;wf[M.a.bDh]=Nc;wf[M.a.cDh]=!1;wf[M.a.hci]=!0;wf[M.a.vti]=Id;wf[M.a.S2j]=ke;wf[M.a.R2j]=Sa[Ie];mc.a("isSharedUXDarkModeOn")&&appChrome.api.isSharedUXDarkModeOn()&&(wf[M.a.yrg]="Dark");Le&&(null!=Le.eod&&(wf[M.a.eod]=Le.eod),null!=Le.yQd&&(wf[M.a.yQd]=Le.yQd),Le.zQd&&(wf[M.a.zQd]=Le.zQd));return wf}}
Object(m.a)(pb,"SharedFilePickerManager",null,[836]);class Ac{constructor(){this.Mh=null}get name(){return"Common.App.SharedFilePicker"}ao(Oa){this.Mh=Oa;Oa.register(pb,"Common.App.SharedFilePicker.SharedFilePickerManager").as("Common.App.SharedFilePicker.ISharedFilePicker").hi().mi(()=>new pb(Object(cc.a)()))}init(){l.AFrameworkApplication.fa.ty(()=>{this.GSb()})}GSb(){Td.a.instance.resolve("Common.App.SharedFilePicker.ISharedFilePicker")}dispose(){}static main(){Tc.a.instance.Lo(new Ac)}}Object(m.a)(Ac,
"SharedFilePickerPackage",null,[12,13]);const yd=()=>{Type.registerNamespace("Common.App.SharedFilePicker");Ac.main()};Object(Ya.b)(bb.Bf,{yk:"singleton"})(()=>No(function*(){return Td.a.instance.resolve("Common.App.SharedFilePicker.ISharedFilePicker")}));class vb extends kb.a{constructor(Oa){super();this.$=Oa;this.Bl()}static Aa(Oa){const Cb=new vb(Oa);Oa.ka.ph(507,Cb);Cb.create()}create(){this.Yj(Object(rb.a)(this.$.ka,506,()=>{yd();return Td.a.instance.resolve("Common.App.SharedFilePicker.ISharedFilePicker")}))}}
Object(m.a)(vb,"SharedFilePickerFactory",kb.a,[]);let Sc=class{constructor(Oa){this.KGb=new nc.a("xlsx xlsb xls xlsm xlb xlc xlt xltx xltm xlm xla xll xlam xlw excel csv".split(" "));this.pYb=100;this.F7k=()=>{l.AFrameworkApplication.$i.Cca||e.ULS.sendTraceTag(508303134,231,50,"Received an empty AAD token");const Cb=this.c6h();if(!Cb)return e.ULS.sendTraceTag(508303133,231,50,"Failed to invoke the insert file dialog flow"),2;Cb();return 32};this.tad=Oa}Bi(){return!1}executeCommand(Oa,Cb){Oa=2;const yc=
Cb.command;switch(yc){case 564066394:Oa=this.F7k()}return 2===Oa&&Cb?ma.a(yc):gb.Task.Va(!0)}ni(Oa,Cb){switch(Cb.command){case 564066394:return!0;default:return!1}}Ji(){return!1}c6h(){return()=>{this.tad.wBk(this.pYb);this.tad.dyk(this.KGb);this.tad.showDialog()}}};Sc=Object(t.__decorate)([Object(Ya.d)(bb.vg),Object(t.__param)(0,Object(bb.sd)())],Sc);Object(m.a)(Sc,"UploadFromDesktopCommandHandler",null,[39]);class hd extends Ka.a{constructor(){super();this.Bh=0;this.Yh(1,Object(U.a)("DialogClose"))}displayError(Oa){this.jG(Oa,
Object(U.a)("DefaultDialogTitle"),Object(U.a)("OneDriveContactError"),null)}gtc(Oa){this.jG(Oa,Object(U.a)("DefaultDialogTitle"),Object(U.a)("OneDriveContactError"),null,!0)}}Object(m.a)(hd,"ErrorDialog",Ka.a,[818]);class qc{TAf(){e.ULS.sendTraceTag(24134234,352,50,"Returning endpoint for ODC");const Oa=new Y.a;Oa.setResult("api.onedrive.com");return Oa.task}}Object(m.a)(qc,"OneDriveConsumerEndpointHelper",null,[784]);var Lc=a(85),bd=a(525),jd=a(290);class Yd{constructor(Oa,Cb,yc,Nc){this.GSa=this.qha=
null;this.rhd=this.thd=!1;this.Sab=null;this.Ga=Oa;this.D9a=Cb;this.yab=yc;this.OD=Nc}get D3e(){return this.D9a}get fa(){return this.Ga}Vjb(){this.Sab||(this.Sab=this.Rqb?jd.a.create(this.Rqb,null,null,null,!1):null);return this.Sab}setup(Oa){this.GSa=Oa;this.thd||this.rhd?this.thd&&this.GSa&&this.GSa(!0):(Oa=this.Vjb())?(this.rhd=!0,Oa.Bob.continueWith(Cb=>{this.lUj(Cb)}),bd.a.sva(Oa)):(e.ULS.sendTraceTag(20509837,352,15,"Failure with OneDrive API download as the onedrive url received is empty."),
this.GSa(!1))}J7d(Oa){e.ULS.sendTraceTag(20509838,352,15,"Failure during OneDrive API download: {0}",Oa.exception?Oa.exception.toString():"No error detail.")}lUj(Oa){this.rhd=!1;if(Oa.om)this.J7d(Oa),this.GSa(!1);else try{this.thd=!0,e.ULS.sendTraceTag(17909022,352,50,"Initializing OneDrive API"),this.VQd(),e.ULS.sendTraceTag(17909023,352,50,"OneDrive API is initialized."),this.GSa(!0)}catch(Cb){e.ULS.sendTraceTag(20555412,352,10,"Failed during OneDrive API init: {0}",Cb.toString()),this.GSa(!1)}}startPicker(Oa){this.qha=
Oa;this.yab?e.ULS.sendTraceTag(23881878,216,50,"In limited edit mode, will not show Picker."):(e.ULS.sendTraceTag(23881877,216,50,"Not in limited edit mode, will show file picker."),this.setup(Object(He.a)(this,this.b6d,"onApiReady")))}b6d(Oa){Oa?this.eJc():this.lp()}lp(){this.OD().displayError(Lc.a.yZj)}f1(Oa){e.ULS.sendTraceTag(17909057,352,50,"Success Callback called. Calling callback function.");this.qha&&this.qha(!0,Oa)}dispose(){this.Sab&&this.Sab.dispose()}}Object(m.a)(Yd,"AOneDriveFilePickerApiManager",
null,[823,2]);class te extends Yd{constructor(Oa,Cb,yc,Nc,Id,ke){super(Cb,yc,Nc,ke);this.Tk=null;this.wda=Oa;this.iph=Id}get Rqb(){return this.fa.Xa("OneDriveApiUrl")}start(Oa,Cb){this.Tk=Oa;this.startPicker(Cb)}VQd(){WL.init(1===this.D3e||2===this.D3e?{["client_id"]:this.fa.appSettings.UploadToSkyDriveClientId}:{["client_id"]:this.fa.appSettings.UploadToSkyDriveClientId,["env"]:"INT"})}startPicker(Oa){this.qha=Oa;!this.yab&&this.wda.E_a?(e.ULS.sendTraceTag(17909025,352,50,"User is signed in. We will show file picker."),
this.setup(Object(He.a)(this,this.b6d,"onApiReady"))):(e.ULS.sendTraceTag(17909026,352,50,"User is not signed in. show need to sign in dialog."),this.iph())}eJc(){try{e.ULS.sendTraceTag(17909027,352,50,"Launching file dialogue"),WL.fileDialog(this.Tk).then(Object(He.a)(this,this.f1,"onSuccess"),Object(He.a)(this,this.pha,"onFailure"))}catch(Oa){e.ULS.sendTraceTag(17909056,352,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",Oa,Oa.stack),this.lp()}}pha(Oa){if(Oa&&Oa.error){if("user_canceled"===
Oa.error.code){e.ULS.sendTraceTag(17909058,352,50,"User canceled.");return}e.ULS.sendTraceTag(17909059,352,50,"File Dialog returned with error code:{0}, and error message: {1}",Oa.error.code,Oa.error.message)}else e.ULS.sendTraceTag(17909060,352,50,"File Dialog returned with no response");this.qha&&this.qha(!1,Oa);this.lp()}}Object(m.a)(te,"OneDriveFilePickerApiManagerV5",Yd,[]);class oe extends Yd{constructor(Oa,Cb,yc,Nc,Id){super(Oa,Cb,yc,Nc);this.Cdc=this.FQe=null;this.E_c=()=>{this.Cdc.style.visibility=
"hidden"===this.Cdc.style.visibility?"":"hidden"};this.bhh=Id;this.options={};this.options.clientId=this.fa.Xa("OneDriveApiV7ClientId");this.options.cancel=this.E_c}get Rqb(){return this.fa.Xa("OneDriveApiV72Url")}start(Oa,Cb){this.Cdc=Cb;const yc=this.bhh.TAf();yc.continueWith(()=>{e.ULS.sendTraceTag(24134241,352,50,"Fetch endpoint task completed, attempting to start OneDrive picker");this.FQe=yc.result;this.startPicker((Nc,Id)=>{this.E_c();Oa(Nc,Id)})},3);yc.continueWith(()=>{e.ULS.sendTraceTag(24134242,
352,15,yc.exception.message);this.E_c()},5)}VQd(){this.options.success=Oa=>{const Cb={};Cb.data=Oa;this.f1(Cb)};this.options.error=Oa=>{const Cb={};Cb.error=Oa;this.pha(Cb)};this.options.advanced={};this.options.advanced.linkType="share";this.options.advanced.endpointHint=this.FQe;this.options.advanced.iframeParentDiv=this.Cdc}eJc(){try{e.ULS.sendTraceTag(22090007,352,50,"Launching OneDrive file picker dialog"),this.E_c(),OneDrive.open(this.options)}catch(Oa){e.ULS.sendTraceTag(22090008,352,10,"Opening OneDrive file picker threw an exception: {0}",
Oa.message),this.lp()}}pha(Oa){this.qha&&this.qha(!1,Oa);this.lp()}}Object(m.a)(oe,"OneDriveFilePickerApiManagerV7",Yd,[]);class Kd extends Yd{constructor(Oa,Cb,yc,Nc){super(Oa,Cb,yc,Nc);this.Hdh=Oa;this.options={};this.options.advanced={};this.options.action="query";this.options.clientId=this.fa.Xa("OneDriveApiV72ClientId");this.options.advanced.trapFocus=!0}get Rqb(){return this.fa.Xa("OneDriveApiV72Url")}start(Oa,Cb,yc,Nc){this.options.advanced.iframeParentDiv=yc;this.options.advanced.endpointHint=
Nc;this.options.cancel=Cb;this.Hdh.la("OneDriveApiV72RecentsViewEnabled")&&(this.options.advanced.navigation={},this.options.advanced.navigation.entryLocation={},this.options.advanced.navigation.entryLocation.oneDrive={},this.options.advanced.navigation.entryLocation.oneDrive.recent={});this.startPicker(Oa)}startPicker(Oa){this.qha=Oa;this.yab?e.ULS.sendTraceTag(24391838,216,50,"In limited edit mode, will not show Picker."):(e.ULS.sendTraceTag(24391837,216,50,"Not in limited edit mode, will show file picker."),
this.setup(Object(He.a)(this,this.b6d,"onApiReady")))}VQd(){this.options.success=Oa=>{const Cb={};Cb.data=Oa;this.f1(Cb)};this.options.error=Oa=>{const Cb={};Cb.error=Oa;this.pha(Cb)}}eJc(){try{e.ULS.sendTraceTag(23881879,216,50,"Launching OneDrive file picker dialog"),OneDrive.save(this.options)}catch(Oa){e.ULS.sendTraceTag(23881880,216,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",Oa.message,Oa.stack),this.lp()}}J7d(Oa){e.ULS.sendTraceTag(25180160,216,15,"Failure during OneDrive API download: {0}",
Oa.exception?Oa.exception.toString():"No error detail.");bd.a.Ahk(this.Rqb);this.Sab=null}lp(){this.OD().gtc(Lc.a.Hsk)}pha(Oa){this.qha&&this.qha(!1,Oa)}}Object(m.a)(Kd,"OneDriveFilePickerApiManagerV72",Yd,[]);class Ee{constructor(Oa){this.olsSessionId=this.value=this.key=null;this.olsSessionId=Oa}}Object(m.a)(Ee,"IExtraData",null,[]);class rc extends Kd{constructor(Oa,Cb,yc,Nc){super(Oa,Cb,yc,Nc);this.options.advanced.filter=Oa.Xa("OneDriveApiV72Filter")||"folder,photo";this.options.advanced.linkType=
"download";this.options.multiSelect=l.AFrameworkApplication.M3e;Oa.la("OneDriveApiV72CommandModeEnabled")&&(this.options.commandMode=Oa.Xa("OneDriveApiV72CommandMode")||"none");Oa.la("OneDriveApiV72QosExtraDataEnabled")&&(this.options.qosExtradata=new Ee(l.AFrameworkApplication.userSessionId))}get Rqb(){return this.fa.Xa("OneDriveApiV72Url")}eJc(){try{e.ULS.sendTraceTag(26071182,352,50,"Launching OneDrive file picker dialog with filter: {0}, commandMode: {1}, QosExtraData: {2} officeSessionId: {3}",
this.options.advanced.filter,this.options.commandMode,this.options.qosExtradata?this.options.qosExtradata.olsSessionId:"",l.AFrameworkApplication.userSessionId),OneDrive.open(this.options)}catch(Oa){e.ULS.sendTraceTag(26071183,352,10,"Opening OneDrive file picker fail. Exception: {0}, Callstack: {1}.",Oa.message,Oa.stack),this.lp()}}}Object(m.a)(rc,"OneDriveFilePickerApiOpenManagerV72",Kd,[]);class fd{constructor(Oa){this.Fs=null;this.dOi=Cb=>{if(Cb.data.httpStatus===wd.a.m1b&&"X-NewKey"in Cb.data.responseHeaders){e.ULS.sendTraceTag(24134236,
352,50,"GetMoreInfo request failed due to bad canary. Updating with new canary and resending");const yc={};yc["X-Key"]=Cb.data.responseHeaders["X-NewKey"];this.ple(yc)}else 0<this.tgd?(e.ULS.sendTraceTag(24134237,352,50,"GetMoreInfo request failed, attmepting again. {0} retries remaining",this.tgd),this.tgd--,this.ple()):(e.ULS.sendTraceTag(24134238,352,50,"GetMoreInfo request failed, and no more retries remaining. Faulting task"),this.Fs.setException(Error.create("GetMoreInfo request failed and no more retries remain")))};
this.fOi=Cb=>{"PersonalFileStorageUrl"in Cb.data.responseHeaders&&""!==Cb.data.responseHeaders.PersonalFileStorageUrl?(e.ULS.sendTraceTag(24134239,352,50,"Successfully received an ODB endpoint"),this.Fs.setResult(Cb.data.responseHeaders.PersonalFileStorageUrl)):(e.ULS.sendTraceTag(24134240,352,50,"GetMoreInfo request was successful but didn't return an ODB endpoint"),this.Fs.setException(Error.create("GetMoreInfo request succeeded but did not have ODB endpoint")))};this.vn=Oa;this.tgd=3}TAf(){this.Fs=
new Y.a;e.ULS.sendTraceTag(24134235,352,50,"Sending initial request for OneDrive for Business Endpoint");this.ple();return this.Fs.task}ple(Oa){Oa=void 0===Oa?null:Oa;const Cb=String.format("GetMoreInfoHandler.ashx?{0}",l.AFrameworkApplication.Oea);this.vn.Tda(Cb,1,null,Oa,["PersonalFileStorageUrl","X-NewKey"],!1,2,this.fOi,this.dOi,null,void 0,void 0,void 0,void 0,"21")}}Object(m.a)(fd,"OneDriveForBusinessEndpointHelper",null,[784]);var Ed=a(650);class Rd{constructor(){this.Mh=null}get name(){return"Common.App.OneDriveFilePickerApi"}init(){}dispose(){}ao(Oa){this.Mh=
Oa;this.Mh.register(te,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV5").as("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager").hi().mi(()=>new te(Ed.a.instance,l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,l.AFrameworkApplication.limitedEdit,Ka.a.jSg,()=>new hd));l.AFrameworkApplication.gXd?this.Mh.register(784,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").hi().mi(()=>new qc):this.Mh.register(784,"Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper").hi().mi(()=>
new fd(l.AFrameworkApplication.$i));this.Mh.register(oe,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV7").hi().mi(()=>new oe(l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,l.AFrameworkApplication.limitedEdit,()=>new hd,Td.a.instance.resolve("Common.App.OneDriveFilePickerApi.IOneDriveApiEndpointHelper")));this.Mh.register(Kd,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV72").hi().mi(()=>new Kd(l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,l.AFrameworkApplication.limitedEdit,
()=>new hd));this.Mh.register(rc,"Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiOpenManagerV72").hi().mi(()=>new rc(l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,l.AFrameworkApplication.limitedEdit,()=>new hd))}static main(){Tc.a.instance.Lo(new Rd)}}Object(m.a)(Rd,"PackageManager",null,[12,13]);const Fe=()=>Td.a.instance.resolve("Common.App.SaveAsToHost.IUploadToHostManager"),Ae=()=>Td.a.instance.resolve("Common.App.SaveAsToHost.IErrorRetryDialogFactory");class We extends Ka.a{constructor(Oa,
Cb){super();this.jsa=!1;this.Fz=null;this.gje=yc=>{1===yc?(e.ULS.sendTraceTag(8194010,216,50,"User click to retry button in error dialog."),this.Fz?this.$c.Xj(Fd.a.$Na,2,[this.Fz,this.jsa]):this.$c.Gk(Fd.a.$Na,2)):e.ULS.sendTraceTag(8194011,216,50,"User cancel the error dialog.")};this.$c=Oa;this.fDa=Cb;this.VOa=!1}displayError(Oa,Cb,yc){this.Fz=Cb;this.jsa=yc;e.ULS.sendTraceTag(8194008,216,50,"Display error with code:{0}, overwriteTarget:{1}.",Oa,yc);Oa=this.IVa(Oa);0===Oa?(this.Bh=6,this.Yh(0,Object(U.a)("DialogClose"))):
(this.Bh=0,this.Yh(1,Object(U.a)("DialogClose")));0===Oa&&e.ULS.sendTraceTag(8194009,216,50,"Show standard error dialog.");this.jG(Lc.a.Gsk,this.Ajb(Oa),this.wyc(Oa,Cb),this.gje,!0)}IVa(Oa){return 0>Oa||6<Oa?(e.ULS.sendTraceTag(8194012,216,15,"Unexpected error code {0}.",Oa),0):Oa}wyc(Oa,Cb){Oa=this.IVa(Oa);return this.fDa?[Object(U.a)("FailToSaveFile"),Object(U.a)("InvalidFileNameAllowPercentOctothorpe"),Object(U.a)("EmptyNameText"),Object(U.a)("InvalidPermissionText"),String.format(Object(U.a)("OverwriteTargetText"),
Cb),Object(U.a)("LockTargetText"),Object(U.a)("InvalidFileNameDisallowPercentOctothorpe")][Oa]:[Object(U.a)("FailToSaveFile"),Object(U.a)("InvalidFileNameText"),Object(U.a)("EmptyNameText"),Object(U.a)("InvalidPermissionText"),String.format(Object(U.a)("OverwriteTargetText"),Cb),Object(U.a)("LockTargetText"),Object(U.a)("InvalidFileNameText")][Oa]}Ajb(Oa){Oa=this.IVa(Oa);return[Object(U.a)("GeneralFailTitle"),Object(U.a)("InvalidFileNameTitle"),Object(U.a)("EmptyNameTitle"),Object(U.a)("GeneralFailTitle"),
Object(U.a)("GeneralFailTitle"),Object(U.a)("GeneralFailTitle"),Object(U.a)("InvalidFileNameTitle")][Oa]}}Object(m.a)(We,"ErrorRetryDialog",Ka.a,[844]);class ve extends Ka.a{constructor(Oa,Cb){super();this.jsa=!1;this.Fz=null;this.VLb=480;this.yqk=yc=>{1===yc?(e.ULS.sendTraceTag(507388501,216,50,"User click to retry button in error dialog."),this.gTe?this.$c.Gk(this.gTe,2):this.Fz?this.$c.Xj(Fd.a.$Na,2,[this.Fz,this.jsa]):this.$c.Gk(Fd.a.$Na,2)):e.ULS.sendTraceTag(507388500,216,50,"User cancel the error dialog.")};
this.$c=Oa;this.fDa=Cb;this.VOa=!1}displayError(Oa,Cb,yc,Nc){this.Fz=Cb;this.jsa=yc;this.gTe=Nc;this.maxWidth=this.VLb;e.ULS.sendTraceTag(507388505,216,50,"Display error with code:{0}, overwriteTarget:{1}.",Oa,yc);Oa=this.IVa(Oa);0===Oa&&e.ULS.sendTraceTag(507388504,216,50,"Show standard error dialog.");4===Oa||5===Oa?(e.ULS.sendTraceTag(507388503,216,50,"show retry dialog."),this.Bh=1,this.Yh(1,Object(U.a)("CopyFailedAsNameExistsDialogButton")),this.Yh(0,Object(U.a)("DialogClose")),this.Io(this.Ajb(Oa),
this.wyc(Oa,this.Fz),2,this.yqk)):(this.Bh=6,this.Yh(0,Object(U.a)("DialogGotit")),this.Io(this.Ajb(Oa),this.wyc(Oa,this.Fz),2))}IVa(Oa){return 0>Oa||6<Oa?(e.ULS.sendTraceTag(507388502,216,15,"Unexpected error code {0}.",Oa),0):Oa}wyc(Oa,Cb){Oa=this.IVa(Oa);return this.fDa?[Object(U.a)("CopyFailedDialogDescription"),Object(U.a)("InvalidFileNameAllowPercentOctothorpe"),Object(U.a)("EmptyNameText"),Object(U.a)("InvalidPermissionText"),String.format(Object(U.a)("CopyFailedAsNameExistsDialogDescription"),
Cb),String.format(Object(U.a)("CopyFailedAsNameExistsDialogDescription"),Cb),Object(U.a)("InvalidFileNameDisallowPercentOctothorpe")][Oa]:[Object(U.a)("CopyFailedDialogDescription"),Object(U.a)("InvalidFileNameText"),Object(U.a)("EmptyNameText"),Object(U.a)("InvalidPermissionText"),String.format(Object(U.a)("CopyFailedAsNameExistsDialogDescription"),Cb),String.format(Object(U.a)("CopyFailedAsNameExistsDialogDescription"),Cb),Object(U.a)("InvalidFileNameText")][Oa]}Ajb(Oa){Oa=this.IVa(Oa);return[Object(U.a)("CopyFailedDialogTitle"),
Object(U.a)("InvalidFileNameTitle"),Object(U.a)("EmptyNameTitle"),Object(U.a)("GeneralFailTitle"),Object(U.a)("CopyFailedAsNameExistsDialogTitle"),Object(U.a)("GeneralFailTitle"),Object(U.a)("InvalidFileNameTitle")][Oa]}}Object(m.a)(ve,"ErrorRetryDialogV1",Ka.a,[844]);class Ze{constructor(Oa,Cb){this.Ga=Oa;this.$c=Cb;this.fDa=this.Ga.la("SaveToHostWithExtraCharsInFileName")}create(){var Oa;return(null===(Oa=l.AFrameworkApplication.fa)||void 0===Oa?0:Oa.la("SaveAsDialogImprovementsEnabled"))?new ve(this.$c,
this.fDa):new We(this.$c,this.fDa)}}Object(m.a)(Ze,"ErrorRetryDialogFactory",null,[833]);var Oe=a(52);class Nf extends B.a{constructor(Oa,Cb,yc,Nc,Id,ke,Ie){Ie=void 0===Ie?null:Ie;super();this.K8=null;this.$c=Cb;this.ija=Nc;this.LEa=ke;this.Ga=Oa;this.OD=Id;this.vm=yc;this.fDa=this.Ga.la("SaveToHostWithExtraCharsInFileName");this.Tk=Ie;this.Yh(1,Object(U.a)("SaveButtonLabel"))}get ra(){return this.vm}Hbi(Oa,Cb){this.z7(1,!!Oa&&Oa!==Cb);this.K8=document.getElementById(Nf.owf);Oe.a.addHandler(this.K8,
"change",Object(He.a)(this,this.OMc,"onFileNameChange"));Oe.a.addHandler(this.K8,"input",Object(He.a)(this,this.OMc,"onFileNameChange"));this.K8.focus()}qEd(Oa){return this.fDa?(new RegExp("["+this.Guc('\\/:*?"<>|')+"]")).test(Oa):(new RegExp("["+this.Guc('\\/:*?"<>|#{}%~&')+"]")).test(Oa)}Guc(Oa){return Oa.replace(RegExp("[.*+?|()\\[\\]{}\\\\]","g"),"\\\\$&")}w0i(){const Oa=Md.a.kz(l.AFrameworkApplication.Qt.ov);this.z7(1,!!this.K8&&""!==this.K8.value&&this.K8.value!==Oa)}OMc(){this.K8&&window.setTimeout(()=>
{this.w0i()},0)}PNb(Oa,Cb){if(1!==Oa)e.ULS.sendTraceTag(23881882,216,50,"User click cancel to cancel upload file in file name dialog.");else{Oa=Cb[Nf.owf];Cb=Nf.gqg in Cb?Cb[Nf.gqg]:!1;e.ULS.sendTraceTag(23881883,216,50,"User click save to upload file with new name {0} and overwrite the target {1}.",Md.a.zRc(Oa),Cb);const yc=Md.a.H$(l.AFrameworkApplication.fileName);(Oa=Oa?Oa.trim():null)&&""!==Oa&&""!==yc||1===this.ra.state?this.qEd(Oa)?this.OD.create().displayError(1,Oa,Cb):this.LEa.Y1(Oa+yc,Cb,
this.Tk):this.OD.create().displayError(2,Oa,Cb)}}dispose(){this.K8&&(Oe.a.removeHandler(this.K8,"change",Object(He.a)(this,this.OMc,"onFileNameChange")),Oe.a.removeHandler(this.K8,"input",Object(He.a)(this,this.OMc,"onFileNameChange")),this.K8=null);super.dispose()}}Nf.owf="txtFileName";Nf.gqg="chkOverwrite";Object(m.a)(Nf,"FileNameDialogBase",B.a,[]);class Zf{static get Po(){return B.a.UA(Zf.$v,Object(U.a)("SaveACopyFileName"),Object(U.a)("SaveAsToHostOverwrite"))}}Zf.$v="<div class='WACDialogRow' id='DocumentFolderBlock'> <label id='lblFolderName' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div> <div class='WACDialogRow' id='OverwriteBlock'> <span id='OverwriteBlockSpan' class='WACDialogSpan'><input type='checkbox' id='chkOverwrite' class='WACDialogCheckBox'></input> <label id='lbcOverwrite' class='\"WACDialogInlineLabel\"' for='chkOverwrite'>{1}</label></span> </div>";
Object(m.a)(Zf,"FileNameDialogHtml",null,[]);class Rb extends Nf{constructor(Oa,Cb,yc,Nc,Id,ke){super(Oa,Cb,yc,Nc,Id,ke);this.Po=Zf.Po;this.Lk="FileNameDialog-SaveAsToHost"}bU(Oa,Cb){const yc=Md.a.kz(l.AFrameworkApplication.Qt.ov);Cb={["txtFileName"]:Oa||yc,["lblFolderName"]:Object(U.a)("ToCurrentFolder"),["chkOverwrite"]:Cb};this.initializeAndShow(Object(U.a)("SaveAs"),Object(He.a)(this,this.PNb,"fileNameDialogHandler"),Cb);this.Hbi(Oa,yc)}}Object(m.a)(Rb,"FileNameDialog",Nf,[845]);class Vb{constructor(Oa,
Cb,yc,Nc,Id,ke){this.$c=Cb;this.Ga=Oa;this.ija=Nc;this.LEa=ke;this.OD=Id;this.vm=yc}create(){return new Rb(this.Ga,this.$c,this.vm,this.ija,this.OD,this.LEa)}}Object(m.a)(Vb,"FileNameDialogFactory",null,[832]);var Cc=a(598);class rg{constructor(Oa,Cb,yc){this.GHg=(Nc,Id,ke,Ie,Le)=>Id.contextId!==le.a.frame||Nc!==Fd.a.$Na?2:this.Ga.la("SaveAsToHostBrsIsEnabled")?1===ke?Cc.SessionStatusManager.instance.Fkb||l.AFrameworkApplication.Cga?8:32:2===ke?(e.ULS.sendTraceTag(8194015,216,50,"User clicked on SaveAsToHost button from the backstage."),
Nc=this.h9c.create(),Le&&Object.getType(Le)===Array&&2===Le.length?Nc.bU(Le[0],!!Le[1]):Nc.bU(null,!1),32):8:8;this.LEa=yc;this.h9c=Cb;this.Ga=Oa}ko(){2===l.AFrameworkApplication.ra.$d.Om?l.AFrameworkApplication.jh.Vk(Fd.a.$Na,le.a.frame,this.GHg,4):l.AFrameworkApplication.jh.Hh(Fd.a.$Na,le.a.frame,this.GHg)}}Object(m.a)(rg,"SaveAsToHostActor",null,[]);var yf=a(950);class jg{constructor(Oa,Cb,yc,Nc,Id,ke,Ie,Le){var wf;this.Nu=null;this.jsa=this.JRa=!1;this.Tk=this.Fz=null;this.Udc=this.yL=!1;this.Wsa=
null;this.Ga=Cb;this.tka=this.Ga.appSettings.SaveAsToHostWebServiceBase;this.fLe=Nc;this.wDb=Id;this.vn=yc;this.OD=ke;this.oo=Le;this.vm=Ie;this.$c=Oa;this.LZ=Cb.Xa("SaveAsToHostUploadHandler")||"hostuploadhandler.ashx";this.yL=Cb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OpenCopyFileInNewTabEnabled",!1);this.Udc=null===(wf=l.AFrameworkApplication.fa)||void 0===wf?void 0:wf.la("SaveAsDialogImprovementsEnabled")}b7b(){1!==this.vm.state&&(this.Nu=this.wDb(),this.Nu.message=Object(U.a)("CommentProgressTooltip"),
this.Nu.Bh=5,this.Nu.hC=!1,this.Nu.UOa(Object(U.a)("DefaultDialogTitle"),null,null))}S1(Oa){Oa=void 0===Oa?0:Oa;1!==this.vm.state&&this.OD.create().displayError(Oa,this.Udc?this.Fz:Md.a.kz(this.Fz),this.jsa,this.Udc?this.doh:void 0)}O4a(){const Oa=this.Ga.appSettings.BreadcrumbFolderUrl;this.yL?e.ULS.sendTraceTag(8194016,219,15,"UploadToHostManager.RedirectToFolder: Opening Saved Document Folder in new tab."):e.ULS.sendTraceTag(8194016,216,50,"Redirecting to OneDrive for business Folder.");nd.a.dm(Oa,
nd.a.q2(this.yL?4:3),void 0,"UploadToHostManager.RedirectToFolder")}N4a(Oa){let Cb=!1,yc=!1;this.Ga&&(Cb=this.Ga.la("SaveACopyIsEnabledForUiHost"),yc=this.Ga.la("UiHostSupportsDocRebootFeatures"));e.ULS.sendTraceTag(8194017,216,50,"Redirecting to edit url. IsEnabledForUiHost {0} uiHostSupportsFeature {1}",Cb,yc);if(Cb&&yc){e.ULS.sendTraceTag(51245197,216,50,"UploadToHostManager.RedirectToEditUrl: Sending DocumentRefresh post message.");const Nc={};Nc[M.a.H4a]="1";Nc[M.a.documentUrl]=Oa;Nc[M.a.reason]=
P.a.saveAs;l.AFrameworkApplication.BI().execute(Id=>{Id.sendMessage(u.a.t4,Nc)})}else Cb&&!yc&&l.AFrameworkApplication.jH||this.yL?(this.yL&&e.ULS.sendTraceTag(507594581,219,15,"UploadToHostManager.RedirectToEditUrl: Opening Saved Document URL in new tab."),nd.a.dm(Oa,nd.a.q2(4),void 0,"UploadToHostManager.RedirectToEditUrl")):nd.a.dm(Oa,nd.a.q2(3),void 0,"UploadToHostManager.RedirectToEditUrl")}Y1(Oa,Cb,yc){yc=void 0===yc?null:yc;e.ULS.sendTraceTag(8194018,216,50,"Starting to upload file");this.fLe&&
!this.fLe()&&this.vn&&(this.oo&&(this.Wsa=this.oo.vi("DialogShown","SaveAsToHostUploadTime")),this.b7b(),this.jsa=Cb,this.Fz=Oa,this.Tk=yc,this.Udc&&this.Tk&&this.Tk.hasOwnProperty("sourceActionId")&&(this.doh=this.Tk.sourceActionId),this.Tk&&"true"===this.Tk.SkipSaveToHost?this.qvc():this.U_())}U_(){32!==this.$c.Gk(Fd.a.oAa,1)?(e.ULS.sendTraceTag(18989378,219,15,"The save file change is not supported, this operation may exist data losting."),this.qvc()):this.$c.Xj(Fd.a.oAa,2,[()=>{e.ULS.sendTraceTag(18989379,
219,50,"Call the force save file change successfully.");this.qvc()},(Oa,Cb)=>{e.ULS.sendTraceTag(18989380,219,15,"The file change is not saved successfully, this operation may lead to data loss.");this.S1(Cb)}])}IYj(Oa){this.hva();this.JRa=!1;if(Oa&&Oa.data&&Oa.data.responseData){let yc=Bb.d(Oa.data.responseData);({hz:Cb}=yc);if(yc.returnValue)if(Oa=Cb,Oa.StatusCode!==wd.a.jN&&Oa.StatusCode!==wd.a.zWa){e.ULS.sendTraceTag(8194049,216,10,"UploadToHostManager failure. Response data is not JSON.");var Cb=
{};Cb.FailureReason=Oa.StatusCode.toString();Cb.ExtraInfo=Oa.ExtraInfo;this.Hpa(Cb);this.S1(parseInt(Oa.ExtraInfo))}else{e.ULS.sendTraceTag(8194050,216,50,"UploadToHost execute success.");this.Qhe();try{Oa.NewDocumentUrl&&""!==Oa.NewDocumentUrl?this.N4a(Oa.NewDocumentUrl):this.O4a()}catch(Nc){e.ULS.sendTraceTag(37025699,216,15,"Redirect failed with exception: {0}",Nc.toString())}this.Q0b()}else e.ULS.sendTraceTag(8194048,216,10,"Failed to deserialize : {0}",{["ResponseData"]:yf.a.n8a(Oa.data.responseData)}),
this.Hpa({["FailureReason"]:"Failed to deserialize response"}),this.S1()}else e.ULS.sendTraceTag(8194019,216,10,"UploadToHostManager failure. Response data is null"),this.Hpa({["FailureReason"]:"null response"}),this.S1()}HYj(Oa){5!==Oa.data.status&&12!==Oa.data.status||this.JRa?(e.ULS.sendTraceTag(8194052,216,10,"UploadToHostManager HTTP failure with code: {0}",{["Status"]:Oa.data.status,["HttpStatus"]:Oa.data.httpStatus}),this.Hpa({["FailureReason"]:Oa.data.httpStatus.toString()}),this.hva(),this.S1(),
this.Q0b()):(e.ULS.sendTraceTag(8194051,216,10,"UploadToHostManager failure. Retry automatically."),this.JRa=!0,this.Tk&&"true"===this.Tk.SkipSaveToHost?this.qvc():this.U_())}hva(){this.Nu&&(this.Nu.close(),this.Nu=null)}Q0b(){this.Wsa&&(this.Wsa.stop(),this.Wsa=null)}Qhe(){this.Tk&&"VersionHistory"===this.Tk.SaveEntryPoint&&this.$c.Gk(Fd.a.DTc,2)}Hpa(Oa){this.Tk&&"VersionHistory"===this.Tk.SaveEntryPoint&&this.$c.Xj(Fd.a.The,2,Oa)}qvc(){let Oa=this.tka+this.LZ;Oa=Rc.a.mr(Oa,"qs",Md.a.kl(l.AFrameworkApplication.qo));
Oa=Rc.a.mr(Oa,"n",Md.a.kl((new Date).getTime().toString()));Oa=Rc.a.mr(Oa,"ov",Md.a.kl(this.jsa.toString()));Oa=Rc.a.mr(Oa,"fn",Md.a.kl(this.Fz));this.Tk&&this.Tk.FileDownloadUrl&&(Oa=Rc.a.mr(Oa,"furl",Md.a.kl(this.Tk.FileDownloadUrl)));this.vn.Ou(Oa,1,"",{"Content-Type":"application/json; charset=utf-8"},!1,2,Object(He.a)(this,this.IYj,"onUploadFinished"),Object(He.a)(this,this.HYj,"onUploadFailed"),null,void 0,void 0,void 0,void 0,"1")}}Object(m.a)(jg,"UploadToHostManager",null,[803]);var If=a(977);
class cf{constructor(){this.Mh=null;this.CK=()=>{l.AFrameworkApplication.fa.la("SaveAsToHostBrsIsEnabled")&&Td.a.instance.resolve("Common.App.SaveAsToHost.SaveAsToHostActor").ko()}}get name(){return"Common.App.SaveAsToHost"}init(){l.AFrameworkApplication.fa.ty(this.CK)}ao(Oa){this.Mh=Oa;this.Mh.register(Ze,"Common.App.SaveAsToHost.ErrorRetryDialogFactory").as("Common.App.SaveAsToHost.IErrorRetryDialogFactory").mi(()=>new Ze(l.AFrameworkApplication.fa,l.AFrameworkApplication.jh)).hi();this.Mh.register(jg,
"Common.App.SaveAsToHost.UploadToHostManager").as("Common.App.SaveAsToHost.IUploadToHostManager").mi(()=>new jg(l.AFrameworkApplication.jh,l.AFrameworkApplication.fa,l.AFrameworkApplication.$i,()=>l.AFrameworkApplication.Il,()=>(new If.a).create(),Ae(),l.AFrameworkApplication.ra,l.AFrameworkApplication.ra.cL)).hi();this.Mh.register(Vb,"Common.App.SaveAsToHost.FileNameDialogFactory").as("Common.App.SaveAsToHost.IFileNameDialogFactory").mi(()=>new Vb(l.AFrameworkApplication.fa,l.AFrameworkApplication.jh,
l.AFrameworkApplication.ra,l.AFrameworkApplication.ra.$d,Ae(),Fe())).hi();this.Mh.register(rg,"Common.App.SaveAsToHost.SaveAsToHostActor").mi(()=>new rg(l.AFrameworkApplication.fa,Td.a.instance.resolve("Common.App.SaveAsToHost.FileNameDialogFactory"),Fe())).hi()}dispose(){}static main(){Tc.a.instance.Lo(new cf)}}Object(m.a)(cf,"SaveAsToHostPackage",null,[12,13]);const Nb=()=>Td.a.instance.resolve("Common.App.SaveToSharePoint.FileNameDialogFactory"),Bc=()=>Td.a.instance.resolve("Common.App.SaveToSharePoint.ISaveToSharePointManager"),
Ob=()=>Td.a.instance.resolve("Common.App.OneDriveFilePickerApi.OneDriveFilePickerApiManagerV72"),zc=()=>Td.a.instance.resolve("Common.App.SaveToSharePoint.IOneDriveFilePickerHelper"),od=()=>Td.a.instance.resolve("Common.App.SaveToSharePoint.IUploadToSharePointManager");var ce=a(1102),Qb=a(1247),Xc=a(1248),md=a(592);class ie extends Ka.a{constructor(){super();this.Bh=0;this.Yh(1,Object(U.a)("DialogClose"))}displayError(Oa,Cb){this.dtc(Oa,Cb,Lc.a.HHg)}dtc(Oa,Cb,yc){e.ULS.sendTraceTag(25180161,216,10,
"Show upload error dialog with error code {0}.",yc);this.jG(yc,Oa,Cb,null)}gtc(Oa,Cb){e.ULS.sendTraceTag(25235986,216,15,"Show warning dialog of Picker related issue.");this.jG(Lc.a.Jsk,Oa,Cb,null,!0)}}Object(m.a)(ie,"ErrorDialog",Ka.a,[804]);const me=()=>Td.a.instance.resolve("Common.App.SaveACopy.SaveACopyUploadToCloudManager");var Pe=a(842),gf=a(641),tf=a(1007),Qe=a(1107),Ca=a(201);class yb{constructor(){this.extension=this.fileName=null;this.enableMoreLocations=!1;this.saveLocations=this.scenario=
null}}Object(m.a)(yb,"SaveAsDialogInput",null,[]);class wc{constructor(){this.properties=this.friendlyPath=this.folderName=null}}Object(m.a)(wc,"SaveLocation",null,[]);var dd=a(280);class vd{constructor(Oa,Cb,yc,Nc,Id,ke,Ie,Le,wf){this.Kcd=null;this.Fz="";this.AHi=()=>{const Kf=new nc.a;Kf.add(this.EGi());const cg=this.qUi();cg&&Kf.addRange(cg);return Object.assign(new yb,{enableMoreLocations:!l.AFrameworkApplication.fa.la("HideSaveToAnotherFolderButtonforUIHost"),fileName:this.Fz,extension:Md.a.H$(this.ZH.ov),
saveLocations:Kf.toArray(),scenario:this.T8?"SaveToSharePoint":"SaveToCloudStorage"})};this.Zgd=Oa;this.OD=Cb;this.Tk=wf;this.LEa=yc;this.vm=Id;this.ZH=Nc;this.BTa=Ie;this.Gbb=Le;ke&&(this.Kcd=new md.a(()=>new tf.a(ke.value,null)));this.T8=!(null!==this.Tk&&this.Tk.hasOwnProperty("caller")&&"SaveToCloudManager"===this.Tk.caller.toString())}get k4g(){this.Xsa||(this.Xsa=me());return this.Xsa}get VTb(){var Oa;void 0===this.aHe&&(dd.a.dB("j73i2773;b6f46151"),this.aHe=null===(Oa=l.AFrameworkApplication.fa)||
void 0===Oa?void 0:Oa.la("SaveAsDialogImprovementsEnabled"));return this.aHe}get DNi(){if(null!=this.NCe)var Oa=this.NCe;else{var Cb;Oa=this.NCe=null===(Cb=l.AFrameworkApplication.fa)||void 0===Cb?void 0:Cb.vj("MaxSizeForMRUPathListInSaveAsDialog",4)}return Oa}EGi(){const Oa=new Pe.a(gf.a.lm());let Cb=this.ZH.breadcrumbFolderName,yc=this.ZH.breadcrumbBrandName;this.T8||null!=Cb&&""!=Cb||(Cb=Object(U.a)("MyFiles"));this.VTb&&yc===Object(U.a)("OneDriveName")&&(yc=Object(U.a)("YourOneDrive"));Oa.ga("type",
"currentHost");return Object.assign(new wc,{folderName:Cb,friendlyPath:yc,properties:Oa})}Poj(Oa){return!!Oa&&"ClassicMru"===Oa.type&&!!Oa.service_info&&!!Oa.service_info.service_id&&-1!==Oa.service_info.service_id.indexOf("SHAREPOINT")}qUi(){if(!this.Kcd||!this.BTa)return null;var Oa=this.Kcd.value.kR("SaveAsToSharePointDialog",!1);if(!Oa||3!==Oa.state||!Oa.iag)return null;Oa=Oa.iag;const Cb=new nc.a;let yc=0,Nc=0;for(var Id=0;Id<Oa.length&&!(this.VTb&&Cb.count>=this.DNi);Id++){var ke=Oa[Id];if(this.T8&&
!this.Poj(ke))continue;yc++;const Ie=ke.title,Le=Qe.b(ke,l.AFrameworkApplication.isRtl);if(!Ie||!Le)continue;if(this.T8&&!ke.sharepoint_info)continue;const wf=ke.url,Kf=this.T8?ke.sharepoint_info.site_url:null;if(!wf||this.T8&&!Kf)continue;let cg="",Bg="";ke.onedrive_info&&(cg=ke.onedrive_info.drive_id,Bg=ke.onedrive_info.item_id);Nc++;ke=new Pe.a(gf.a.lm());this.T8?ke.ga("type","SharePoint"):ke.ga("type","OneDrive");ke.ga("siteUrl",Kf);ke.ga("folderUrl",wf);ke.ga("driveId",cg);ke.ga("folderId",Bg);
Nc++;Cb.add(Object.assign(new wc,{folderName:Ie,friendlyPath:Le,properties:ke}))}Id=new Map;Id.set("NumPlaces",Oa.length.toString());Id.set("NumSharepointPlaces",yc.toString());Id.set("placesWithMetadata",Nc.toString());v.Health.instance.recordKpiUsage("SharePointSaveAsDialogMru",Q.b.FailureBased,"smartfio",Id);0<yc&&(Nc?.5>1*Nc/yc&&v.Health.instance.recordKpiFailure("SharePointSaveAsDialogMru","PartialPlacesMetadataMissing",!1,!1,null):v.Health.instance.recordKpiFailure("SharePointSaveAsDialogMru",
"AllPlacesMetadataMissing",!1,!1,null));return Cb}vyc(){const Oa={};Oa.inputPropsCallback=this.AHi;return Oa}bU(Oa){this.Fz=Oa;this.Fz||(this.Fz=String.format(Object(U.a)("SaveACopy_Filename"),Md.a.kz(this.ZH.ov)));if(this.T8||l.AFrameworkApplication.fa.la("UserCanWriteRelative")){Oa={["id"]:"SaveAsDialog",["bodyControls"]:this.vyc(),["dialogImprovementsEnabled"]:this.VTb};var Cb=Object(U.a)("SaveAs");2===this.vm.$d.Om&&(Cb=Object(U.a)("SaveACopy"));this.VTb&&(Cb=Object(U.a)("CreateACopyOnline"));
var yc=new B.a(!1,!1,!0);yc.Bh=1;yc.Lk="SaveAsDialog";yc.Yh(1,this.VTb?Object(U.a)("CreateACopy"):Object(U.a)("SaveButtonLabel"));yc.initializeAndShow(Cb,Object(He.a)(this,this.Esk,"saveAsDialogHandler"),Oa)}else e.ULS.sendTraceTag(507593120,216,50,"load file picker directly"),Oa=Md.a.H$(this.ZH.ov),this.w4f(this.Fz,Oa)}sMk(Oa,Cb){Oa&&""!==Oa&&""!==Cb||1===this.vm.state?this.v_f()?this.w4f(Oa,Cb):this.T8?(""!==Cb&&(Oa+=Cb),this.Zgd.start(Oa,this.Tk)):(e.ULS.sendTraceTag(507593119,216,10,"Shared Picker not enabled"),
this.OD.create().displayError(0,Oa,!1)):(e.ULS.sendTraceTag(579179796,216,10,"filename is empty but dialog should have handled this error case"),this.OD.create().displayError(2,Oa,!1))}w4f(Oa,Cb){v.Health.instance.recordKpiUsage("SaveACopySFP",Q.b.FailureBased,"smartfio",null);const yc=this.Gbb.Owd(Object(U.a)("PickerSaveACopyOkButton"),Object(U.a)("PickerSaveACopyTitle"),!1,!0,null,"SaveACopy",2);this.Gbb.Lyc(yc).then(Nc=>{if(Nc&&0<Nc.length){const Id=Nc[0][M.a.N2j]||"root",ke=Nc[0][M.a.M2j],Ie=
Nc[0][M.a.P2j];Nc=Nc[0][this.T8?M.a.xrg:M.a.O2j];if(this.T8?""!==Ie&&""!==Nc:""!==Nc)this.T8?this.BTa.Y1(Nc,Oa+Cb,Ie,Id,ke,this.Tk):(e.ULS.sendTraceTag(507593118,216,50,"UploadToCloudManager called from shared"),this.k4g.Y1(Id,Nc,Oa+Cb,this.Tk)),v.Health.instance.recordKpiSuccess("SaveACopySFP",null);else{this.OD.create().displayError(0,Oa,!1);const Le=Ca.a.ey();Le&&(Le.set("FolderIdAvailable",""===Id?"false":"true"),Le.set("DriveIdAvailable",""===ke?"false":"true"),Le.set("SiteUrlAvailable",""===
Ie?"false":"true"),Le.set("FolderUrlAvailable",""===Nc?"false":"true"));v.Health.instance.recordKpiFailure("SaveACopySFP","Not all values Available to start upload",!1,!1,Object.assign({},{extendedProperties:Le}))}}else this.OD.create().displayError(0,Oa,!1),v.Health.instance.recordKpiFailure("SaveACopySFP","Picker Data is unavaliable",!1,!1,null)}).catch(Nc=>{"Canceled"===Nc?((Nc=Ca.a.ey())&&Nc.set("IsCanceled","true"),v.Health.instance.recordKpiSuccess("SaveACopySFP",Object.assign({},{extendedProperties:Nc}))):
v.Health.instance.recordKpiFailure("SaveACopySFP",Nc,!1,!1,null)})}v_f(){return this.Gbb?this.Gbb.UWd():(e.ULS.sendTraceTag(572343636,216,50,"_sharedFilePickerManager is null"),!1)}Esk(Oa,Cb){if(Cb&&1===Oa){Oa=Cb.fileName;var yc=Md.a.H$(this.ZH.ov);Cb.moreLocationsSelected&&this.sMk(Oa,yc);if(Cb.locationCallback)if(Cb=Cb.locationCallback())if(Cb.properties&&"currentHost"===Cb.properties.ma("type"))this.LEa.Y1(Oa+yc,!1,this.Tk);else if(Cb.properties&&"SharePoint"===Cb.properties.ma("type")){var Nc=
Cb.properties.ma("folderId");var Id=Cb.properties.ma("driveId");var ke=Cb.properties.ma("siteUrl");Cb=Cb.properties.ma("folderUrl");this.BTa.Y1(Cb,Oa+yc,ke,Nc,Id,this.Tk)}else Cb.properties&&"OneDrive"===Cb.properties.ma("type")?(ke=null===(Id=Cb.properties)||void 0===Id?void 0:Id.ma("folderId"),Cb=null===(Nc=Cb.properties)||void 0===Nc?void 0:Nc.ma("folderUrl"),e.ULS.sendTraceTag(507593117,216,50,"UploadToCloudManager called from dialog box"),this.k4g.Y1(ke,Cb,Oa+yc,this.Tk)):e.ULS.sendTraceTag(579179799,
216,10,"unknown location type sent back");else e.ULS.sendTraceTag(579179798,216,10,"selected location is empty");else e.ULS.sendTraceTag(579179797,216,10,"locationCallback is empty")}}}Object(m.a)(vd,"SaveAsDialog",null,[843]);class Zd{constructor(Oa,Cb,yc,Nc,Id,ke,Ie){this.LEa=yc;this.OD=Cb;this.vm=Oa;this.uoh=Nc;this.clh=void 0===Id?null:Id;this.BTa=void 0===ke?null:ke;this.Gbb=void 0===Ie?null:Ie}create(Oa){return new vd(this.uoh,this.OD,this.LEa,l.AFrameworkApplication.Qt,this.vm,this.clh,this.BTa,
this.Gbb,Oa)}}Object(m.a)(Zd,"FileNameDialogFactory",null,[830]);class Re{constructor(Oa,Cb,yc,Nc){this.Nv=this.XCb=null;this.lQb=Id=>{this.Nv||3!==Id.state||(this.Nv=Id)};this.QAb=Oa;this.vm=yc;this.Qmh=Nc;this.URa=new md.a(()=>new tf.a(Cb.value,this.lQb))}get qpg(){this.XCb||(this.URa.value.kR("Save As",!0),this.Nv&&this.Nv.MY&&this.Nv.MY.length&&(this.XCb=this.BPi(this.Nv.MY)));return this.XCb}start(Oa){if(!this.qpg)if(l.AFrameworkApplication.breadcrumbFolderUrl&&l.AFrameworkApplication.breadcrumbFolderUrl.length)this.XCb=
l.AFrameworkApplication.breadcrumbFolderUrl;else return e.ULS.sendTraceTag(23881884,216,10,"CachedGetMoreInfoResult is null, can't get OneDrive for Bussiness page url. BreadcrumbFolderUrl is null. Get more info result is null: ",!this.Nv),!1;const Cb=this.Qmh();Cb.RMk();const yc=Cb.rQi();if(!yc)return e.ULS.sendTraceTag(24664067,216,10,"Picker container is null, will not show picker."),!1;this.QAb.start((Nc,Id)=>{Cb.hide();Oa(Nc,Id)},()=>{this.aba(Cb)},yc,this.XCb);return!0}aba(Oa){Oa.hide();e.ULS.sendTraceTag(24664068,
216,50,"User cancelled save to another folder.")}BPi(Oa){Oa=Oa.toLowerCase();Oa.endsWith("/")||(Oa+="/");const Cb=Oa.indexOf("/documents/");return-1!==Cb?Oa.substring(0,Cb+1)+"_layouts/15/onedrive.aspx":""}}Object(m.a)(Re,"OneDriveFilePickerHelper",null,[831]);class ff extends B.a{constructor(){super()}RMk(){this.P7c="FilePickerDialog";this.Po="<div class='FilePickerDiv' id='FilePickerDiv'></div>";this.Lk="PickerDialog-MsoSp";this.showDialog("",null)}rQi(){return document.getElementById("FilePickerDiv")}GS(){}Nza(){}}
Object(m.a)(ff,"PickerDialog",B.a,[829]);var af=a(1036);class xf{constructor(Oa,Cb,yc,Nc,Id,ke,Ie){this.Ga=Oa;this.h9c=yc;this.$c=Cb;this.Zgd=Nc;this.QAb=Id;this.Ced=ke;this.Reh=Ie}ko(){const Oa=this.QAb.Vjb();Oa?W.a.Lna||this.Ga.la("SaveToSharePointOnDemandDownloadJsIsEnabled")?this.$c.Vk(Fd.a.saveToSharePoint,le.a.frame,Object(He.a)(this,this.ZHg,"saveToSharePointActionDispatcher"),64):(Oa.Bob.continueWith(Cb=>{Cb.om&&this.QAb.J7d(Cb)}),this.Knc()):e.ULS.sendTraceTag(25180162,216,15,"Failure with OneDrive API download as the js url is empty.")}Knc(){bd.a.Bee(Object(He.a)(this,
this.ZHg,"saveToSharePointActionDispatcher"));bd.a.zBd([new af.a(Fd.a.saveToSharePoint,le.a.frame,0)],this.QAb.Vjb())}get xnb(){return this.Ga.la("SaveToAnotherFolderBrsIsEnabled")}get n$e(){return this.Ga.la("UserCanWriteRelative")}get CWd(){return null!=this.RCe?this.RCe:this.RCe=(()=>{var Oa;return null===(Oa=this.Ga)||void 0===Oa?void 0:Oa.la("SaveAsDialogImprovementsEnabled")})()}ZHg(Oa,Cb,yc,Nc,Id){return Cb.contextId!==le.a.frame||Oa!==Fd.a.saveToSharePoint?2:this.xnb&&(this.Ced.qpg||this.n$e)?
1===yc?Cc.SessionStatusManager.instance.Fkb||l.AFrameworkApplication.Cga?8:this.Reh()?32:8:2===yc?(Cb=Id,this.CWd&&(null==Cb&&(Cb={}),Cb.sourceActionId=Oa),e.ULS.sendTraceTag(23881885,216,50,"User clicked on SaveToSharePoint button from "+(Cb&&Cb.SaveEntryPoint&&"VersionHistory"===Cb.SaveEntryPoint.toString()?"version history.":"the backstage.")),this.n$e?(e.ULS.sendTraceTag(24524226,216,50,"Show save a copy dialog."),this.h9c.create(Cb).bU(null)):(e.ULS.sendTraceTag(24524225,216,50,"No permission save to current folder, show Picker to save to another folder."),
this.Zgd.start(null,Cb)),32):8:8}}Object(m.a)(xf,"SaveToSharePointActor",null,[]);class eg{constructor(Oa,Cb,yc,Nc){this.Tk=this.MPe=null;this.BTa=Oa;this.OD=Cb;this.Ced=yc;this.vm=Nc}start(Oa,Cb){e.ULS.sendTraceTag(25180163,216,50,"Try launch Picker.");this.MPe=Oa;this.Tk=Cb;this.Ced.start((yc,Nc)=>{this.processResponse(yc,Nc)})||this.sqe()}processResponse(Oa,Cb){Oa?this.f1(Cb):this.pha(Cb)}sqe(){1!==this.vm.state&&this.OD().gtc(Object(U.a)("DefaultDialogTitle"),Object(U.a)("OneDriveContactError"))}f1(Oa){e.ULS.sendTraceTag(23881886,
216,50,"Success Callback called. Calling UploadToSharePointManager to start upload.");let Cb="",yc="";Oa&&Oa.data&&Oa.data.value&&Oa.data.value.length&&Oa.data.value[0].parentReference?(Cb=Oa.data.value[0].id,yc=Oa.data.value[0].parentReference.driveId,Cb&&yc||e.ULS.sendTraceTag(508040406,216,15,"Picker return invalid data, folder id is null: {0}, drive id is null: {1}.",!Cb,!yc)):e.ULS.sendTraceTag(508040405,216,15,"Picker return invalid data or empty parent reference.");if(Oa&&Oa.data&&Oa.data.value&&
Oa.data.value.length&&Oa.data.value[0].sharePoint){const Nc=Oa.data.value[0].sharePoint.url;Oa=Oa.data.value[0].sharePoint.listUrl;let Id=null;if(Nc&&(Id=Oa?this.QUi(Oa):this.PUi(Nc))){this.BTa.Y1(Nc,this.MPe,Id,Cb,yc,this.Tk);return}e.ULS.sendTraceTag(25180164,216,10,"Picker return invalid data, folder url is null: {0}, siteUrl url is null: {1}.",!Nc,!Id)}e.ULS.sendTraceTag(23881887,216,10,"Picker return invalid data or empty SharePoint url.");this.sqe()}PUi(Oa){Oa.endsWith("/")||(Oa+="/");let Cb=
0;for(let yc=0;yc<Oa.length;yc++)if("/"===Oa.charAt(yc)&&5===++Cb)return Oa.substr(0,yc);return null}QUi(Oa){Oa.endsWith("/")&&(Oa=Oa.substring(0,Oa.length-1));const Cb=Oa.lastIndexOf("/");return-1!==Cb?Oa.substring(0,Cb):null}pha(Oa){e.ULS.sendTraceTag(23881888,216,10,"Picker failure Callback called.");Oa&&Oa.error?e.ULS.sendTraceTag(23881889,216,10,"File Dialog returned with error code:{0}, and error message: {1}.",Oa.error.errorCode,Oa.error.message):e.ULS.sendTraceTag(23881890,216,10,"File Dialog returned empty error.");
this.sqe()}}Object(m.a)(eg,"SaveToSharePointManager",null,[827]);class Ab{constructor(Oa,Cb,yc,Nc,Id,ke,Ie,Le,wf,Kf){this.tka=Oa;this.Fz=Cb;this.B$a=Nc;this.Nfd=Le;this.K2=yc;this.Whd=Id;this.Ija=ke;this.scc=Ie;this.LZ=wf;this.Tk=Kf}execute(Oa,Cb){if(!l.AFrameworkApplication.Il&&l.AFrameworkApplication.$i){var yc={"Content-Type":"application/json; charset=utf-8"},Nc=this.tka+this.LZ;dd.a.dB("d6454864;54012657");l.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseGraphFileUploaderForSharePointSaveAsHandler",
!1)&&(yc["X-UseGraphFileUploader"]="1",yc["X-AADToken"]=l.AFrameworkApplication.$i.Cca);this.Ija&&(Nc=Rc.a.mr(Nc,"fo",Md.a.kl(this.Ija)));this.scc&&(Nc=Rc.a.mr(Nc,"dr",Md.a.kl(this.scc)));Nc=Rc.a.mr(Nc,"fu",Md.a.kl(this.K2));Nc=Rc.a.mr(Nc,"su",Md.a.kl(this.Whd));Nc=Rc.a.mr(Nc,"fn",Md.a.kl(this.Fz));Nc=Rc.a.mr(Nc,"n",Md.a.kl((new Date).getTime().toString()));this.Tk&&this.Tk.FileDownloadUrl&&(Nc=Rc.a.mr(Nc,"furl",Md.a.kl(this.Tk.FileDownloadUrl)));Nc=Nc+"&"+this.Nfd;this.B$a&&this.B$a.length?Nc=Rc.a.mr(Nc,
"fnn",Md.a.kl(this.B$a)):e.ULS.sendTraceTag(23881891,216,15,"No new file name in request.");e.ULS.sendTraceTag(23881920,216,50,"Trying send SharePointSaveAsHandler.ashx request.");l.AFrameworkApplication.$i.Ou(Nc,1,"",yc,!1,2,Oa,Cb,null,void 0,void 0,void 0,void 0,"9")}}}Object(m.a)(Ab,"SharePointSaveAsCaller",null,[837]);class xc{constructor(Oa){this.ITa=Oa.appSettings.SaveAsToHostWebServiceBase;this.Fz=Oa.appSettings.FileName;this.LZ=Oa.Xa("SharePointSaveAsHandler")||"sharepointsaveashandler.ashx"}create(Oa,
Cb,yc,Nc,Id,ke){return new Ab(this.ITa,this.Fz,Oa,Cb,yc,Nc,Id,l.AFrameworkApplication.qo,this.LZ,ke)}}Object(m.a)(xc,"SharePointUploadCallerFactory",null,[826]);var eb=a(846);class Ub{constructor(Oa,Cb,yc,Nc,Id){this.Nu=this.XQa=null;this.h5c=!1;this.Vgd=this.K2=null;this.yL=!1;this.Hjd=Cb;this.wDb=yc;this.OD=Nc;this.vm=Id;this.$c=Oa;this.yL=l.AFrameworkApplication.fa?l.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OpenCopyFileInNewTabEnabled",!1):!1}Y1(Oa,Cb,yc,Nc,
Id,ke){this.h5c=!1;e.ULS.sendTraceTag(23881921,216,50,"UploadToSharePointManager.StartUpload : Starting to upload file");this.b7b();this.K2=Oa;ke&&ke.SaveEntryPoint&&(this.Vgd=ke.SaveEntryPoint);this.XQa=this.Hjd.create(Oa,Cb,yc,Nc,Id,ke);ke&&"true"===ke.SkipSaveToHost?this.U_():this.exi()}exi(){const Oa=()=>{e.ULS.sendTraceTag(23881923,216,15,"The file change is not saved successfully, this operation may lead to data loss.");this.U_()};32!==this.$c.Xj(Fd.a.oAa,2,[()=>{e.ULS.sendTraceTag(23881922,
216,50,"Call the force save file change successfully.");this.U_()},Oa])&&Oa()}U_(){e.ULS.sendTraceTag(23881924,216,50,"Send SharePointSaveAsHandler.ashx request.");this.XQa.execute(Object(He.a)(this,this.fWj,"onSaveToSharePointUploadFinished"),Object(He.a)(this,this.eWj,"onSaveToSharePointUploadFailed"))}fWj(Oa){if(Oa&&Oa.data&&Oa.data.responseData){var Cb;let yc=Bb.d(Oa.data.responseData);({hz:Cb}=yc);if(yc.returnValue)if(Cb.StatusCode!==wd.a.jN&&Cb.StatusCode!==wd.a.zWa)e.ULS.sendTraceTag(25235987,
216,15,"UploadToSharePointManager upload failed with status: {0}, status code: {1}.",Oa.data.status,Cb.StatusCode),Cb.StatusCode!==wd.a.cEg&&this.enf(Oa.data.status)||(this.Hpa(Cb.StatusCode.toString()),this.rLk(Cb.StatusCode));else{e.ULS.sendTraceTag(23881927,216,50,"UploadToSharePointManager upload success.");this.Qhe();try{Cb.NewDocumentUrl?this.N4a(Cb.NewDocumentUrl):this.O4a()}catch(Nc){e.ULS.sendTraceTag(37025729,216,15,"Redirect failed with exception: {0}",Nc.toString())}}else e.ULS.sendTraceTag(23881926,
216,10,"Failed to deserialize : {0}",{["ResponseData"]:yf.a.n8a(Oa.data.responseData)}),this.utc()||(this.Hpa("Failed to deserialize response"),this.a7b())}else e.ULS.sendTraceTag(23881925,216,10,"Upload failure. Response data is null"),this.utc()||(this.Hpa("Unknown"),this.a7b())}eWj(Oa){Oa&&Oa.data?this.enf(Oa.data.status)||(e.ULS.sendTraceTag(23881929,216,10,"Upload failed."),this.Hpa(eb.a[Oa.data.status]),this.a7b()):(e.ULS.sendTraceTag(23881928,216,10,"Upload failure. Response data is null"),
this.utc()||(this.Hpa("Unknown"),this.a7b()))}utc(){if(!this.h5c)return e.ULS.sendTraceTag(23881930,216,10,"Upload fail. Retrying."),this.h5c=!0,this.U_(),!0;e.ULS.sendTraceTag(23881931,216,10,"Upload fail. Already retry once but still fail.");return!1}enf(Oa){e.ULS.sendTraceTag(23881932,216,10,"HTTP failure with code: {0}",Oa);return this.utc()}O4a(){this.yL?e.ULS.sendTraceTag(23881933,216,15,"UploadToSharePointManager.RedirectToFolder: Opening Saved Document Folder in new tab."):e.ULS.sendTraceTag(23881933,
216,50,"Redirecting to Folder.");nd.a.dm(this.K2,nd.a.q2(this.yL?4:3),void 0,"UploadToSharePointManager.RedirectToFolder")}N4a(Oa){var Cb=!1;let yc=!1;l.AFrameworkApplication.fa&&(Cb=l.AFrameworkApplication.fa.la("SaveACopyIsEnabledForUiHost"),yc=l.AFrameworkApplication.fa.la("UiHostSupportsDocRebootFeatures"));e.ULS.sendTraceTag(23881934,216,50,"Redirecting to edit url. IsEnabledForUiHost {0}",Cb);if(Cb&&yc){e.ULS.sendTraceTag(51245198,216,50,"UploadToSharePointManager.RedirectToEditUrl: Sending DocumentRefresh post message.");
const Nc={};Nc[M.a.H4a]="1";Nc[M.a.documentUrl]=Oa;Nc[M.a.reason]=P.a.saveAs;l.AFrameworkApplication.BI().execute(Id=>{Id.sendMessage(u.a.t4,Nc)})}else Cb=this.yL?4:3,this.yL&&e.ULS.sendTraceTag(507594579,216,15,"UploadToSharePointManager.RedirectToEditUrl: Opening Saved Document URL in new tab."),nd.a.dm(Oa,nd.a.q2(Cb),void 0,"UploadToSharePointManager.RedirectToEditUrl")}b7b(){this.vm&&1===this.vm.state||(this.Nu=this.wDb(),this.Nu.message=Object(U.a)("CommentProgressTooltip"),this.Nu.Bh=5,this.Nu.hC=
!1,this.Nu.UOa(Object(U.a)("DefaultDialogTitle"),null,null))}hva(){this.Nu&&(this.Nu.close(),this.Nu=null)}a7b(){var Oa;(null===(Oa=l.AFrameworkApplication.fa)||void 0===Oa?0:Oa.la("SaveAsDialogImprovementsEnabled"))?this.lp(Object(U.a)("CopyFailedDialogTitle"),Object(U.a)("CopyFailedDialogDescription")):this.lp(Object(U.a)("SaveFailedDialogTitle"),Object(U.a)("FailToSaveFile"))}zMk(){this.lp(Object(U.a)("NoSavePermissionDialogTitle"),Object(U.a)("NoSavePermissionDialogMessage"))}xLk(){const Oa=String.format(Object(U.a)("SaveAsFileTooLargeMessage"),
250);this.lp(Object(U.a)("SaveAsFileTooLargeTitle"),Oa,Lc.a.Fsk)}lp(Oa,Cb,yc){yc=void 0===yc?Lc.a.Isk:yc;e.ULS.sendTraceTag(25180165,216,10,"Upload failure with title: {0}, message: {1}",Oa,Cb);this.hva();1!==this.vm.state&&this.OD().dtc(Oa,Cb,yc)}rLk(Oa){e.ULS.sendTraceTag(25180166,216,50,"Upload fail with status code: {0}.",Oa);switch(Oa){case wd.a.Nve:this.zMk();break;case wd.a.cEg:this.xLk();break;default:this.a7b()}}Qhe(){this.yL&&this.hva();"VersionHistory"===this.Vgd&&this.$c.Gk(Fd.a.DTc,2)}Hpa(Oa){this.yL&&
this.hva();"VersionHistory"===this.Vgd&&this.$c.Xj(Fd.a.The,2,{["FailureReason"]:Oa})}}Object(m.a)(Ub,"UploadToSharePointManager",null,[825]);var Fc=a(599);class rd extends Ka.a{constructor(){super();this.VLb=480;this.Bh=0;this.Yh(1,Object(U.a)("DialogGotit"));this.maxWidth=this.VLb}displayError(Oa,Cb){this.dtc(Oa,Cb,Lc.a.HHg)}dtc(Oa,Cb,yc){e.ULS.sendTraceTag(507388507,216,10,"Show upload error dialog with error code {0}.",yc);this.Io(Oa,Cb,2)}gtc(Oa,Cb){e.ULS.sendTraceTag(507388506,216,15,"Show warning dialog of Picker related issue.");
this.Io(Oa,Cb,2)}}Object(m.a)(rd,"ErrorDialogV1",Ka.a,[804]);class Gd{constructor(){this.wEa=this.Qdd=this.Jdd=this.Mh=null}get name(){return"Common.App.SaveToSharePoint"}init(){}dispose(){}ao(Oa){this.Mh=Oa;this.Jdd=Fc.a.hv(Object(Qb.a)());this.Qdd=Fc.a.hv(Object(Xc.a)());this.wEa=Fc.a.hv(Object(ce.a)());gb.Task.WAA.call(null,this.Jdd,this.Qdd,this.wEa).continueWith(()=>{this.Kdk()})}Kdk(){this.Mh.register(xc,"Common.App.SaveToSharePoint.SharePointUploadCallerFactory").as("Common.App.SaveToSharePoint.ISharePointUploadCallerFactory").mi(()=>
new xc(l.AFrameworkApplication.fa)).hi();this.Mh.register(Ub,"Common.App.SaveToSharePoint.UploadToSharePointManager").as("Common.App.SaveToSharePoint.IUploadToSharePointManager").mi(()=>{var Oa;return new Ub(l.AFrameworkApplication.jh,Td.a.instance.resolve("Common.App.SaveToSharePoint.SharePointUploadCallerFactory"),()=>(new If.a).create(),(null===(Oa=l.AFrameworkApplication.fa)||void 0===Oa?0:Oa.la("SaveAsDialogImprovementsEnabled"))?()=>new rd:()=>new ie,l.AFrameworkApplication.ra)}).hi();this.Mh.register(eg,
"Common.App.SaveToSharePoint.SaveToSharePointManager").as("Common.App.SaveToSharePoint.ISaveToSharePointManager").mi(()=>{var Oa;return new eg(od(),(null===(Oa=l.AFrameworkApplication.fa)||void 0===Oa?0:Oa.la("SaveAsDialogImprovementsEnabled"))?()=>new rd:()=>new ie,zc(),l.AFrameworkApplication.ra)}).hi();this.Mh.register(Re,"Common.App.SaveToSharePoint.OneDriveFilePickerHelper").as("Common.App.SaveToSharePoint.IOneDriveFilePickerHelper").mi(()=>new Re(Ob(),new md.a(()=>this.Jdd.result),l.AFrameworkApplication.ra,
()=>new ff)).hi();this.Mh.register(Zd,"Common.App.SaveToSharePoint.FileNameDialogFactory").mi(()=>new Zd(l.AFrameworkApplication.ra,Ae(),Fe(),Bc(),new md.a(()=>this.Qdd.result),od(),this.wEa?this.wEa.result:null)).hi();this.Mh.register(xf,"Common.App.SaveToSharePoint.SaveToSharePointActor").mi(()=>new xf(l.AFrameworkApplication.fa,l.AFrameworkApplication.jh,Nb(),Bc(),Ob(),zc(),()=>l.AFrameworkApplication.ra.SPh)).hi();l.AFrameworkApplication.fa.la("SaveToAnotherFolderBrsIsEnabled")&&Td.a.instance.resolve("Common.App.SaveToSharePoint.SaveToSharePointActor").ko()}static main(){Tc.a.instance.Lo(new Gd)}}
Object(m.a)(Gd,"PackageManager",null,[12,13]);const ue=()=>Td.a.instance.resolve("Common.App.SaveToCloudStorage.ODCXStackOperationManager"),Ce=()=>Td.a.instance.resolve("Common.App.SaveToCloudStorage.UploadToCloudManager"),Se=()=>Td.a.instance.resolve("Common.App.SaveToCloudStorage.SignInDialogFactory"),of=()=>Td.a.instance.resolve("Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory"),jf=()=>Td.a.instance.resolve("Common.App.OneDriveFilePickerApi.IOneDriveFilePickerApiManager");class bf extends Ka.a{constructor(){super();
this.Bh=0;this.Yh(1,Object(U.a)("DialogClose"))}displayError(Oa){this.jG(Oa,Object(U.a)("DefaultDialogTitle"),Object(U.a)("ErrorSavingToOneDrive"),null)}}Object(m.a)(bf,"ErrorDialog",Ka.a,[802]);var pf=a(158);class Ud{}Ud.default=0;Object(m.a)(Ud,"SaveToCloudErrorCodes",null,[]);class Ff{}Ff.saveToCloudStorage="SaveToCloudStorage";Ff.saveACopy="SaveACopy";Object(m.a)(Ff,"SaveToCloudStorageConstants",null,[]);class Uf{constructor(Oa,Cb,yc,Nc,Id,ke,Ie){this.Tk=null;this.oph=Oa;this.wda=Cb;this.Xsa=
yc;this.Ga=Nc;this.D9a=Id;this.OD=ke;this.UCb=Ie}get Dsk(){this.NTe||(this.NTe=Nb());return this.NTe}start(Oa){this.Tk=Oa;this.UCb.Fyb?this.UCb.Start(Oa):(Oa=null!==this.Tk&&this.Tk.hasOwnProperty("SaveEntryPoint")&&this.Tk.SaveEntryPoint.toString()===Ff.saveToCloudStorage,this.wda.E_a?(Object(pf.a)(String,l.AFrameworkApplication.Nh.Host),l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om&&Oa?(e.ULS.sendTraceTag(508852051,216,15,"User is signed in. We will initiate a save for this file to user's root OneDrive location"),
this.Xsa.Y1("root","https://onedrive.live.com",null,this.Tk)):(e.ULS.sendTraceTag(6590559,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"User is signed in. We will show file picker."),null!==this.Tk&&this.Tk.hasOwnProperty("showSaveAsDialog")&&"true"===this.Tk.showSaveAsDialog?this.kPh():this.O9e())):(e.ULS.sendTraceTag(6590560,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"User is not signed in. We will show sign in dialog."),
this.showSignInDialog()))}kPh(){this.Tk.caller="SaveToCloudManager";const Oa=this.Dsk.create(this.Tk);Oa.v_f()?(e.ULS.sendTraceTag(507646752,216,50,"Call SaveAs dialog box"),Oa.bU(null)):(e.ULS.sendTraceTag(507646753,216,50,"SharedSaveACopyPicker not enabled"),this.O9e())}showSignInDialog(){this.oph.create().bU()}lp(){this.OD().displayError(Ud.default)}O9e(){try{e.ULS.sendTraceTag(6590561,216,50,"Initializing OneDrive API");let Oa={["client_id"]:this.Ga.appSettings.UploadToSkyDriveClientId,["env"]:"INT"};
if(1===this.D9a||2===this.D9a)Oa={["client_id"]:this.Ga.appSettings.UploadToSkyDriveClientId};WL.init(Oa);e.ULS.sendTraceTag(6590562,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"OneDrive API is initialized. Launching file dialogue");WL.fileDialog({["mode"]:"save",["lightbox"]:"grey"}).then(Object(He.a)(this,this.f1,"onSuccess"),Object(He.a)(this,this.pha,"onFailure"))}catch(Oa){e.ULS.sendTraceTag(6590563,216,10,"OneDrive API Failure. [Exception:{0}] [Stack:{1}]",
Oa,Oa.stack),this.lp()}}f1(Oa){e.ULS.sendTraceTag(6590592,216,50,"Success Callback called. Calling UploadToCloudManger to start upload.");Oa&&Oa.data&&Oa.data.folders&&this.Xsa.Y1(Oa.data.folders[0].id,Oa.data.folders[0].urls.viewInBrowser,null,this.Tk)}pha(Oa){if(Oa&&Oa.error){if("user_canceled"===Oa.error.code){e.ULS.sendTraceTag(6590593,216,50,"User cancelled upload to their OneDrive.");return}e.ULS.sendTraceTag(6590594,216,50,"File Dialog returned with error code:{0}, and error message: {1}",
Oa.error.code,Oa.error.message)}else e.ULS.sendTraceTag(6590595,216,50,"File Dialog returned with no response");this.lp()}}Object(m.a)(Uf,"SaveToCloudManager",null,[839]);class Gf{constructor(Oa,Cb,yc,Nc){this.Tgc=null;this.toh=Oa;this.Ga=yc;this.GQe=Cb;this.iOe=new Y.a;this.oo=Nc}xnb(){return this.Ga.la("SaveToCloudStorageUIIsEnabled")}xAf(){return Fd.a.saveToCloudStorage}get ooj(){return null!=this.QCe?this.QCe:this.QCe=(()=>{var Oa;dd.a.dB("g76e5980;fg7ae797");return null===(Oa=this.Ga)||void 0===
Oa?void 0:Oa.la("SaveAsDialogEnabledForOneDrive")})()}get CWd(){return null!=this.SCe?this.SCe:this.SCe=(()=>{var Oa;return null===(Oa=this.Ga)||void 0===Oa?void 0:Oa.la("SaveAsDialogImprovementsEnabled")})()}Knc(){bd.a.Bee(Object(He.a)(this,this.YHg,"saveToCloudActionDispatcher"));bd.a.zBd([new af.a(Fd.a.saveToCloudStorage,le.a.frame,0)],this.GQe.Vjb())}ko(){const Oa=this.GQe.Vjb();Oa?(Oa.Eka(()=>{this.iOe.setResult(!0)}),this.Knc()):e.ULS.sendTraceTag(6590596,216,15,"Failure with OneDrive API download as the onedrive url received is empty ")}oyg(){e.ULS.sendTraceTag(6590597,
216,50,"User clicked on SaveToOneDrive button")}YHg(Oa,Cb,yc,Nc,Id){Nc=l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om;var ke="";switch(Oa){case Fd.a.saveToCloudStorage:ke=Ff.saveToCloudStorage;break;case Fd.a.saveACopy:ke=Ff.saveACopy;break;default:e.ULS.sendTraceTag(508372377,216,50,"SaveToCloudStorageActor Entry Point other than SaveToCloudStorage or SaveACopy")}if(Cb.contextId!==le.a.frame||Oa!==this.xAf())return 2;if(!this.xnb())return 8;if(1===
yc)return Cc.SessionStatusManager.instance.Fkb||l.AFrameworkApplication.Cga?8:32;if(2===yc){this.oyg();let Ie=Nc&&ke===Ff.saveToCloudStorage&&null===Id?{}:Id;Ie&&(Ie.SaveEntryPoint=ke);Ie&&Ie.FileDownloadUrl&&e.ULS.sendTraceTag(50708835,216,50,"SaveToCloudStorageActor FileDownloadUrl is there");this.ooj&&ke===Ff.saveACopy&&(null==Ie&&(Ie={}),Ie.showSaveAsDialog="true");this.CWd&&ke===Ff.saveACopy&&(null==Ie&&(Ie={}),Ie.sourceActionId=Oa);this.oo&&(this.Tgc=this.oo.vi("DialogShown","SaveToOneDriveReponseTime"));
this.iOe.task.continueWith(()=>{this.Tgc&&(this.Tgc.stop(),this.Tgc=null);this.toh.start(Ie)});return 32}return 8}}Object(m.a)(Gf,"SaveToCloudStorageActor",null,[838]);var lg=a(284);class Pa extends Ka.a{constructor(Oa,Cb,yc){super();this.Jbj=Nc=>{0===Nc?(e.ULS.sendTraceTag(6590598,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"User dismissed SignIn Dialog."),this.hide()):this.Eha()};this.ung=()=>{this.xt&&this.hide();e.ULS.sendTraceTag(7143885,
216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"User signed in successfully. Calling Savetocloudstorage action handler");this.$c.Gk(Fd.a.saveToCloudStorage,2)};this.$c=Oa;this.wda=Cb;this.ija=yc;this.aI=!1;this.Bh=1;this.mia(1);this.Yh(1,Object(U.a)("SignIn"));this.Yh(0,Object(U.a)("SignInToSaveDialogCancelButton"))}bU(){this.wda.Mcb(this.ung);this.Io(Object(U.a)("SignInToSaveDialogTitle"),Object(U.a)("SaveToCloudSignInDialog"),0,this.Jbj)}gSh(){let Oa=
"2";if(this.ija)switch(this.ija.Om){case 3:Oa="0";break;case 2:Oa="3";break;case 1:Oa="1"}return Oa}hide(){this.wda.X2b(this.ung);super.hide()}Eha(){var Oa=l.AFrameworkApplication.fa.la("SignInAspxInWebAppsPortalIsEnabled")?"/start/signin.aspx":"Signin.aspx";Oa=new lg.QueryStringBuilder(Oa);Oa.Kp("prompt","1");Oa.Kp("cbcxt",this.gSh());l.AFrameworkApplication.Dcb(Oa);nd.a.dm(Oa.toString(),"LoginWindow",void 0,"SignInDialog")}}Object(m.a)(Pa,"SignInDialog",Ka.a,[820]);class lc{constructor(Oa,Cb,yc){this.$c=
Oa;this.wda=Cb;this.ija=yc}create(){return new Pa(this.$c,this.wda,this.ija)}}Object(m.a)(lc,"SignInDialogFactory",null,[801]);class Gc{constructor(Oa,Cb,yc,Nc,Id,ke,Ie){this.tka=Oa;this.Fz=Cb;this.B$a=yc;this.Ija=Nc;this.Nfd=Id;this.LZ=ke;this.Tk=Ie}execute(Oa,Cb){if(!l.AFrameworkApplication.Il&&l.AFrameworkApplication.$i){var yc={"Content-Type":"application/json; charset=utf-8"};dd.a.dB("ib994913;b48ce942");var Nc=l.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseGraphFileUploaderForSkyDriveUploadHandler",
!1),Id=l.AFrameworkApplication.$i.Cca,ke=!!Id,Ie=Nc&&ke;Ie?(yc["X-UseGraphFileUploader"]="1",yc["X-AADToken"]=Id):(this.tka="/start/",this.LZ.startsWith("/start/")&&(this.LZ=this.LZ.substring(7)));e.ULS.sendTraceTag(507908319,216,50,"Use GraphFileUploader:{0}, flight enabled:{1}, token available:{2}",Ie,Nc,ke);Nc=this.tka+this.LZ;Nc=Rc.a.mr(Nc,"fo",Md.a.kl(this.Ija));Nc=Rc.a.mr(Nc,"fn",Md.a.kl(this.Fz));Nc=Rc.a.mr(Nc,"qs",Md.a.kl(this.Nfd));Nc=Rc.a.mr(Nc,"n",Md.a.kl((new Date).getTime().toString()));
this.Tk&&this.Tk.FileDownloadUrl&&(Nc=Rc.a.mr(Nc,"furl",Md.a.kl(this.Tk.FileDownloadUrl)));this.B$a&&(Nc=Rc.a.mr(Nc,"fnn",Md.a.kl(this.B$a)));l.AFrameworkApplication.$i.Ou(Nc,1,"",yc,!1,2,Oa,Cb,null)}}}Object(m.a)(Gc,"SkyDriveUploadCaller",null,[819]);class Cd{constructor(Oa){this.Ga=Oa;this.ITa=Oa.appSettings.SkyDriveUploadWebServiceBase;this.Fz=Oa.appSettings.FileName;this.LZ=Oa.Xa("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx"}create(Oa,Cb,yc){return new Gc(this.ITa,this.Fz,Cb,Oa,l.AFrameworkApplication.qo,
this.LZ,yc)}}Object(m.a)(Cd,"SkydriveUploadCallerFactory",null,[800]);class Qd{constructor(Oa,Cb,yc,Nc,Id){this.K2=this.Nu=this.XQa=null;this.yL=this.JRa=!1;this.Tk=this.Wsa=null;this.Hjd=Oa;this.wDb=Cb;this.OD=yc;this.vm=Nc;this.oo=Id;this.yL=l.AFrameworkApplication.fa?l.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OpenCopyFileInNewTabEnabled",!1):!1}b7b(){this.vm&&1===this.vm.state||(this.Nu=this.wDb(),this.Nu.message=Object(U.a)("CommentProgressTooltip"),this.Nu.Bh=
5,this.Nu.hC=!1,this.Nu.UOa(Object(U.a)("DefaultDialogTitle"),null,null))}hva(){this.Nu&&(this.Nu.close(),this.Nu=null)}S1(){1!==l.AFrameworkApplication.ra.state&&this.OD().displayError(Ud.default)}O4a(){this.yL?e.ULS.sendTraceTag(6590599,216,15,"UploadToCloudManager.RedirectToFolder: Opening Saved Document Folder URL in new tab."):e.ULS.sendTraceTag(6590599,216,50,"Redirecting to OneDrive Folder.");nd.a.dm(this.K2,nd.a.q2(this.yL?4:3),void 0,"UploadToCloudManager.RedirectToFolder")}N4a(Oa){var Cb=
null!==this.Tk&&this.Tk.hasOwnProperty("SaveEntryPoint")&&this.Tk.SaveEntryPoint.toString()===Ff.saveToCloudStorage;l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om&&Cb&&(Oa+="&wdsvodm=true");let yc=Cb=!1;l.AFrameworkApplication.fa&&(Cb=l.AFrameworkApplication.fa.la("SaveACopyIsEnabledForUiHost"),yc=l.AFrameworkApplication.fa.la("UiHostSupportsDocRebootFeatures"));e.ULS.sendTraceTag(6654163,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&
1===l.AFrameworkApplication.ra.$d.Om?15:50,"Redirecting to edit url. IsEnabledForUiHost {0}",Cb);if(Cb&&yc){e.ULS.sendTraceTag(594929733,216,50,"UploadToCloudManager.RedirectToEditUrl: Sending DocumentRefresh post message.");const Nc={};Nc[M.a.H4a]="1";Nc[M.a.documentUrl]=Oa;l.AFrameworkApplication.BI().execute(Id=>{Id.sendMessage(u.a.t4,Nc)})}else Cb=this.yL?4:3,this.yL&&e.ULS.sendTraceTag(507594583,216,15,"UploadToCloudManager.RedirectToEditUrl: Opening Saved Document URL in new tab."),nd.a.dm(Oa,
nd.a.q2(Cb),void 0,"UploadToCloudManager.RedirectToEditUrl")}Y1(Oa,Cb,yc,Nc){yc=void 0===yc?null:yc;Nc=void 0===Nc?null:Nc;e.ULS.sendTraceTag(7143886,216,50,"Starting to upload file");this.oo&&(this.Wsa=this.oo.vi("DialogShown","SaveToOneDriveUploadTime"));this.b7b();this.K2=Cb;this.XQa=this.Hjd.create(Oa,yc,Nc);this.Tk=Nc;this.U_()}U_(){e.ULS.sendTraceTag(6590600,216,50,"Calling SkydriveUploadHandler.");this.XQa.execute(Object(He.a)(this,this.dWj,"onSaveToCloudUploadFinished"),Object(He.a)(this,
this.cWj,"onSaveToCloudUploadFailed"))}dWj(Oa){this.hva();this.JRa=!1;if(Oa&&Oa.data&&Oa.data.responseData){var Cb;let yc=Bb.d(Oa.data.responseData);({hz:Cb}=yc);if(yc.returnValue)if(Oa=Cb,Oa.StatusCode!==wd.a.jN&&Oa.StatusCode!==wd.a.zWa)e.ULS.sendTraceTag(6590602,216,10,"UploadToCloudManager upload failure. Response data is not JSON."),this.S1();else{e.ULS.sendTraceTag(6590603,216,l.AFrameworkApplication.ra&&l.AFrameworkApplication.ra.$d&&1===l.AFrameworkApplication.ra.$d.Om?15:50,"UploadToCloudManager upload success.");
try{Oa.NewDocumentUrl&&""!==Oa.NewDocumentUrl?this.N4a(Oa.NewDocumentUrl):this.O4a()}catch(Nc){e.ULS.sendTraceTag(37025728,216,15,"Redirect failed with exception: {0}",Nc.toString())}this.Q0b()}else e.ULS.sendTraceTag(7660114,216,10,"Failed to deserialize : {0}",{["ResponseData"]:yf.a.n8a(Oa.data.responseData)}),this.S1()}else e.ULS.sendTraceTag(6590601,216,10,"UploadToCloudManager upload failure. Response data is null"),this.S1()}cWj(Oa){5!==Oa.data.status&&12!==Oa.data.status||this.JRa?(e.ULS.sendTraceTag(6590605,
216,10,"UploadToCloudManager HTTP failure with code: {0}",Oa.data.status),this.hva(),this.S1(),this.Q0b()):(e.ULS.sendTraceTag(6590604,216,10,"UploadToCloudManager failure. Retrying."),this.JRa=!0,this.U_())}Q0b(){this.Wsa&&(this.Wsa.stop(),this.Wsa=null)}}Object(m.a)(Qd,"UploadToCloudManager",null,[799]);class ge{constructor(Oa){this.Ga=Oa;this.tka=Oa.appSettings.SkyDriveUploadWebServiceBase;this.LZ=Oa.Xa("SkyDriveUploadHandler")||"skydriveuploadhandler.ashx";Oa.ty(()=>{this.y$g()})}get Fyb(){if(!this.Ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseODCXStackOperationManager",
!1)||!this.fEa)return!1;var Oa=this.Ga.Xa("FileSource");return!Oa||"SharePointOnlineConsumer"!=Oa&&"OneDriveWOPI"!=Oa?!1:Oa!=this.fEa||"SharePointOnlineConsumer"==Oa}get NewDocumentDestinationHost(){return"OneDriveWOPI"==this.fEa?"OneDriveWopi":"SharePointOnlineConsumer"==this.fEa?"SharePoint":l.AFrameworkApplication.qY}get PersonalFileStorageUrl(){return this.Omh}Start(Oa){Object(ce.a)().execute(Cb=>{const yc=Cb.Owd(Object(U.a)("PickerSaveACopyOkButton"),Object(U.a)("PickerSaveACopyTitle"),!1,!0,
null,"SaveACopy",0);Cb.Lyc(yc).then(Nc=>{Nc&&0<Nc.length?(e.ULS.sendTraceTag(507867474,216,50,"Got data from file picker"),Nc=Nc[0],(new $e(Oa,this.fEa,Nc.id,Nc.name,Nc.url,Nc.driveId,Nc.siteUrl,this.eah)).bU()):e.ULS.sendTraceTag(507867473,216,10,"Got null/empty data from file picker")}).catch(Nc=>{e.ULS.sendTraceTag(507867472,216,50,"File picker failed with error {0}",Nc)})})}eah(Oa,Cb,yc,Nc,Id,ke,Ie,Le){"OneDriveWOPI"==Oa?Ce().Y1(yc,Id,Cb,Le):od().Y1(Id,Cb,Ie,yc,ke,Le)}y$g(){var Oa=this.Ga.Xa("FileSource");
this.fEa=Oa;if("SharePointOnlineConsumer"==Oa||"OneDriveWOPI"==Oa){var Cb=this.Ga.Xa("LoggableUserId");if(this.Ga.Xa("LoggableOwnerId")!=Cb||"OneDriveWOPI"!=Oa){Oa=null;"MsaCid"==l.AFrameworkApplication.fa.Xa("LoggableUserIdSpace")?Oa=Cb:"Windows Live"==l.AFrameworkApplication.fa.Xa("PresenceProvider")&&(Oa=l.AFrameworkApplication.fa.Xa("PresenceUserId"));Cb=this.tka+this.LZ;var yc={};yc.Cid=Oa;l.AFrameworkApplication.$i.Ou(Cb+"?cpfsi=1",1,"",yc,!1,2,Nc=>{this.Omh=Nc.data.responseHeaders.PersonalFileStorageLocation;
this.fEa=Nc.data.responseHeaders.PersonalFileStorageHost},()=>{},null,null,!1,1E4,2E4,"CheckConvergedUserStatus",null,!1,null,["PersonalFileStorageLocation","PersonalFileStorageHost"])}}}}Object(m.a)(ge,"ODCXStackOperationManager",null,[]);class ye{static get Po(){return B.a.UA(ye.$v,Object(U.a)("SaveACopyFileName"))}}ye.$v="<div class='WACDialogRow' id='DocumentFolderBlock'> <label id='lblFolderName' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div>";
Object(m.a)(ye,"FileNameDialogHtml",null,[]);class $e extends B.a{constructor(Oa,Cb,yc,Nc,Id,ke,Ie,Le){super();this.Ija=this.K2=null;this.Yh(1,Object(U.a)("SaveButtonLabel"));this.Po=ye.Po;this.Lk="FileNameDialog-SaveACopy";this.Tk=Oa;this.fEa=Cb;this.nN=Le;this.Ija=yc;this.K2=Id;this.Whd=Ie;this.ZIe=Nc;this.scc=ke}bU(){const Oa={["txtFileName"]:Md.a.kz(l.AFrameworkApplication.Qt.ov),["lblFolderName"]:String.format(Object(U.a)("DestinationFolder"),this.ZIe)};this.initializeAndShow(Object(U.a)("SaveToOneDrive"),
Object(He.a)(this,this.PNb,"fileNameDialogHandler"),Oa);e.ULS.sendTraceTag(507867471,216,50,"The file name dialog is initialized and shown.");document.getElementById("txtFileName").focus()}PNb(Oa,Cb){1!==Oa?e.ULS.sendTraceTag(507867470,216,50,"User clicked cancel to cancel upload file in file name dialog."):(Oa=Cb.txtFileName.trim(),e.ULS.sendTraceTag(507867469,216,50,"User clicked save to upload file with new name."),Cb=Md.a.H$(l.AFrameworkApplication.fileName),Oa&&""!==Oa&&""!==Cb&&(Oa+=Cb),this.nN(this.fEa,
Oa,this.Ija,this.ZIe,this.K2,this.scc,this.Whd,this.Tk))}}Object(m.a)($e,"FileNameDialog",B.a,[]);class qf{constructor(){this.Mh=null}get name(){return"Common.App.SaveToCloudStorage"}init(){l.AFrameworkApplication.fa.la("SaveToCloudStorageUIIsEnabled")&&Td.a.instance.resolve("Common.App.SaveToCloudStorage.SaveToCloudStorageActor").ko()}dispose(){}ao(Oa){this.Mh=Oa;this.Mh.register(lc,"Common.App.SaveToCloudStorage.SignInDialogFactory").as("Common.App.SaveToCloudStorage.ISignInDialogFactory").mi(()=>
new lc(l.AFrameworkApplication.jh,Ed.a.instance,l.AFrameworkApplication.ra.$d)).hi();this.Mh.register(Cd,"Common.App.SaveToCloudStorage.SkydriveUploadCallerFactory").as("Common.App.SaveToCloudStorage.ISkydriveUploadCallerFactory").mi(()=>new Cd(l.AFrameworkApplication.fa)).hi();this.Mh.register(Gf,"Common.App.SaveToCloudStorage.SaveToCloudStorageActor").mi(()=>new Gf(Td.a.instance.resolve("Common.App.SaveToCloudStorage.SaveToCloudManager"),jf(),l.AFrameworkApplication.fa,l.AFrameworkApplication.ra.cL)).hi();
this.Mh.register(Qd,"Common.App.SaveToCloudStorage.UploadToCloudManager").mi(()=>new Qd(of(),()=>(new If.a).create(),()=>new bf,l.AFrameworkApplication.ra,l.AFrameworkApplication.ra.cL)).hi();this.Mh.register(Uf,"Common.App.SaveToCloudStorage.SaveToCloudManager").mi(()=>new Uf(Se(),Ed.a.instance,Ce(),l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,()=>new bf,ue())).hi();this.Mh.register(ge,"Common.App.SaveToCloudStorage.ODCXStackOperationManager").mi(()=>new ge(l.AFrameworkApplication.fa)).hi()}static main(){Tc.a.instance.Lo(new qf)}}
Object(m.a)(qf,"PackageManager",null,[12,13]);class h{static get Po(){return B.a.UA(h.$v,Object(U.a)("SaveACopyFileName"))}}h.$v="<div class='WACDialogRow' id='DocumentFolderBlock'> <label id='lblFolderName' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRow' id='DocumentNameBlock'> <label id='lblFileName' class='WACDialogLabel' for='txtFileName' >{0}</label> <input type='text' id='txtFileName' class='WACDialogInput' autocomplete=\"off\"/> </div>";Object(m.a)(h,"FileNameDialogHtml",
null,[]);class Z extends B.a{constructor(Oa,Cb,yc,Nc){super();this.Ija=this.K2=null;this.$c=Oa;this.ija=Cb;this.Xsa=yc;this.Yh(1,Object(U.a)("SaveButtonLabel"));this.Po=h.Po;this.Lk="FileNameDialog-SaveACopy";this.Tk=Nc}bU(Oa,Cb,yc){this.Ija=Oa;this.K2=yc;Oa={["txtFileName"]:Md.a.kz(l.AFrameworkApplication.Qt.ov),["lblFolderName"]:String.format(Object(U.a)("DestinationFolder"),Cb)};this.initializeAndShow(Object(U.a)("SaveToOneDrive"),Object(He.a)(this,this.PNb,"fileNameDialogHandler"),Oa);e.ULS.sendTraceTag(7174148,
216,50,"The file name dialog is initialized and shown.");document.getElementById("txtFileName").focus()}PNb(Oa,Cb){1!==Oa?e.ULS.sendTraceTag(7165650,216,50,"User click cancel to cancel upload file in file name dialog."):(Oa=Cb.txtFileName.trim(),e.ULS.sendTraceTag(7165651,216,50,"User click save to upload file with new name."),Cb=Md.a.H$(l.AFrameworkApplication.fileName),Oa&&""!==Oa&&""!==Cb&&(Oa+=Cb),this.Xsa.Y1(this.Ija,this.K2,Oa,this.Tk))}}Object(m.a)(Z,"FileNameDialog",B.a,[846]);class E{constructor(Oa,
Cb,yc){this.$c=Oa;this.ija=Cb;this.Xsa=yc}create(Oa){return new Z(this.$c,this.ija,this.Xsa,Oa)}}Object(m.a)(E,"FileNameDialogFactory",null,[834]);class aa extends Ka.a{constructor(Oa){super();this.gje=Cb=>{1===Cb?(e.ULS.sendTraceTag(7165653,216,50,"User click to retry the action."),this.$c.Gk(Fd.a.saveACopy,2)):e.ULS.sendTraceTag(7165654,216,50,"User cancel the error dialog.")};this.Bh=1;this.Yh(1,Object(U.a)("RetryButtonLabel"));this.Yh(0,Object(U.a)("DialogClose"));this.$c=Oa}displayError(Oa){e.ULS.sendTraceTag(7165652,
216,50,"Show error dialog here {0}.",Oa);this.jG(Oa,Object(U.a)("DefaultDialogTitle"),Object(U.a)("ErrorSavingToOneDrive"),this.gje)}}Object(m.a)(aa,"RetryDialog",Ka.a,[802]);class Ja extends Gf{constructor(Oa,Cb,yc,Nc){super(Oa,Cb,yc,Nc);this.mmh=Cb}xnb(){return this.Ga.la("SaveACopyBrsIsEnabled")}xAf(){return Fd.a.saveACopy}Knc(){bd.a.Bee(Object(He.a)(this,this.YHg,"saveToCloudActionDispatcher"));bd.a.zBd([new af.a(Fd.a.saveACopy,le.a.frame,0)],this.mmh.Vjb())}oyg(){dd.a.dB("CreateCopy_cf;CreateCopy_tf");
e.ULS.sendTraceTag(7205456,216,50,"User clicked on SaveAs button from the backstage.")}}Object(m.a)(Ja,"SaveACopyActor",Gf,[]);class tb extends Uf{constructor(Oa,Cb,yc,Nc,Id,ke,Ie,Le){super(Cb,yc,Nc,Id,ke,Ie,Le);this.yhh=Oa}f1(Oa){Oa&&Oa.data&&Oa.data.folders?(e.ULS.sendTraceTag(7165655,216,50,"User selected which folder to upload file to."),this.yhh.create(this.Tk).bU(Oa.data.folders[0].id,Oa.data.folders[0].name,Oa.data.folders[0].urls.viewInBrowser)):(e.ULS.sendTraceTag(7165656,216,10,"Fail to select folder to upload file."),
this.lp())}pha(Oa){Oa&&Oa.error&&"user_canceled"===Oa.error.code&&e.ULS.sendTraceTag(7205457,216,50,"User cancelled upload to their OneDrive in Save A Copy.");super.pha(Oa)}lp(){e.ULS.sendTraceTag(7205458,216,50,"Error occur in Save A Copy Manager.");super.lp()}}Object(m.a)(tb,"SaveACopyManager",Uf,[]);class S extends Qd{constructor(Oa,Cb,yc,Nc,Id,ke){super(Cb,yc,Nc,Id,ke);this.$c=Oa}BWd(){return!!this.Tk&&!!this.Tk.SaveEntryPoint&&"VersionHistory"===this.Tk.SaveEntryPoint.toString()}S1(){e.ULS.sendTraceTag(7205459,
216,50,"Display Error for Save A Copy.");this.BWd()&&this.$c.Xj(Fd.a.The,2,{["FailureReason"]:"Unknown"});super.S1()}O4a(){e.ULS.sendTraceTag(7205460,216,50,"Redirecting to OneDrive Folder for Save A Copy.");this.BWd()&&this.$c.Gk(Fd.a.DTc,2);super.O4a()}N4a(Oa){e.ULS.sendTraceTag(7205461,216,50,"Redirecting to edit url for Save A Copy.");this.BWd()&&this.$c.Gk(Fd.a.DTc,2);super.N4a(Oa)}U_(){this.Tk&&"true"===this.Tk.SkipSaveToHost?super.U_():32!==this.$c.Gk(Fd.a.oAa,1)?(e.ULS.sendTraceTag(8741711,
216,15,"The save file change is not supported, this operation may result in data loss"),super.U_()):this.$c.Xj(Fd.a.oAa,2,[()=>{e.ULS.sendTraceTag(8741712,216,50,"Call the force save file change successfully.");Qd.prototype.U_.call(this)},()=>{e.ULS.sendTraceTag(8741713,216,15,"The file change is not saved successfully, this operation may lead to data loss.");this.S1()}])}}Object(m.a)(S,"SaveACopyUploadToCloudManager",Qd,[]);class Wa extends Ka.a{constructor(){super();this.VLb=480;this.Bh=0;this.Yh(1,
Object(U.a)("DialogGotit"));this.maxWidth=this.VLb}displayError(Oa){e.ULS.sendTraceTag(507393931,216,50,"Show error dialog, errorCode - {0}.",Oa);this.Io(Object(U.a)("CopyFailedDialogTitle"),Object(U.a)("CopyFailedDialogDescription"),2)}}Object(m.a)(Wa,"ErrorDialog",Ka.a,[802]);class zb{constructor(){this.Mh=null;this.CK=()=>{l.AFrameworkApplication.fa.la("SaveACopyBrsIsEnabled")&&Td.a.instance.resolve("Common.App.SaveACopy.SaveACopyActor").ko()}}get name(){return"Common.App.SaveACopy"}init(){l.AFrameworkApplication.fa.ty(this.CK)}dispose(){}ao(Oa){this.Mh=
Oa;this.Mh.register(S,"Common.App.SaveACopy.SaveACopyUploadToCloudManager").mi(()=>{var Cb;return new S(l.AFrameworkApplication.jh,of(),()=>(new If.a).create(),(null===(Cb=l.AFrameworkApplication.fa)||void 0===Cb?0:Cb.la("SaveAsDialogImprovementsEnabled"))?()=>new Wa:()=>new aa(l.AFrameworkApplication.jh),l.AFrameworkApplication.ra,l.AFrameworkApplication.ra.cL)}).hi();this.Mh.register(E,"Common.App.SaveACopy.FileNameDialogFactory").as("Common.App.SaveACopy.IFileNameDialogFactory").mi(()=>new E(l.AFrameworkApplication.jh,
l.AFrameworkApplication.ra.$d,me())).hi();this.Mh.register(Ja,"Common.App.SaveACopy.SaveACopyActor").mi(()=>new Ja(Td.a.instance.resolve("Common.App.SaveACopy.SaveACopyManager"),jf(),l.AFrameworkApplication.fa,l.AFrameworkApplication.ra.cL)).hi();this.Mh.register(tb,"Common.App.SaveACopy.SaveACopyManager").mi(()=>{var Cb;return new tb(Td.a.instance.resolve("Common.App.SaveACopy.FileNameDialogFactory"),Se(),Ed.a.instance,me(),l.AFrameworkApplication.fa,l.AFrameworkApplication.uva,(null===(Cb=l.AFrameworkApplication.fa)||
void 0===Cb?0:Cb.la("SaveAsDialogImprovementsEnabled"))?()=>new Wa:()=>new aa(l.AFrameworkApplication.jh),ue())}).hi()}static main(){Tc.a.instance.Lo(new zb)}}Object(m.a)(zb,"PackageManager",null,[12,13]);var hc=a(9),cd=a(894),ta=a(197);class wb extends cd.a{constructor(Oa){super(Oa)}Qs(){const Oa=this.$,Cb=[],yc=Object(ra.d)(Ya.a.resolve(bb.je,{va:this.hh}));Cb.push(yc);const Nc=Object(ra.d)(Ya.a.resolve(bb.C,{va:this.hh}));Cb.push(Nc);Da.TaskExtensions.Ua(gb.Task.XP(...Cb),()=>{ta.b(yc)&&this.cr([new sb(Oa,
yc.result,null,Nc.result,new md.a(()=>bb.id.Ha()?Object(ra.d)(Ya.a.resolve(bb.id,{va:this.hh})):lb.GetServiceTaskFactory.create(Oa.ka,137,this.xa,this.hh)))])},this.xa,0)}static Aa(Oa){cd.a.sx(94,new wb(Oa))}}Object(m.a)(wb,"FileOperationsCommandHandlerFactory",cd.a,[]);class ic extends cd.a{constructor(Oa){super(Oa);this.YFd=(Cb,yc,Nc,Id,ke)=>1===Nc?32:Cb===Fd.a.oAa&&2===Nc?(Cb=this.$.pa.ta.Jh(),Ea.D(this.$.pa.ta,ke[0],ke[1],null,null,Cb),32):8}Qs(){Da.TaskExtensions.Ua(Object(ra.d)(Ya.a.resolve(bb.ab,
{va:this.hh})),()=>{this.cr([new dc(this.$,l.AFrameworkApplication.jh,null)])},this.xa,3);l.AFrameworkApplication.jh.Hh(Fd.a.oAa,le.a.frame,this.YFd)}static Aa(Oa){cd.a.sx(267,new ic(Oa))}}Object(m.a)(ic,"SaveToHostCommandHandlerFactory",cd.a,[]);Type.registerNamespace("Common.App.OneDriveFilePickerApi");Rd.main();Type.registerNamespace("Common.App.SaveAsToHost");cf.main();Type.registerNamespace("Common.App.SaveToSharePoint");Gd.main();Type.registerNamespace("Common.App.SaveToCloudStorage");qf.main();
Type.registerNamespace("Common.App.SaveACopy");zb.main();(()=>{hc.a.Qg(Oa=>{bb.ec.Ha()||wb.Aa(Oa)})})();(()=>{hc.a.Qg(Oa=>{bb.lf.Ha()||ic.Aa(Oa)})})();(()=>{hc.a.Qg(Oa=>{bb.Bf.Ha()?yd():vb.Aa(Oa)})})();String(c);String(b);String(f);String(r);String(d);String(k);window.___1708742503445_closurehack=c;window.___1708742503445_closurehack=b;window.___1708742503445_closurehack=f;window.___1708742503445_closurehack=r;window.___1708742503445_closurehack=d;window.___1708742503445_closurehack=k}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.fim.js.map/1d91359a4904cd03fafa558c111ddd60/EwaTS.fim.js.map